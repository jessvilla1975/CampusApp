var GF=Object.create;var Y1=Object.defineProperty,HF=Object.defineProperties,qF=Object.getOwnPropertyDescriptor,WF=Object.getOwnPropertyDescriptors,ZF=Object.getOwnPropertyNames,Cy=Object.getOwnPropertySymbols,XF=Object.getPrototypeOf,J1=Object.prototype.hasOwnProperty,tI=Object.prototype.propertyIsEnumerable;var eI=(i,s,a)=>s in i?Y1(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,Mt=(i,s)=>{for(var a in s||={})J1.call(s,a)&&eI(i,a,s[a]);if(Cy)for(var a of Cy(s))tI.call(s,a)&&eI(i,a,s[a]);return i},ei=(i,s)=>HF(i,WF(s));var Ey=(i,s)=>{var a={};for(var f in i)J1.call(i,f)&&s.indexOf(f)<0&&(a[f]=i[f]);if(i!=null&&Cy)for(var f of Cy(i))s.indexOf(f)<0&&tI.call(i,f)&&(a[f]=i[f]);return a};var YF=(i,s)=>()=>(s||i((s={exports:{}}).exports,s),s.exports);var JF=(i,s,a,f)=>{if(s&&typeof s=="object"||typeof s=="function")for(let x of ZF(s))!J1.call(i,x)&&x!==a&&Y1(i,x,{get:()=>s[x],enumerable:!(f=qF(s,x))||f.enumerable});return i};var nI=(i,s,a)=>(a=i!=null?GF(XF(i)):{},JF(s||!i||!i.__esModule?Y1(a,"default",{value:i,enumerable:!0}):a,i));var vh=(i,s,a)=>new Promise((f,x)=>{var n=G=>{try{$(a.next(G))}catch(se){x(se)}},R=G=>{try{$(a.throw(G))}catch(se){x(se)}},$=G=>G.done?f(G.value):Promise.resolve(G.value).then(n,R);$((a=a.apply(i,s)).next())});var LE=YF((RE,OE)=>{"use strict";(function(i,s){typeof RE=="object"&&typeof OE<"u"?OE.exports=s():typeof define=="function"&&define.amd?define(s):(i=typeof globalThis<"u"?globalThis:i||self,i.mapboxgl=s())})(RE,function(){"use strict";var i,s,a;function f(n,R){if(!i)i=R;else if(!s)s=R;else{var $="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",G={};i(G),a=R(G),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}f(["exports"],function(n){function R(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var $,G={},se={};function Me(){if($)return se;$=1,Object.defineProperty(se,"__esModule",{value:!0}),se.setMatrixArrayType=function(p){se.ARRAY_TYPE=e=p},se.toRadian=function(p){return p*c},se.equals=function(p,u){return Math.abs(p-u)<=l*Math.max(1,Math.abs(p),Math.abs(u))},se.RANDOM=se.ARRAY_TYPE=se.EPSILON=void 0;var l=1e-6;se.EPSILON=l;var e=typeof Float32Array<"u"?Float32Array:Array;se.ARRAY_TYPE=e;var r=Math.random;se.RANDOM=r;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,u=arguments.length;u--;)p+=arguments[u]*arguments[u];return Math.sqrt(p)}),se}var ke,tt={};function Ye(){if(ke)return tt;function l(u){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(u)}ke=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.create=function(){var u=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},tt.clone=function(u){var m=new e.ARRAY_TYPE(4);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m},tt.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u},tt.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u},tt.fromValues=function(u,m,v,E){var T=new e.ARRAY_TYPE(4);return T[0]=u,T[1]=m,T[2]=v,T[3]=E,T},tt.set=function(u,m,v,E,T){return u[0]=m,u[1]=v,u[2]=E,u[3]=T,u},tt.transpose=function(u,m){if(u===m){var v=m[1];u[1]=m[2],u[2]=v}else u[0]=m[0],u[1]=m[2],u[2]=m[1],u[3]=m[3];return u},tt.invert=function(u,m){var v=m[0],E=m[1],T=m[2],_=m[3],C=v*_-T*E;return C?(u[0]=_*(C=1/C),u[1]=-E*C,u[2]=-T*C,u[3]=v*C,u):null},tt.adjoint=function(u,m){var v=m[0];return u[0]=m[3],u[1]=-m[1],u[2]=-m[2],u[3]=v,u},tt.determinant=function(u){return u[0]*u[3]-u[2]*u[1]},tt.multiply=c,tt.rotate=function(u,m,v){var E=m[0],T=m[1],_=m[2],C=m[3],S=Math.sin(v),w=Math.cos(v);return u[0]=E*w+_*S,u[1]=T*w+C*S,u[2]=E*-S+_*w,u[3]=T*-S+C*w,u},tt.scale=function(u,m,v){var E=m[1],T=m[2],_=m[3],C=v[0],S=v[1];return u[0]=m[0]*C,u[1]=E*C,u[2]=T*S,u[3]=_*S,u},tt.fromRotation=function(u,m){var v=Math.sin(m),E=Math.cos(m);return u[0]=E,u[1]=v,u[2]=-v,u[3]=E,u},tt.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u},tt.str=function(u){return"mat2("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")"},tt.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},tt.LDU=function(u,m,v,E){return u[2]=E[2]/E[0],v[0]=E[0],v[1]=E[1],v[3]=E[3]-u[2]*v[1],[u,m,v]},tt.add=function(u,m,v){return u[0]=m[0]+v[0],u[1]=m[1]+v[1],u[2]=m[2]+v[2],u[3]=m[3]+v[3],u},tt.subtract=p,tt.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]},tt.equals=function(u,m){var v=u[0],E=u[1],T=u[2],_=u[3],C=m[0],S=m[1],w=m[2],M=m[3];return Math.abs(v-C)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(C))&&Math.abs(E-S)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(S))&&Math.abs(T-w)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(w))&&Math.abs(_-M)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(M))},tt.multiplyScalar=function(u,m,v){return u[0]=m[0]*v,u[1]=m[1]*v,u[2]=m[2]*v,u[3]=m[3]*v,u},tt.multiplyScalarAndAdd=function(u,m,v,E){return u[0]=m[0]+v[0]*E,u[1]=m[1]+v[1]*E,u[2]=m[2]+v[2]*E,u[3]=m[3]+v[3]*E,u},tt.sub=tt.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||l(u)!=="object"&&typeof u!="function")return{default:u};var v=r(void 0);if(v&&v.has(u))return v.get(u);var E={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var C=T?Object.getOwnPropertyDescriptor(u,_):null;C&&(C.get||C.set)?Object.defineProperty(E,_,C):E[_]=u[_]}return E.default=u,v&&v.set(u,E),E}(Me());function r(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,v=new WeakMap;return(r=function(E){return E?v:m})(u)}function c(u,m,v){var E=m[0],T=m[1],_=m[2],C=m[3],S=v[0],w=v[1],M=v[2],D=v[3];return u[0]=E*S+_*w,u[1]=T*S+C*w,u[2]=E*M+_*D,u[3]=T*M+C*D,u}function p(u,m,v){return u[0]=m[0]-v[0],u[1]=m[1]-v[1],u[2]=m[2]-v[2],u[3]=m[3]-v[3],u}return tt.mul=c,tt.sub=p,tt}var wt,mt={};function Ht(){if(wt)return mt;function l(u){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(u)}wt=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var u=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[4]=0,u[5]=0),u[0]=1,u[3]=1,u},mt.clone=function(u){var m=new e.ARRAY_TYPE(6);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m},mt.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u},mt.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=0,u[5]=0,u},mt.fromValues=function(u,m,v,E,T,_){var C=new e.ARRAY_TYPE(6);return C[0]=u,C[1]=m,C[2]=v,C[3]=E,C[4]=T,C[5]=_,C},mt.set=function(u,m,v,E,T,_,C){return u[0]=m,u[1]=v,u[2]=E,u[3]=T,u[4]=_,u[5]=C,u},mt.invert=function(u,m){var v=m[0],E=m[1],T=m[2],_=m[3],C=m[4],S=m[5],w=v*_-E*T;return w?(u[0]=_*(w=1/w),u[1]=-E*w,u[2]=-T*w,u[3]=v*w,u[4]=(T*S-_*C)*w,u[5]=(E*C-v*S)*w,u):null},mt.determinant=function(u){return u[0]*u[3]-u[1]*u[2]},mt.multiply=c,mt.rotate=function(u,m,v){var E=m[0],T=m[1],_=m[2],C=m[3],S=m[4],w=m[5],M=Math.sin(v),D=Math.cos(v);return u[0]=E*D+_*M,u[1]=T*D+C*M,u[2]=E*-M+_*D,u[3]=T*-M+C*D,u[4]=S,u[5]=w,u},mt.scale=function(u,m,v){var E=m[1],T=m[2],_=m[3],C=m[4],S=m[5],w=v[0],M=v[1];return u[0]=m[0]*w,u[1]=E*w,u[2]=T*M,u[3]=_*M,u[4]=C,u[5]=S,u},mt.translate=function(u,m,v){var E=m[0],T=m[1],_=m[2],C=m[3],S=m[4],w=m[5],M=v[0],D=v[1];return u[0]=E,u[1]=T,u[2]=_,u[3]=C,u[4]=E*M+_*D+S,u[5]=T*M+C*D+w,u},mt.fromRotation=function(u,m){var v=Math.sin(m),E=Math.cos(m);return u[0]=E,u[1]=v,u[2]=-v,u[3]=E,u[4]=0,u[5]=0,u},mt.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u[4]=0,u[5]=0,u},mt.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=m[0],u[5]=m[1],u},mt.str=function(u){return"mat2d("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+")"},mt.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],1)},mt.add=function(u,m,v){return u[0]=m[0]+v[0],u[1]=m[1]+v[1],u[2]=m[2]+v[2],u[3]=m[3]+v[3],u[4]=m[4]+v[4],u[5]=m[5]+v[5],u},mt.subtract=p,mt.multiplyScalar=function(u,m,v){return u[0]=m[0]*v,u[1]=m[1]*v,u[2]=m[2]*v,u[3]=m[3]*v,u[4]=m[4]*v,u[5]=m[5]*v,u},mt.multiplyScalarAndAdd=function(u,m,v,E){return u[0]=m[0]+v[0]*E,u[1]=m[1]+v[1]*E,u[2]=m[2]+v[2]*E,u[3]=m[3]+v[3]*E,u[4]=m[4]+v[4]*E,u[5]=m[5]+v[5]*E,u},mt.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]},mt.equals=function(u,m){var v=u[0],E=u[1],T=u[2],_=u[3],C=u[4],S=u[5],w=m[0],M=m[1],D=m[2],L=m[3],F=m[4],B=m[5];return Math.abs(v-w)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(w))&&Math.abs(E-M)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(T-D)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(D))&&Math.abs(_-L)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(C-F)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(F))&&Math.abs(S-B)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(B))},mt.sub=mt.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||l(u)!=="object"&&typeof u!="function")return{default:u};var v=r(void 0);if(v&&v.has(u))return v.get(u);var E={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var C=T?Object.getOwnPropertyDescriptor(u,_):null;C&&(C.get||C.set)?Object.defineProperty(E,_,C):E[_]=u[_]}return E.default=u,v&&v.set(u,E),E}(Me());function r(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,v=new WeakMap;return(r=function(E){return E?v:m})(u)}function c(u,m,v){var E=m[0],T=m[1],_=m[2],C=m[3],S=m[4],w=m[5],M=v[0],D=v[1],L=v[2],F=v[3],B=v[4],V=v[5];return u[0]=E*M+_*D,u[1]=T*M+C*D,u[2]=E*L+_*F,u[3]=T*L+C*F,u[4]=E*B+_*V+S,u[5]=T*B+C*V+w,u}function p(u,m,v){return u[0]=m[0]-v[0],u[1]=m[1]-v[1],u[2]=m[2]-v[2],u[3]=m[3]-v[3],u[4]=m[4]-v[4],u[5]=m[5]-v[5],u}return mt.mul=c,mt.sub=p,mt}var _n,Ut={};function Ln(){if(_n)return Ut;function l(u){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(u)}_n=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.create=function(){var u=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u},Ut.fromMat4=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[4],u[4]=m[5],u[5]=m[6],u[6]=m[8],u[7]=m[9],u[8]=m[10],u},Ut.clone=function(u){var m=new e.ARRAY_TYPE(9);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m[6]=u[6],m[7]=u[7],m[8]=u[8],m},Ut.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},Ut.fromValues=function(u,m,v,E,T,_,C,S,w){var M=new e.ARRAY_TYPE(9);return M[0]=u,M[1]=m,M[2]=v,M[3]=E,M[4]=T,M[5]=_,M[6]=C,M[7]=S,M[8]=w,M},Ut.set=function(u,m,v,E,T,_,C,S,w,M){return u[0]=m,u[1]=v,u[2]=E,u[3]=T,u[4]=_,u[5]=C,u[6]=S,u[7]=w,u[8]=M,u},Ut.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ut.transpose=function(u,m){if(u===m){var v=m[1],E=m[2],T=m[5];u[1]=m[3],u[2]=m[6],u[3]=v,u[5]=m[7],u[6]=E,u[7]=T}else u[0]=m[0],u[1]=m[3],u[2]=m[6],u[3]=m[1],u[4]=m[4],u[5]=m[7],u[6]=m[2],u[7]=m[5],u[8]=m[8];return u},Ut.invert=function(u,m){var v=m[0],E=m[1],T=m[2],_=m[3],C=m[4],S=m[5],w=m[6],M=m[7],D=m[8],L=D*C-S*M,F=-D*_+S*w,B=M*_-C*w,V=v*L+E*F+T*B;return V?(u[0]=L*(V=1/V),u[1]=(-D*E+T*M)*V,u[2]=(S*E-T*C)*V,u[3]=F*V,u[4]=(D*v-T*w)*V,u[5]=(-S*v+T*_)*V,u[6]=B*V,u[7]=(-M*v+E*w)*V,u[8]=(C*v-E*_)*V,u):null},Ut.adjoint=function(u,m){var v=m[0],E=m[1],T=m[2],_=m[3],C=m[4],S=m[5],w=m[6],M=m[7],D=m[8];return u[0]=C*D-S*M,u[1]=T*M-E*D,u[2]=E*S-T*C,u[3]=S*w-_*D,u[4]=v*D-T*w,u[5]=T*_-v*S,u[6]=_*M-C*w,u[7]=E*w-v*M,u[8]=v*C-E*_,u},Ut.determinant=function(u){var m=u[3],v=u[4],E=u[5],T=u[6],_=u[7],C=u[8];return u[0]*(C*v-E*_)+u[1]*(-C*m+E*T)+u[2]*(_*m-v*T)},Ut.multiply=c,Ut.translate=function(u,m,v){var E=m[0],T=m[1],_=m[2],C=m[3],S=m[4],w=m[5],M=m[6],D=m[7],L=m[8],F=v[0],B=v[1];return u[0]=E,u[1]=T,u[2]=_,u[3]=C,u[4]=S,u[5]=w,u[6]=F*E+B*C+M,u[7]=F*T+B*S+D,u[8]=F*_+B*w+L,u},Ut.rotate=function(u,m,v){var E=m[0],T=m[1],_=m[2],C=m[3],S=m[4],w=m[5],M=m[6],D=m[7],L=m[8],F=Math.sin(v),B=Math.cos(v);return u[0]=B*E+F*C,u[1]=B*T+F*S,u[2]=B*_+F*w,u[3]=B*C-F*E,u[4]=B*S-F*T,u[5]=B*w-F*_,u[6]=M,u[7]=D,u[8]=L,u},Ut.scale=function(u,m,v){var E=v[0],T=v[1];return u[0]=E*m[0],u[1]=E*m[1],u[2]=E*m[2],u[3]=T*m[3],u[4]=T*m[4],u[5]=T*m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},Ut.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=m[0],u[7]=m[1],u[8]=1,u},Ut.fromRotation=function(u,m){var v=Math.sin(m),E=Math.cos(m);return u[0]=E,u[1]=v,u[2]=0,u[3]=-v,u[4]=E,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ut.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=0,u[4]=m[1],u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},Ut.fromMat2d=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=0,u[3]=m[2],u[4]=m[3],u[5]=0,u[6]=m[4],u[7]=m[5],u[8]=1,u},Ut.fromQuat=function(u,m){var v=m[0],E=m[1],T=m[2],_=m[3],C=v+v,S=E+E,w=T+T,M=v*C,D=E*C,L=E*S,F=T*C,B=T*S,V=T*w,N=_*C,U=_*S,H=_*w;return u[0]=1-L-V,u[3]=D-H,u[6]=F+U,u[1]=D+H,u[4]=1-M-V,u[7]=B-N,u[2]=F-U,u[5]=B+N,u[8]=1-M-L,u},Ut.normalFromMat4=function(u,m){var v=m[0],E=m[1],T=m[2],_=m[3],C=m[4],S=m[5],w=m[6],M=m[7],D=m[8],L=m[9],F=m[10],B=m[11],V=m[12],N=m[13],U=m[14],H=m[15],J=v*S-E*C,oe=v*w-T*C,ee=v*M-_*C,ne=E*w-T*S,ge=E*M-_*S,te=T*M-_*w,pe=D*N-L*V,xe=D*U-F*V,be=D*H-B*V,Se=L*U-F*N,Re=L*H-B*N,Le=F*H-B*U,De=J*Le-oe*Re+ee*Se+ne*be-ge*xe+te*pe;return De?(u[0]=(S*Le-w*Re+M*Se)*(De=1/De),u[1]=(w*be-C*Le-M*xe)*De,u[2]=(C*Re-S*be+M*pe)*De,u[3]=(T*Re-E*Le-_*Se)*De,u[4]=(v*Le-T*be+_*xe)*De,u[5]=(E*be-v*Re-_*pe)*De,u[6]=(N*te-U*ge+H*ne)*De,u[7]=(U*ee-V*te-H*oe)*De,u[8]=(V*ge-N*ee+H*J)*De,u):null},Ut.projection=function(u,m,v){return u[0]=2/m,u[1]=0,u[2]=0,u[3]=0,u[4]=-2/v,u[5]=0,u[6]=-1,u[7]=1,u[8]=1,u},Ut.str=function(u){return"mat3("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+", "+u[6]+", "+u[7]+", "+u[8]+")"},Ut.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8])},Ut.add=function(u,m,v){return u[0]=m[0]+v[0],u[1]=m[1]+v[1],u[2]=m[2]+v[2],u[3]=m[3]+v[3],u[4]=m[4]+v[4],u[5]=m[5]+v[5],u[6]=m[6]+v[6],u[7]=m[7]+v[7],u[8]=m[8]+v[8],u},Ut.subtract=p,Ut.multiplyScalar=function(u,m,v){return u[0]=m[0]*v,u[1]=m[1]*v,u[2]=m[2]*v,u[3]=m[3]*v,u[4]=m[4]*v,u[5]=m[5]*v,u[6]=m[6]*v,u[7]=m[7]*v,u[8]=m[8]*v,u},Ut.multiplyScalarAndAdd=function(u,m,v,E){return u[0]=m[0]+v[0]*E,u[1]=m[1]+v[1]*E,u[2]=m[2]+v[2]*E,u[3]=m[3]+v[3]*E,u[4]=m[4]+v[4]*E,u[5]=m[5]+v[5]*E,u[6]=m[6]+v[6]*E,u[7]=m[7]+v[7]*E,u[8]=m[8]+v[8]*E,u},Ut.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]&&u[6]===m[6]&&u[7]===m[7]&&u[8]===m[8]},Ut.equals=function(u,m){var v=u[0],E=u[1],T=u[2],_=u[3],C=u[4],S=u[5],w=u[6],M=u[7],D=u[8],L=m[0],F=m[1],B=m[2],V=m[3],N=m[4],U=m[5],H=m[6],J=m[7],oe=m[8];return Math.abs(v-L)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(E-F)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(F))&&Math.abs(T-B)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(B))&&Math.abs(_-V)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(C-N)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(N))&&Math.abs(S-U)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(w-H)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(H))&&Math.abs(M-J)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(J))&&Math.abs(D-oe)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(oe))},Ut.sub=Ut.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||l(u)!=="object"&&typeof u!="function")return{default:u};var v=r(void 0);if(v&&v.has(u))return v.get(u);var E={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var C=T?Object.getOwnPropertyDescriptor(u,_):null;C&&(C.get||C.set)?Object.defineProperty(E,_,C):E[_]=u[_]}return E.default=u,v&&v.set(u,E),E}(Me());function r(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,v=new WeakMap;return(r=function(E){return E?v:m})(u)}function c(u,m,v){var E=m[0],T=m[1],_=m[2],C=m[3],S=m[4],w=m[5],M=m[6],D=m[7],L=m[8],F=v[0],B=v[1],V=v[2],N=v[3],U=v[4],H=v[5],J=v[6],oe=v[7],ee=v[8];return u[0]=F*E+B*C+V*M,u[1]=F*T+B*S+V*D,u[2]=F*_+B*w+V*L,u[3]=N*E+U*C+H*M,u[4]=N*T+U*S+H*D,u[5]=N*_+U*w+H*L,u[6]=J*E+oe*C+ee*M,u[7]=J*T+oe*S+ee*D,u[8]=J*_+oe*w+ee*L,u}function p(u,m,v){return u[0]=m[0]-v[0],u[1]=m[1]-v[1],u[2]=m[2]-v[2],u[3]=m[3]-v[3],u[4]=m[4]-v[4],u[5]=m[5]-v[5],u[6]=m[6]-v[6],u[7]=m[7]-v[7],u[8]=m[8]-v[8],u}return Ut.mul=c,Ut.sub=p,Ut}var mi,Pt={};function xi(){if(mi)return Pt;function l(_){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},l(_)}mi=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},Pt.clone=function(_){var C=new e.ARRAY_TYPE(16);return C[0]=_[0],C[1]=_[1],C[2]=_[2],C[3]=_[3],C[4]=_[4],C[5]=_[5],C[6]=_[6],C[7]=_[7],C[8]=_[8],C[9]=_[9],C[10]=_[10],C[11]=_[11],C[12]=_[12],C[13]=_[13],C[14]=_[14],C[15]=_[15],C},Pt.copy=function(_,C){return _[0]=C[0],_[1]=C[1],_[2]=C[2],_[3]=C[3],_[4]=C[4],_[5]=C[5],_[6]=C[6],_[7]=C[7],_[8]=C[8],_[9]=C[9],_[10]=C[10],_[11]=C[11],_[12]=C[12],_[13]=C[13],_[14]=C[14],_[15]=C[15],_},Pt.fromValues=function(_,C,S,w,M,D,L,F,B,V,N,U,H,J,oe,ee){var ne=new e.ARRAY_TYPE(16);return ne[0]=_,ne[1]=C,ne[2]=S,ne[3]=w,ne[4]=M,ne[5]=D,ne[6]=L,ne[7]=F,ne[8]=B,ne[9]=V,ne[10]=N,ne[11]=U,ne[12]=H,ne[13]=J,ne[14]=oe,ne[15]=ee,ne},Pt.set=function(_,C,S,w,M,D,L,F,B,V,N,U,H,J,oe,ee,ne){return _[0]=C,_[1]=S,_[2]=w,_[3]=M,_[4]=D,_[5]=L,_[6]=F,_[7]=B,_[8]=V,_[9]=N,_[10]=U,_[11]=H,_[12]=J,_[13]=oe,_[14]=ee,_[15]=ne,_},Pt.identity=c,Pt.transpose=function(_,C){if(_===C){var S=C[1],w=C[2],M=C[3],D=C[6],L=C[7],F=C[11];_[1]=C[4],_[2]=C[8],_[3]=C[12],_[4]=S,_[6]=C[9],_[7]=C[13],_[8]=w,_[9]=D,_[11]=C[14],_[12]=M,_[13]=L,_[14]=F}else _[0]=C[0],_[1]=C[4],_[2]=C[8],_[3]=C[12],_[4]=C[1],_[5]=C[5],_[6]=C[9],_[7]=C[13],_[8]=C[2],_[9]=C[6],_[10]=C[10],_[11]=C[14],_[12]=C[3],_[13]=C[7],_[14]=C[11],_[15]=C[15];return _},Pt.invert=function(_,C){var S=C[0],w=C[1],M=C[2],D=C[3],L=C[4],F=C[5],B=C[6],V=C[7],N=C[8],U=C[9],H=C[10],J=C[11],oe=C[12],ee=C[13],ne=C[14],ge=C[15],te=S*F-w*L,pe=S*B-M*L,xe=S*V-D*L,be=w*B-M*F,Se=w*V-D*F,Re=M*V-D*B,Le=N*ee-U*oe,De=N*ne-H*oe,He=N*ge-J*oe,et=U*ne-H*ee,je=U*ge-J*ee,pt=H*ge-J*ne,at=te*pt-pe*je+xe*et+be*He-Se*De+Re*Le;return at?(_[0]=(F*pt-B*je+V*et)*(at=1/at),_[1]=(M*je-w*pt-D*et)*at,_[2]=(ee*Re-ne*Se+ge*be)*at,_[3]=(H*Se-U*Re-J*be)*at,_[4]=(B*He-L*pt-V*De)*at,_[5]=(S*pt-M*He+D*De)*at,_[6]=(ne*xe-oe*Re-ge*pe)*at,_[7]=(N*Re-H*xe+J*pe)*at,_[8]=(L*je-F*He+V*Le)*at,_[9]=(w*He-S*je-D*Le)*at,_[10]=(oe*Se-ee*xe+ge*te)*at,_[11]=(U*xe-N*Se-J*te)*at,_[12]=(F*De-L*et-B*Le)*at,_[13]=(S*et-w*De+M*Le)*at,_[14]=(ee*pe-oe*be-ne*te)*at,_[15]=(N*be-U*pe+H*te)*at,_):null},Pt.adjoint=function(_,C){var S=C[0],w=C[1],M=C[2],D=C[3],L=C[4],F=C[5],B=C[6],V=C[7],N=C[8],U=C[9],H=C[10],J=C[11],oe=C[12],ee=C[13],ne=C[14],ge=C[15];return _[0]=F*(H*ge-J*ne)-U*(B*ge-V*ne)+ee*(B*J-V*H),_[1]=-(w*(H*ge-J*ne)-U*(M*ge-D*ne)+ee*(M*J-D*H)),_[2]=w*(B*ge-V*ne)-F*(M*ge-D*ne)+ee*(M*V-D*B),_[3]=-(w*(B*J-V*H)-F*(M*J-D*H)+U*(M*V-D*B)),_[4]=-(L*(H*ge-J*ne)-N*(B*ge-V*ne)+oe*(B*J-V*H)),_[5]=S*(H*ge-J*ne)-N*(M*ge-D*ne)+oe*(M*J-D*H),_[6]=-(S*(B*ge-V*ne)-L*(M*ge-D*ne)+oe*(M*V-D*B)),_[7]=S*(B*J-V*H)-L*(M*J-D*H)+N*(M*V-D*B),_[8]=L*(U*ge-J*ee)-N*(F*ge-V*ee)+oe*(F*J-V*U),_[9]=-(S*(U*ge-J*ee)-N*(w*ge-D*ee)+oe*(w*J-D*U)),_[10]=S*(F*ge-V*ee)-L*(w*ge-D*ee)+oe*(w*V-D*F),_[11]=-(S*(F*J-V*U)-L*(w*J-D*U)+N*(w*V-D*F)),_[12]=-(L*(U*ne-H*ee)-N*(F*ne-B*ee)+oe*(F*H-B*U)),_[13]=S*(U*ne-H*ee)-N*(w*ne-M*ee)+oe*(w*H-M*U),_[14]=-(S*(F*ne-B*ee)-L*(w*ne-M*ee)+oe*(w*B-M*F)),_[15]=S*(F*H-B*U)-L*(w*H-M*U)+N*(w*B-M*F),_},Pt.determinant=function(_){var C=_[0],S=_[1],w=_[2],M=_[3],D=_[4],L=_[5],F=_[6],B=_[7],V=_[8],N=_[9],U=_[10],H=_[11],J=_[12],oe=_[13],ee=_[14],ne=_[15];return(C*L-S*D)*(U*ne-H*ee)-(C*F-w*D)*(N*ne-H*oe)+(C*B-M*D)*(N*ee-U*oe)+(S*F-w*L)*(V*ne-H*J)-(S*B-M*L)*(V*ee-U*J)+(w*B-M*F)*(V*oe-N*J)},Pt.multiply=p,Pt.translate=function(_,C,S){var w,M,D,L,F,B,V,N,U,H,J,oe,ee=S[0],ne=S[1],ge=S[2];return C===_?(_[12]=C[0]*ee+C[4]*ne+C[8]*ge+C[12],_[13]=C[1]*ee+C[5]*ne+C[9]*ge+C[13],_[14]=C[2]*ee+C[6]*ne+C[10]*ge+C[14],_[15]=C[3]*ee+C[7]*ne+C[11]*ge+C[15]):(M=C[1],D=C[2],L=C[3],F=C[4],B=C[5],V=C[6],N=C[7],U=C[8],H=C[9],J=C[10],oe=C[11],_[0]=w=C[0],_[1]=M,_[2]=D,_[3]=L,_[4]=F,_[5]=B,_[6]=V,_[7]=N,_[8]=U,_[9]=H,_[10]=J,_[11]=oe,_[12]=w*ee+F*ne+U*ge+C[12],_[13]=M*ee+B*ne+H*ge+C[13],_[14]=D*ee+V*ne+J*ge+C[14],_[15]=L*ee+N*ne+oe*ge+C[15]),_},Pt.scale=function(_,C,S){var w=S[0],M=S[1],D=S[2];return _[0]=C[0]*w,_[1]=C[1]*w,_[2]=C[2]*w,_[3]=C[3]*w,_[4]=C[4]*M,_[5]=C[5]*M,_[6]=C[6]*M,_[7]=C[7]*M,_[8]=C[8]*D,_[9]=C[9]*D,_[10]=C[10]*D,_[11]=C[11]*D,_[12]=C[12],_[13]=C[13],_[14]=C[14],_[15]=C[15],_},Pt.rotate=function(_,C,S,w){var M,D,L,F,B,V,N,U,H,J,oe,ee,ne,ge,te,pe,xe,be,Se,Re,Le,De,He,et,je=w[0],pt=w[1],at=w[2],rt=Math.hypot(je,pt,at);return rt<e.EPSILON?null:(je*=rt=1/rt,pt*=rt,at*=rt,M=Math.sin(S),D=Math.cos(S),B=C[1],V=C[2],N=C[3],H=C[5],J=C[6],oe=C[7],ne=C[9],ge=C[10],te=C[11],pe=je*je*(L=1-D)+D,Se=je*pt*L-at*M,Re=pt*pt*L+D,Le=at*pt*L+je*M,De=je*at*L+pt*M,He=pt*at*L-je*M,et=at*at*L+D,_[0]=(F=C[0])*pe+(U=C[4])*(xe=pt*je*L+at*M)+(ee=C[8])*(be=at*je*L-pt*M),_[1]=B*pe+H*xe+ne*be,_[2]=V*pe+J*xe+ge*be,_[3]=N*pe+oe*xe+te*be,_[4]=F*Se+U*Re+ee*Le,_[5]=B*Se+H*Re+ne*Le,_[6]=V*Se+J*Re+ge*Le,_[7]=N*Se+oe*Re+te*Le,_[8]=F*De+U*He+ee*et,_[9]=B*De+H*He+ne*et,_[10]=V*De+J*He+ge*et,_[11]=N*De+oe*He+te*et,C!==_&&(_[12]=C[12],_[13]=C[13],_[14]=C[14],_[15]=C[15]),_)},Pt.rotateX=function(_,C,S){var w=Math.sin(S),M=Math.cos(S),D=C[4],L=C[5],F=C[6],B=C[7],V=C[8],N=C[9],U=C[10],H=C[11];return C!==_&&(_[0]=C[0],_[1]=C[1],_[2]=C[2],_[3]=C[3],_[12]=C[12],_[13]=C[13],_[14]=C[14],_[15]=C[15]),_[4]=D*M+V*w,_[5]=L*M+N*w,_[6]=F*M+U*w,_[7]=B*M+H*w,_[8]=V*M-D*w,_[9]=N*M-L*w,_[10]=U*M-F*w,_[11]=H*M-B*w,_},Pt.rotateY=function(_,C,S){var w=Math.sin(S),M=Math.cos(S),D=C[0],L=C[1],F=C[2],B=C[3],V=C[8],N=C[9],U=C[10],H=C[11];return C!==_&&(_[4]=C[4],_[5]=C[5],_[6]=C[6],_[7]=C[7],_[12]=C[12],_[13]=C[13],_[14]=C[14],_[15]=C[15]),_[0]=D*M-V*w,_[1]=L*M-N*w,_[2]=F*M-U*w,_[3]=B*M-H*w,_[8]=D*w+V*M,_[9]=L*w+N*M,_[10]=F*w+U*M,_[11]=B*w+H*M,_},Pt.rotateZ=function(_,C,S){var w=Math.sin(S),M=Math.cos(S),D=C[0],L=C[1],F=C[2],B=C[3],V=C[4],N=C[5],U=C[6],H=C[7];return C!==_&&(_[8]=C[8],_[9]=C[9],_[10]=C[10],_[11]=C[11],_[12]=C[12],_[13]=C[13],_[14]=C[14],_[15]=C[15]),_[0]=D*M+V*w,_[1]=L*M+N*w,_[2]=F*M+U*w,_[3]=B*M+H*w,_[4]=V*M-D*w,_[5]=N*M-L*w,_[6]=U*M-F*w,_[7]=H*M-B*w,_},Pt.fromTranslation=function(_,C){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=C[0],_[13]=C[1],_[14]=C[2],_[15]=1,_},Pt.fromScaling=function(_,C){return _[0]=C[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=C[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=C[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Pt.fromRotation=function(_,C,S){var w,M,D,L=S[0],F=S[1],B=S[2],V=Math.hypot(L,F,B);return V<e.EPSILON?null:(L*=V=1/V,F*=V,B*=V,w=Math.sin(C),M=Math.cos(C),_[0]=L*L*(D=1-M)+M,_[1]=F*L*D+B*w,_[2]=B*L*D-F*w,_[3]=0,_[4]=L*F*D-B*w,_[5]=F*F*D+M,_[6]=B*F*D+L*w,_[7]=0,_[8]=L*B*D+F*w,_[9]=F*B*D-L*w,_[10]=B*B*D+M,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},Pt.fromXRotation=function(_,C){var S=Math.sin(C),w=Math.cos(C);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=w,_[6]=S,_[7]=0,_[8]=0,_[9]=-S,_[10]=w,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Pt.fromYRotation=function(_,C){var S=Math.sin(C),w=Math.cos(C);return _[0]=w,_[1]=0,_[2]=-S,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=S,_[9]=0,_[10]=w,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Pt.fromZRotation=function(_,C){var S=Math.sin(C),w=Math.cos(C);return _[0]=w,_[1]=S,_[2]=0,_[3]=0,_[4]=-S,_[5]=w,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Pt.fromRotationTranslation=u,Pt.fromQuat2=function(_,C){var S=new e.ARRAY_TYPE(3),w=-C[0],M=-C[1],D=-C[2],L=C[3],F=C[4],B=C[5],V=C[6],N=C[7],U=w*w+M*M+D*D+L*L;return U>0?(S[0]=2*(F*L+N*w+B*D-V*M)/U,S[1]=2*(B*L+N*M+V*w-F*D)/U,S[2]=2*(V*L+N*D+F*M-B*w)/U):(S[0]=2*(F*L+N*w+B*D-V*M),S[1]=2*(B*L+N*M+V*w-F*D),S[2]=2*(V*L+N*D+F*M-B*w)),u(_,C,S),_},Pt.getTranslation=function(_,C){return _[0]=C[12],_[1]=C[13],_[2]=C[14],_},Pt.getScaling=m,Pt.getRotation=function(_,C){var S=new e.ARRAY_TYPE(3);m(S,C);var w=1/S[0],M=1/S[1],D=1/S[2],L=C[0]*w,F=C[1]*M,B=C[2]*D,V=C[4]*w,N=C[5]*M,U=C[6]*D,H=C[8]*w,J=C[9]*M,oe=C[10]*D,ee=L+N+oe,ne=0;return ee>0?(ne=2*Math.sqrt(ee+1),_[3]=.25*ne,_[0]=(U-J)/ne,_[1]=(H-B)/ne,_[2]=(F-V)/ne):L>N&&L>oe?(ne=2*Math.sqrt(1+L-N-oe),_[3]=(U-J)/ne,_[0]=.25*ne,_[1]=(F+V)/ne,_[2]=(H+B)/ne):N>oe?(ne=2*Math.sqrt(1+N-L-oe),_[3]=(H-B)/ne,_[0]=(F+V)/ne,_[1]=.25*ne,_[2]=(U+J)/ne):(ne=2*Math.sqrt(1+oe-L-N),_[3]=(F-V)/ne,_[0]=(H+B)/ne,_[1]=(U+J)/ne,_[2]=.25*ne),_},Pt.fromRotationTranslationScale=function(_,C,S,w){var M=C[0],D=C[1],L=C[2],F=C[3],B=M+M,V=D+D,N=L+L,U=M*B,H=M*V,J=M*N,oe=D*V,ee=D*N,ne=L*N,ge=F*B,te=F*V,pe=F*N,xe=w[0],be=w[1],Se=w[2];return _[0]=(1-(oe+ne))*xe,_[1]=(H+pe)*xe,_[2]=(J-te)*xe,_[3]=0,_[4]=(H-pe)*be,_[5]=(1-(U+ne))*be,_[6]=(ee+ge)*be,_[7]=0,_[8]=(J+te)*Se,_[9]=(ee-ge)*Se,_[10]=(1-(U+oe))*Se,_[11]=0,_[12]=S[0],_[13]=S[1],_[14]=S[2],_[15]=1,_},Pt.fromRotationTranslationScaleOrigin=function(_,C,S,w,M){var D=C[0],L=C[1],F=C[2],B=C[3],V=D+D,N=L+L,U=F+F,H=D*V,J=D*N,oe=D*U,ee=L*N,ne=L*U,ge=F*U,te=B*V,pe=B*N,xe=B*U,be=w[0],Se=w[1],Re=w[2],Le=M[0],De=M[1],He=M[2],et=(1-(ee+ge))*be,je=(J+xe)*be,pt=(oe-pe)*be,at=(J-xe)*Se,rt=(1-(H+ge))*Se,Qe=(ne+te)*Se,Dt=(oe+pe)*Re,ft=(ne-te)*Re,yt=(1-(H+ee))*Re;return _[0]=et,_[1]=je,_[2]=pt,_[3]=0,_[4]=at,_[5]=rt,_[6]=Qe,_[7]=0,_[8]=Dt,_[9]=ft,_[10]=yt,_[11]=0,_[12]=S[0]+Le-(et*Le+at*De+Dt*He),_[13]=S[1]+De-(je*Le+rt*De+ft*He),_[14]=S[2]+He-(pt*Le+Qe*De+yt*He),_[15]=1,_},Pt.fromQuat=function(_,C){var S=C[0],w=C[1],M=C[2],D=C[3],L=S+S,F=w+w,B=M+M,V=S*L,N=w*L,U=w*F,H=M*L,J=M*F,oe=M*B,ee=D*L,ne=D*F,ge=D*B;return _[0]=1-U-oe,_[1]=N+ge,_[2]=H-ne,_[3]=0,_[4]=N-ge,_[5]=1-V-oe,_[6]=J+ee,_[7]=0,_[8]=H+ne,_[9]=J-ee,_[10]=1-V-U,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Pt.frustum=function(_,C,S,w,M,D,L){var F=1/(S-C),B=1/(M-w),V=1/(D-L);return _[0]=2*D*F,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*D*B,_[6]=0,_[7]=0,_[8]=(S+C)*F,_[9]=(M+w)*B,_[10]=(L+D)*V,_[11]=-1,_[12]=0,_[13]=0,_[14]=L*D*2*V,_[15]=0,_},Pt.perspectiveNO=v,Pt.perspectiveZO=function(_,C,S,w,M){var D,L=1/Math.tan(C/2);return _[0]=L/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=L,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,M!=null&&M!==1/0?(_[10]=M*(D=1/(w-M)),_[14]=M*w*D):(_[10]=-1,_[14]=-w),_},Pt.perspectiveFromFieldOfView=function(_,C,S,w){var M=Math.tan(C.upDegrees*Math.PI/180),D=Math.tan(C.downDegrees*Math.PI/180),L=Math.tan(C.leftDegrees*Math.PI/180),F=Math.tan(C.rightDegrees*Math.PI/180),B=2/(L+F),V=2/(M+D);return _[0]=B,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=V,_[6]=0,_[7]=0,_[8]=-(L-F)*B*.5,_[9]=(M-D)*V*.5,_[10]=w/(S-w),_[11]=-1,_[12]=0,_[13]=0,_[14]=w*S/(S-w),_[15]=0,_},Pt.orthoNO=E,Pt.orthoZO=function(_,C,S,w,M,D,L){var F=1/(C-S),B=1/(w-M),V=1/(D-L);return _[0]=-2*F,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=V,_[11]=0,_[12]=(C+S)*F,_[13]=(M+w)*B,_[14]=D*V,_[15]=1,_},Pt.lookAt=function(_,C,S,w){var M,D,L,F,B,V,N,U,H,J,oe=C[0],ee=C[1],ne=C[2],ge=w[0],te=w[1],pe=w[2],xe=S[0],be=S[1],Se=S[2];return Math.abs(oe-xe)<e.EPSILON&&Math.abs(ee-be)<e.EPSILON&&Math.abs(ne-Se)<e.EPSILON?c(_):(N=oe-xe,U=ee-be,H=ne-Se,M=te*(H*=J=1/Math.hypot(N,U,H))-pe*(U*=J),D=pe*(N*=J)-ge*H,L=ge*U-te*N,(J=Math.hypot(M,D,L))?(M*=J=1/J,D*=J,L*=J):(M=0,D=0,L=0),F=U*L-H*D,B=H*M-N*L,V=N*D-U*M,(J=Math.hypot(F,B,V))?(F*=J=1/J,B*=J,V*=J):(F=0,B=0,V=0),_[0]=M,_[1]=F,_[2]=N,_[3]=0,_[4]=D,_[5]=B,_[6]=U,_[7]=0,_[8]=L,_[9]=V,_[10]=H,_[11]=0,_[12]=-(M*oe+D*ee+L*ne),_[13]=-(F*oe+B*ee+V*ne),_[14]=-(N*oe+U*ee+H*ne),_[15]=1,_)},Pt.targetTo=function(_,C,S,w){var M=C[0],D=C[1],L=C[2],F=w[0],B=w[1],V=w[2],N=M-S[0],U=D-S[1],H=L-S[2],J=N*N+U*U+H*H;J>0&&(N*=J=1/Math.sqrt(J),U*=J,H*=J);var oe=B*H-V*U,ee=V*N-F*H,ne=F*U-B*N;return(J=oe*oe+ee*ee+ne*ne)>0&&(oe*=J=1/Math.sqrt(J),ee*=J,ne*=J),_[0]=oe,_[1]=ee,_[2]=ne,_[3]=0,_[4]=U*ne-H*ee,_[5]=H*oe-N*ne,_[6]=N*ee-U*oe,_[7]=0,_[8]=N,_[9]=U,_[10]=H,_[11]=0,_[12]=M,_[13]=D,_[14]=L,_[15]=1,_},Pt.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},Pt.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},Pt.add=function(_,C,S){return _[0]=C[0]+S[0],_[1]=C[1]+S[1],_[2]=C[2]+S[2],_[3]=C[3]+S[3],_[4]=C[4]+S[4],_[5]=C[5]+S[5],_[6]=C[6]+S[6],_[7]=C[7]+S[7],_[8]=C[8]+S[8],_[9]=C[9]+S[9],_[10]=C[10]+S[10],_[11]=C[11]+S[11],_[12]=C[12]+S[12],_[13]=C[13]+S[13],_[14]=C[14]+S[14],_[15]=C[15]+S[15],_},Pt.subtract=T,Pt.multiplyScalar=function(_,C,S){return _[0]=C[0]*S,_[1]=C[1]*S,_[2]=C[2]*S,_[3]=C[3]*S,_[4]=C[4]*S,_[5]=C[5]*S,_[6]=C[6]*S,_[7]=C[7]*S,_[8]=C[8]*S,_[9]=C[9]*S,_[10]=C[10]*S,_[11]=C[11]*S,_[12]=C[12]*S,_[13]=C[13]*S,_[14]=C[14]*S,_[15]=C[15]*S,_},Pt.multiplyScalarAndAdd=function(_,C,S,w){return _[0]=C[0]+S[0]*w,_[1]=C[1]+S[1]*w,_[2]=C[2]+S[2]*w,_[3]=C[3]+S[3]*w,_[4]=C[4]+S[4]*w,_[5]=C[5]+S[5]*w,_[6]=C[6]+S[6]*w,_[7]=C[7]+S[7]*w,_[8]=C[8]+S[8]*w,_[9]=C[9]+S[9]*w,_[10]=C[10]+S[10]*w,_[11]=C[11]+S[11]*w,_[12]=C[12]+S[12]*w,_[13]=C[13]+S[13]*w,_[14]=C[14]+S[14]*w,_[15]=C[15]+S[15]*w,_},Pt.exactEquals=function(_,C){return _[0]===C[0]&&_[1]===C[1]&&_[2]===C[2]&&_[3]===C[3]&&_[4]===C[4]&&_[5]===C[5]&&_[6]===C[6]&&_[7]===C[7]&&_[8]===C[8]&&_[9]===C[9]&&_[10]===C[10]&&_[11]===C[11]&&_[12]===C[12]&&_[13]===C[13]&&_[14]===C[14]&&_[15]===C[15]},Pt.equals=function(_,C){var S=_[0],w=_[1],M=_[2],D=_[3],L=_[4],F=_[5],B=_[6],V=_[7],N=_[8],U=_[9],H=_[10],J=_[11],oe=_[12],ee=_[13],ne=_[14],ge=_[15],te=C[0],pe=C[1],xe=C[2],be=C[3],Se=C[4],Re=C[5],Le=C[6],De=C[7],He=C[8],et=C[9],je=C[10],pt=C[11],at=C[12],rt=C[13],Qe=C[14],Dt=C[15];return Math.abs(S-te)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(te))&&Math.abs(w-pe)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(pe))&&Math.abs(M-xe)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(xe))&&Math.abs(D-be)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(be))&&Math.abs(L-Se)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(Se))&&Math.abs(F-Re)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(Re))&&Math.abs(B-Le)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Le))&&Math.abs(V-De)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(De))&&Math.abs(N-He)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(He))&&Math.abs(U-et)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(et))&&Math.abs(H-je)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(je))&&Math.abs(J-pt)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(pt))&&Math.abs(oe-at)<=e.EPSILON*Math.max(1,Math.abs(oe),Math.abs(at))&&Math.abs(ee-rt)<=e.EPSILON*Math.max(1,Math.abs(ee),Math.abs(rt))&&Math.abs(ne-Qe)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Qe))&&Math.abs(ge-Dt)<=e.EPSILON*Math.max(1,Math.abs(ge),Math.abs(Dt))},Pt.sub=Pt.mul=Pt.ortho=Pt.perspective=void 0;var e=function(_,C){if(_&&_.__esModule)return _;if(_===null||l(_)!=="object"&&typeof _!="function")return{default:_};var S=r(void 0);if(S&&S.has(_))return S.get(_);var w={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var D in _)if(D!=="default"&&Object.prototype.hasOwnProperty.call(_,D)){var L=M?Object.getOwnPropertyDescriptor(_,D):null;L&&(L.get||L.set)?Object.defineProperty(w,D,L):w[D]=_[D]}return w.default=_,S&&S.set(_,w),w}(Me());function r(_){if(typeof WeakMap!="function")return null;var C=new WeakMap,S=new WeakMap;return(r=function(w){return w?S:C})(_)}function c(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function p(_,C,S){var w=C[0],M=C[1],D=C[2],L=C[3],F=C[4],B=C[5],V=C[6],N=C[7],U=C[8],H=C[9],J=C[10],oe=C[11],ee=C[12],ne=C[13],ge=C[14],te=C[15],pe=S[0],xe=S[1],be=S[2],Se=S[3];return _[0]=pe*w+xe*F+be*U+Se*ee,_[1]=pe*M+xe*B+be*H+Se*ne,_[2]=pe*D+xe*V+be*J+Se*ge,_[3]=pe*L+xe*N+be*oe+Se*te,_[4]=(pe=S[4])*w+(xe=S[5])*F+(be=S[6])*U+(Se=S[7])*ee,_[5]=pe*M+xe*B+be*H+Se*ne,_[6]=pe*D+xe*V+be*J+Se*ge,_[7]=pe*L+xe*N+be*oe+Se*te,_[8]=(pe=S[8])*w+(xe=S[9])*F+(be=S[10])*U+(Se=S[11])*ee,_[9]=pe*M+xe*B+be*H+Se*ne,_[10]=pe*D+xe*V+be*J+Se*ge,_[11]=pe*L+xe*N+be*oe+Se*te,_[12]=(pe=S[12])*w+(xe=S[13])*F+(be=S[14])*U+(Se=S[15])*ee,_[13]=pe*M+xe*B+be*H+Se*ne,_[14]=pe*D+xe*V+be*J+Se*ge,_[15]=pe*L+xe*N+be*oe+Se*te,_}function u(_,C,S){var w=C[0],M=C[1],D=C[2],L=C[3],F=w+w,B=M+M,V=D+D,N=w*F,U=w*B,H=w*V,J=M*B,oe=M*V,ee=D*V,ne=L*F,ge=L*B,te=L*V;return _[0]=1-(J+ee),_[1]=U+te,_[2]=H-ge,_[3]=0,_[4]=U-te,_[5]=1-(N+ee),_[6]=oe+ne,_[7]=0,_[8]=H+ge,_[9]=oe-ne,_[10]=1-(N+J),_[11]=0,_[12]=S[0],_[13]=S[1],_[14]=S[2],_[15]=1,_}function m(_,C){var S=C[4],w=C[5],M=C[6],D=C[8],L=C[9],F=C[10];return _[0]=Math.hypot(C[0],C[1],C[2]),_[1]=Math.hypot(S,w,M),_[2]=Math.hypot(D,L,F),_}function v(_,C,S,w,M){var D,L=1/Math.tan(C/2);return _[0]=L/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=L,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,M!=null&&M!==1/0?(_[10]=(M+w)*(D=1/(w-M)),_[14]=2*M*w*D):(_[10]=-1,_[14]=-2*w),_}function E(_,C,S,w,M,D,L){var F=1/(C-S),B=1/(w-M),V=1/(D-L);return _[0]=-2*F,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*V,_[11]=0,_[12]=(C+S)*F,_[13]=(M+w)*B,_[14]=(L+D)*V,_[15]=1,_}function T(_,C,S){return _[0]=C[0]-S[0],_[1]=C[1]-S[1],_[2]=C[2]-S[2],_[3]=C[3]-S[3],_[4]=C[4]-S[4],_[5]=C[5]-S[5],_[6]=C[6]-S[6],_[7]=C[7]-S[7],_[8]=C[8]-S[8],_[9]=C[9]-S[9],_[10]=C[10]-S[10],_[11]=C[11]-S[11],_[12]=C[12]-S[12],_[13]=C[13]-S[13],_[14]=C[14]-S[14],_[15]=C[15]-S[15],_}return Pt.perspective=v,Pt.ortho=E,Pt.mul=p,Pt.sub=T,Pt}var Qi,zt={},$t={};function va(){if(Qi)return $t;function l(M){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},l(M)}Qi=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=c,$t.clone=function(M){var D=new e.ARRAY_TYPE(3);return D[0]=M[0],D[1]=M[1],D[2]=M[2],D},$t.length=p,$t.fromValues=function(M,D,L){var F=new e.ARRAY_TYPE(3);return F[0]=M,F[1]=D,F[2]=L,F},$t.copy=function(M,D){return M[0]=D[0],M[1]=D[1],M[2]=D[2],M},$t.set=function(M,D,L,F){return M[0]=D,M[1]=L,M[2]=F,M},$t.add=function(M,D,L){return M[0]=D[0]+L[0],M[1]=D[1]+L[1],M[2]=D[2]+L[2],M},$t.subtract=u,$t.multiply=m,$t.divide=v,$t.ceil=function(M,D){return M[0]=Math.ceil(D[0]),M[1]=Math.ceil(D[1]),M[2]=Math.ceil(D[2]),M},$t.floor=function(M,D){return M[0]=Math.floor(D[0]),M[1]=Math.floor(D[1]),M[2]=Math.floor(D[2]),M},$t.min=function(M,D,L){return M[0]=Math.min(D[0],L[0]),M[1]=Math.min(D[1],L[1]),M[2]=Math.min(D[2],L[2]),M},$t.max=function(M,D,L){return M[0]=Math.max(D[0],L[0]),M[1]=Math.max(D[1],L[1]),M[2]=Math.max(D[2],L[2]),M},$t.round=function(M,D){return M[0]=Math.round(D[0]),M[1]=Math.round(D[1]),M[2]=Math.round(D[2]),M},$t.scale=function(M,D,L){return M[0]=D[0]*L,M[1]=D[1]*L,M[2]=D[2]*L,M},$t.scaleAndAdd=function(M,D,L,F){return M[0]=D[0]+L[0]*F,M[1]=D[1]+L[1]*F,M[2]=D[2]+L[2]*F,M},$t.distance=E,$t.squaredDistance=T,$t.squaredLength=_,$t.negate=function(M,D){return M[0]=-D[0],M[1]=-D[1],M[2]=-D[2],M},$t.inverse=function(M,D){return M[0]=1/D[0],M[1]=1/D[1],M[2]=1/D[2],M},$t.normalize=function(M,D){var L=D[0],F=D[1],B=D[2],V=L*L+F*F+B*B;return V>0&&(V=1/Math.sqrt(V)),M[0]=D[0]*V,M[1]=D[1]*V,M[2]=D[2]*V,M},$t.dot=C,$t.cross=function(M,D,L){var F=D[0],B=D[1],V=D[2],N=L[0],U=L[1],H=L[2];return M[0]=B*H-V*U,M[1]=V*N-F*H,M[2]=F*U-B*N,M},$t.lerp=function(M,D,L,F){var B=D[0],V=D[1],N=D[2];return M[0]=B+F*(L[0]-B),M[1]=V+F*(L[1]-V),M[2]=N+F*(L[2]-N),M},$t.hermite=function(M,D,L,F,B,V){var N=V*V,U=N*(2*V-3)+1,H=N*(V-2)+V,J=N*(V-1),oe=N*(3-2*V);return M[0]=D[0]*U+L[0]*H+F[0]*J+B[0]*oe,M[1]=D[1]*U+L[1]*H+F[1]*J+B[1]*oe,M[2]=D[2]*U+L[2]*H+F[2]*J+B[2]*oe,M},$t.bezier=function(M,D,L,F,B,V){var N=1-V,U=N*N,H=V*V,J=U*N,oe=3*V*U,ee=3*H*N,ne=H*V;return M[0]=D[0]*J+L[0]*oe+F[0]*ee+B[0]*ne,M[1]=D[1]*J+L[1]*oe+F[1]*ee+B[1]*ne,M[2]=D[2]*J+L[2]*oe+F[2]*ee+B[2]*ne,M},$t.random=function(M,D){D=D||1;var L=2*e.RANDOM()*Math.PI,F=2*e.RANDOM()-1,B=Math.sqrt(1-F*F)*D;return M[0]=Math.cos(L)*B,M[1]=Math.sin(L)*B,M[2]=F*D,M},$t.transformMat4=function(M,D,L){var F=D[0],B=D[1],V=D[2],N=L[3]*F+L[7]*B+L[11]*V+L[15];return M[0]=(L[0]*F+L[4]*B+L[8]*V+L[12])/(N=N||1),M[1]=(L[1]*F+L[5]*B+L[9]*V+L[13])/N,M[2]=(L[2]*F+L[6]*B+L[10]*V+L[14])/N,M},$t.transformMat3=function(M,D,L){var F=D[0],B=D[1],V=D[2];return M[0]=F*L[0]+B*L[3]+V*L[6],M[1]=F*L[1]+B*L[4]+V*L[7],M[2]=F*L[2]+B*L[5]+V*L[8],M},$t.transformQuat=function(M,D,L){var F=L[0],B=L[1],V=L[2],N=D[0],U=D[1],H=D[2],J=B*H-V*U,oe=V*N-F*H,ee=F*U-B*N,ne=B*ee-V*oe,ge=V*J-F*ee,te=F*oe-B*J,pe=2*L[3];return oe*=pe,ee*=pe,ge*=2,te*=2,M[0]=N+(J*=pe)+(ne*=2),M[1]=U+oe+ge,M[2]=H+ee+te,M},$t.rotateX=function(M,D,L,F){var B=[],V=[];return B[0]=D[0]-L[0],B[1]=D[1]-L[1],B[2]=D[2]-L[2],V[0]=B[0],V[1]=B[1]*Math.cos(F)-B[2]*Math.sin(F),V[2]=B[1]*Math.sin(F)+B[2]*Math.cos(F),M[0]=V[0]+L[0],M[1]=V[1]+L[1],M[2]=V[2]+L[2],M},$t.rotateY=function(M,D,L,F){var B=[],V=[];return B[0]=D[0]-L[0],B[1]=D[1]-L[1],B[2]=D[2]-L[2],V[0]=B[2]*Math.sin(F)+B[0]*Math.cos(F),V[1]=B[1],V[2]=B[2]*Math.cos(F)-B[0]*Math.sin(F),M[0]=V[0]+L[0],M[1]=V[1]+L[1],M[2]=V[2]+L[2],M},$t.rotateZ=function(M,D,L,F){var B=[],V=[];return B[0]=D[0]-L[0],B[1]=D[1]-L[1],B[2]=D[2]-L[2],V[0]=B[0]*Math.cos(F)-B[1]*Math.sin(F),V[1]=B[0]*Math.sin(F)+B[1]*Math.cos(F),V[2]=B[2],M[0]=V[0]+L[0],M[1]=V[1]+L[1],M[2]=V[2]+L[2],M},$t.angle=function(M,D){var L=M[0],F=M[1],B=M[2],V=D[0],N=D[1],U=D[2],H=Math.sqrt(L*L+F*F+B*B)*Math.sqrt(V*V+N*N+U*U),J=H&&C(M,D)/H;return Math.acos(Math.min(Math.max(J,-1),1))},$t.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},$t.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},$t.exactEquals=function(M,D){return M[0]===D[0]&&M[1]===D[1]&&M[2]===D[2]},$t.equals=function(M,D){var L=M[0],F=M[1],B=M[2],V=D[0],N=D[1],U=D[2];return Math.abs(L-V)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(V))&&Math.abs(F-N)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(N))&&Math.abs(B-U)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(U))},$t.forEach=$t.sqrLen=$t.len=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=void 0;var e=function(M,D){if(M&&M.__esModule)return M;if(M===null||l(M)!=="object"&&typeof M!="function")return{default:M};var L=r(void 0);if(L&&L.has(M))return L.get(M);var F={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in M)if(V!=="default"&&Object.prototype.hasOwnProperty.call(M,V)){var N=B?Object.getOwnPropertyDescriptor(M,V):null;N&&(N.get||N.set)?Object.defineProperty(F,V,N):F[V]=M[V]}return F.default=M,L&&L.set(M,F),F}(Me());function r(M){if(typeof WeakMap!="function")return null;var D=new WeakMap,L=new WeakMap;return(r=function(F){return F?L:D})(M)}function c(){var M=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function p(M){return Math.hypot(M[0],M[1],M[2])}function u(M,D,L){return M[0]=D[0]-L[0],M[1]=D[1]-L[1],M[2]=D[2]-L[2],M}function m(M,D,L){return M[0]=D[0]*L[0],M[1]=D[1]*L[1],M[2]=D[2]*L[2],M}function v(M,D,L){return M[0]=D[0]/L[0],M[1]=D[1]/L[1],M[2]=D[2]/L[2],M}function E(M,D){return Math.hypot(D[0]-M[0],D[1]-M[1],D[2]-M[2])}function T(M,D){var L=D[0]-M[0],F=D[1]-M[1],B=D[2]-M[2];return L*L+F*F+B*B}function _(M){var D=M[0],L=M[1],F=M[2];return D*D+L*L+F*F}function C(M,D){return M[0]*D[0]+M[1]*D[1]+M[2]*D[2]}$t.sub=u,$t.mul=m,$t.div=v,$t.dist=E,$t.sqrDist=T,$t.len=p,$t.sqrLen=_;var S,w=(S=c(),function(M,D,L,F,B,V){var N,U;for(D||(D=3),L||(L=0),U=F?Math.min(F*D+L,M.length):M.length,N=L;N<U;N+=D)S[0]=M[N],S[1]=M[N+1],S[2]=M[N+2],B(S,S,V),M[N]=S[0],M[N+1]=S[1],M[N+2]=S[2];return M});return $t.forEach=w,$t}var Us,ad,an={};function wr(){if(Us)return an;function l(w){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(w)}Us=1,Object.defineProperty(an,"__esModule",{value:!0}),an.create=c,an.clone=function(w){var M=new e.ARRAY_TYPE(4);return M[0]=w[0],M[1]=w[1],M[2]=w[2],M[3]=w[3],M},an.fromValues=function(w,M,D,L){var F=new e.ARRAY_TYPE(4);return F[0]=w,F[1]=M,F[2]=D,F[3]=L,F},an.copy=function(w,M){return w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=M[3],w},an.set=function(w,M,D,L,F){return w[0]=M,w[1]=D,w[2]=L,w[3]=F,w},an.add=function(w,M,D){return w[0]=M[0]+D[0],w[1]=M[1]+D[1],w[2]=M[2]+D[2],w[3]=M[3]+D[3],w},an.subtract=p,an.multiply=u,an.divide=m,an.ceil=function(w,M){return w[0]=Math.ceil(M[0]),w[1]=Math.ceil(M[1]),w[2]=Math.ceil(M[2]),w[3]=Math.ceil(M[3]),w},an.floor=function(w,M){return w[0]=Math.floor(M[0]),w[1]=Math.floor(M[1]),w[2]=Math.floor(M[2]),w[3]=Math.floor(M[3]),w},an.min=function(w,M,D){return w[0]=Math.min(M[0],D[0]),w[1]=Math.min(M[1],D[1]),w[2]=Math.min(M[2],D[2]),w[3]=Math.min(M[3],D[3]),w},an.max=function(w,M,D){return w[0]=Math.max(M[0],D[0]),w[1]=Math.max(M[1],D[1]),w[2]=Math.max(M[2],D[2]),w[3]=Math.max(M[3],D[3]),w},an.round=function(w,M){return w[0]=Math.round(M[0]),w[1]=Math.round(M[1]),w[2]=Math.round(M[2]),w[3]=Math.round(M[3]),w},an.scale=function(w,M,D){return w[0]=M[0]*D,w[1]=M[1]*D,w[2]=M[2]*D,w[3]=M[3]*D,w},an.scaleAndAdd=function(w,M,D,L){return w[0]=M[0]+D[0]*L,w[1]=M[1]+D[1]*L,w[2]=M[2]+D[2]*L,w[3]=M[3]+D[3]*L,w},an.distance=v,an.squaredDistance=E,an.length=T,an.squaredLength=_,an.negate=function(w,M){return w[0]=-M[0],w[1]=-M[1],w[2]=-M[2],w[3]=-M[3],w},an.inverse=function(w,M){return w[0]=1/M[0],w[1]=1/M[1],w[2]=1/M[2],w[3]=1/M[3],w},an.normalize=function(w,M){var D=M[0],L=M[1],F=M[2],B=M[3],V=D*D+L*L+F*F+B*B;return V>0&&(V=1/Math.sqrt(V)),w[0]=D*V,w[1]=L*V,w[2]=F*V,w[3]=B*V,w},an.dot=function(w,M){return w[0]*M[0]+w[1]*M[1]+w[2]*M[2]+w[3]*M[3]},an.cross=function(w,M,D,L){var F=D[0]*L[1]-D[1]*L[0],B=D[0]*L[2]-D[2]*L[0],V=D[0]*L[3]-D[3]*L[0],N=D[1]*L[2]-D[2]*L[1],U=D[1]*L[3]-D[3]*L[1],H=D[2]*L[3]-D[3]*L[2],J=M[0],oe=M[1],ee=M[2],ne=M[3];return w[0]=oe*H-ee*U+ne*N,w[1]=-J*H+ee*V-ne*B,w[2]=J*U-oe*V+ne*F,w[3]=-J*N+oe*B-ee*F,w},an.lerp=function(w,M,D,L){var F=M[0],B=M[1],V=M[2],N=M[3];return w[0]=F+L*(D[0]-F),w[1]=B+L*(D[1]-B),w[2]=V+L*(D[2]-V),w[3]=N+L*(D[3]-N),w},an.random=function(w,M){var D,L,F,B,V,N;M=M||1;do V=(D=2*e.RANDOM()-1)*D+(L=2*e.RANDOM()-1)*L;while(V>=1);do N=(F=2*e.RANDOM()-1)*F+(B=2*e.RANDOM()-1)*B;while(N>=1);var U=Math.sqrt((1-V)/N);return w[0]=M*D,w[1]=M*L,w[2]=M*F*U,w[3]=M*B*U,w},an.transformMat4=function(w,M,D){var L=M[0],F=M[1],B=M[2],V=M[3];return w[0]=D[0]*L+D[4]*F+D[8]*B+D[12]*V,w[1]=D[1]*L+D[5]*F+D[9]*B+D[13]*V,w[2]=D[2]*L+D[6]*F+D[10]*B+D[14]*V,w[3]=D[3]*L+D[7]*F+D[11]*B+D[15]*V,w},an.transformQuat=function(w,M,D){var L=M[0],F=M[1],B=M[2],V=D[0],N=D[1],U=D[2],H=D[3],J=H*L+N*B-U*F,oe=H*F+U*L-V*B,ee=H*B+V*F-N*L,ne=-V*L-N*F-U*B;return w[0]=J*H+ne*-V+oe*-U-ee*-N,w[1]=oe*H+ne*-N+ee*-V-J*-U,w[2]=ee*H+ne*-U+J*-N-oe*-V,w[3]=M[3],w},an.zero=function(w){return w[0]=0,w[1]=0,w[2]=0,w[3]=0,w},an.str=function(w){return"vec4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+")"},an.exactEquals=function(w,M){return w[0]===M[0]&&w[1]===M[1]&&w[2]===M[2]&&w[3]===M[3]},an.equals=function(w,M){var D=w[0],L=w[1],F=w[2],B=w[3],V=M[0],N=M[1],U=M[2],H=M[3];return Math.abs(D-V)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(V))&&Math.abs(L-N)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(N))&&Math.abs(F-U)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(U))&&Math.abs(B-H)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))},an.forEach=an.sqrLen=an.len=an.sqrDist=an.dist=an.div=an.mul=an.sub=void 0;var e=function(w,M){if(w&&w.__esModule)return w;if(w===null||l(w)!=="object"&&typeof w!="function")return{default:w};var D=r(void 0);if(D&&D.has(w))return D.get(w);var L={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=F?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(L,B,V):L[B]=w[B]}return L.default=w,D&&D.set(w,L),L}(Me());function r(w){if(typeof WeakMap!="function")return null;var M=new WeakMap,D=new WeakMap;return(r=function(L){return L?D:M})(w)}function c(){var w=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0,w[3]=0),w}function p(w,M,D){return w[0]=M[0]-D[0],w[1]=M[1]-D[1],w[2]=M[2]-D[2],w[3]=M[3]-D[3],w}function u(w,M,D){return w[0]=M[0]*D[0],w[1]=M[1]*D[1],w[2]=M[2]*D[2],w[3]=M[3]*D[3],w}function m(w,M,D){return w[0]=M[0]/D[0],w[1]=M[1]/D[1],w[2]=M[2]/D[2],w[3]=M[3]/D[3],w}function v(w,M){return Math.hypot(M[0]-w[0],M[1]-w[1],M[2]-w[2],M[3]-w[3])}function E(w,M){var D=M[0]-w[0],L=M[1]-w[1],F=M[2]-w[2],B=M[3]-w[3];return D*D+L*L+F*F+B*B}function T(w){return Math.hypot(w[0],w[1],w[2],w[3])}function _(w){var M=w[0],D=w[1],L=w[2],F=w[3];return M*M+D*D+L*L+F*F}an.sub=p,an.mul=u,an.div=m,an.dist=v,an.sqrDist=E,an.len=T,an.sqrLen=_;var C,S=(C=c(),function(w,M,D,L,F,B){var V,N;for(M||(M=4),D||(D=0),N=L?Math.min(L*M+D,w.length):w.length,V=D;V<N;V+=M)C[0]=w[V],C[1]=w[V+1],C[2]=w[V+2],C[3]=w[V+3],F(C,C,B),w[V]=C[0],w[V+1]=C[1],w[V+2]=C[2],w[V+3]=C[3];return w});return an.forEach=S,an}function ds(){if(ad)return zt;function l(te){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(pe){return typeof pe}:function(pe){return pe&&typeof Symbol=="function"&&pe.constructor===Symbol&&pe!==Symbol.prototype?"symbol":typeof pe},l(te)}ad=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=v,zt.identity=function(te){return te[0]=0,te[1]=0,te[2]=0,te[3]=1,te},zt.setAxisAngle=E,zt.getAxisAngle=function(te,pe){var xe=2*Math.acos(pe[3]),be=Math.sin(xe/2);return be>e.EPSILON?(te[0]=pe[0]/be,te[1]=pe[1]/be,te[2]=pe[2]/be):(te[0]=1,te[1]=0,te[2]=0),xe},zt.getAngle=function(te,pe){var xe=D(te,pe);return Math.acos(2*xe*xe-1)},zt.multiply=T,zt.rotateX=function(te,pe,xe){xe*=.5;var be=pe[0],Se=pe[1],Re=pe[2],Le=pe[3],De=Math.sin(xe),He=Math.cos(xe);return te[0]=be*He+Le*De,te[1]=Se*He+Re*De,te[2]=Re*He-Se*De,te[3]=Le*He-be*De,te},zt.rotateY=function(te,pe,xe){xe*=.5;var be=pe[0],Se=pe[1],Re=pe[2],Le=pe[3],De=Math.sin(xe),He=Math.cos(xe);return te[0]=be*He-Re*De,te[1]=Se*He+Le*De,te[2]=Re*He+be*De,te[3]=Le*He-Se*De,te},zt.rotateZ=function(te,pe,xe){xe*=.5;var be=pe[0],Se=pe[1],Re=pe[2],Le=pe[3],De=Math.sin(xe),He=Math.cos(xe);return te[0]=be*He+Se*De,te[1]=Se*He-be*De,te[2]=Re*He+Le*De,te[3]=Le*He-Re*De,te},zt.calculateW=function(te,pe){var xe=pe[0],be=pe[1],Se=pe[2];return te[0]=xe,te[1]=be,te[2]=Se,te[3]=Math.sqrt(Math.abs(1-xe*xe-be*be-Se*Se)),te},zt.exp=_,zt.ln=C,zt.pow=function(te,pe,xe){return C(te,pe),M(te,te,xe),_(te,te),te},zt.slerp=S,zt.random=function(te){var pe=e.RANDOM(),xe=e.RANDOM(),be=e.RANDOM(),Se=Math.sqrt(1-pe),Re=Math.sqrt(pe);return te[0]=Se*Math.sin(2*Math.PI*xe),te[1]=Se*Math.cos(2*Math.PI*xe),te[2]=Re*Math.sin(2*Math.PI*be),te[3]=Re*Math.cos(2*Math.PI*be),te},zt.invert=function(te,pe){var xe=pe[0],be=pe[1],Se=pe[2],Re=pe[3],Le=xe*xe+be*be+Se*Se+Re*Re,De=Le?1/Le:0;return te[0]=-xe*De,te[1]=-be*De,te[2]=-Se*De,te[3]=Re*De,te},zt.conjugate=function(te,pe){return te[0]=-pe[0],te[1]=-pe[1],te[2]=-pe[2],te[3]=pe[3],te},zt.fromMat3=w,zt.fromEuler=function(te,pe,xe,be){var Se=.5*Math.PI/180;pe*=Se,xe*=Se,be*=Se;var Re=Math.sin(pe),Le=Math.cos(pe),De=Math.sin(xe),He=Math.cos(xe),et=Math.sin(be),je=Math.cos(be);return te[0]=Re*He*je-Le*De*et,te[1]=Le*De*je+Re*He*et,te[2]=Le*He*et-Re*De*je,te[3]=Le*He*je+Re*De*et,te},zt.str=function(te){return"quat("+te[0]+", "+te[1]+", "+te[2]+", "+te[3]+")"},zt.setAxes=zt.sqlerp=zt.rotationTo=zt.equals=zt.exactEquals=zt.normalize=zt.sqrLen=zt.squaredLength=zt.len=zt.length=zt.lerp=zt.dot=zt.scale=zt.mul=zt.add=zt.set=zt.copy=zt.fromValues=zt.clone=void 0;var e=m(Me()),r=m(Ln()),c=m(va()),p=m(wr());function u(te){if(typeof WeakMap!="function")return null;var pe=new WeakMap,xe=new WeakMap;return(u=function(be){return be?xe:pe})(te)}function m(te,pe){if(te&&te.__esModule)return te;if(te===null||l(te)!=="object"&&typeof te!="function")return{default:te};var xe=u(pe);if(xe&&xe.has(te))return xe.get(te);var be={},Se=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Re in te)if(Re!=="default"&&Object.prototype.hasOwnProperty.call(te,Re)){var Le=Se?Object.getOwnPropertyDescriptor(te,Re):null;Le&&(Le.get||Le.set)?Object.defineProperty(be,Re,Le):be[Re]=te[Re]}return be.default=te,xe&&xe.set(te,be),be}function v(){var te=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(te[0]=0,te[1]=0,te[2]=0),te[3]=1,te}function E(te,pe,xe){xe*=.5;var be=Math.sin(xe);return te[0]=be*pe[0],te[1]=be*pe[1],te[2]=be*pe[2],te[3]=Math.cos(xe),te}function T(te,pe,xe){var be=pe[0],Se=pe[1],Re=pe[2],Le=pe[3],De=xe[0],He=xe[1],et=xe[2],je=xe[3];return te[0]=be*je+Le*De+Se*et-Re*He,te[1]=Se*je+Le*He+Re*De-be*et,te[2]=Re*je+Le*et+be*He-Se*De,te[3]=Le*je-be*De-Se*He-Re*et,te}function _(te,pe){var xe=pe[0],be=pe[1],Se=pe[2],Re=pe[3],Le=Math.sqrt(xe*xe+be*be+Se*Se),De=Math.exp(Re),He=Le>0?De*Math.sin(Le)/Le:0;return te[0]=xe*He,te[1]=be*He,te[2]=Se*He,te[3]=De*Math.cos(Le),te}function C(te,pe){var xe=pe[0],be=pe[1],Se=pe[2],Re=pe[3],Le=Math.sqrt(xe*xe+be*be+Se*Se),De=Le>0?Math.atan2(Le,Re)/Le:0;return te[0]=xe*De,te[1]=be*De,te[2]=Se*De,te[3]=.5*Math.log(xe*xe+be*be+Se*Se+Re*Re),te}function S(te,pe,xe,be){var Se,Re,Le,De,He,et=pe[0],je=pe[1],pt=pe[2],at=pe[3],rt=xe[0],Qe=xe[1],Dt=xe[2],ft=xe[3];return(Re=et*rt+je*Qe+pt*Dt+at*ft)<0&&(Re=-Re,rt=-rt,Qe=-Qe,Dt=-Dt,ft=-ft),1-Re>e.EPSILON?(Se=Math.acos(Re),Le=Math.sin(Se),De=Math.sin((1-be)*Se)/Le,He=Math.sin(be*Se)/Le):(De=1-be,He=be),te[0]=De*et+He*rt,te[1]=De*je+He*Qe,te[2]=De*pt+He*Dt,te[3]=De*at+He*ft,te}function w(te,pe){var xe,be=pe[0]+pe[4]+pe[8];if(be>0)xe=Math.sqrt(be+1),te[3]=.5*xe,te[0]=(pe[5]-pe[7])*(xe=.5/xe),te[1]=(pe[6]-pe[2])*xe,te[2]=(pe[1]-pe[3])*xe;else{var Se=0;pe[4]>pe[0]&&(Se=1),pe[8]>pe[3*Se+Se]&&(Se=2);var Re=(Se+1)%3,Le=(Se+2)%3;xe=Math.sqrt(pe[3*Se+Se]-pe[3*Re+Re]-pe[3*Le+Le]+1),te[Se]=.5*xe,te[3]=(pe[3*Re+Le]-pe[3*Le+Re])*(xe=.5/xe),te[Re]=(pe[3*Re+Se]+pe[3*Se+Re])*xe,te[Le]=(pe[3*Le+Se]+pe[3*Se+Le])*xe}return te}zt.clone=p.clone,zt.fromValues=p.fromValues,zt.copy=p.copy,zt.set=p.set,zt.add=p.add,zt.mul=T;var M=p.scale;zt.scale=M;var D=p.dot;zt.dot=D,zt.lerp=p.lerp;var L=p.length;zt.length=L,zt.len=L;var F=p.squaredLength;zt.squaredLength=F,zt.sqrLen=F;var B=p.normalize;zt.normalize=B,zt.exactEquals=p.exactEquals,zt.equals=p.equals;var V,N,U,H=(V=c.create(),N=c.fromValues(1,0,0),U=c.fromValues(0,1,0),function(te,pe,xe){var be=c.dot(pe,xe);return be<-.999999?(c.cross(V,N,pe),c.len(V)<1e-6&&c.cross(V,U,pe),c.normalize(V,V),E(te,V,Math.PI),te):be>.999999?(te[0]=0,te[1]=0,te[2]=0,te[3]=1,te):(c.cross(V,pe,xe),te[0]=V[0],te[1]=V[1],te[2]=V[2],te[3]=1+be,B(te,te))});zt.rotationTo=H;var J,oe,ee=(J=v(),oe=v(),function(te,pe,xe,be,Se,Re){return S(J,pe,Se,Re),S(oe,xe,be,Re),S(te,J,oe,2*Re*(1-Re)),te});zt.sqlerp=ee;var ne,ge=(ne=r.create(),function(te,pe,xe,be){return ne[0]=xe[0],ne[3]=xe[1],ne[6]=xe[2],ne[1]=be[0],ne[4]=be[1],ne[7]=be[2],ne[2]=-pe[0],ne[5]=-pe[1],ne[8]=-pe[2],B(te,w(te,ne))});return zt.setAxes=ge,zt}var ll,nn={};function xa(){if(ll)return nn;function l(S){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},l(S)}ll=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.create=function(){var S=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(S[0]=0,S[1]=0,S[2]=0,S[4]=0,S[5]=0,S[6]=0,S[7]=0),S[3]=1,S},nn.clone=function(S){var w=new e.ARRAY_TYPE(8);return w[0]=S[0],w[1]=S[1],w[2]=S[2],w[3]=S[3],w[4]=S[4],w[5]=S[5],w[6]=S[6],w[7]=S[7],w},nn.fromValues=function(S,w,M,D,L,F,B,V){var N=new e.ARRAY_TYPE(8);return N[0]=S,N[1]=w,N[2]=M,N[3]=D,N[4]=L,N[5]=F,N[6]=B,N[7]=V,N},nn.fromRotationTranslationValues=function(S,w,M,D,L,F,B){var V=new e.ARRAY_TYPE(8);V[0]=S,V[1]=w,V[2]=M,V[3]=D;var N=.5*L,U=.5*F,H=.5*B;return V[4]=N*D+U*M-H*w,V[5]=U*D+H*S-N*M,V[6]=H*D+N*w-U*S,V[7]=-N*S-U*w-H*M,V},nn.fromRotationTranslation=m,nn.fromTranslation=function(S,w){return S[0]=0,S[1]=0,S[2]=0,S[3]=1,S[4]=.5*w[0],S[5]=.5*w[1],S[6]=.5*w[2],S[7]=0,S},nn.fromRotation=function(S,w){return S[0]=w[0],S[1]=w[1],S[2]=w[2],S[3]=w[3],S[4]=0,S[5]=0,S[6]=0,S[7]=0,S},nn.fromMat4=function(S,w){var M=r.create();c.getRotation(M,w);var D=new e.ARRAY_TYPE(3);return c.getTranslation(D,w),m(S,M,D),S},nn.copy=v,nn.identity=function(S){return S[0]=0,S[1]=0,S[2]=0,S[3]=1,S[4]=0,S[5]=0,S[6]=0,S[7]=0,S},nn.set=function(S,w,M,D,L,F,B,V,N){return S[0]=w,S[1]=M,S[2]=D,S[3]=L,S[4]=F,S[5]=B,S[6]=V,S[7]=N,S},nn.getDual=function(S,w){return S[0]=w[4],S[1]=w[5],S[2]=w[6],S[3]=w[7],S},nn.setDual=function(S,w){return S[4]=w[0],S[5]=w[1],S[6]=w[2],S[7]=w[3],S},nn.getTranslation=function(S,w){var M=w[4],D=w[5],L=w[6],F=w[7],B=-w[0],V=-w[1],N=-w[2],U=w[3];return S[0]=2*(M*U+F*B+D*N-L*V),S[1]=2*(D*U+F*V+L*B-M*N),S[2]=2*(L*U+F*N+M*V-D*B),S},nn.translate=function(S,w,M){var D=w[0],L=w[1],F=w[2],B=w[3],V=.5*M[0],N=.5*M[1],U=.5*M[2],H=w[4],J=w[5],oe=w[6],ee=w[7];return S[0]=D,S[1]=L,S[2]=F,S[3]=B,S[4]=B*V+L*U-F*N+H,S[5]=B*N+F*V-D*U+J,S[6]=B*U+D*N-L*V+oe,S[7]=-D*V-L*N-F*U+ee,S},nn.rotateX=function(S,w,M){var D=-w[0],L=-w[1],F=-w[2],B=w[3],V=w[4],N=w[5],U=w[6],H=w[7],J=V*B+H*D+N*F-U*L,oe=N*B+H*L+U*D-V*F,ee=U*B+H*F+V*L-N*D,ne=H*B-V*D-N*L-U*F;return r.rotateX(S,w,M),S[4]=J*(B=S[3])+ne*(D=S[0])+oe*(F=S[2])-ee*(L=S[1]),S[5]=oe*B+ne*L+ee*D-J*F,S[6]=ee*B+ne*F+J*L-oe*D,S[7]=ne*B-J*D-oe*L-ee*F,S},nn.rotateY=function(S,w,M){var D=-w[0],L=-w[1],F=-w[2],B=w[3],V=w[4],N=w[5],U=w[6],H=w[7],J=V*B+H*D+N*F-U*L,oe=N*B+H*L+U*D-V*F,ee=U*B+H*F+V*L-N*D,ne=H*B-V*D-N*L-U*F;return r.rotateY(S,w,M),S[4]=J*(B=S[3])+ne*(D=S[0])+oe*(F=S[2])-ee*(L=S[1]),S[5]=oe*B+ne*L+ee*D-J*F,S[6]=ee*B+ne*F+J*L-oe*D,S[7]=ne*B-J*D-oe*L-ee*F,S},nn.rotateZ=function(S,w,M){var D=-w[0],L=-w[1],F=-w[2],B=w[3],V=w[4],N=w[5],U=w[6],H=w[7],J=V*B+H*D+N*F-U*L,oe=N*B+H*L+U*D-V*F,ee=U*B+H*F+V*L-N*D,ne=H*B-V*D-N*L-U*F;return r.rotateZ(S,w,M),S[4]=J*(B=S[3])+ne*(D=S[0])+oe*(F=S[2])-ee*(L=S[1]),S[5]=oe*B+ne*L+ee*D-J*F,S[6]=ee*B+ne*F+J*L-oe*D,S[7]=ne*B-J*D-oe*L-ee*F,S},nn.rotateByQuatAppend=function(S,w,M){var D=M[0],L=M[1],F=M[2],B=M[3],V=w[0],N=w[1],U=w[2],H=w[3];return S[0]=V*B+H*D+N*F-U*L,S[1]=N*B+H*L+U*D-V*F,S[2]=U*B+H*F+V*L-N*D,S[3]=H*B-V*D-N*L-U*F,S[4]=(V=w[4])*B+(H=w[7])*D+(N=w[5])*F-(U=w[6])*L,S[5]=N*B+H*L+U*D-V*F,S[6]=U*B+H*F+V*L-N*D,S[7]=H*B-V*D-N*L-U*F,S},nn.rotateByQuatPrepend=function(S,w,M){var D=w[0],L=w[1],F=w[2],B=w[3],V=M[0],N=M[1],U=M[2],H=M[3];return S[0]=D*H+B*V+L*U-F*N,S[1]=L*H+B*N+F*V-D*U,S[2]=F*H+B*U+D*N-L*V,S[3]=B*H-D*V-L*N-F*U,S[4]=D*(H=M[7])+B*(V=M[4])+L*(U=M[6])-F*(N=M[5]),S[5]=L*H+B*N+F*V-D*U,S[6]=F*H+B*U+D*N-L*V,S[7]=B*H-D*V-L*N-F*U,S},nn.rotateAroundAxis=function(S,w,M,D){if(Math.abs(D)<e.EPSILON)return v(S,w);var L=Math.hypot(M[0],M[1],M[2]);D*=.5;var F=Math.sin(D),B=F*M[0]/L,V=F*M[1]/L,N=F*M[2]/L,U=Math.cos(D),H=w[0],J=w[1],oe=w[2],ee=w[3];S[0]=H*U+ee*B+J*N-oe*V,S[1]=J*U+ee*V+oe*B-H*N,S[2]=oe*U+ee*N+H*V-J*B,S[3]=ee*U-H*B-J*V-oe*N;var ne=w[4],ge=w[5],te=w[6],pe=w[7];return S[4]=ne*U+pe*B+ge*N-te*V,S[5]=ge*U+pe*V+te*B-ne*N,S[6]=te*U+pe*N+ne*V-ge*B,S[7]=pe*U-ne*B-ge*V-te*N,S},nn.add=function(S,w,M){return S[0]=w[0]+M[0],S[1]=w[1]+M[1],S[2]=w[2]+M[2],S[3]=w[3]+M[3],S[4]=w[4]+M[4],S[5]=w[5]+M[5],S[6]=w[6]+M[6],S[7]=w[7]+M[7],S},nn.multiply=E,nn.scale=function(S,w,M){return S[0]=w[0]*M,S[1]=w[1]*M,S[2]=w[2]*M,S[3]=w[3]*M,S[4]=w[4]*M,S[5]=w[5]*M,S[6]=w[6]*M,S[7]=w[7]*M,S},nn.lerp=function(S,w,M,D){var L=1-D;return T(w,M)<0&&(D=-D),S[0]=w[0]*L+M[0]*D,S[1]=w[1]*L+M[1]*D,S[2]=w[2]*L+M[2]*D,S[3]=w[3]*L+M[3]*D,S[4]=w[4]*L+M[4]*D,S[5]=w[5]*L+M[5]*D,S[6]=w[6]*L+M[6]*D,S[7]=w[7]*L+M[7]*D,S},nn.invert=function(S,w){var M=C(w);return S[0]=-w[0]/M,S[1]=-w[1]/M,S[2]=-w[2]/M,S[3]=w[3]/M,S[4]=-w[4]/M,S[5]=-w[5]/M,S[6]=-w[6]/M,S[7]=w[7]/M,S},nn.conjugate=function(S,w){return S[0]=-w[0],S[1]=-w[1],S[2]=-w[2],S[3]=w[3],S[4]=-w[4],S[5]=-w[5],S[6]=-w[6],S[7]=w[7],S},nn.normalize=function(S,w){var M=C(w);if(M>0){M=Math.sqrt(M);var D=w[0]/M,L=w[1]/M,F=w[2]/M,B=w[3]/M,V=w[4],N=w[5],U=w[6],H=w[7],J=D*V+L*N+F*U+B*H;S[0]=D,S[1]=L,S[2]=F,S[3]=B,S[4]=(V-D*J)/M,S[5]=(N-L*J)/M,S[6]=(U-F*J)/M,S[7]=(H-B*J)/M}return S},nn.str=function(S){return"quat2("+S[0]+", "+S[1]+", "+S[2]+", "+S[3]+", "+S[4]+", "+S[5]+", "+S[6]+", "+S[7]+")"},nn.exactEquals=function(S,w){return S[0]===w[0]&&S[1]===w[1]&&S[2]===w[2]&&S[3]===w[3]&&S[4]===w[4]&&S[5]===w[5]&&S[6]===w[6]&&S[7]===w[7]},nn.equals=function(S,w){var M=S[0],D=S[1],L=S[2],F=S[3],B=S[4],V=S[5],N=S[6],U=S[7],H=w[0],J=w[1],oe=w[2],ee=w[3],ne=w[4],ge=w[5],te=w[6],pe=w[7];return Math.abs(M-H)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(H))&&Math.abs(D-J)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(J))&&Math.abs(L-oe)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(oe))&&Math.abs(F-ee)<=e.EPSILON*Math.max(1,Math.abs(F),Math.abs(ee))&&Math.abs(B-ne)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(ne))&&Math.abs(V-ge)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ge))&&Math.abs(N-te)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(te))&&Math.abs(U-pe)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(pe))},nn.sqrLen=nn.squaredLength=nn.len=nn.length=nn.dot=nn.mul=nn.setReal=nn.getReal=void 0;var e=u(Me()),r=u(ds()),c=u(xi());function p(S){if(typeof WeakMap!="function")return null;var w=new WeakMap,M=new WeakMap;return(p=function(D){return D?M:w})(S)}function u(S,w){if(S&&S.__esModule)return S;if(S===null||l(S)!=="object"&&typeof S!="function")return{default:S};var M=p(w);if(M&&M.has(S))return M.get(S);var D={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var F in S)if(F!=="default"&&Object.prototype.hasOwnProperty.call(S,F)){var B=L?Object.getOwnPropertyDescriptor(S,F):null;B&&(B.get||B.set)?Object.defineProperty(D,F,B):D[F]=S[F]}return D.default=S,M&&M.set(S,D),D}function m(S,w,M){var D=.5*M[0],L=.5*M[1],F=.5*M[2],B=w[0],V=w[1],N=w[2],U=w[3];return S[0]=B,S[1]=V,S[2]=N,S[3]=U,S[4]=D*U+L*N-F*V,S[5]=L*U+F*B-D*N,S[6]=F*U+D*V-L*B,S[7]=-D*B-L*V-F*N,S}function v(S,w){return S[0]=w[0],S[1]=w[1],S[2]=w[2],S[3]=w[3],S[4]=w[4],S[5]=w[5],S[6]=w[6],S[7]=w[7],S}function E(S,w,M){var D=w[0],L=w[1],F=w[2],B=w[3],V=M[4],N=M[5],U=M[6],H=M[7],J=w[4],oe=w[5],ee=w[6],ne=w[7],ge=M[0],te=M[1],pe=M[2],xe=M[3];return S[0]=D*xe+B*ge+L*pe-F*te,S[1]=L*xe+B*te+F*ge-D*pe,S[2]=F*xe+B*pe+D*te-L*ge,S[3]=B*xe-D*ge-L*te-F*pe,S[4]=D*H+B*V+L*U-F*N+J*xe+ne*ge+oe*pe-ee*te,S[5]=L*H+B*N+F*V-D*U+oe*xe+ne*te+ee*ge-J*pe,S[6]=F*H+B*U+D*N-L*V+ee*xe+ne*pe+J*te-oe*ge,S[7]=B*H-D*V-L*N-F*U+ne*xe-J*ge-oe*te-ee*pe,S}nn.getReal=r.copy,nn.setReal=r.copy,nn.mul=E;var T=r.dot;nn.dot=T;var _=r.length;nn.length=_,nn.len=_;var C=r.squaredLength;return nn.squaredLength=C,nn.sqrLen=C,nn}var Nc,cl,en={};function zc(){if(Nc)return en;function l(w){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(w)}Nc=1,Object.defineProperty(en,"__esModule",{value:!0}),en.create=c,en.clone=function(w){var M=new e.ARRAY_TYPE(2);return M[0]=w[0],M[1]=w[1],M},en.fromValues=function(w,M){var D=new e.ARRAY_TYPE(2);return D[0]=w,D[1]=M,D},en.copy=function(w,M){return w[0]=M[0],w[1]=M[1],w},en.set=function(w,M,D){return w[0]=M,w[1]=D,w},en.add=function(w,M,D){return w[0]=M[0]+D[0],w[1]=M[1]+D[1],w},en.subtract=p,en.multiply=u,en.divide=m,en.ceil=function(w,M){return w[0]=Math.ceil(M[0]),w[1]=Math.ceil(M[1]),w},en.floor=function(w,M){return w[0]=Math.floor(M[0]),w[1]=Math.floor(M[1]),w},en.min=function(w,M,D){return w[0]=Math.min(M[0],D[0]),w[1]=Math.min(M[1],D[1]),w},en.max=function(w,M,D){return w[0]=Math.max(M[0],D[0]),w[1]=Math.max(M[1],D[1]),w},en.round=function(w,M){return w[0]=Math.round(M[0]),w[1]=Math.round(M[1]),w},en.scale=function(w,M,D){return w[0]=M[0]*D,w[1]=M[1]*D,w},en.scaleAndAdd=function(w,M,D,L){return w[0]=M[0]+D[0]*L,w[1]=M[1]+D[1]*L,w},en.distance=v,en.squaredDistance=E,en.length=T,en.squaredLength=_,en.negate=function(w,M){return w[0]=-M[0],w[1]=-M[1],w},en.inverse=function(w,M){return w[0]=1/M[0],w[1]=1/M[1],w},en.normalize=function(w,M){var D=M[0],L=M[1],F=D*D+L*L;return F>0&&(F=1/Math.sqrt(F)),w[0]=M[0]*F,w[1]=M[1]*F,w},en.dot=function(w,M){return w[0]*M[0]+w[1]*M[1]},en.cross=function(w,M,D){var L=M[0]*D[1]-M[1]*D[0];return w[0]=w[1]=0,w[2]=L,w},en.lerp=function(w,M,D,L){var F=M[0],B=M[1];return w[0]=F+L*(D[0]-F),w[1]=B+L*(D[1]-B),w},en.random=function(w,M){M=M||1;var D=2*e.RANDOM()*Math.PI;return w[0]=Math.cos(D)*M,w[1]=Math.sin(D)*M,w},en.transformMat2=function(w,M,D){var L=M[0],F=M[1];return w[0]=D[0]*L+D[2]*F,w[1]=D[1]*L+D[3]*F,w},en.transformMat2d=function(w,M,D){var L=M[0],F=M[1];return w[0]=D[0]*L+D[2]*F+D[4],w[1]=D[1]*L+D[3]*F+D[5],w},en.transformMat3=function(w,M,D){var L=M[0],F=M[1];return w[0]=D[0]*L+D[3]*F+D[6],w[1]=D[1]*L+D[4]*F+D[7],w},en.transformMat4=function(w,M,D){var L=M[0],F=M[1];return w[0]=D[0]*L+D[4]*F+D[12],w[1]=D[1]*L+D[5]*F+D[13],w},en.rotate=function(w,M,D,L){var F=M[0]-D[0],B=M[1]-D[1],V=Math.sin(L),N=Math.cos(L);return w[0]=F*N-B*V+D[0],w[1]=F*V+B*N+D[1],w},en.angle=function(w,M){var D=w[0],L=w[1],F=M[0],B=M[1],V=Math.sqrt(D*D+L*L)*Math.sqrt(F*F+B*B);return Math.acos(Math.min(Math.max(V&&(D*F+L*B)/V,-1),1))},en.zero=function(w){return w[0]=0,w[1]=0,w},en.str=function(w){return"vec2("+w[0]+", "+w[1]+")"},en.exactEquals=function(w,M){return w[0]===M[0]&&w[1]===M[1]},en.equals=function(w,M){var D=w[0],L=w[1],F=M[0],B=M[1];return Math.abs(D-F)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(F))&&Math.abs(L-B)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(B))},en.forEach=en.sqrLen=en.sqrDist=en.dist=en.div=en.mul=en.sub=en.len=void 0;var e=function(w,M){if(w&&w.__esModule)return w;if(w===null||l(w)!=="object"&&typeof w!="function")return{default:w};var D=r(void 0);if(D&&D.has(w))return D.get(w);var L={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=F?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(L,B,V):L[B]=w[B]}return L.default=w,D&&D.set(w,L),L}(Me());function r(w){if(typeof WeakMap!="function")return null;var M=new WeakMap,D=new WeakMap;return(r=function(L){return L?D:M})(w)}function c(){var w=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0),w}function p(w,M,D){return w[0]=M[0]-D[0],w[1]=M[1]-D[1],w}function u(w,M,D){return w[0]=M[0]*D[0],w[1]=M[1]*D[1],w}function m(w,M,D){return w[0]=M[0]/D[0],w[1]=M[1]/D[1],w}function v(w,M){return Math.hypot(M[0]-w[0],M[1]-w[1])}function E(w,M){var D=M[0]-w[0],L=M[1]-w[1];return D*D+L*L}function T(w){return Math.hypot(w[0],w[1])}function _(w){var M=w[0],D=w[1];return M*M+D*D}en.len=T,en.sub=p,en.mul=u,en.div=m,en.dist=v,en.sqrDist=E,en.sqrLen=_;var C,S=(C=c(),function(w,M,D,L,F,B){var V,N;for(M||(M=2),D||(D=0),N=L?Math.min(L*M+D,w.length):w.length,V=D;V<N;V+=M)C[0]=w[V],C[1]=w[V+1],F(C,C,B),w[V]=C[0],w[V+1]=C[1];return w});return en.forEach=S,en}function wo(){if(cl)return G;function l(w){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},l(w)}cl=1,Object.defineProperty(G,"__esModule",{value:!0}),G.vec4=G.vec3=G.vec2=G.quat2=G.quat=G.mat4=G.mat3=G.mat2d=G.mat2=G.glMatrix=void 0;var e=S(Me());G.glMatrix=e;var r=S(Ye());G.mat2=r;var c=S(Ht());G.mat2d=c;var p=S(Ln());G.mat3=p;var u=S(xi());G.mat4=u;var m=S(ds());G.quat=m;var v=S(xa());G.quat2=v;var E=S(zc());G.vec2=E;var T=S(va());G.vec3=T;var _=S(wr());function C(w){if(typeof WeakMap!="function")return null;var M=new WeakMap,D=new WeakMap;return(C=function(L){return L?D:M})(w)}function S(w,M){if(w&&w.__esModule)return w;if(w===null||l(w)!=="object"&&typeof w!="function")return{default:w};var D=C(M);if(D&&D.has(w))return D.get(w);var L={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=F?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(L,B,V):L[B]=w[B]}return L.default=w,D&&D.set(w,L),L}return G.vec4=_,G}var ao,ul,Bc,ba,Ee=wo(),hs=function(){if(ul)return ao;function l(e,r,c,p){this.cx=3*e,this.bx=3*(c-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=c,this.p2y=p}return ul=1,ao=l,l.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,p=0;p<8;p++){var u=this.sampleCurveX(c)-e;if(Math.abs(u)<r)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=u/m}var v=0,E=1;for(c=e,p=0;p<20&&(u=this.sampleCurveX(c),!(Math.abs(u-e)<r));p++)e>u?v=c:E=c,c=.5*(E-v)+v;return c},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},ao}(),$s=R(hs);function Vc(){if(ba)return Bc;function l(e,r){this.x=e,this.y=r}return ba=1,Bc=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,c=e.y-this.y;return r*r+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),c=Math.sin(e),p=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=p,this},_rotateAround:function(e,r){var c=Math.cos(e),p=Math.sin(e),u=r.y+p*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-p*(this.y-r.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(e){return e instanceof l?e:Array.isArray(e)?new l(e[0],e[1]):e},Bc}var lt=R(Vc());function wa(l,e){if(Array.isArray(l)){if(!Array.isArray(e)||l.length!==e.length)return!1;for(let r=0;r<l.length;r++)if(!wa(l[r],e[r]))return!1;return!0}if(typeof l=="object"&&l!==null&&e!==null){if(typeof e!="object"||Object.keys(l).length!==Object.keys(e).length)return!1;for(let r in l)if(!wa(l[r],e[r]))return!1;return!0}return l===e}let er=Math.PI/180,fs=180/Math.PI;function pn(l){return l*er}function Ki(l){return l*fs}let Co=[[0,0],[1,0],[1,1],[0,1]];function Ca(l){if(l<=0)return 0;if(l>=1)return 1;let e=l*l,r=e*l;return 4*(l<.5?r:3*(l-e)+r-.75)}function Gs(l,e,r,c){let p=new $s(l,e,r,c);return function(u){return p.solve(u)}}let dl=Gs(.25,.1,.25,1);function Wt(l,e,r){return Math.min(r,Math.max(e,l))}function hl(l,e,r){return(r=Wt((r-l)/(e-l),0,1))*r*(3-2*r)}function ps(l,e,r){let c=r-e,p=((l-e)%c+c)%c+e;return p===e?r:p}function Ea(l,e,r){if(!l.length)return r(null,[]);let c=l.length,p=new Array(l.length),u=null;l.forEach((m,v)=>{e(m,(E,T)=>{E&&(u=E),p[v]=T,--c==0&&r(u,p)})})}function pr(l,...e){for(let r of e)for(let c in r)l[c]=r[c];return l}let Ur=1;function jc(){return Ur++}function Uc(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function fl(l,e){l.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ms(l,e){return l.indexOf(e,l.length-e.length)!==-1}function Ma(l,e,r){let c={};for(let p in l)c[p]=e.call(this,l[p],p,l);return c}function pl(l,e,r){let c={};for(let p in l)e.call(this,l[p],p,l)&&(c[p]=l[p]);return c}function lo(l){return Array.isArray(l)?l.map(lo):typeof l=="object"&&l?Ma(l,lo):l}let $c={};function xn(l){$c[l]||(typeof console<"u"&&console.warn(l),$c[l]=!0)}function Vo(l,e,r){return(r.y-l.y)*(e.x-l.x)>(e.y-l.y)*(r.x-l.x)}function ld(l){let e=0;for(let r,c,p=0,u=l.length,m=u-1;p<u;m=p++)r=l[p],c=l[m],e+=(c.x-r.x)*(r.y+c.y);return e}function $r([l,e,r]){let c=pn(e+90),p=pn(r);return{x:l*Math.cos(c)*Math.sin(p),y:l*Math.sin(c)*Math.sin(p),z:l*Math.cos(p),azimuthal:e,polar:r}}function Sa(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Gc(l){let e={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,c,p,u)=>{let m=p||u;return e[c]=!m||m.toLowerCase(),""}),e["max-age"]){let r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Hc=null;function ml(l,e){return[l[4*e],l[4*e+1],l[4*e+2],l[4*e+3]]}function qc(l,e,r,c){for(;e<r;){let p=e+r>>1;l[p]<c?e=p+1:r=p}return e}function Ve(l,e,r,c){for(;e<r;){let p=e+r>>1;l[p]<=c?e=p+1:r=p}return e}function Y(l){return l>0?1/(1.001-l):1+l}function K(l){return l>0?1-1/(1.001-l):-l}let ce={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ce.API_URL)return null;try{let l=new URL(ce.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ce(l){return ce.API_URL_REGEX.test(l)}function me(l){return ce.API_SPRITE_REGEX.test(l)}let Te,ze,Ae,Be,$e,Ge;function it(){return Te==null&&(Te=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Te}let dt={now:()=>Be!==void 0?Be:performance.now(),setNow(l){Be=l},restoreNow(){Be=void 0},frame(l){let e=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(l,e=0){let{width:r,height:c}=l;$e||($e=document.createElement("canvas"));let p=$e.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(r>$e.width||c>$e.height)&&($e.width=r,$e.height=c),p.clearRect(-e,-e,r+2*e,c+2*e),p.drawImage(l,0,0,r,c),p.getImageData(-e,-e,r+2*e,c+2*e)},resolveURL:l=>(ze||(ze=document.createElement("a")),ze.href=l,ze.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ae==null&&(Ae=window.matchMedia("(prefers-reduced-motion: reduce)")),Ae.matches)},hasCanvasFingerprintNoise(){if(Ge!==void 0)return Ge;if(!it())return Ge=!1,!1;let l=new OffscreenCanvas(85,1),e=l.getContext("2d",{willReadFrequently:!0}),r=0;for(let p=0;p<l.width;++p)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(p,0,1,1);let c=e.getImageData(0,0,l.width,l.height);r=0;for(let p=0;p<c.data.length;++p)if(p%4!=3&&r++!==c.data[p])return Ge=!0,!0;return Ge=!1,!1}};function xt(l,e){let r=l.indexOf("?");if(r<0)return`${l}?${new URLSearchParams(e).toString()}`;let c=new URLSearchParams(l.slice(r));for(let p in e)c.set(p,e[p]);return`${l.slice(0,r)}?${c.toString()}`}function Bt(l,e={persistentParams:[]}){let r=l.indexOf("?");if(r<0)return l;let c=new URLSearchParams,p=new URLSearchParams(l.slice(r));for(let m of e.persistentParams){let v=p.get(m);v&&c.set(m,v)}let u=c.toString();return`${l.slice(0,r)}${u.length>0?`?${u}`:""}`}let Zt="mapbox-tiles",Xt=500,Vt=50,zn=["language","worldview","jobid"],Sn,ln;function Zn(){try{return caches}catch{}}function ci(){let l=Zn();l&&Sn==null&&(Sn=l.open(Zt))}let Zi=1/0,tr={supported:!1,testSupport:function(l){!Hs&&nr&&(jo?ud(l):Bi=l)}},Bi,nr,Hs=!1,jo=!1,cd=typeof self<"u"?self:{};function ud(l){let e=l.createTexture();l.bindTexture(l.TEXTURE_2D,e);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,nr),l.isContextLost())return;tr.supported=!0}catch{}l.deleteTexture(e),Hs=!0}cd.document&&(nr=cd.document.createElement("img"),nr.onload=function(){Bi&&ud(Bi),Bi=null,jo=!0},nr.onerror=function(){Hs=!0,Bi=null},nr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let dd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(dd);class Af extends Error{constructor(e,r,c){r===401&&Ce(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Pf=Sa()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,gl=function(l,e){if(!(/^file:/.test(r=l.url)||/^file:/.test(Pf())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,p){let u=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Pf(),referrerPolicy:c.referrerPolicy,signal:u.signal}),v=!1,E=!1,T=(_=m.url).indexOf("sku=")>0&&Ce(_);var _;c.type==="json"&&m.headers.set("Accept","application/json");let C=(w,M,D)=>{if(E)return;if(w&&w.message!=="SecurityError"&&xn(w.toString()),M&&D)return S(M);let L=Date.now();fetch(m).then(F=>{if(F.ok){let B=T?F.clone():null;return S(F,B,L)}return p(new Af(F.statusText,F.status,c.url))}).catch(F=>{F.name!=="AbortError"&&p(new Error(`${F.message} ${c.url}`))})},S=(w,M,D)=>{(c.type==="arrayBuffer"?w.arrayBuffer():c.type==="json"?w.json():w.text()).then(L=>{E||(M&&D&&function(F,B,V){if(ci(),Sn==null)return;let N=Gc(B.headers.get("Cache-Control")||"");if(N["no-store"])return;let U={status:B.status,statusText:B.statusText,headers:new Headers};B.headers.forEach((oe,ee)=>U.headers.set(ee,oe)),N["max-age"]&&U.headers.set("Expires",new Date(V+1e3*N["max-age"]).toUTCString());let H=U.headers.get("Expires");if(!H||new Date(H).getTime()-V<42e4)return;let J=Bt(F.url,{persistentParams:zn});if(B.status===206){let oe=F.headers.get("Range");if(!oe)return;U.status=200,J=xt(J,{range:oe})}(function(oe,ee){if(ln===void 0)try{new Response(new ReadableStream),ln=!0}catch{ln=!1}ln?ee(oe.body):oe.blob().then(ee)})(B,oe=>{let ee=new Response((ne=B.status)!==200&&ne!==404&&[101,103,204,205,304].includes(ne)?null:oe,U);var ne;ci(),Sn?.then(ge=>ge.put(J,ee)).catch(ge=>xn(ge.message))})}(m,M,D),v=!0,p(null,L,w.headers.get("Cache-Control"),w.headers.get("Expires")))}).catch(L=>{E||p(new Error(L.message))})};return T?function(w,M){if(ci(),Sn==null)return M(null);Sn.then(D=>{let L=Bt(w.url,{persistentParams:zn}),F=w.headers.get("Range");F&&(L=xt(L,{range:F})),D.match(L).then(B=>{let V=function(N){if(!N)return!1;let U=new Date(N.headers.get("Expires")||0),H=Gc(N.headers.get("Cache-Control")||"");return U>Date.now()&&!H["no-cache"]}(B);D.delete(L),V&&D.put(L,B.clone()),M(null,B,V)}).catch(M)}).catch(M)}(m,C):C(null,null),{cancel:()=>{E=!0,v||u.abort()}}}(l,e);if(Sa()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,e,void 0,!0)}var r;return function(c,p){let u=new XMLHttpRequest;u.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let m in c.headers)u.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=c.credentials==="include",u.onerror=()=>{p(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let m=u.response;if(c.type==="json")try{m=JSON.parse(u.response)}catch(v){return p(v)}p(null,m,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else p(new Af(u.statusText,u.status,c.url))},u.send(c.body),{cancel:()=>u.abort()}}(l,e)},_l=function(l,e){return gl(pr(l,{type:"arrayBuffer"}),e)};function co(l){let e=document.createElement("a");return e.href=l,e.protocol===location.protocol&&e.host===location.host}let Eo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Mo,Dr;Mo=[],Dr=0;let Uo=function(l,e){if(tr.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),Dr>=ce.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:l,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Mo.push(u),u}Dr++;let r=!1,c=()=>{if(!r)for(r=!0,Dr--;Mo.length&&Dr<ce.MAX_PARALLEL_IMAGE_REQUESTS;){let u=Mo.shift(),{requestParameters:m,callback:v,cancelled:E}=u;E||(u.cancel=Uo(m,v).cancel)}},p=_l(l,(u,m,v,E)=>{c(),u?e(u):m&&(self.createImageBitmap?function(T,_){let C=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(C).then(S=>{_(null,S)}).catch(S=>{_(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(T,_)=>e(T,_,v,E)):function(T,_){let C=new Image;C.onload=()=>{_(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=Eo})},C.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let S=new Blob([new Uint8Array(T)],{type:"image/png"});C.src=T.byteLength?URL.createObjectURL(S):Eo}(m,(T,_)=>e(T,_,v,E)))});return{cancel:()=>{p.cancel(),c()}}};var Wc,Rf,Of,$o={exports:{}},hd={exports:{}},Og={exports:{}},cx=function(){if(Of)return $o.exports;Of=1;var l=(Wc||(Wc=1,hd.exports=function(r,c){var p,u,m,v,E,T,_,C;for(u=r.length-(p=3&r.length),m=c,E=3432918353,T=461845907,C=0;C<u;)_=255&r.charCodeAt(C)|(255&r.charCodeAt(++C))<<8|(255&r.charCodeAt(++C))<<16|(255&r.charCodeAt(++C))<<24,++C,m=27492+(65535&(v=5*(65535&(m=(m^=_=(65535&(_=(_=(65535&_)*E+(((_>>>16)*E&65535)<<16)&4294967295)<<15|_>>>17))*T+(((_>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(_=0,p){case 3:_^=(255&r.charCodeAt(C+2))<<16;case 2:_^=(255&r.charCodeAt(C+1))<<8;case 1:m^=_=(65535&(_=(_=(65535&(_^=255&r.charCodeAt(C)))*E+(((_>>>16)*E&65535)<<16)&4294967295)<<15|_>>>17))*T+(((_>>>16)*T&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),hd.exports),e=(Rf||(Rf=1,Og.exports=function(r,c){for(var p,u=r.length,m=c^u,v=0;u>=4;)p=1540483477*(65535&(p=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(p>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),u-=4,++v;switch(u){case 3:m^=(255&r.charCodeAt(v+2))<<16;case 2:m^=(255&r.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Og.exports);return $o.exports=l,$o.exports.murmur3=l,$o.exports.murmur2=e,$o.exports}(),Ar=R(cx);class qs{constructor(e,...r){pr(this,r[0]||{}),this.type=e}}class Zc extends qs{constructor(e,r={}){super("error",pr({error:e},r))}}function yl(l,e,r){r[l]&&r[l].indexOf(e)!==-1||(r[l]=r[l]||[],r[l].push(e))}function Lf(l,e,r){if(r&&r[l]){let c=r[l].indexOf(e);c!==-1&&r[l].splice(c,1)}}class vl{on(e,r){return this._listeners=this._listeners||{},yl(e,r,this._listeners),this}off(e,r){return Lf(e,r,this._listeners),Lf(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},yl(e,r,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,r){let c=typeof e=="string"?new qs(e,r):e,p=c.type;if(this.listens(p)){c.target=this;let u=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(let E of u)E.call(this,c);let m=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(let E of m)Lf(p,E,this._oneTimeListeners),E.call(this,c);let v=this._eventedParent;v&&(pr(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(c))}else c instanceof Zc&&console.error(c.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ff,Tn={},kf=function(){if(Ff)return Tn;Ff=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function r(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function c(u){return(m=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:m>1?1:m;var m}function p(u,m,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?u+(m-u)*v*6:2*v<1?m:3*v<2?u+(m-u)*(2/3-v)*6:u}try{Tn.parseCSSColor=function(u){var m,v=u.replace(/ /g,"").toLowerCase();if(v in l)return l[v].slice();if(v[0]==="#")return v.length===4?(m=parseInt(v.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:v.length===7&&(m=parseInt(v.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var E=v.indexOf("("),T=v.indexOf(")");if(E!==-1&&T+1===v.length){var _=v.substr(0,E),C=v.substr(E+1,T-(E+1)).split(","),S=1;switch(_){case"rgba":if(C.length!==4)return null;S=c(C.pop());case"rgb":return C.length!==3?null:[r(C[0]),r(C[1]),r(C[2]),S];case"hsla":if(C.length!==4)return null;S=c(C.pop());case"hsl":if(C.length!==3)return null;var w=(parseFloat(C[0])%360+360)%360/360,M=c(C[1]),D=c(C[2]),L=D<=.5?D*(M+1):D+M-D*M,F=2*D-L;return[e(255*p(F,L,w+1/3)),e(255*p(F,L,w)),e(255*p(F,L,w-1/3)),S];default:return null}}return null}}catch{}return Tn}();class Un{constructor(e,r,c,p=1){this.r=e,this.g=r,this.b=c,this.a=p}static parse(e){if(!e)return;if(e instanceof Un)return e;if(typeof e!="string")return;let r=kf.parseCSSColor(e);return r?new Un(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){let[e,r,c,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(c)},${p})`}toRenderColor(e){let{r,g:c,b:p,a:u}=this;return new ux(e,r,c,p,u)}}class ux{constructor(e,r,c,p,u){if(e){let m=e.image.height,v=m*m;r=u===0?0:r/u*(m-1),c=u===0?0:c/u*(m-1),p=u===0?0:p/u*(m-1);let E=Math.floor(r),T=Math.floor(c),_=Math.floor(p),C=Math.ceil(r),S=Math.ceil(c),w=Math.ceil(p),M=r-E,D=c-T,L=p-_,F=e.image.data,B=4*(E+T*v+_*m),V=4*(E+T*v+w*m),N=4*(E+S*v+_*m),U=4*(E+S*v+w*m),H=4*(C+T*v+_*m),J=4*(C+T*v+w*m),oe=4*(C+S*v+_*m),ee=4*(C+S*v+w*m);if(B<0||ee>=F.length)throw new Error("out of range");this.r=kt(kt(kt(F[B],F[V],L),kt(F[N],F[U],L),D),kt(kt(F[H],F[J],L),kt(F[oe],F[ee],L),D),M)/255*u,this.g=kt(kt(kt(F[B+1],F[V+1],L),kt(F[N+1],F[U+1],L),D),kt(kt(F[H+1],F[J+1],L),kt(F[oe+1],F[ee+1],L),D),M)/255*u,this.b=kt(kt(kt(F[B+2],F[V+2],L),kt(F[N+2],F[U+2],L),D),kt(kt(F[H+2],F[J+2],L),kt(F[oe+2],F[ee+2],L),D),M)/255*u,this.a=u}else this.r=r,this.g=c,this.b=p,this.a=u}toArray(){let{r:e,g:r,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*r/p,255*c/p,p]}toArray01(){let{r:e,g:r,b:c,a:p}=this;return p===0?[0,0,0,0]:[e/p,r/p,c/p,p]}toArray01Scaled(e){let{r,g:c,b:p,a:u}=this;return u===0?[0,0,0]:[r/u*e,c/u*e,p/u*e]}toArray01PremultipliedAlpha(){let{r:e,g:r,b:c,a:p}=this;return[e,r,c,p]}toArray01Linear(){let{r:e,g:r,b:c,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(e/p,2.2),Math.pow(r/p,2.2),Math.pow(c/p,2.2),p]}}function kt(l,e,r){return l*(1-r)+e*r}function Xc(l,e,r){return l.map((c,p)=>kt(c,e[p],r))}Un.black=new Un(0,0,0,1),Un.white=new Un(1,1,1,1),Un.transparent=new Un(0,0,0,0),Un.red=new Un(1,0,0,1),Un.blue=new Un(0,0,1,1);var Ta=Object.freeze({__proto__:null,array:Xc,color:function(l,e,r){return new Un(kt(l.r,e.r,r),kt(l.g,e.g,r),kt(l.b,e.b,r),kt(l.a,e.a,r))},number:kt});function xl(l,...e){for(let r of e)for(let c in r)l[c]=r[c];return l}class So extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class fd{constructor(e,r=[]){this.parent=e,this.bindings={};for(let[c,p]of r)this.bindings[c]=p}concat(e){return new fd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let To={kind:"null"},vt={kind:"number"},bn={kind:"string"},wn={kind:"boolean"},Pr={kind:"color"},mr={kind:"object"},En={kind:"value"},pd={kind:"collator"},bl={kind:"formatted"},wl={kind:"resolvedImage"};function Cr(l,e){return{kind:"array",itemType:l,N:e}}function Ii(l){if(l.kind==="array"){let e=Ii(l.itemType);return typeof l.N=="number"?`array<${e}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${e}>`}return l.kind}let Lg=[To,vt,bn,wn,Pr,bl,mr,Cr(En),wl];function Cl(l,e){if(e.kind==="error")return null;if(l.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Cl(l.itemType,e.itemType))&&(typeof l.N!="number"||l.N===e.N))return null}else{if(l.kind===e.kind)return null;if(l.kind==="value"){for(let r of Lg)if(!Cl(r,e))return null}}return`Expected ${Ii(l)} but found ${Ii(e)} instead.`}function El(l,e){return e.some(r=>r.kind===l.kind)}function Go(l,e){return e.some(r=>r==="null"?l===null:r==="array"?Array.isArray(l):r==="object"?l&&!Array.isArray(l)&&typeof l=="object":r===typeof l)}class md{constructor(e,r,c){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gr{constructor(e,r,c,p,u){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=c,this.fontStack=p,this.textColor=u}}class gr{constructor(e){this.sections=e}static fromString(e){return new gr([new Gr(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof gr?e:gr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);let c={};r.fontStack&&(c["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(c["font-scale"]=r.scale),r.textColor&&(c["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(c)}return e}}class Er{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new Er({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Fg(l,e,r,c){return typeof l=="number"&&l>=0&&l<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[l,e,r,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[l,e,r,c]:[l,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ws(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Un||l instanceof md||l instanceof gr||l instanceof Er)return!0;if(Array.isArray(l)){for(let e of l)if(!Ws(e))return!1;return!0}if(typeof l=="object"){for(let e in l)if(!Ws(l[e]))return!1;return!0}return!1}function Oi(l){if(l===null)return To;if(typeof l=="string")return bn;if(typeof l=="boolean")return wn;if(typeof l=="number")return vt;if(l instanceof Un)return Pr;if(l instanceof md)return pd;if(l instanceof gr)return bl;if(l instanceof Er)return wl;if(Array.isArray(l)){let e=l.length,r;for(let c of l){let p=Oi(c);if(r){if(r===p)continue;r=En;break}r=p}return Cr(r||En,e)}return mr}function Mr(l){let e=typeof l;return l===null?"":e==="string"||e==="number"||e==="boolean"?String(l):l instanceof Un||l instanceof gr||l instanceof Er?l.toString():JSON.stringify(l)}class Io{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ws(e[1]))return r.error("invalid value");let c=e[1],p=Oi(c),u=r.expectedType;return p.kind!=="array"||p.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(p=u),new Io(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Un?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof gr?this.value.serialize():this.value}}class Xi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Nf={string:bn,number:vt,boolean:wn,object:mr};class Do{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let c,p=1,u=e[0];if(u==="array"){let v,E;if(e.length>2){let T=e[1];if(typeof T!="string"||!(T in Nf)||T==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=Nf[T],p++}else v=En;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);E=e[2],p++}c=Cr(v,E)}else c=Nf[u];let m=[];for(;p<e.length;p++){let v=r.parse(e[p],p,En);if(!v)return null;m.push(v)}return new Do(c,m)}evaluate(e){for(let r=0;r<this.args.length;r++){let c=this.args[r].evaluate(e);if(!Cl(this.type,Oi(c)))return c;if(r===this.args.length-1)throw new Xi(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${Ii(Oi(c))} but was expected to be of type ${Ii(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,r=[e.kind];if(e.kind==="array"){let c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){r.push(c.kind);let p=e.N;(typeof p=="number"||this.args.length>1)&&r.push(p)}}return r.concat(this.args.map(c=>c.serialize()))}}class Ml{constructor(e){this.type=bl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let c=e[1];if(!Array.isArray(c)&&typeof c=="object")return r.error("First argument must be an image or text section.");let p=[],u=!1;for(let m=1;m<=e.length-1;++m){let v=e[m];if(u&&typeof v=="object"&&!Array.isArray(v)){u=!1;let E=null;if(v["font-scale"]&&(E=r.parseObjectValue(v["font-scale"],m,"font-scale",vt),!E))return null;let T=null;if(v["text-font"]&&(T=r.parseObjectValue(v["text-font"],m,"text-font",Cr(bn)),!T))return null;let _=null;if(v["text-color"]&&(_=r.parseObjectValue(v["text-color"],m,"text-color",Pr),!_))return null;let C=p[p.length-1];C.scale=E,C.font=T,C.textColor=_}else{let E=r.parse(e[m],m,En);if(!E)return null;let T=E.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new Ml(p)}evaluate(e){return new gr(this.sections.map(r=>{let c=r.content.evaluate(e);return Oi(c)===wl?new Gr("",c,null,null,null):new Gr(Mr(c),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(let r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let r of this.sections){e.push(r.content.serialize());let c={};r.scale&&(c["font-scale"]=r.scale.serialize()),r.font&&(c["text-font"]=r.font.serialize()),r.textColor&&(c["text-color"]=r.textColor.serialize()),e.push(c)}return e}}class Ia{constructor(e,r){this.type=wl,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let c=r.parse(e[1],1,bn);if(!c)return r.error("No image name provided.");if(e.length===2)return new Ia(c);let p=r.parse(e[2],1,bn);return p?new Ia(c,p):r.error("Secondary image variant is not a string.")}evaluate(e){let r=Er.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Da(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}let gd={"to-boolean":wn,"to-color":Pr,"to-number":vt,"to-string":bn};class gs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let c=e[0],p=[],u=To;if(c==="to-array"){if(!Array.isArray(e[1]))return null;let m=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);u=Cr(r.expectedType.itemType,m)}else{if(!(m>0&&Ws(e[1][0])))return null;u=Cr(Oi(e[1][0]),m)}for(let v=0;v<m;v++){let E=e[1][v],T;if(Da(E)==="array")T=r.parse(E,void 0,u.itemType);else{let _=Da(E);if(_!==u.itemType.kind)return r.error(`Expected ${u.itemType.kind} but found ${_}.`);T=r.registry.literal.parse(["literal",E===void 0?null:E],r)}if(!T)return null;p.push(T)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return r.error("Expected one argument.");u=gd[c];for(let m=1;m<e.length;m++){let v=r.parse(e[m],m,En);if(!v)return null;p.push(v)}}return new gs(u,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,c;for(let p of this.args){if(r=p.evaluate(e),c=null,r instanceof Un)return r;if(typeof r=="string"){let u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(c=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Fg(r[0],r[1],r[2],r[3]),!c))return new Un(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Xi(c||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(let c of this.args){if(r=c.evaluate(e),r===null)return 0;let p=Number(r);if(!isNaN(p))return p}throw new Xi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?gr.fromString(Mr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Er.fromString(Mr(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Mr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ml([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ia(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}let dx=["Unknown","Point","LineString","Polygon"];class kg{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dx[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*r-e[0])+this.featureDistanceData.bearing[1]*(p*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Un.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class Rr{constructor(e,r,c,p,u){this.name=e,this.type=r,this._evaluate=c,this.args=p,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let r=Rr.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){let c=e[0],p=Rr.definitions[c];if(!p)return r.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(p)?p[0]:p.type,m=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,v=[],E=null,T=-1;for(let[_,C]of m){if(Array.isArray(_)&&_.length!==e.length-1)continue;v.push(_),T++,E=new Zg(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);let S=[],w=!1;for(let M=1;M<e.length;M++){let D=e[M],L=Array.isArray(_)?_[M-1]:_.type,F=E.parse(D,1+S.length,L);if(!F){w=!0;break}S.push(F)}if(!w)if(Array.isArray(_)&&_.length!==S.length)E.error(`Expected ${_.length} arguments, but found ${S.length} instead.`);else{for(let M=0;M<S.length;M++){let D=Array.isArray(_)?_[M]:_.type,L=S[M];E.concat(M+1).checkSubtype(D,L.type)}if(E.errors.length===0)return new Rr(c,u,C,S,T)}}if(v.length===1)r.errors.push(...E.errors);else{let _=(v.length?v:m.map(([S])=>S)).map(hx).join(" | "),C=[];for(let S=1;S<e.length;S++){let w=r.parse(e[S],1+C.length);if(!w)return null;C.push(Ii(w.type))}r.error(`Expected arguments of type ${_}, but found (${C.join(", ")}) instead.`)}return null}static register(e,r){Rr.definitions=r;for(let c in r)e[c]=Rr}}function hx(l){return Array.isArray(l)?`(${l.map(Ii).join(", ")})`:`(${Ii(l.type)}...)`}class _d{constructor(e,r,c){this.type=pd,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");let c=e[1];if(typeof c!="object"||Array.isArray(c))return r.error("Collator options argument must be an object.");let p=c["case-sensitive"]===void 0?r.parse(!1,1,wn):r.parseObjectValue(c["case-sensitive"],1,"case-sensitive",wn);if(!p)return null;let u=c["diacritic-sensitive"]===void 0?r.parse(!1,1,wn):r.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",wn);if(!u)return null;let m=null;return c.locale&&(m=r.parseObjectValue(c.locale,1,"locale",bn),!m)?null:new _d(p,u,m)}evaluate(e){return new md(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Ng(l,e,r=0,c=l.length-1,p=Tl){for(;c>r;){if(c-r>600){let E=c-r+1,T=e-r+1,_=Math.log(E),C=.5*Math.exp(2*_/3),S=.5*Math.sqrt(_*C*(E-C)/E)*(T-E/2<0?-1:1);Ng(l,e,Math.max(r,Math.floor(e-T*C/E+S)),Math.min(c,Math.floor(e+(E-T)*C/E+S)),p)}let u=l[e],m=r,v=c;for(Sl(l,r,e),p(l[c],u)>0&&Sl(l,r,c);m<v;){for(Sl(l,m,v),m++,v--;p(l[m],u)<0;)m++;for(;p(l[v],u)>0;)v--}p(l[r],u)===0?Sl(l,r,v):(v++,Sl(l,v,c)),v<=e&&(r=v+1),e<=v&&(c=v-1)}}function Sl(l,e,r){let c=l[e];l[e]=l[r],l[r]=c}function Tl(l,e){return l<e?-1:l>e?1:0}function fx(l){let e=0;for(let r,c,p=0,u=l.length,m=u-1;p<u;m=p++)r=l[p],c=l[m],e+=(c.x-r.x)*(r.y+c.y);return e}function Yc(l,e){l[0]=Math.min(l[0],e[0]),l[1]=Math.min(l[1],e[1]),l[2]=Math.max(l[2],e[0]),l[3]=Math.max(l[3],e[1])}function Aa(l,e){return!(l[0]<=e[0]||l[2]>=e[2]||l[1]<=e[1]||l[3]>=e[3])}function px(l,e,r){let c=l[0]-e[0],p=l[1]-e[1],u=l[0]-r[0],m=l[1]-r[1];return c*m-u*p==0&&c*u<=0&&p*m<=0}function Il(l,e,r=!1){let c=!1;for(let v=0,E=e.length;v<E;v++){let T=e[v];for(let _=0,C=T.length,S=C-1;_<C;S=_++){let w=T[S],M=T[_];if(px(l,w,M))return r;(u=w)[1]>(p=l)[1]!=(m=M)[1]>p[1]&&p[0]<(m[0]-u[0])*(p[1]-u[1])/(m[1]-u[1])+u[0]&&(c=!c)}}var p,u,m;return c}function zg(l,e,r,c){let p=c[0]-r[0],u=c[1]-r[1],m=(l[0]-r[0])*u-p*(l[1]-r[1]),v=(e[0]-r[0])*u-p*(e[1]-r[1]);return m>0&&v<0||m<0&&v>0}function yd(l,e,r,c){return(p=[c[0]-r[0],c[1]-r[1]])[0]*(u=[e[0]-l[0],e[1]-l[1]])[1]-p[1]*u[0]!=0&&!(!zg(l,e,r,c)||!zg(r,c,l,e));var p,u}let Hr=8192;function fn(l,e){let r=(180+l[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*Hr),Math.round(c*p*Hr)]}function Rt(l,e){for(let r=0;r<e.length;r++)if(Il(l,e[r]))return!0;return!1}function zf(l,e,r){for(let c of r)for(let p=0,u=c.length,m=u-1;p<u;m=p++)if(yd(l,e,c[m],c[p]))return!0;return!1}function Yt(l,e){for(let r=0;r<l.length;++r)if(!Il(l[r],e))return!1;for(let r=0;r<l.length-1;++r)if(zf(l[r],l[r+1],e))return!1;return!0}function Bf(l,e){for(let r=0;r<e.length;r++)if(Yt(l,e[r]))return!0;return!1}function Jc(l,e,r){let c=[];for(let p=0;p<l.length;p++){let u=[];for(let m=0;m<l[p].length;m++){let v=fn(l[p][m],r);Yc(e,v),u.push(v)}c.push(u)}return c}function jt(l,e,r){let c=[];for(let p=0;p<l.length;p++){let u=Jc(l[p],e,r);c.push(u)}return c}function Vf(l,e,r,c){if(l[0]<r[0]||l[0]>r[2]){let p=.5*c,u=l[0]-r[0]>p?-c:r[0]-l[0]>p?c:0;u===0&&(u=l[0]-r[2]>p?-c:r[2]-l[0]>p?c:0),l[0]+=u}Yc(e,l)}function vd(l,e,r,c){let p=Math.pow(2,c.z)*Hr,u=[c.x*Hr,c.y*Hr],m=[];if(!l)return m;for(let v of l)for(let E of v){let T=[E.x+u[0],E.y+u[1]];Vf(T,e,r,p),m.push(T)}return m}function jf(l,e,r,c){let p=Math.pow(2,c.z)*Hr,u=[c.x*Hr,c.y*Hr],m=[];if(!l)return m;for(let E of l){let T=[];for(let _ of E){let C=[_.x+u[0],_.y+u[1]];Yc(e,C),T.push(C)}m.push(T)}if(e[2]-e[0]<=p/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let E of m)for(let T of E)Vf(T,e,r,p)}var v;return m}class Zs{constructor(e,r){this.type=wn,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ws(e[1])){let c=e[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){let u=c.features[p].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Zs(c,c.features[p].geometry)}else if(c.type==="Feature"){let p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Zs(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Zs(c,c)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,c){let p=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(c.type==="Polygon"){let v=Jc(c.coordinates,u,m),E=vd(r.geometry(),p,u,m);if(!Aa(p,u))return!1;for(let T of E)if(!Il(T,v))return!1}if(c.type==="MultiPolygon"){let v=jt(c.coordinates,u,m),E=vd(r.geometry(),p,u,m);if(!Aa(p,u))return!1;for(let T of E)if(!Rt(T,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,c){let p=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(c.type==="Polygon"){let v=Jc(c.coordinates,u,m),E=jf(r.geometry(),p,u,m);if(!Aa(p,u))return!1;for(let T of E)if(!Yt(T,v))return!1}if(c.type==="MultiPolygon"){let v=jt(c.coordinates,u,m),E=jf(r.geometry(),p,u,m);if(!Aa(p,u))return!1;for(let T of E)if(!Bf(T,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let Pa={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ar=1/298.257223563,xd=ar*(2-ar),Dl=Math.PI/180;class Al{static fromTile(e,r,c){let p=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),u=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Dl;return new Al(u,c)}static get units(){return Pa}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!Pa[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(Pa).join(", ")}`);let c=6378.137*Dl*(r?Pa[r]:1),p=Math.cos(e*Dl),u=1/(1-xd*(1-p*p)),m=Math.sqrt(u);this.kx=c*m*p,this.ky=c*m*u*(1-xd)}distance(e,r){let c=Ci(e[0]-r[0])*this.kx,p=(e[1]-r[1])*this.ky;return Math.sqrt(c*c+p*p)}bearing(e,r){let c=Ci(r[0]-e[0])*this.kx;return Math.atan2(c,(r[1]-e[1])*this.ky)/Dl}destination(e,r,c){let p=c*Dl;return this.offset(e,Math.sin(p)*r,Math.cos(p)*r)}offset(e,r,c){return[e[0]+r/this.kx,e[1]+c/this.ky]}lineDistance(e){let r=0;for(let c=0;c<e.length-1;c++)r+=this.distance(e[c],e[c+1]);return r}area(e){let r=0;for(let c=0;c<e.length;c++){let p=e[c];for(let u=0,m=p.length,v=m-1;u<m;v=u++)r+=Ci(p[u][0]-p[v][0])*(p[u][1]+p[v][1])*(c?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let c=0;if(r<=0)return e[0];for(let p=0;p<e.length-1;p++){let u=e[p],m=e[p+1],v=this.distance(u,m);if(c+=v,c>r)return _s(u,m,(r-(c-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,r,c){let[p,u]=r,m=Ci(c[0]-p)*this.kx,v=(c[1]-u)*this.ky;if(m!==0||v!==0){let E=(Ci(e[0]-p)*this.kx*m+(e[1]-u)*this.ky*v)/(m*m+v*v);E>1?(p=c[0],u=c[1]):E>0&&(p+=m/this.kx*E,u+=v/this.ky*E)}return m=Ci(e[0]-p)*this.kx,v=(e[1]-u)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(e,r){let c=1/0,p=e[0][0],u=e[0][1],m=0,v=0;for(let E=0;E<e.length-1;E++){let T=e[E][0],_=e[E][1],C=Ci(e[E+1][0]-T)*this.kx,S=(e[E+1][1]-_)*this.ky,w=0;C===0&&S===0||(w=(Ci(r[0]-T)*this.kx*C+(r[1]-_)*this.ky*S)/(C*C+S*S),w>1?(T=e[E+1][0],_=e[E+1][1]):w>0&&(T+=C/this.kx*w,_+=S/this.ky*w)),C=Ci(r[0]-T)*this.kx,S=(r[1]-_)*this.ky;let M=C*C+S*S;M<c&&(c=M,p=T,u=_,m=E,v=w)}return{point:[p,u],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(e,r,c){let p=this.pointOnLine(c,e),u=this.pointOnLine(c,r);if(p.index>u.index||p.index===u.index&&p.t>u.t){let T=p;p=u,u=T}let m=[p.point],v=p.index+1,E=u.index;!bd(c[v],m[0])&&v<=E&&m.push(c[v]);for(let T=v+1;T<=E;T++)m.push(c[T]);return bd(c[E],u.point)||m.push(u.point),m}lineSliceAlong(e,r,c){let p=0,u=[];for(let m=0;m<c.length-1;m++){let v=c[m],E=c[m+1],T=this.distance(v,E);if(p+=T,p>e&&u.length===0&&u.push(_s(v,E,(e-(p-T))/T)),p>=r)return u.push(_s(v,E,(r-(p-T))/T)),u;p>e&&u.push(E)}return u}bufferPoint(e,r){let c=r/this.ky,p=r/this.kx;return[e[0]-p,e[1]-c,e[0]+p,e[1]+c]}bufferBBox(e,r){let c=r/this.ky,p=r/this.kx;return[e[0]-p,e[1]-c,e[2]+p,e[3]+c]}insideBBox(e,r){return Ci(e[0]-r[0])>=0&&Ci(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function bd(l,e){return l[0]===e[0]&&l[1]===e[1]}function _s(l,e,r){let c=Ci(e[0]-l[0]);return[l[0]+c*r,l[1]+(e[1]-l[1])*r]}function Ci(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Uf{constructor(e=[],r=(c,p)=>c<p?-1:c>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:r,compare:c}=this,p=r[e];for(;e>0;){let u=e-1>>1,m=r[u];if(c(p,m)>=0)break;r[e]=m,e=u}r[e]=p}_down(e){let{data:r,compare:c}=this,p=this.length>>1,u=r[e];for(;e<p;){let m=1+(e<<1),v=m+1;if(v<this.length&&c(r[v],r[m])<0&&(m=v),c(r[m],u)>=0)break;r[e]=r[m],e=m}r[e]=u}}var ct=8192;function Bg(l,e){return e.dist-l.dist}let Pl=100,wd=50;function Cd(l){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==l.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==l[r])return!1;return!0}function Ed(l){return l[1]-l[0]+1}function ys(l,e){let r=l[1]>=l[0]&&l[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function $f(l,e){if(l[0]>l[1])return[null,null];let r=Ed(l);if(e){if(r===2)return[l,null];let c=Math.floor(r/2);return[[l[0],l[0]+c],[l[0]+c,l[1]]]}{if(r===1)return[l,null];let c=Math.floor(r/2)-1;return[[l[0],l[0]+c],[l[0]+c+1,l[1]]]}}function qr(l,e){let r=[1/0,1/0,-1/0,-1/0];if(!ys(e,l.length))return r;for(let c=e[0];c<=e[1];++c)Yc(r,l[c]);return r}function Md(l){let e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<l.length;++r)for(let c=0;c<l[r].length;++c)Yc(e,l[r][c]);return e}function Rl(l,e,r){if(Cd(l)||Cd(e))return NaN;let c=0,p=0;return l[2]<e[0]&&(c=e[0]-l[2]),l[0]>e[2]&&(c=l[0]-e[2]),l[1]>e[3]&&(p=l[1]-e[3]),l[3]<e[1]&&(p=e[1]-l[3]),r.distance([0,0],[c,p])}function Vg(l){return 360*l-180}function jg(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Wr(l,e){let r=Math.pow(2,e.z),c=(l.y/ct+e.y)/r;return[Vg((l.x/ct+e.x)/r),jg(c)]}function Ug(l,e){let r=[];for(let c=0;c<l.length;++c)r.push(Wr(l[c],e));return r}function Gf(l,e,r){let c=r.pointOnLine(e,l).point;return r.distance(l,c)}function Hf(l,e,r,c,p){let u=r.slice(c[0],c[1]+1),m=1/0;for(let v=e[0];v<=e[1];++v)if((m=Math.min(m,Gf(l[v],u,p)))===0)return 0;return m}function Sd(l,e,r,c,p){let u=Math.min(p.pointToSegmentDistance(l,r,c),p.pointToSegmentDistance(e,r,c)),m=Math.min(p.pointToSegmentDistance(r,l,e),p.pointToSegmentDistance(c,l,e));return Math.min(u,m)}function $g(l,e,r,c,p){if(!ys(e,l.length)||!ys(c,r.length))return NaN;let u=1/0;for(let m=e[0];m<e[1];++m)for(let v=c[0];v<c[1];++v){if(yd(l[m],l[m+1],r[v],r[v+1]))return 0;u=Math.min(u,Sd(l[m],l[m+1],r[v],r[v+1],p))}return u}function Gg(l,e,r,c,p){if(!ys(e,l.length)||!ys(c,r.length))return NaN;let u=1/0;for(let m=e[0];m<=e[1];++m)for(let v=c[0];v<=c[1];++v)if((u=Math.min(u,p.distance(l[m],r[v])))===0)return u;return u}function Hg(l,e,r){if(Il(l,e,!0))return 0;let c=1/0;for(let p of e){let u=p.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[u-1]&&(c=Math.min(c,r.pointToSegmentDistance(l,p[u-1],p[0])))===0||(c=Math.min(c,Gf(l,p,r)))===0)return c}return c}function qg(l,e,r,c){if(!ys(e,l.length))return NaN;for(let u=e[0];u<=e[1];++u)if(Il(l[u],r,!0))return 0;let p=1/0;for(let u=e[0];u<e[1];++u)for(let m of r)for(let v=0,E=m.length,T=E-1;v<E;T=v++){if(yd(l[u],l[u+1],m[T],m[v]))return 0;p=Math.min(p,Sd(l[u],l[u+1],m[T],m[v],c))}return p}function qf(l,e){for(let r of l)for(let c=0;c<=r.length-1;++c)if(Il(r[c],e,!0))return!0;return!1}function Wg(l,e,r,c=1/0){let p=Md(l),u=Md(e);if(c!==1/0&&Rl(p,u,r)>=c)return c;if(Aa(p,u)){if(qf(l,e))return 0}else if(qf(e,l))return 0;let m=c;for(let v of l)for(let E=0,T=v.length,_=T-1;E<T;_=E++)for(let C of e)for(let S=0,w=C.length,M=w-1;S<w;M=S++){if(yd(v[_],v[E],C[M],C[S]))return 0;m=Math.min(m,Sd(v[_],v[E],C[M],C[S],r))}return m}function Kc(l,e,r,c,p,u,m){if(u===null||m===null)return;let v=Rl(qr(c,u),qr(p,m),r);v<e&&l.push({dist:v,range1:u,range2:m})}function Td(l,e,r,c,p=1/0){let u=Math.min(c.distance(l[0],r[0][0]),p);if(u===0)return u;let m=new Uf([{dist:0,range1:[0,l.length-1],range2:[0,0]}],Bg),v=e?wd:Pl,E=Md(r);for(;m.length;){let T=m.pop();if(T.dist>=u)continue;let _=T.range1;if(Ed(_)<=v){if(!ys(_,l.length))return NaN;if(e){let C=qg(l,_,r,c);if((u=Math.min(u,C))===0)return u}else for(let C=_[0];C<=_[1];++C){let S=Hg(l[C],r,c);if((u=Math.min(u,S))===0)return u}}else{let C=$f(_,e);if(C[0]!==null){let S=Rl(qr(l,C[0]),E,c);S<u&&m.push({dist:S,range1:C[0],range2:[0,0]})}if(C[1]!==null){let S=Rl(qr(l,C[1]),E,c);S<u&&m.push({dist:S,range1:C[1],range2:[0,0]})}}}return u}function Qc(l,e,r,c,p,u=1/0){let m=Math.min(u,p.distance(l[0],r[0]));if(m===0)return m;let v=new Uf([{dist:0,range1:[0,l.length-1],range2:[0,r.length-1]}],Bg),E=e?wd:Pl,T=c?wd:Pl;for(;v.length;){let _=v.pop();if(_.dist>=m)continue;let C=_.range1,S=_.range2;if(Ed(C)<=E&&Ed(S)<=T){if(!ys(C,l.length)||!ys(S,r.length))return NaN;if(e&&c?m=Math.min(m,$g(l,C,r,S,p)):e||c?e&&!c?m=Math.min(m,Hf(r,S,l,C,p)):!e&&c&&(m=Math.min(m,Hf(l,C,r,S,p))):m=Math.min(m,Gg(l,C,r,S,p)),m===0)return m}else{let w=$f(C,e),M=$f(S,c);Kc(v,m,p,l,r,w[0],M[0]),Kc(v,m,p,l,r,w[0],M[1]),Kc(v,m,p,l,r,w[1],M[0]),Kc(v,m,p,l,r,w[1],M[1])}}return m}function Ol(l,e,r,c,p=1/0){let u=p,m=qr(l,[0,l.length-1]);for(let v of r)if(!(u!==1/0&&Rl(m,qr(v,[0,v.length-1]),c)>=u)&&(u=Math.min(u,Qc(l,e,v,!0,c,u)),u===0))return u;return u}function eu(l,e,r,c,p=1/0){let u=p,m=qr(l,[0,l.length-1]);for(let v of r){if(u!==1/0&&Rl(m,Md(v),c)>=u)continue;let E=Td(l,e,v,c,u);if(isNaN(E))return E;if((u=Math.min(u,E))===0)return u}return u}function Id(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Xs{constructor(e,r){this.type=vt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ws(e[1])){let c=e[1];if(c.type==="FeatureCollection"){for(let p=0;p<c.features.length;++p)if(Id(c.features[p].geometry.type))return new Xs(c,c.features[p].geometry)}else if(c.type==="Feature"){if(Id(c.geometry.type))return new Xs(c,c.geometry)}else if(Id(c.type))return new Xs(c,c)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let r=e.geometry(),c=e.canonicalID();if(r!=null&&c!=null){if(e.geometryType()==="Point")return function(p,u,m){let v=[];for(let T of p)for(let _ of T)v.push(Wr(_,u));let E=new Al(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Qc(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",E):m.type==="MultiLineString"?Ol(v,!1,m.coordinates,E):m.type==="Polygon"||m.type==="MultiPolygon"?eu(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,E):null}(r,c,this.geometries);if(e.geometryType()==="LineString")return function(p,u,m){let v=[];for(let T of p){let _=[];for(let C of T)_.push(Wr(C,u));v.push(_)}let E=new Al(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Ol(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,E);if(m.type==="MultiLineString"){let T=1/0;for(let _=0;_<m.coordinates.length;_++){let C=Ol(m.coordinates[_],!0,v,E,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}if(m.type==="Polygon"||m.type==="MultiPolygon"){let T=1/0;for(let _=0;_<v.length;_++){let C=eu(v[_],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,E,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return null}(r,c,this.geometries);if(e.geometryType()==="Polygon")return function(p,u,m){let v=[];for(let T of function(_,C){let S=_.length;if(S<=1)return[_];let w=[],M,D;for(let L=0;L<S;L++){let F=fx(_[L]);F!==0&&(_[L].area=Math.abs(F),D===void 0&&(D=F<0),D===F<0?(M&&w.push(M),M=[_[L]]):M.push(_[L]))}return M&&w.push(M),w}(p)){let _=[];for(let C=0;C<T.length;++C)_.push(Ug(T[C],u));v.push(_)}let E=new Al(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return eu(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,E);if(m.type==="MultiLineString"){let T=1/0;for(let _=0;_<m.coordinates.length;_++){let C=eu(m.coordinates[_],!0,v,E,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return m.type==="Polygon"||m.type==="MultiPolygon"?function(T,_,C){let S=1/0;for(let w of T)for(let M of _){let D=Wg(w,M,C,S);if(isNaN(D))return D;if((S=Math.min(S,D))===0)return S}return S}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,E):null}(r,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ys(l,e){switch(l){case"string":return Mr(e);case"number":return+e;case"boolean":return!!e;case"color":return Un.parse(e);case"formatted":return gr.fromString(Mr(e));case"resolvedImage":return Er.fromString(Mr(e))}return e}function yn(l,e,r,c){return c!==void 0&&(l=c*Math.round(l/c)),e!==void 0&&l<e&&(l=e),r!==void 0&&l>r&&(l=r),l}class Ll{constructor(e,r,c){this.type=e,this.key=r,this.scope=c}static parse(e,r){let c=r.expectedType;if(c==null&&(c=En),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");let p=r.parse(e[1],1);if(!(p instanceof Io))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let u=r.parse(e[2],2);return u instanceof Io?new Ll(c,Mr(p.value),Mr(u.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Ll(c,Mr(p.value))}evaluate(e){let r=[this.key,this.scope,e.scope].filter(Boolean).join(""),c=e.getConfig(r);if(!c)return null;let{type:p,value:u,values:m,minValue:v,maxValue:E,stepValue:T}=c,_=c.default.evaluate(e),C=_;if(u){let S=e.scope;e.scope=(S||"").split("").slice(1).join(""),C=u.evaluate(e),e.scope=S}return p&&(C=Ys(p,C)),C===void 0||v===void 0&&E===void 0&&T===void 0||(typeof C=="number"?C=yn(C,v,E,T):Array.isArray(C)&&(C=C.map(S=>typeof S=="number"?yn(S,v,E,T):S))),u!==void 0&&C!==void 0&&m&&!m.includes(C)&&(C=_,p&&(C=Ys(p,C))),(p&&p!==this.type||C!==void 0&&Oi(C)!==this.type)&&(C=Ys(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function tu(l){if(l instanceof Rr&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Zs||l instanceof Xs)return!1;let e=!0;return l.eachChild(r=>{e&&!tu(r)&&(e=!1)}),e}function Dd(l){if(l instanceof Rr&&l.name==="feature-state")return!1;let e=!0;return l.eachChild(r=>{e&&!Dd(r)&&(e=!1)}),e}function nu(l){if(l instanceof Ll)return new Set([l.key]);let e=new Set;return l.eachChild(r=>{e=new Set([...e,...nu(r)])}),e}function Fl(l,e){if(l instanceof Rr&&e.indexOf(l.name)>=0)return!1;let r=!0;return l.eachChild(c=>{r&&!Fl(c,e)&&(r=!1)}),r}class ti{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let c=e[1];return r.scope.has(c)?new ti(c,r.scope.get(c)):r.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Wf{constructor(e,r=[],c,p=new fd,u=[],m,v){this.registry=e,this.path=r,this.key=r.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=p,this.errors=u,this.expectedType=c,this._scope=m,this.options=v}parse(e,r,c,p,u={}){return r||c?this.concat(r,null,c,p)._parse(e,u):this._parse(e,u)}parseObjectValue(e,r,c,p,u,m={}){return this.concat(r,c,p,u)._parse(e,m)}_parse(e,r){function c(p,u,m){return m==="assert"?new Do(u,[p]):m==="coerce"?new gs(u,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(p){let u=p.parse(e,this);if(!u)return null;if(this.expectedType){let m=this.expectedType,v=u.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else u=c(u,m,r.typeAnnotation||"coerce");else u=c(u,m,r.typeAnnotation||"assert")}if(!(u instanceof Io)&&u.type.kind!=="resolvedImage"&&Zf(u)){let m=new kg(this._scope,this.options);try{u=new Io(u.type,u.evaluate(m))}catch(v){return this.error(v.message),null}}return u}return gs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,c,p){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof r=="string"?u.concat(r):u;let m=p?this.scope.concat(p):this.scope;return new Wf(this.registry,u,c||null,m,this.errors,this._scope,this.options)}error(e,...r){let c=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new So(c,e))}checkSubtype(e,r){let c=Cl(e,r);return c&&this.error(c),c}}var Zg=Wf;function Zf(l){if(l instanceof ti)return Zf(l.boundExpression);if(l instanceof Rr&&l.name==="error"||l instanceof _d||l instanceof Zs||l instanceof Xs||l instanceof Ll)return!1;let e=l instanceof gs||l instanceof Do,r=!0;return l.eachChild(c=>{r=e?r&&Zf(c):r&&c instanceof Io}),!!r&&tu(l)&&Fl(l,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ad(l,e){let r=l.length-1,c,p,u=0,m=r,v=0;for(;u<=m;)if(v=Math.floor((u+m)/2),c=l[v],p=l[v+1],c<=e){if(v===r||e<p)return v;u=v+1}else{if(!(c>e))throw new Xi("Input is not a number.");m=v-1}return 0}class iu{constructor(e,r,c){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(let[p,u]of c)this.labels.push(p),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");let c=r.parse(e[1],1,vt);if(!c)return null;let p=[],u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let m=1;m<e.length;m+=2){let v=m===1?-1/0:e[m],E=e[m+1],T=m,_=m+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(p.length&&p[p.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);let C=r.parse(E,_,u);if(!C)return null;u=u||C.type,p.push([v,C])}return new iu(u,c,p)}evaluate(e){let r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(e);let p=this.input.evaluate(e);if(p<=r[0])return c[0].evaluate(e);let u=r.length;return p>=r[u-1]?c[u-1].evaluate(e):c[Ad(r,p)].evaluate(e)}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}let Xg=.95047,Yg=1.08883,Jg=4/29,kl=6/29,Kg=3*kl*kl,mx=kl*kl*kl,gx=Math.PI/180,_x=180/Math.PI;function Xf(l){return l>mx?Math.pow(l,1/3):l/Kg+Jg}function Yf(l){return l>kl?l*l*l:Kg*(l-Jg)}function Jf(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Kf(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Qg(l){let e=Kf(l.r),r=Kf(l.g),c=Kf(l.b),p=Xf((.4124564*e+.3575761*r+.1804375*c)/Xg),u=Xf((.2126729*e+.7151522*r+.072175*c)/1);return{l:116*u-16,a:500*(p-u),b:200*(u-Xf((.0193339*e+.119192*r+.9503041*c)/Yg)),alpha:l.a}}function e_(l){let e=(l.l+16)/116,r=isNaN(l.a)?e:e+l.a/500,c=isNaN(l.b)?e:e-l.b/200;return e=1*Yf(e),r=Xg*Yf(r),c=Yg*Yf(c),new Un(Jf(3.2404542*r-1.5371385*e-.4985314*c),Jf(-.969266*r+1.8760108*e+.041556*c),Jf(.0556434*r-.2040259*e+1.0572252*c),l.alpha)}function yx(l,e,r){let c=e-l;return l+r*(c>180||c<-180?c-360*Math.round(c/360):c)}let ru={forward:Qg,reverse:e_,interpolate:function(l,e,r){return{l:kt(l.l,e.l,r),a:kt(l.a,e.a,r),b:kt(l.b,e.b,r),alpha:kt(l.alpha,e.alpha,r)}}},ou={forward:function(l){let{l:e,a:r,b:c}=Qg(l),p=Math.atan2(c,r)*_x;return{h:p<0?p+360:p,c:Math.sqrt(r*r+c*c),l:e,alpha:l.a}},reverse:function(l){let e=l.h*gx,r=l.c;return e_({l:l.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:l.alpha})},interpolate:function(l,e,r){return{h:yx(l.h,e.h,r),c:kt(l.c,e.c,r),l:kt(l.l,e.l,r),alpha:kt(l.alpha,e.alpha,r)}}};var t_=Object.freeze({__proto__:null,hcl:ou,lab:ru});class Zr{constructor(e,r,c,p,u){this.type=e,this.operator=r,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(let[m,v]of u)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,r,c,p){let u=0;if(e.name==="exponential")u=Qf(r,e.base,c,p);else if(e.name==="linear")u=Qf(r,1,c,p);else if(e.name==="cubic-bezier"){let m=e.controlPoints;u=new $s(m[0],m[1],m[2],m[3]).solve(Qf(r,1,c,p))}return u}static parse(e,r){let[c,p,u,...m]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let T=p[1];if(typeof T!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:T}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{let T=p.slice(1);if(T.length!==4||T.some(_=>typeof _!="number"||_<0||_>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,vt),!u)return null;let v=[],E=null;c==="interpolate-hcl"||c==="interpolate-lab"?E=Pr:r.expectedType&&r.expectedType.kind!=="value"&&(E=r.expectedType);for(let T=0;T<m.length;T+=2){let _=m[T],C=m[T+1],S=T+3,w=T+4;if(typeof _!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(v.length&&v[v.length-1][0]>=_)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let M=r.parse(C,w,E);if(!M)return null;E=E||M.type,v.push([_,M])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Zr(E,c,p,u,v):r.error(`Type ${Ii(E)} is not interpolatable.`)}evaluate(e){let r=this.labels,c=this.outputs;if(r.length===1)return c[0].evaluate(e);let p=this.input.evaluate(e);if(p<=r[0])return c[0].evaluate(e);let u=r.length;if(p>=r[u-1])return c[u-1].evaluate(e);let m=Ad(r,p),v=Zr.interpolationFactor(this.interpolation,p,r[m],r[m+1]),E=c[m].evaluate(e),T=c[m+1].evaluate(e);return this.operator==="interpolate"?Ta[this.type.kind.toLowerCase()](E,T,v):this.operator==="interpolate-hcl"?ou.reverse(ou.interpolate(ou.forward(E),ou.forward(T),v)):ru.reverse(ru.interpolate(ru.forward(E),ru.forward(T),v))}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)r.push(this.labels[c],this.outputs[c].serialize());return r}}function Qf(l,e,r,c){let p=c-r,u=l-r;return p===0?0:e===1?u/p:(Math.pow(e,u)-1)/(Math.pow(e,p)-1)}class Pd{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let c=null,p=r.expectedType;p&&p.kind!=="value"&&(c=p);let u=[];for(let v of e.slice(1)){let E=r.parse(v,1+u.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,u.push(E)}let m=p&&u.some(v=>Cl(p,v.type));return new Pd(m?En:c,u)}evaluate(e){let r,c=null,p=0;for(let u of this.args){if(p++,c=u.evaluate(e),c&&c instanceof Er&&!c.available&&(r||(r=c),c=null,p===this.args.length))return r;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Rd{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let c=[];for(let u=1;u<e.length-1;u+=2){let m=e[u];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,u);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);let v=r.parse(e[u+1],u+1);if(!v)return null;c.push([m,v])}let p=r.parse(e[e.length-1],e.length-1,r.expectedType,c);return p?new Rd(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[r,c]of this.bindings)e.push(r,c.serialize());return e.push(this.result.serialize()),e}}class ep{constructor(e,r,c){this.type=e,this.index=r,this.input=c}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=r.parse(e[1],1,vt),p=r.parse(e[2],2,Cr(r.expectedType||En));return c&&p?new ep(p.type.itemType,c,p):null}evaluate(e){let r=this.index.evaluate(e),c=this.input.evaluate(e);if(r<0)throw new Xi(`Array index out of bounds: ${r} < 0.`);if(r>c.length-1)throw new Xi(`Array index out of bounds: ${r} > ${c.length-1}.`);if(r===Math.floor(r))return c[r];let p=Math.floor(r),u=Math.ceil(r),m=c[p],v=c[u];if(typeof m!="number"||typeof v!="number")throw new Xi(`Cannot interpolate between non-number values at index ${r}.`);let E=r-p;return m*(1-E)+v*E}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class tp{constructor(e,r){this.type=wn,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=r.parse(e[1],1,En),p=r.parse(e[2],2,En);return c&&p?El(c.type,[wn,bn,vt,To,En])?new tp(c,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(c.type)} instead`):null}evaluate(e){let r=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!Go(r,["boolean","string","number","null"]))throw new Xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(Oi(r))} instead.`);if(!Go(c,["string","array"]))throw new Xi(`Expected second argument to be of type array or string, but found ${Ii(Oi(c))} instead.`);return c.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Od{constructor(e,r,c){this.type=vt,this.needle=e,this.haystack=r,this.fromIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=r.parse(e[1],1,En),p=r.parse(e[2],2,En);if(!c||!p)return null;if(!El(c.type,[wn,bn,vt,To,En]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(c.type)} instead`);if(e.length===4){let u=r.parse(e[3],3,vt);return u?new Od(c,p,u):null}return new Od(c,p)}evaluate(e){let r=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!Go(r,["boolean","string","number","null"]))throw new Xi(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(Oi(r))} instead.`);if(!Go(c,["string","array"]))throw new Xi(`Expected second argument to be of type array or string, but found ${Ii(Oi(c))} instead.`);if(this.fromIndex){let p=this.fromIndex.evaluate(e);return c.indexOf(r,p)}return c.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class np{constructor(e,r,c,p,u,m){this.inputType=e,this.type=r,this.input=c,this.cases=p,this.outputs=u,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let c,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);let u={},m=[];for(let T=2;T<e.length-1;T+=2){let _=e[T],C=e[T+1];Array.isArray(_)||(_=[_]);let S=r.concat(T);if(_.length===0)return S.error("Expected at least one branch label.");for(let M of _){if(typeof M!="number"&&typeof M!="string")return S.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return S.error("Numeric branch labels must be integer values.");if(c){if(S.checkSubtype(c,Oi(M)))return null}else c=Oi(M);if(u[String(M)]!==void 0)return S.error("Branch labels must be unique.");u[String(M)]=m.length}let w=r.parse(C,T,p);if(!w)return null;p=p||w.type,m.push(w)}let v=r.parse(e[1],1,En);if(!v)return null;let E=r.parse(e[e.length-1],e.length-1,p);return E?v.type.kind!=="value"&&r.concat(1).checkSubtype(c,v.type)?null:new np(c,p,v,u,m,E):null}evaluate(e){let r=this.input.evaluate(e);return(Oi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),c=[],p={};for(let m of r){let v=p[this.cases[m]];v===void 0?(p[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[v][1].push(m)}let u=m=>this.inputType.kind==="number"?Number(m):m;for(let[m,v]of c)e.push(v.length===1?u(v[0]):v.map(u)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class su{constructor(e,r,c){this.type=e,this.branches=r,this.otherwise=c}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);let p=[];for(let m=1;m<e.length-1;m+=2){let v=r.parse(e[m],m,wn);if(!v)return null;let E=r.parse(e[m+1],m+1,c);if(!E)return null;p.push([v,E]),c=c||E.type}let u=r.parse(e[e.length-1],e.length-1,c);return u?new su(c,p,u):null}evaluate(e){for(let[r,c]of this.branches)if(r.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[r,c]of this.branches)e(r),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Ld{constructor(e,r,c,p){this.type=e,this.input=r,this.beginIndex=c,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=r.parse(e[1],1,En),p=r.parse(e[2],2,vt);if(!c||!p)return null;if(!El(c.type,[Cr(En),bn,En]))return r.error(`Expected first argument to be of type array or string, but found ${Ii(c.type)} instead`);if(e.length===4){let u=r.parse(e[3],3,vt);return u?new Ld(c.type,c,p,u):null}return new Ld(c.type,c,p)}evaluate(e){let r=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!Go(r,["string","array"]))throw new Xi(`Expected first argument to be of type array or string, but found ${Ii(Oi(r))} instead.`);if(this.endIndex){let p=this.endIndex.evaluate(e);return r.slice(c,p)}return r.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ip(l,e){return l==="=="||l==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function n_(l,e,r,c){return c.compare(e,r)===0}function Nl(l,e,r){let c=l!=="=="&&l!=="!=";return class sO{constructor(u,m,v){this.type=wn,this.lhs=u,this.rhs=m,this.collator=v,this.hasUntypedArgument=u.type.kind==="value"||m.type.kind==="value"}static parse(u,m){if(u.length!==3&&u.length!==4)return m.error("Expected two or three arguments.");let v=u[0],E=m.parse(u[1],1,En);if(!E)return null;if(!ip(v,E.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Ii(E.type)}'.`);let T=m.parse(u[2],2,En);if(!T)return null;if(!ip(v,T.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Ii(T.type)}'.`);if(E.type.kind!==T.type.kind&&E.type.kind!=="value"&&T.type.kind!=="value")return m.error(`Cannot compare types '${Ii(E.type)}' and '${Ii(T.type)}'.`);c&&(E.type.kind==="value"&&T.type.kind!=="value"?E=new Do(T.type,[E]):E.type.kind!=="value"&&T.type.kind==="value"&&(T=new Do(E.type,[T])));let _=null;if(u.length===4){if(E.type.kind!=="string"&&T.type.kind!=="string"&&E.type.kind!=="value"&&T.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(_=m.parse(u[3],3,pd),!_)return null}return new sO(E,T,_)}evaluate(u){let m=this.lhs.evaluate(u),v=this.rhs.evaluate(u);if(c&&this.hasUntypedArgument){let E=Oi(m),T=Oi(v);if(E.kind!==T.kind||E.kind!=="string"&&E.kind!=="number")throw new Xi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${E.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){let E=Oi(m),T=Oi(v);if(E.kind!=="string"||T.kind!=="string")return e(u,m,v)}return this.collator?r(u,m,v,this.collator.evaluate(u)):e(u,m,v)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[l];return this.eachChild(m=>{u.push(m.serialize())}),u}}}let vx=Nl("==",function(l,e,r){return e===r},n_),i_=Nl("!=",function(l,e,r){return e!==r},function(l,e,r,c){return!n_(0,e,r,c)}),r_=Nl("<",function(l,e,r){return e<r},function(l,e,r,c){return c.compare(e,r)<0}),zl=Nl(">",function(l,e,r){return e>r},function(l,e,r,c){return c.compare(e,r)>0}),o_=Nl("<=",function(l,e,r){return e<=r},function(l,e,r,c){return c.compare(e,r)<=0}),s_=Nl(">=",function(l,e,r){return e>=r},function(l,e,r,c){return c.compare(e,r)>=0});class rp{constructor(e,r,c,p,u,m){this.type=bn,this.number=e,this.locale=r,this.currency=c,this.unit=p,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");let c=r.parse(e[1],1,vt);if(!c)return null;let p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let u=null;if(p.locale&&(u=r.parseObjectValue(p.locale,2,"locale",bn),!u))return null;let m=null;if(p.currency&&(m=r.parseObjectValue(p.currency,2,"currency",bn),!m))return null;let v=null;if(p.unit&&(v=r.parseObjectValue(p.unit,2,"unit",bn),!v))return null;let E=null;if(p["min-fraction-digits"]&&(E=r.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",vt),!E))return null;let T=null;return p["max-fraction-digits"]&&(T=r.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",vt),!T)?null:new rp(c,u,m,v,E,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class au{constructor(e){this.type=vt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let c=r.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ii(c.type)} instead.`):new au(c):null}evaluate(e){let r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Xi(`Expected value to be of type string or array, but found ${Ii(Oi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Fd(l){return function(){l=1831565813+(l|=0)|0;let e=Math.imul(l^l>>>15,1|l);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Bl={"==":vx,"!=":i_,">":zl,"<":r_,">=":s_,"<=":o_,array:Do,at:ep,boolean:Do,case:su,coalesce:Pd,collator:_d,format:Ml,image:Ia,in:tp,"index-of":Od,interpolate:Zr,"interpolate-hcl":Zr,"interpolate-lab":Zr,length:au,let:Rd,literal:Io,match:np,number:Do,"number-format":rp,object:Do,slice:Ld,step:iu,string:Do,"to-boolean":gs,"to-color":gs,"to-number":gs,"to-string":gs,var:ti,within:Zs,distance:Xs,config:Ll};function a_(l,[e,r,c,p]){e=e.evaluate(l),r=r.evaluate(l),c=c.evaluate(l);let u=p?p.evaluate(l):1,m=Fg(e,r,c,u);if(m)throw new Xi(m);return new Un(e/255*u,r/255*u,c/255*u,u)}function op(l,[e,r,c,p]){e=e.evaluate(l),r=r.evaluate(l),c=c.evaluate(l);let u=p?p.evaluate(l):1,m=function(T,_,C,S){return typeof T=="number"&&T>=0&&T<=360?typeof _=="number"&&_>=0&&_<=100&&typeof C=="number"&&C>=0&&C<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[T,_,C,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[T,_,C,S]:[T,_,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[T,_,C,S]:[T,_,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,c,u);if(m)throw new Xi(m);let v=`hsla(${e}, ${r}%, ${c}%, ${u})`,E=Un.parse(v);if(!E)throw new Xi(`Failed to parse HSLA color: ${v}`);return E}function sp(l,e){return l in e}function ap(l,e){let r=e[l];return r===void 0?null:r}function Ra(l){return{type:l}}function l_(l){return{result:"success",value:l}}function vs(l){return{result:"error",value:l}}function kd(l,e){return!!l&&!!l.parameters&&l.parameters.indexOf(e)>-1}function Oa(l){return l["property-type"]==="data-driven"}function c_(l){return kd(l.expression,"measure-light")}function lp(l){return kd(l.expression,"zoom")}function cp(l){return!!l.expression&&l.expression.interpolated}function up(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function u_(l){return l}function dp(l,e){let r=e.type==="color",c=l.stops&&typeof l.stops[0][0]=="object",p=c||!(c||l.property!==void 0),u=l.type||(cp(e)?"exponential":"interval");if(r&&((l=xl({},l)).stops&&(l.stops=l.stops.map(T=>[T[0],Un.parse(T[1])])),l.default=Un.parse(l.default?l.default:e.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!t_[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let m,v,E;if(u==="exponential")m=hp;else if(u==="interval")m=bx;else if(u==="categorical"){m=xx,v=Object.create(null);for(let T of l.stops)v[T[0]]=T[1];E=typeof l.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);m=wx}if(c){let T={},_=[];for(let w=0;w<l.stops.length;w++){let M=l.stops[w],D=M[0].zoom;T[D]===void 0&&(T[D]={zoom:D,type:l.type,property:l.property,default:l.default,stops:[]},_.push(D)),T[D].stops.push([M[0].value,M[1]])}let C=[];for(let w of _)C.push([T[w].zoom,dp(T[w],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:Zr.interpolationFactor.bind(void 0,S),zoomStops:C.map(w=>w[0]),evaluate:({zoom:w},M)=>hp({stops:C,base:l.base},e,w).evaluate(w,M)}}if(p){let T=u==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Zr.interpolationFactor.bind(void 0,T),zoomStops:l.stops.map(_=>_[0]),evaluate:({zoom:_})=>m(l,e,_,v,E)}}return{kind:"source",evaluate(T,_){let C=_&&_.properties?_.properties[l.property]:void 0;return C===void 0?lu(l.default,e.default):m(l,e,C,v,E)}}}function lu(l,e,r){return l!==void 0?l:e!==void 0?e:r!==void 0?r:void 0}function xx(l,e,r,c,p){return lu(typeof r===p?c[r]:void 0,l.default,e.default)}function bx(l,e,r){if(Da(r)!=="number")return lu(l.default,e.default);let c=l.stops.length;if(c===1||r<=l.stops[0][0])return l.stops[0][1];if(r>=l.stops[c-1][0])return l.stops[c-1][1];let p=Ad(l.stops.map(u=>u[0]),r);return l.stops[p][1]}function hp(l,e,r){let c=l.base!==void 0?l.base:1;if(Da(r)!=="number")return lu(l.default,e.default);let p=l.stops.length;if(p===1||r<=l.stops[0][0])return l.stops[0][1];if(r>=l.stops[p-1][0])return l.stops[p-1][1];let u=Ad(l.stops.map(_=>_[0]),r),m=function(_,C,S,w){let M=w-S,D=_-S;return M===0?0:C===1?D/M:(Math.pow(C,D)-1)/(Math.pow(C,M)-1)}(r,c,l.stops[u][0],l.stops[u+1][0]),v=l.stops[u][1],E=l.stops[u+1][1],T=Ta[e.type]||u_;if(l.colorSpace&&l.colorSpace!=="rgb"){let _=t_[l.colorSpace];T=(C,S)=>_.reverse(_.interpolate(_.forward(C),_.forward(S),m))}return typeof v.evaluate=="function"?{evaluate(..._){let C=v.evaluate.apply(void 0,_),S=E.evaluate.apply(void 0,_);if(C!==void 0&&S!==void 0)return T(C,S,m)}}:T(v,E,m)}function wx(l,e,r){return e.type==="color"?r=Un.parse(r):e.type==="formatted"?r=gr.fromString(r.toString()):e.type==="resolvedImage"?r=Er.fromString(r.toString()):Da(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),lu(r,l.default,e.default)}Rr.register(Bl,{error:[{kind:"error"},[bn],(l,[e])=>{throw new Xi(e.evaluate(l))}],typeof:[bn,[En],(l,[e])=>Ii(Oi(e.evaluate(l)))],"to-rgba":[Cr(vt,4),[Pr],(l,[e])=>e.evaluate(l).toRenderColor(null).toArray()],rgb:[Pr,[vt,vt,vt],a_],rgba:[Pr,[vt,vt,vt,vt],a_],hsl:[Pr,[vt,vt,vt],op],hsla:[Pr,[vt,vt,vt,vt],op],has:{type:wn,overloads:[[[bn],(l,[e])=>sp(e.evaluate(l),l.properties())],[[bn,mr],(l,[e,r])=>sp(e.evaluate(l),r.evaluate(l))]]},get:{type:En,overloads:[[[bn],(l,[e])=>ap(e.evaluate(l),l.properties())],[[bn,mr],(l,[e,r])=>ap(e.evaluate(l),r.evaluate(l))]]},"feature-state":[En,[bn],(l,[e])=>ap(e.evaluate(l),l.featureState||{})],properties:[mr,[],l=>l.properties()],"geometry-type":[bn,[],l=>l.geometryType()],id:[En,[],l=>l.id()],zoom:[vt,[],l=>l.globals.zoom],pitch:[vt,[],l=>l.globals.pitch||0],"distance-from-center":[vt,[],l=>l.distanceFromCenter()],"measure-light":[vt,[bn],(l,[e])=>l.measureLight(e.evaluate(l))],"heatmap-density":[vt,[],l=>l.globals.heatmapDensity||0],"line-progress":[vt,[],l=>l.globals.lineProgress||0],"raster-value":[vt,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[vt,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[vt,[],l=>l.globals.skyRadialProgress||0],accumulated:[En,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[vt,Ra(vt),(l,e)=>{let r=0;for(let c of e)r+=c.evaluate(l);return r}],"*":[vt,Ra(vt),(l,e)=>{let r=1;for(let c of e)r*=c.evaluate(l);return r}],"-":{type:vt,overloads:[[[vt,vt],(l,[e,r])=>e.evaluate(l)-r.evaluate(l)],[[vt],(l,[e])=>-e.evaluate(l)]]},"/":[vt,[vt,vt],(l,[e,r])=>e.evaluate(l)/r.evaluate(l)],"%":[vt,[vt,vt],(l,[e,r])=>e.evaluate(l)%r.evaluate(l)],ln2:[vt,[],()=>Math.LN2],pi:[vt,[],()=>Math.PI],e:[vt,[],()=>Math.E],"^":[vt,[vt,vt],(l,[e,r])=>Math.pow(e.evaluate(l),r.evaluate(l))],sqrt:[vt,[vt],(l,[e])=>Math.sqrt(e.evaluate(l))],log10:[vt,[vt],(l,[e])=>Math.log(e.evaluate(l))/Math.LN10],ln:[vt,[vt],(l,[e])=>Math.log(e.evaluate(l))],log2:[vt,[vt],(l,[e])=>Math.log(e.evaluate(l))/Math.LN2],sin:[vt,[vt],(l,[e])=>Math.sin(e.evaluate(l))],cos:[vt,[vt],(l,[e])=>Math.cos(e.evaluate(l))],tan:[vt,[vt],(l,[e])=>Math.tan(e.evaluate(l))],asin:[vt,[vt],(l,[e])=>Math.asin(e.evaluate(l))],acos:[vt,[vt],(l,[e])=>Math.acos(e.evaluate(l))],atan:[vt,[vt],(l,[e])=>Math.atan(e.evaluate(l))],min:[vt,Ra(vt),(l,e)=>Math.min(...e.map(r=>r.evaluate(l)))],max:[vt,Ra(vt),(l,e)=>Math.max(...e.map(r=>r.evaluate(l)))],abs:[vt,[vt],(l,[e])=>Math.abs(e.evaluate(l))],round:[vt,[vt],(l,[e])=>{let r=e.evaluate(l);return r<0?-Math.round(-r):Math.round(r)}],floor:[vt,[vt],(l,[e])=>Math.floor(e.evaluate(l))],ceil:[vt,[vt],(l,[e])=>Math.ceil(e.evaluate(l))],"filter-==":[wn,[bn,En],(l,[e,r])=>l.properties()[e.value]===r.value],"filter-id-==":[wn,[En],(l,[e])=>l.id()===e.value],"filter-type-==":[wn,[bn],(l,[e])=>l.geometryType()===e.value],"filter-<":[wn,[bn,En],(l,[e,r])=>{let c=l.properties()[e.value],p=r.value;return typeof c==typeof p&&c<p}],"filter-id-<":[wn,[En],(l,[e])=>{let r=l.id(),c=e.value;return typeof r==typeof c&&r<c}],"filter->":[wn,[bn,En],(l,[e,r])=>{let c=l.properties()[e.value],p=r.value;return typeof c==typeof p&&c>p}],"filter-id->":[wn,[En],(l,[e])=>{let r=l.id(),c=e.value;return typeof r==typeof c&&r>c}],"filter-<=":[wn,[bn,En],(l,[e,r])=>{let c=l.properties()[e.value],p=r.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[wn,[En],(l,[e])=>{let r=l.id(),c=e.value;return typeof r==typeof c&&r<=c}],"filter->=":[wn,[bn,En],(l,[e,r])=>{let c=l.properties()[e.value],p=r.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[wn,[En],(l,[e])=>{let r=l.id(),c=e.value;return typeof r==typeof c&&r>=c}],"filter-has":[wn,[En],(l,[e])=>e.value in l.properties()],"filter-has-id":[wn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[wn,[Cr(bn)],(l,[e])=>e.value.indexOf(l.geometryType())>=0],"filter-id-in":[wn,[Cr(En)],(l,[e])=>e.value.indexOf(l.id())>=0],"filter-in-small":[wn,[bn,Cr(En)],(l,[e,r])=>r.value.indexOf(l.properties()[e.value])>=0],"filter-in-large":[wn,[bn,Cr(En)],(l,[e,r])=>function(c,p,u,m){for(;u<=m;){let v=u+m>>1;if(p[v]===c)return!0;p[v]>c?m=v-1:u=v+1}return!1}(l.properties()[e.value],r.value,0,r.value.length-1)],all:{type:wn,overloads:[[[wn,wn],(l,[e,r])=>e.evaluate(l)&&r.evaluate(l)],[Ra(wn),(l,e)=>{for(let r of e)if(!r.evaluate(l))return!1;return!0}]]},any:{type:wn,overloads:[[[wn,wn],(l,[e,r])=>e.evaluate(l)||r.evaluate(l)],[Ra(wn),(l,e)=>{for(let r of e)if(r.evaluate(l))return!0;return!1}]]},"!":[wn,[wn],(l,[e])=>!e.evaluate(l)],"is-supported-script":[wn,[bn],(l,[e])=>{let r=l.globals&&l.globals.isSupportedScript;return!r||r(e.evaluate(l))}],upcase:[bn,[bn],(l,[e])=>e.evaluate(l).toUpperCase()],downcase:[bn,[bn],(l,[e])=>e.evaluate(l).toLowerCase()],concat:[bn,Ra(En),(l,e)=>e.map(r=>Mr(r.evaluate(l))).join("")],"resolved-locale":[bn,[pd],(l,[e])=>e.evaluate(l).resolvedLocale()],random:[vt,[vt,vt,En],(l,e)=>{let[r,c,p]=e.map(m=>m.evaluate(l));if(r>c||r===c)return r;let u;if(typeof p=="string")u=function(m){let v=0;if(m.length===0)return v;for(let E=0;E<m.length;E++)v=(v<<5)-v+m.charCodeAt(E),v|=0;return v}(p);else{if(typeof p!="number")throw new Xi(`Invalid seed input: ${p}`);u=p}return r+Fd(u)()*(c-r)}]});class fp{constructor(e,r,c,p){this.expression=e,this._warningHistory={},this._evaluator=new kg(c,p),this._defaultValue=r?function(u){return u.type==="color"&&(up(u.default)||Array.isArray(u.default))?new Un(0,0,0,0):u.type==="color"?Un.parse(u.default)||null:u.default===void 0?null:u.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=nu(e)}evaluateWithoutErrorHandling(e,r,c,p,u,m,v,E){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,c,p,u,m,v,E){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=E||null;try{let T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Xi(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${T.message}`)),this._defaultValue}}}function Nd(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Bl}function Vl(l,e,r,c){let p=new Zg(Bl,[],e?function(m){let v={color:Pr,string:bn,number:vt,enum:bn,boolean:wn,formatted:bl,resolvedImage:wl};return m.type==="array"?Cr(v[m.value]||En,m.length):v[m.type]}(e):void 0,void 0,void 0,r,c),u=p.parse(l,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?l_(new fp(u,e,r,c)):vs(p.errors)}class zd{constructor(e,r,c){this.kind=e,this._styleExpression=r,this.isLightConstant=c,this.isStateDependent=e!=="constant"&&!Dd(r.expression),this.configDependencies=nu(r.expression)}evaluateWithoutErrorHandling(e,r,c,p,u,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,c,p,u,m)}evaluate(e,r,c,p,u,m){return this._styleExpression.evaluate(e,r,c,p,u,m)}}class cu{constructor(e,r,c,p,u){this.kind=e,this.zoomStops=c,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Dd(r.expression),this.isLightConstant=u,this.configDependencies=nu(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,c,p,u,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,c,p,u,m)}evaluate(e,r,c,p,u,m){return this._styleExpression.evaluate(e,r,c,p,u,m)}interpolationFactor(e,r,c){return this.interpolationType?Zr.interpolationFactor(this.interpolationType,e,r,c):0}}function La(l,e,r,c){if((l=Vl(l,e,r,c)).result==="error")return l;let p=l.value.expression,u=tu(p);if(!u&&!Oa(e))return vs([new So("","data expressions not supported")]);let m=Fl(p,["zoom","pitch","distance-from-center"]);if(!m&&!lp(e))return vs([new So("","zoom expressions not supported")]);let v=Fl(p,["measure-light"]);if(!v&&!c_(e))return vs([new So("","measure-light expression not supported")]);let E=Fl(p,["line-progress"]);if(!E&&!function(C){return kd(C.expression,"line-progress")}(e))return vs([new So("","line-progress expression not supported")]);let T=e.expression&&e.expression.relaxZoomRestriction,_=Vd(p);return _||m||T?_ instanceof So?vs([_]):_ instanceof Zr&&!cp(e)?vs([new So("",'"interpolate" expressions cannot be used with this property')]):l_(_?new cu(u&&E?"camera":"composite",l.value,_.labels,_ instanceof Zr?_.interpolation:void 0,v):new zd(u&&E?"constant":"source",l.value,v)):vs([new So("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Bd{constructor(e,r){this._parameters=e,this._specification=r,xl(this,dp(this._parameters,this._specification))}static deserialize(e){return new Bd(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Vd(l){let e=null;if(l instanceof Rd)e=Vd(l.result);else if(l instanceof Pd){for(let r of l.args)if(e=Vd(r),e)break}else(l instanceof iu||l instanceof Zr)&&l.input instanceof Rr&&l.input.name==="zoom"&&(e=l);return e instanceof So||l.eachChild(r=>{let c=Vd(r);c instanceof So?e=c:e&&c&&e!==c&&(e=new So("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var pp,mp,d_=function(){if(mp)return pp;mp=1,pp=e;var l=3;function e(r,c,p){var u=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var m=new Int32Array(this.arrayBuffer);r=m[0],this.d=(c=m[1])+2*(p=m[2]);for(var v=0;v<this.d*this.d;v++){var E=m[l+v],T=m[l+v+1];u.push(E===T?null:m.subarray(E,T))}var _=m[l+u.length+1];this.keys=m.subarray(m[l+u.length],_),this.bboxes=m.subarray(_),this.insert=this._insertReadonly}else{this.d=c+2*p;for(var C=0;C<this.d*this.d;C++)u.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=p,this.scale=c/r,this.uid=0;var S=p/c*r;this.min=-S,this.max=r+S}return e.prototype.insert=function(r,c,p,u,m){this._forEachCell(c,p,u,m,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(u),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,c,p,u,m,v){this.cells[m].push(v)},e.prototype.query=function(r,c,p,u,m){var v=this.min,E=this.max;if(r<=v&&c<=v&&E<=p&&E<=u&&!m)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(r,c,p,u,this._queryCell,T,{},m),T},e.prototype._queryCell=function(r,c,p,u,m,v,E,T){var _=this.cells[m];if(_!==null)for(var C=this.keys,S=this.bboxes,w=0;w<_.length;w++){var M=_[w];if(E[M]===void 0){var D=4*M;(T?T(S[D+0],S[D+1],S[D+2],S[D+3]):r<=S[D+2]&&c<=S[D+3]&&p>=S[D+0]&&u>=S[D+1])?(E[M]=!0,v.push(C[M])):E[M]=!1}}},e.prototype._forEachCell=function(r,c,p,u,m,v,E,T){for(var _=this._convertToCellCoord(r),C=this._convertToCellCoord(c),S=this._convertToCellCoord(p),w=this._convertToCellCoord(u),M=_;M<=S;M++)for(var D=C;D<=w;D++){var L=this.d*D+M;if((!T||T(this._convertFromCellCoord(M),this._convertFromCellCoord(D),this._convertFromCellCoord(M+1),this._convertFromCellCoord(D+1)))&&m.call(this,r,c,p,u,L,v,E,T))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,c=l+this.cells.length+1+1,p=0,u=0;u<this.cells.length;u++)p+=this.cells[u].length;var m=new Int32Array(c+p+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var v=c,E=0;E<r.length;E++){var T=r[E];m[l+E]=v,m.set(T,v),v+=T.length}return m[l+r.length]=v,m.set(this.keys,v),m[l+r.length+1]=v+=this.keys.length,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer},pp}(),Fa=R(d_);let uu={};function gt(l,e,r={}){Object.defineProperty(l,"_classRegistryKey",{value:e,writable:!1}),uu[e]={klass:l,omit:r.omit||[]}}gt(Object,"Object"),Fa.serialize=function(l,e){let r=l.toArrayBuffer();return e&&e.add(r),{buffer:r}},Fa.deserialize=function(l){return new Fa(l.buffer)},Object.defineProperty(Fa,"name",{value:"Grid"}),gt(Fa,"Grid"),gt(Un,"Color"),gt(Error,"Error"),gt(gr,"Formatted"),gt(Gr,"FormattedSection"),gt(Af,"AJAXError"),gt(Er,"ResolvedImage"),gt(Bd,"StylePropertyFunction"),gt(fp,"StyleExpression",{omit:["_evaluator"]}),gt(cu,"ZoomDependentExpression"),gt(zd,"ZoomConstantExpression"),gt(Rr,"CompoundExpression",{omit:["_evaluate"]});for(let l in Bl)uu[Bl[l]._classRegistryKey]||gt(Bl[l],`Expression${l}`);function jd(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function gp(l){return self.ImageBitmap&&l instanceof ImageBitmap}function ka(l,e){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(jd(l)||gp(l))return e&&e.add(l),l;if(ArrayBuffer.isView(l)){let r=l;return e&&e.add(r.buffer),r}if(l instanceof ImageData)return e&&e.add(l.data.buffer),l;if(Array.isArray(l)){let r=[];for(let c of l)r.push(ka(c,e));return r}if(l instanceof Map){let r={$name:"Map"};for(let[c,p]of l.entries())r[c]=ka(p);return r}if(l instanceof Set){let r={$name:"Set"},c=0;for(let p of l.values())r[++c]=ka(p);return r}if(typeof l=="object"){let r=l.constructor,c=r._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);let p=r.serialize?r.serialize(l,e):{};if(!r.serialize){for(let u in l)l.hasOwnProperty(u)&&(uu[c].omit.indexOf(u)>=0||(p[u]=ka(l[u],e)));l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof l)}function Js(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||jd(l)||gp(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Js);if(typeof l=="object"){let e=l.$name||"Object";if(e==="Map"){let p=new Map;for(let u of Object.keys(l))u!=="$name"&&p.set(u,Js(l[u]));return p}if(e==="Set"){let p=new Set;for(let u of Object.keys(l))u!=="$name"&&p.add(Js(l[u]));return p}let{klass:r}=uu[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(l);let c=Object.create(r.prototype);for(let p of Object.keys(l))p!=="$name"&&(c[p]=Js(l[p]));return c}throw new Error("can't deserialize object of type "+typeof l)}let Et={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function _p(l){for(let e of l)if(jl(e.charCodeAt(0)))return!0;return!1}function h_(l){for(let e of l)if(!Cx(e.charCodeAt(0)))return!1;return!0}function Cx(l){return!(Et.Arabic(l)||Et["Arabic Supplement"](l)||Et["Arabic Extended-A"](l)||Et["Arabic Presentation Forms-A"](l)||Et["Arabic Presentation Forms-B"](l))}function jl(l){return!(l!==746&&l!==747&&(l<4352||!(Et["Bopomofo Extended"](l)||Et.Bopomofo(l)||Et["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Et["CJK Compatibility Ideographs"](l)||Et["CJK Compatibility"](l)||Et["CJK Radicals Supplement"](l)||Et["CJK Strokes"](l)||!(!Et["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||Et["CJK Unified Ideographs Extension A"](l)||Et["CJK Unified Ideographs"](l)||Et["Enclosed CJK Letters and Months"](l)||Et["Hangul Compatibility Jamo"](l)||Et["Hangul Jamo Extended-A"](l)||Et["Hangul Jamo Extended-B"](l)||Et["Hangul Jamo"](l)||Et["Hangul Syllables"](l)||Et.Hiragana(l)||Et["Ideographic Description Characters"](l)||Et.Kanbun(l)||Et["Kangxi Radicals"](l)||Et["Katakana Phonetic Extensions"](l)||Et.Katakana(l)&&l!==12540||!(!Et["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Et["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Et["Unified Canadian Aboriginal Syllabics"](l)||Et["Unified Canadian Aboriginal Syllabics Extended"](l)||Et["Vertical Forms"](l)||Et["Yijing Hexagram Symbols"](l)||Et["Yi Syllables"](l)||Et["Yi Radicals"](l))))}function yp(l){return!(jl(l)||function(e){return!!(Et["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Et["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Et["Letterlike Symbols"](e)||Et["Number Forms"](e)||Et["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Et["Control Pictures"](e)&&e!==9251||Et["Optical Character Recognition"](e)||Et["Enclosed Alphanumerics"](e)||Et["Geometric Shapes"](e)||Et["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Et["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Et["CJK Symbols and Punctuation"](e)||Et.Katakana(e)||Et["Private Use Area"](e)||Et["CJK Compatibility Forms"](e)||Et["Small Form Variants"](e)||Et["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(l))}function du(l){return l>=1424&&l<=2303||Et["Arabic Presentation Forms-A"](l)||Et["Arabic Presentation Forms-B"](l)}function f_(l,e){return!(!e&&du(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Et.Khmer(l))}function Ex(l){for(let e of l)if(du(e.charCodeAt(0)))return!0;return!1}let vp="deferred",hu="loading",fu="loaded",Ud=null,lr="unavailable",Xr=null,p_=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(lr="error"),Ud&&Ud(l)};function xp(){bp.fire(new qs("pluginStateChange",{pluginStatus:lr,pluginURL:Xr}))}let bp=new vl,wp=function(){return lr},m_=function(){if(lr!==vp||!Xr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");lr=hu,xp(),Xr&&_l({url:Xr},l=>{l?p_(l):(lr=fu,xp())})},Yr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>lr===fu||Yr.applyArabicShaping!=null,isLoading:()=>lr===hu,setState(l){lr=l.pluginStatus,Xr=l.pluginURL},isParsed:()=>Yr.applyArabicShaping!=null&&Yr.processBidirectionalText!=null&&Yr.processStyledBidirectionalText!=null,getPluginURL:()=>Xr};class bi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,c){for(let p of r)if(!f_(p.charCodeAt(0),c))return!1;return!0}(e,Yr.isLoaded())}}class $d{constructor(e,r,c,p){this.property=e,this.value=r,this.expression=function(u,m,v,E){if(up(u))return new Bd(u,m);if(Nd(u)||Array.isArray(u)&&u.length>0){let T=La(u,m,v,E);if(T.result==="error")throw new Error(T.value.map(_=>`${_.key}: ${_.message}`).join(", "));return T.value}{let T=u;return typeof u=="string"&&m.type==="color"&&(T=Un.parse(u)),{kind:"constant",configDependencies:new Set,evaluate:()=>T}}}(r===void 0?e.specification.default:r,e.specification,c,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,c){return this.property.possiblyEvaluate(this,e,r,c)}}class Cp{constructor(e,r,c){this.property=e,this.value=new $d(e,void 0,r,c)}transitioned(e,r){return new __(this.property,this.value,r,pr({},e.transition,this.transition),e.now)}untransitioned(){return new __(this.property,this.value,null,{},0)}}class g_{constructor(e,r,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=c,this.configDependencies=new Set}getValue(e){return lo(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Cp(this._values[e].property,this._scope,this._options)),this._values[e].value=new $d(this._values[e].property,r===null?void 0:lo(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);let c=this._properties.properties;if(e)for(let p in e){let u=e[p];if(ms(p,"-transition")){let m=p.slice(0,-11);c[m]&&this.setTransition(m,u)}else c.hasOwnProperty(p)&&this.setValue(p,u)}}getTransition(e){return lo(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Cp(this._values[e].property)),this._values[e].transition=lo(r)||void 0}serialize(){let e={};for(let r of Object.keys(this._values)){let c=this.getValue(r);c!==void 0&&(e[r]=c);let p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){let c=new y_(this._properties);for(let p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(e,r._values[p]);return c}untransitioned(){let e=new y_(this._properties);for(let r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class __{constructor(e,r,c,p,u){let m=p.delay||0,v=p.duration||0;u=u||0,this.property=e,this.value=r,this.begin=u+m,this.end=this.begin+v,e.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(e,r,c){let p=e.now||0,u=this.value.possiblyEvaluate(e,r,c),m=this.prior;if(m){if(p>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(p<this.begin)return m.possiblyEvaluate(e,r,c);{let v=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,c),u,Ca(v))}}return u}}class y_{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,c){let p=new $l(this._properties);for(let u of Object.keys(this._values))p._values[u]=this._values[u].possiblyEvaluate(e,r,c);return p}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Mx{constructor(e,r,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=c,this.configDependencies=new Set}getValue(e){return lo(this._values[e].value)}setValue(e,r){this._values[e]=new $d(this._values[e].property,r===null?void 0:lo(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){let e={};for(let r of Object.keys(this._values)){let c=this.getValue(r);c!==void 0&&(e[r]=c)}return e}possiblyEvaluate(e,r,c){let p=new $l(this._properties);for(let u of Object.keys(this._values))p._values[u]=this._values[u].possiblyEvaluate(e,r,c);return p}}class Ul{constructor(e,r,c){this.property=e,this.value=r,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,c,p){return this.property.evaluate(this.value,this.parameters,e,r,c,p)}}class $l{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ot{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,c){let p=Ta[this.specification.type];return p?p(e,r,c):e}}class Tt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,c,p){return new Ul(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},c,p)}:e.expression,r)}interpolate(e,r,c){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Ul(this,{kind:"constant",value:void 0},e.parameters);let p=Ta[this.specification.type];return p?new Ul(this,{kind:"constant",value:p(e.value.value,r.value.value,c)},e.parameters):e}evaluate(e,r,c,p,u,m){return e.kind==="constant"?e.value:e.evaluate(r,c,p,u,m)}}class Gl{constructor(e){this.specification=e}possiblyEvaluate(e,r,c,p){return!!e.expression.evaluate(r,null,{},c,p)}interpolate(){return!1}}class si{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let r=new bi(0,{});for(let c in e){let p=e[c];p.specification.overridable&&this.overridableProperties.push(c);let u=this.defaultPropertyValues[c]=new $d(p,void 0),m=this.defaultTransitionablePropertyValues[c]=new Cp(p);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=u.possiblyEvaluate(r)}}}gt(Tt,"DataDrivenProperty"),gt(ot,"DataConstantProperty"),gt(Gl,"ColorRampProperty");var Oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ep(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Na(l){if(Array.isArray(l))return l.map(Na);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){let e={};for(let r in l)e[r]=Na(l[r]);return e}return Ep(l)}function Mp(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(let e of l.slice(1))if(!Mp(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Gd(l,e="",r=null,c="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Mp(l)||(l=Hd(l));let p=l,u=!0;try{u=function(_){if(!Ao(_))return _;let C=Na(_);return Sp(C),C=xs(C),C}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let m=null,v=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){v=Oe[`filter_${c}`];let _=Vl(u,v,e,r);if(_.result==="error")throw new Error(_.value.map(C=>`${C.key}: ${C.message}`).join(", "));m=(C,S,w)=>_.value.evaluate(C,S,{},w)}let E=null,T=null;if(u!==p){let _=Vl(p,v,e,r);if(_.result==="error")throw new Error(_.value.map(C=>`${C.key}: ${C.message}`).join(", "));E=(C,S,w,M,D)=>_.value.evaluate(C,S,{},w,void 0,void 0,M,D),T=!tu(_.value.expression)}return{filter:m,dynamicFilter:E||void 0,needGeometry:v_(u),needFeature:!!T}}function xs(l){if(!Array.isArray(l))return l;let e=function(r){if(Sx.has(r[0])){for(let c=1;c<r.length;c++)if(Ao(r[c]))return!0}return r}(l);return e===!0?e:e.map(r=>xs(r))}function Sp(l){let e=!1,r=[];if(l[0]==="case"){for(let c=1;c<l.length-1;c+=2)e=e||Ao(l[c]),r.push(l[c+1]);r.push(l[l.length-1])}else if(l[0]==="match"){e=e||Ao(l[1]);for(let c=2;c<l.length-1;c+=2)r.push(l[c+1]);r.push(l[l.length-1])}else if(l[0]==="step"){e=e||Ao(l[1]);for(let c=1;c<l.length-1;c+=2)r.push(l[c+1])}e&&(l.length=0,l.push("any",...r));for(let c=1;c<l.length;c++)Sp(l[c])}function Ao(l){if(!Array.isArray(l))return!1;if((e=l[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<l.length;r++)if(Ao(l[r]))return!0;return!1}let Sx=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Tx(l,e){return l<e?-1:l>e?1:0}function v_(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let e=1;e<l.length;e++)if(v_(l[e]))return!0;return!1}function Hd(l){if(!l)return!0;let e=l[0];return l.length<=1?e!=="any":e==="=="?Tp(l[1],l[2],"=="):e==="!="?za(Tp(l[1],l[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Tp(l[1],l[2],e):e==="any"?(r=l.slice(1),["any"].concat(r.map(Hd))):e==="all"?["all"].concat(l.slice(1).map(Hd)):e==="none"?["all"].concat(l.slice(1).map(Hd).map(za)):e==="in"?Ip(l[1],l.slice(2)):e==="!in"?za(Ip(l[1],l.slice(2))):e==="has"?qd(l[1]):e!=="!has"||za(qd(l[1]));var r}function Tp(l,e,r){switch(l){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,l,e]}}function Ip(l,e){if(e.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",l,["literal",e.sort(Tx)]]:["filter-in-small",l,["literal",e]]}}function qd(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function za(l){return["!",l]}let pu="";function Wd(l,e){return e?`${l}${pu}${e}`:l}let x_="-transition",Ho=new Set(["fill","line","background","hillshade","raster"]);class Sr extends vl{constructor(e,r,c,p,u){if(super(),this.id=e.id,this.fqid=Wd(this.id,c),this.type=e.type,this.scope=c,this.lut=p,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;let m=Vl(this.filter,Oe[`filter_${e.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new Mx(r.layout,this.scope,u),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new g_(r.paint,this.scope,u);for(let m in e.paint)this.setPaintProperty(m,e.paint[m]);for(let m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $l(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Ho.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);let c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return ms(e,x_)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){let c=this._transitionablePaint,p=c._properties.properties;if(ms(e,x_)){let C=e.slice(0,-11);return p[C]&&c.setTransition(C,r||void 0),!1}if(!p[e])return!1;let u=c._values[e],m=u.value.isDataDriven(),v=u.value;c.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);let E=c._values[e].value,T=E.isDataDriven(),_=ms(e,"pattern")||e==="line-dasharray";return T||m||_||this._handleOverridablePaintPropertyUpdate(e,v,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,c){return null}_handleOverridablePaintPropertyUpdate(e,r,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return pl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let r=this.paint.get(e);if(r instanceof Ul&&Oa(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Gd(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,c,p,u,m,v,E,T){}queryIntersectsMatchingFeature(e,r,c,p){}}let b_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class mu{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ai{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Dn(l,e=1){let r=0,c=0;return{members:l.map(p=>{let u=b_[p.type].BYTES_PER_ELEMENT,m=r=w_(r,Math.max(e,u)),v=p.components||1;return c=Math.max(c,u),r+=u*v,{name:p.name,type:p.type,components:v,offset:m}}),size:w_(r,Math.max(c,e)),alignment:e}}function w_(l,e){return Math.ceil(l/e)*e}class Ks extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){let c=this.length;return this.resize(c+1),this.emplace(c,e,r)}emplace(e,r,c){let p=2*e;return this.int16[p+0]=r,this.int16[p+1]=c,e}}Ks.prototype.bytesPerElement=4,gt(Ks,"StructArrayLayout2i4");class Zd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,c)}emplace(e,r,c,p){let u=3*e;return this.int16[u+0]=r,this.int16[u+1]=c,this.int16[u+2]=p,e}}Zd.prototype.bytesPerElement=6,gt(Zd,"StructArrayLayout3i6");class Hl extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,c,p)}emplace(e,r,c,p,u){let m=4*e;return this.int16[m+0]=r,this.int16[m+1]=c,this.int16[m+2]=p,this.int16[m+3]=u,e}}Hl.prototype.bytesPerElement=8,gt(Hl,"StructArrayLayout4i8");class Dp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,c,p,u)}emplace(e,r,c,p,u,m){let v=5*e;return this.int16[v+0]=r,this.int16[v+1]=c,this.int16[v+2]=p,this.int16[v+3]=u,this.int16[v+4]=m,e}}Dp.prototype.bytesPerElement=10,gt(Dp,"StructArrayLayout5i10");class gu extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v){let E=this.length;return this.resize(E+1),this.emplace(E,e,r,c,p,u,m,v)}emplace(e,r,c,p,u,m,v,E){let T=6*e,_=12*e,C=3*e;return this.int16[T+0]=r,this.int16[T+1]=c,this.uint8[_+4]=p,this.uint8[_+5]=u,this.uint8[_+6]=m,this.uint8[_+7]=v,this.float32[C+2]=E,e}}gu.prototype.bytesPerElement=12,gt(gu,"StructArrayLayout2i4ub1f12");class bs extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,c,p)}emplace(e,r,c,p,u){let m=4*e;return this.float32[m+0]=r,this.float32[m+1]=c,this.float32[m+2]=p,this.float32[m+3]=u,e}}bs.prototype.bytesPerElement=16,gt(bs,"StructArrayLayout4f16");class Qs extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,c)}emplace(e,r,c,p){let u=3*e;return this.float32[u+0]=r,this.float32[u+1]=c,this.float32[u+2]=p,e}}Qs.prototype.bytesPerElement=12,gt(Qs,"StructArrayLayout3f12");class ws extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,c,p,u)}emplace(e,r,c,p,u,m){let v=6*e,E=3*e;return this.uint16[v+0]=r,this.uint16[v+1]=c,this.uint16[v+2]=p,this.uint16[v+3]=u,this.float32[E+2]=m,e}}ws.prototype.bytesPerElement=12,gt(ws,"StructArrayLayout4ui1f12");class Xd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c,p){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,c,p)}emplace(e,r,c,p,u){let m=4*e;return this.uint16[m+0]=r,this.uint16[m+1]=c,this.uint16[m+2]=p,this.uint16[m+3]=u,e}}Xd.prototype.bytesPerElement=8,gt(Xd,"StructArrayLayout4ui8");class _u extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,c,p,u,m)}emplace(e,r,c,p,u,m,v){let E=6*e;return this.int16[E+0]=r,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=u,this.int16[E+4]=m,this.int16[E+5]=v,e}}_u.prototype.bytesPerElement=12,gt(_u,"StructArrayLayout6i12");class ql extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v,E,T,_,C,S){let w=this.length;return this.resize(w+1),this.emplace(w,e,r,c,p,u,m,v,E,T,_,C,S)}emplace(e,r,c,p,u,m,v,E,T,_,C,S,w){let M=12*e;return this.int16[M+0]=r,this.int16[M+1]=c,this.int16[M+2]=p,this.int16[M+3]=u,this.uint16[M+4]=m,this.uint16[M+5]=v,this.uint16[M+6]=E,this.uint16[M+7]=T,this.int16[M+8]=_,this.int16[M+9]=C,this.int16[M+10]=S,this.int16[M+11]=w,e}}ql.prototype.bytesPerElement=24,gt(ql,"StructArrayLayout4i4ui4i24");class Ap extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,c,p,u,m)}emplace(e,r,c,p,u,m,v){let E=10*e,T=5*e;return this.int16[E+0]=r,this.int16[E+1]=c,this.int16[E+2]=p,this.float32[T+2]=u,this.float32[T+3]=m,this.float32[T+4]=v,e}}Ap.prototype.bytesPerElement=20,gt(Ap,"StructArrayLayout3i3f20");class Pp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Pp.prototype.bytesPerElement=4,gt(Pp,"StructArrayLayout1ul4");class ea extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){let c=this.length;return this.resize(c+1),this.emplace(c,e,r)}emplace(e,r,c){let p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=c,e}}ea.prototype.bytesPerElement=4,gt(ea,"StructArrayLayout2ui4");class Rp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v,E,T,_,C,S,w){let M=this.length;return this.resize(M+1),this.emplace(M,e,r,c,p,u,m,v,E,T,_,C,S,w)}emplace(e,r,c,p,u,m,v,E,T,_,C,S,w,M){let D=20*e,L=10*e;return this.int16[D+0]=r,this.int16[D+1]=c,this.int16[D+2]=p,this.int16[D+3]=u,this.int16[D+4]=m,this.float32[L+3]=v,this.float32[L+4]=E,this.float32[L+5]=T,this.float32[L+6]=_,this.int16[D+14]=C,this.uint32[L+8]=S,this.uint16[D+18]=w,this.uint16[D+19]=M,e}}Rp.prototype.bytesPerElement=40,gt(Rp,"StructArrayLayout5i4f1i1ul2ui40");class Yd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v){let E=this.length;return this.resize(E+1),this.emplace(E,e,r,c,p,u,m,v)}emplace(e,r,c,p,u,m,v,E){let T=8*e;return this.int16[T+0]=r,this.int16[T+1]=c,this.int16[T+2]=p,this.int16[T+4]=u,this.int16[T+5]=m,this.int16[T+6]=v,this.int16[T+7]=E,e}}Yd.prototype.bytesPerElement=16,gt(Yd,"StructArrayLayout3i2i2i16");class Wl extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,c,p,u)}emplace(e,r,c,p,u,m){let v=4*e,E=8*e;return this.float32[v+0]=r,this.float32[v+1]=c,this.float32[v+2]=p,this.int16[E+6]=u,this.int16[E+7]=m,e}}Wl.prototype.bytesPerElement=16,gt(Wl,"StructArrayLayout2f1f2i16");class Zl extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m){let v=this.length;return this.resize(v+1),this.emplace(v,e,r,c,p,u,m)}emplace(e,r,c,p,u,m,v){let E=20*e,T=5*e;return this.uint8[E+0]=r,this.uint8[E+1]=c,this.float32[T+1]=p,this.float32[T+2]=u,this.float32[T+3]=m,this.float32[T+4]=v,e}}Zl.prototype.bytesPerElement=20,gt(Zl,"StructArrayLayout2ub4f20");class _i extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,r,c)}emplace(e,r,c,p){let u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=c,this.uint16[u+2]=p,e}}_i.prototype.bytesPerElement=6,gt(_i,"StructArrayLayout3ui6");class Xl extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L,F,B,V,N,U){let H=this.length;return this.resize(H+1),this.emplace(H,e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L,F,B,V,N,U)}emplace(e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L,F,B,V,N,U,H){let J=30*e,oe=15*e,ee=60*e;return this.int16[J+0]=r,this.int16[J+1]=c,this.int16[J+2]=p,this.float32[oe+2]=u,this.float32[oe+3]=m,this.uint16[J+8]=v,this.uint16[J+9]=E,this.uint32[oe+5]=T,this.uint32[oe+6]=_,this.uint32[oe+7]=C,this.uint16[J+16]=S,this.uint16[J+17]=w,this.uint16[J+18]=M,this.float32[oe+10]=D,this.float32[oe+11]=L,this.uint8[ee+48]=F,this.uint8[ee+49]=B,this.uint8[ee+50]=V,this.uint32[oe+13]=N,this.int16[J+28]=U,this.uint8[ee+58]=H,e}}Xl.prototype.bytesPerElement=60,gt(Xl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Op extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L,F,B,V,N,U,H,J,oe,ee,ne,ge,te,pe,xe,be,Se){let Re=this.length;return this.resize(Re+1),this.emplace(Re,e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L,F,B,V,N,U,H,J,oe,ee,ne,ge,te,pe,xe,be,Se)}emplace(e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L,F,B,V,N,U,H,J,oe,ee,ne,ge,te,pe,xe,be,Se,Re){let Le=20*e,De=40*e,He=80*e;return this.float32[Le+0]=r,this.float32[Le+1]=c,this.int16[De+4]=p,this.int16[De+5]=u,this.int16[De+6]=m,this.int16[De+7]=v,this.int16[De+8]=E,this.int16[De+9]=T,this.int16[De+10]=_,this.int16[De+11]=C,this.int16[De+12]=S,this.uint16[De+13]=w,this.uint16[De+14]=M,this.uint16[De+15]=D,this.uint16[De+16]=L,this.uint16[De+17]=F,this.uint16[De+18]=B,this.uint16[De+19]=V,this.uint16[De+20]=N,this.uint16[De+21]=U,this.uint16[De+22]=H,this.uint16[De+23]=J,this.uint16[De+24]=oe,this.uint16[De+25]=ee,this.uint16[De+26]=ne,this.uint16[De+27]=ge,this.uint32[Le+14]=te,this.float32[Le+15]=pe,this.float32[Le+16]=xe,this.float32[Le+17]=be,this.float32[Le+18]=Se,this.uint8[He+76]=Re,e}}Op.prototype.bytesPerElement=80,gt(Op,"StructArrayLayout2f9i15ui1ul4f1ub80");class Yl extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Yl.prototype.bytesPerElement=4,gt(Yl,"StructArrayLayout1f4");class Ba extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,c,p,u)}emplace(e,r,c,p,u,m){let v=5*e;return this.float32[v+0]=r,this.float32[v+1]=c,this.float32[v+2]=p,this.float32[v+3]=u,this.float32[v+4]=m,e}}Ba.prototype.bytesPerElement=20,gt(Ba,"StructArrayLayout5f20");class Lp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v){let E=this.length;return this.resize(E+1),this.emplace(E,e,r,c,p,u,m,v)}emplace(e,r,c,p,u,m,v,E){let T=7*e;return this.float32[T+0]=r,this.float32[T+1]=c,this.float32[T+2]=p,this.float32[T+3]=u,this.float32[T+4]=m,this.float32[T+5]=v,this.float32[T+6]=E,e}}Lp.prototype.bytesPerElement=28,gt(Lp,"StructArrayLayout7f28");class Jd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v,E,T,_,C){let S=this.length;return this.resize(S+1),this.emplace(S,e,r,c,p,u,m,v,E,T,_,C)}emplace(e,r,c,p,u,m,v,E,T,_,C,S){let w=11*e;return this.float32[w+0]=r,this.float32[w+1]=c,this.float32[w+2]=p,this.float32[w+3]=u,this.float32[w+4]=m,this.float32[w+5]=v,this.float32[w+6]=E,this.float32[w+7]=T,this.float32[w+8]=_,this.float32[w+9]=C,this.float32[w+10]=S,e}}Jd.prototype.bytesPerElement=44,gt(Jd,"StructArrayLayout11f44");class C_ extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v,E,T){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,c,p,u,m,v,E,T)}emplace(e,r,c,p,u,m,v,E,T,_){let C=9*e;return this.float32[C+0]=r,this.float32[C+1]=c,this.float32[C+2]=p,this.float32[C+3]=u,this.float32[C+4]=m,this.float32[C+5]=v,this.float32[C+6]=E,this.float32[C+7]=T,this.float32[C+8]=_,e}}C_.prototype.bytesPerElement=36,gt(C_,"StructArrayLayout9f36");class yu extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,c,p){let u=this.length;return this.resize(u+1),this.emplace(u,e,r,c,p)}emplace(e,r,c,p,u){let m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=c,this.uint16[m+3]=p,this.uint16[m+4]=u,e}}yu.prototype.bytesPerElement=12,gt(yu,"StructArrayLayout1ul3ui12");class Fp extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Fp.prototype.bytesPerElement=2,gt(Fp,"StructArrayLayout1ui2");class vu extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){let c=this.length;return this.resize(c+1),this.emplace(c,e,r)}emplace(e,r,c){let p=2*e;return this.float32[p+0]=r,this.float32[p+1]=c,e}}vu.prototype.bytesPerElement=8,gt(vu,"StructArrayLayout2f8");class xu extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L){let F=this.length;return this.resize(F+1),this.emplace(F,e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L)}emplace(e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L,F){let B=16*e;return this.float32[B+0]=r,this.float32[B+1]=c,this.float32[B+2]=p,this.float32[B+3]=u,this.float32[B+4]=m,this.float32[B+5]=v,this.float32[B+6]=E,this.float32[B+7]=T,this.float32[B+8]=_,this.float32[B+9]=C,this.float32[B+10]=S,this.float32[B+11]=w,this.float32[B+12]=M,this.float32[B+13]=D,this.float32[B+14]=L,this.float32[B+15]=F,e}}xu.prototype.bytesPerElement=64,gt(xu,"StructArrayLayout16f64");class Kd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,c,p,u,m,v){let E=this.length;return this.resize(E+1),this.emplace(E,e,r,c,p,u,m,v)}emplace(e,r,c,p,u,m,v,E){let T=10*e,_=5*e;return this.uint16[T+0]=r,this.uint16[T+1]=c,this.uint16[T+2]=p,this.uint16[T+3]=u,this.float32[_+2]=m,this.float32[_+3]=v,this.float32[_+4]=E,e}}Kd.prototype.bytesPerElement=20,gt(Kd,"StructArrayLayout4ui3f20");class Qd extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}Qd.prototype.bytesPerElement=2,gt(Qd,"StructArrayLayout1i2");class eh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}eh.prototype.bytesPerElement=1,gt(eh,"StructArrayLayout1ub1");class E_ extends mu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}E_.prototype.size=40;class th extends Rp{get(e){return new E_(this,e)}}gt(th,"CollisionBoxArray");class bu extends mu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}bu.prototype.size=60;class kp extends Xl{get(e){return new bu(this,e)}}gt(kp,"PlacedSymbolArray");class M_ extends mu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}M_.prototype.size=80;class Np extends Op{get(e){return new M_(this,e)}}gt(Np,"SymbolInstanceArray");class S_ extends Yl{getoffsetX(e){return this.float32[1*e+0]}}gt(S_,"GlyphOffsetArray");class nh extends Ks{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}gt(nh,"SymbolLineVertexArray");class T_ extends mu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}T_.prototype.size=12;class I_ extends yu{get(e){return new T_(this,e)}}gt(I_,"FeatureIndexArray");class D_ extends ea{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}gt(D_,"FillExtrusionCentroidArray");class A_ extends mu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}A_.prototype.size=6;class zp extends Zd{get(e){return new A_(this,e)}}gt(zp,"FillExtrusionWallArray");let Ix=Dn([{name:"a_pos",components:2,type:"Int16"}],4),Dx=Dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Mi{constructor(e=[]){this.segments=e}_prepareSegment(e,r,c,p){let u=this.segments[this.segments.length-1];return e>Mi.MAX_VERTEX_ARRAY_LENGTH&&xn(`Max vertices per segment is ${Mi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Mi.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==p)&&(u={vertexOffset:r,primitiveOffset:c,vertexLength:0,primitiveLength:0},p!==void 0&&(u.sortKey=p),this.segments.push(u)),u}prepareSegment(e,r,c,p){return this._prepareSegment(e,r.length,c.length,p)}get(){return this.segments}destroy(){for(let e of this.segments)for(let r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,c,p){return new Mi([{vertexOffset:e,primitiveOffset:r,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function P_(l,e){return 256*(l=Wt(Math.floor(l),0,255))+Wt(Math.floor(e),0,255)}Mi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gt(Mi,"SegmentVector");let Ax=Dn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Px=Dn([{name:"a_dash",components:4,type:"Uint16"}]);class wu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,c,p){this.ids.push(R_(e)),this.positions.push(r,c,p)}eachPosition(e,r){let c=R_(e),p=0,u=this.ids.length-1;for(;p<u;){let m=p+u>>1;this.ids[m]>=c?u=m:p=m+1}for(;this.ids[p]===c;)r(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(e,r){let c=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Jl(c,p,0,c.length-1),r&&(r.add(c.buffer),r.add(p.buffer)),{ids:c,positions:p}}static deserialize(e){let r=new wu,c;r.ids=e.ids,r.positions=e.positions;for(let p of r.ids)p!==c&&r.uniqueIds.push(p),c=p;return r.indexed=!0,r}}function R_(l){let e=+l;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ar(String(l))}function Jl(l,e,r,c){for(;r<c;){let p=l[r+c>>1],u=r-1,m=c+1;for(;;){do u++;while(l[u]<p);do m--;while(l[m]>p);if(u>=m)break;ih(l,u,m),ih(e,3*u,3*m),ih(e,3*u+1,3*m+1),ih(e,3*u+2,3*m+2)}m-r<c-m?(Jl(l,e,r,m),r=m+1):(Jl(l,e,m+1,c),c=m)}}function ih(l,e,r){let c=l[e];l[e]=l[r],l[r]=c}gt(wu,"FeaturePositionMap");class Cs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Va extends Cs{constructor(e){super(e),this.current=0}set(e,r,c){this.fetchUniformLocation(e,r)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class $i extends Cs{constructor(e){super(e),this.current=0}set(e,r,c){this.fetchUniformLocation(e,r)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class qo extends Cs{constructor(e){super(e),this.current=[0,0]}set(e,r,c){this.fetchUniformLocation(e,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class Bp extends Cs{constructor(e){super(e),this.current=[0,0,0]}set(e,r,c){this.fetchUniformLocation(e,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class rh extends Cs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,c){this.fetchUniformLocation(e,r)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Vp extends Cs{constructor(e){super(e),this.current=Un.transparent.toRenderColor(null)}set(e,r,c){this.fetchUniformLocation(e,r)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}let O_=new Float32Array(16);class Cu extends Cs{constructor(e){super(e),this.current=O_}set(e,r,c){if(this.fetchUniformLocation(e,r)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let p=1;p<16;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}let Rx=new Float32Array(9),L_=new Float32Array(4);class oh extends Cs{constructor(e){super(e),this.current=L_}set(e,r,c){if(this.fetchUniformLocation(e,r)){for(let p=0;p<4;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function jp(l){return[P_(255*l.r,255*l.g),P_(255*l.b,255*l.a)]}class Eu{constructor(e,r,c,p){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=c,this.context=p}setUniform(e,r,c,p,u){let m=p.constantOr(this.value);r.set(e,u,m instanceof Un?m.toRenderColor(this.context.lut):m)}getBinding(e,r){return this.type==="color"?new Vp(e):new $i(e)}}class Kl{constructor(e,r){this.uniformNames=r.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,c,p,u){let m=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;m&&r.set(e,u,m)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new rh(e):new $i(e)}}class Es{constructor(e,r,c,p){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,c,p,u,m,v){let E=this.paintVertexArray.length,T=this.expression.evaluate(new bi(0,{brightness:m}),r,{},u,p,v);this.paintVertexArray.resize(e),this._setPaintValue(E,e,T,this.context)}updatePaintArray(e,r,c,p,u,m,v){let E=this.expression.evaluate({zoom:0,brightness:v},c,p,void 0,u);this._setPaintValue(e,r,E,this.context)}_setPaintValue(e,r,c,p){if(this.type==="color"){let u=jp(c.toRenderColor(p.lut));for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Po{constructor(e,r,c,p,u,m){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=p,this.context=u,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,c,p,u,m,v){let E=this.expression.evaluate(new bi(this.context.zoom,{brightness:m}),r,{},u,p,v),T=this.expression.evaluate(new bi(this.context.zoom+1,{brightness:m}),r,{},u,p,v),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,E,T,this.context)}updatePaintArray(e,r,c,p,u,m,v){let E=this.expression.evaluate({zoom:this.context.zoom,brightness:v},c,p,void 0,u),T=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},c,p,void 0,u);this._setPaintValue(e,r,E,T,this.context)}_setPaintValue(e,r,c,p,u){if(this.type==="color"){let m=jp(c.toRenderColor(u.lut)),v=jp(c.toRenderColor(u.lut));for(let E=e;E<r;E++)this.paintVertexArray.emplace(E,m[0],m[1],v[0],v[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,c,p,u){let m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=Wt(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);r.set(e,u,v)}getBinding(e,r){return new $i(e)}}class Ms{constructor(e,r,c,p,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(c==="array"?Px:Ax).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new p}populatePaintArray(e,r,c,p){let u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],c)}updatePaintArray(e,r,c,p,u,m,v){this._setPaintValues(e,r,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,r,c,p){if(!p||!c)return;let u=p[c];if(!u)return;let{tl:m,br:v,pixelRatio:E}=u;for(let T=e;T<r;T++)this.paintVertexArray.emplace(T,m[0],m[1],v[0],v[1],E)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ss{constructor(e,r,c=()=>!0){this.binders={},this._buffers=[],this.context=r;let p=[];for(let u in e.paint._values){let m=e.paint.get(u);if(!c(u)||!(m instanceof Ul&&Oa(m.property.specification)))continue;let v=Lx(u,e.type),E=m.value,T=m.property.specification.type,_=!!m.property.useIntegerZoom,C=u==="line-dasharray"||u.endsWith("pattern"),S=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||S)if(E.kind==="source"||S||C){let w=F_(u,T,"source");this.binders[u]=C?new Ms(E,v,T,w,e.id):new Es(E,v,T,w),p.push(`/a_${u}`)}else{let w=F_(u,T,"composite");this.binders[u]=new Po(E,v,T,_,r,w),p.push(`/z_${u}`)}else this.binders[u]=C?new Kl(E.value,v):new Eu(E.value,v,T,r),p.push(`/u_${u}`)}this.cacheKey=p.sort().join("")}getMaxValue(e){let r=this.binders[e];return r instanceof Es||r instanceof Po?r.maxValue:0}populatePaintArrays(e,r,c,p,u,m,v){for(let E in this.binders){let T=this.binders[E];T.context=this.context,(T instanceof Es||T instanceof Po||T instanceof Ms)&&T.populatePaintArray(e,r,c,p,u,m,v)}}setConstantPatternPositions(e){for(let r in this.binders){let c=this.binders[r];c instanceof Kl&&c.setConstantPatternPositions(e)}}updatePaintArrays(e,r,c,p,u,m,v,E){let T=!1,_=Object.keys(e),C=_.length!==0,S=C?_:r.uniqueIds;this.context.lut=u.lut;for(let w in this.binders){let M=this.binders[w];if(M.context=this.context,(M instanceof Es||M instanceof Po||M instanceof Ms)&&(M.expression.isStateDependent===!0||M.expression.isLightConstant===!1)){let D=u.paint.get(w);M.expression=D.value;for(let L of S){let F=e[L.toString()];r.eachPosition(L,(B,V,N)=>{let U=p.feature(B);M.updatePaintArray(V,N,U,F,m,v,E)})}if(!C)for(let L of c.uniqueIds){let F=e[L.toString()];c.eachPosition(L,(B,V,N)=>{let U=p.feature(B);M.updatePaintArray(V,N,U,F,m,v,E)})}T=!0}}return T}defines(){let e=[];for(let r in this.binders){let c=this.binders[r];(c instanceof Eu||c instanceof Kl)&&e.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){let e=[];for(let r in this.binders){let c=this.binders[r];if(c instanceof Es||c instanceof Po||c instanceof Ms)for(let p=0;p<c.paintVertexAttributes.length;p++)e.push(c.paintVertexAttributes[p].name)}return e}getBinderUniforms(){let e=[];for(let r in this.binders){let c=this.binders[r];if(c instanceof Eu||c instanceof Kl||c instanceof Po)for(let p of c.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let r=[];for(let c in this.binders){let p=this.binders[c];if(p instanceof Eu||p instanceof Kl||p instanceof Po)for(let u of p.uniformNames)r.push({name:u,property:c,binding:p.getBinding(e,u)})}return r}setUniforms(e,r,c,p,u){for(let{name:m,property:v,binding:E}of c)this.binders[v].setUniform(e,E,u,p.get(v),m)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let r=this.binders[e];(r instanceof Es||r instanceof Po||r instanceof Ms)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(let r in this.binders){let c=this.binders[r];(c instanceof Es||c instanceof Po||c instanceof Ms)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let r=this.binders[e];(r instanceof Es||r instanceof Po||r instanceof Ms)&&r.destroy()}}}class Wo{constructor(e,r,c=()=>!0){this.programConfigurations={};for(let p of e)this.programConfigurations[p.id]=new Ss(p,r,c);this.needsUpload=!1,this._featureMap=new wu,this._featureMapWithoutIds=new wu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,c,p,u,m,v,E){for(let T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,r,p,u,m,v,E);r.id!==void 0?this._featureMap.add(r.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,c,p,u,m){for(let v of c)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,v,p,u,m||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let Ox={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Lx(l,e){return Ox[l]||[l.replace(`${e}-`,"").replace(/-/g,"_")]}let Fx={"line-pattern":{source:ws,composite:ws},"fill-pattern":{source:ws,composite:ws},"fill-extrusion-pattern":{source:ws,composite:ws},"line-dasharray":{source:Xd,composite:Xd}},kx={color:{source:vu,composite:bs},number:{source:Yl,composite:vu}};function F_(l,e,r){let c=Fx[l];return c&&c[r]||kx[e][r]}gt(Eu,"ConstantBinder"),gt(Kl,"PatternConstantBinder"),gt(Es,"SourceExpressionBinder"),gt(Ms,"PatternCompositeBinder"),gt(Po,"CompositeExpressionBinder"),gt(Ss,"ProgramConfiguration",{omit:["_buffers"]}),gt(Wo,"ProgramConfigurationSet");let cr=ct/Math.PI/2,k_=5,d=6,t=16383,o=64,h=[o,32,16],g=-cr,y=cr;function b(l,e,r,c=cr){return r=pn(r),[l*Math.sin(r)*c,-e*c,l*Math.cos(r)*c]}function I(l,e,r){return b(Math.cos(pn(l)),Math.sin(pn(l)),e,r)}let A=63710088e-1,O=2*Math.PI*A;class P{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new P(ps(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let r=Math.PI/180,c=this.lat*r,p=e.lat*r,u=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return A*Math.acos(Math.min(u,1))}toBounds(e=0){let r=360*e/40075017,c=r/Math.cos(Math.PI/180*this.lat);return new k({lng:this.lng-c,lat:this.lat-r},{lng:this.lng+c,lat:this.lat+r})}toEcef(e){return I(this.lat,this.lng,cr+e*cr/A)}static convert(e){if(e instanceof P)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new P(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new P(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class k{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){let c=e;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{let c=e;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(e){return this._ne=e instanceof P?new P(e.lng,e.lat):P.convert(e),this}setSouthWest(e){return this._sw=e instanceof P?new P(e.lng,e.lat):P.convert(e),this}extend(e){let r=this._sw,c=this._ne,p,u;if(e instanceof P)p=e,u=e;else{if(!(e instanceof k))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(k.convert(e)):this.extend(P.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(P.convert(e)):this;if(p=e._sw,u=e._ne,!p||!u)return this}return r||c?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),c.lng=Math.max(u.lng,c.lng),c.lat=Math.max(u.lat,c.lat)):(this._sw=new P(p.lng,p.lat),this._ne=new P(u.lng,u.lat)),this}getCenter(){return new P((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new P(this.getWest(),this.getNorth())}getSouthEast(){return new P(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:c}=P.convert(e),p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(e){if(e)return e instanceof k?e:new k(e)}}let z=0,j=25.5;function W(l){return O*Math.cos(l*Math.PI/180)}function q(l){return(180+l)/360}function X(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Z(l,e){return l/W(e)}function Q(l){return 360*l-180}function ie(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function re(l,e){return l*W(ie(e))}let ae=85.051129;function de(l){return Math.cos(pn(Wt(l,-ae,ae)))}function le(l,e){let r=Wt(e,z,j),c=Math.pow(2,r);return de(l)*O/(512*c)}function he(l){return 1/Math.cos(l*Math.PI/180)}function _e(l,e=0){let r=Math.exp(Math.PI*(1-(l.y+e/ct)/(1<<l.z)*2));return 80150034*r/(r*r+1)/ct/(1<<l.z)}class we{constructor(e,r,c=0){this.x=+e,this.y=+r,this.z=+c}static fromLngLat(e,r=0){let c=P.convert(e);return new we(q(c.lng),X(c.lat),Z(r,c.lat))}toLngLat(){return new P(Q(this.x),ie(this.y))}toAltitude(){return re(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/O*he(ie(this.y))}}function ve(l,e,r,c,p,u,m,v,E){let T=(e+c)/2,_=(r+p)/2,C=new lt(T,_);v(C),function(S,w,M,D,L,F){let B=M-L,V=D-F;return Math.abs((D-w)*B-(M-S)*V)/Math.hypot(B,V)}(C.x,C.y,u.x,u.y,m.x,m.y)>=E?(ve(l,e,r,T,_,u,C,v,E),ve(l,T,_,c,p,C,m,v,E)):l.push(m)}function ye(l,e,r){let c=l[0],p=c.x,u=c.y;e(c);let m=[c];for(let v=1;v<l.length;v++){let E=l[v],{x:T,y:_}=E;e(E),ve(m,p,u,T,_,c,E,e,r),p=T,u=_,c=E}return m}function Fe(l,e,r,c){if(c(e,r)){let p=e.add(r)._mult(.5);Fe(l,e,p,c),Fe(l,p,r,c)}else l.push(r)}function Ue(l,e){let r=l[0],c=[r];for(let p=1;p<l.length;p++){let u=l[p];Fe(c,r,u,e),r=u}return c}let Je=Math.pow(2,14)-1,nt=-Je-1;function st(l,e){let r=Math.round(l.x*e),c=Math.round(l.y*e);return l.x=Wt(r,nt,Je),l.y=Wt(c,nt,Je),(r<l.x||r>l.x+1||c<l.y||c>l.y+1)&&xn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Ie(l,e,r){let c=l.loadGeometry(),p=l.extent,u=ct/p;if(e&&r&&r.projection.isReprojectedInTileSpace){let m=1<<e.z,{scale:v,x:E,y:T,projection:_}=r,C=S=>{let w=Q((e.x+S.x/p)/m),M=ie((e.y+S.y/p)/m),D=_.project(w,M);S.x=(D.x*v-E)*p,S.y=(D.y*v-T)*p};for(let S=0;S<c.length;S++)if(l.type!==1)c[S]=ye(c[S],C,1);else{let w=[];for(let M of c[S])M.x<0||M.x>=p||M.y<0||M.y>=p||(C(M),w.push(M));c[S]=w}}for(let m of c)for(let v of m)st(v,u);return c}function Ze(l,e){return{type:l.type,id:l.id,properties:l.properties,geometry:e?Ie(l):[]}}function Ne(l,e,r,c,p){l.emplaceBack(2*e+(c+1)/2,2*r+(p+1)/2)}function Xe(l,e,r){l.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ke{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ks,this.indexArray=new _i,this.segments=new Mi,this.programConfigurations=new Wo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,c,p){let u=this.layers[0],m=[],v=null;u.type==="circle"&&(v=u.layout.get("circle-sort-key"));for(let{feature:T,id:_,index:C,sourceLayerIndex:S}of e){let w=this.layers[0]._featureFilter.needGeometry,M=Ze(T,w);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),M,c))continue;let D=v?v.evaluate(M,{},c):void 0,L={id:_,properties:T.properties,type:T.type,sourceLayerIndex:S,index:C,geometry:w?M.geometry:Ie(T,c,p),patterns:{},sortKey:D};m.push(L)}v&&m.sort((T,_)=>T.sortKey-_.sortKey);let E=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new _u,E=p.projection);for(let T of m){let{geometry:_,index:C,sourceLayerIndex:S}=T,w=e[C].feature;this.addFeature(T,_,C,r.availableImages,c,E,r.brightness),r.featureIndex.insert(w,_,C,S,this.index)}}update(e,r,c,p,u){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,c,p,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ix.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Dx.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,c,p,u,m,v){for(let E of r)for(let T of E){let _=T.x,C=T.y;if(_<0||_>=ct||C<0||C>=ct)continue;if(m){let M=m.projectTilePoint(_,C,u),D=m.upVector(u,_,C),L=this.globeExtVertexArray;Xe(L,M,D),Xe(L,M,D),Xe(L,M,D),Xe(L,M,D)}let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=S.vertexLength;Ne(this.layoutVertexArray,_,C,-1,-1),Ne(this.layoutVertexArray,_,C,1,-1),Ne(this.layoutVertexArray,_,C,1,1),Ne(this.layoutVertexArray,_,C,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+2,w+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},p,u,v)}}function We(l,e){for(let r=0;r<l.length;r++)if(mn(e,l[r]))return!0;for(let r=0;r<e.length;r++)if(mn(l,e[r]))return!0;return!!_t(l,e)}function ut(l,e,r){return!!mn(l,e)||!!ht(e,l,r)}function bt(l,e){if(l.length===1)return Kt(e,l[0]);for(let r=0;r<e.length;r++){let c=e[r];for(let p=0;p<c.length;p++)if(mn(l,c[p]))return!0}for(let r=0;r<l.length;r++)if(Kt(e,l[r]))return!0;for(let r=0;r<e.length;r++)if(_t(l,e[r]))return!0;return!1}function It(l,e,r){if(l.length>1){if(_t(l,e))return!0;for(let c=0;c<e.length;c++)if(ht(e[c],l,r))return!0}for(let c=0;c<l.length;c++)if(ht(l[c],e,r))return!0;return!1}function _t(l,e){if(l.length===0||e.length===0)return!1;for(let r=0;r<l.length-1;r++){let c=l[r],p=l[r+1];for(let u=0;u<e.length-1;u++)if(At(c,p,e[u],e[u+1]))return!0}return!1}function At(l,e,r,c){return Vo(l,r,c)!==Vo(e,r,c)&&Vo(l,e,r)!==Vo(l,e,c)}function ht(l,e,r){let c=r*r;if(e.length===1)return l.distSqr(e[0])<c;for(let p=1;p<e.length;p++)if(Lt(l,e[p-1],e[p])<c)return!0;return!1}function Lt(l,e,r){let c=e.distSqr(r);if(c===0)return l.distSqr(e);let p=((l.x-e.x)*(r.x-e.x)+(l.y-e.y)*(r.y-e.y))/c;return l.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function Kt(l,e){let r,c,p,u=!1;for(let m=0;m<l.length;m++){r=l[m];for(let v=0,E=r.length-1;v<r.length;E=v++)c=r[v],p=r[E],c.y>e.y!=p.y>e.y&&e.x<(p.x-c.x)*(e.y-c.y)/(p.y-c.y)+c.x&&(u=!u)}return u}function mn(l,e){let r=!1;for(let c=0,p=l.length-1;c<l.length;p=c++){let u=l[c],m=l[p];u.y>e.y!=m.y>e.y&&e.x<(m.x-u.x)*(e.y-u.y)/(m.y-u.y)+u.x&&(r=!r)}return r}function Kn(l,e,r,c,p){for(let m of l)if(e<=m.x&&r<=m.y&&c>=m.x&&p>=m.y)return!0;let u=[new lt(e,r),new lt(e,p),new lt(c,p),new lt(c,r)];if(l.length>2){for(let m of u)if(mn(l,m))return!0}for(let m=0;m<l.length-1;m++)if(Mn(l[m],l[m+1],u))return!0;return!1}function Mn(l,e,r){let c=r[0],p=r[2];if(l.x<c.x&&e.x<c.x||l.x>p.x&&e.x>p.x||l.y<c.y&&e.y<c.y||l.y>p.y&&e.y>p.y)return!1;let u=Vo(l,e,r[0]);return u!==Vo(l,e,r[1])||u!==Vo(l,e,r[2])||u!==Vo(l,e,r[3])}function ri(l,e,r,c,p,u){let m=e.y-l.y,v=l.x-e.x;if(u=u||0){let E=m*m+v*v;if(E===0)return!0;let T=Math.sqrt(E);m/=T,v/=T}return!((r.x-l.x)*m+(r.y-l.y)*v-u<0||(c.x-l.x)*m+(c.y-l.y)*v-u<0||(p.x-l.x)*m+(p.y-l.y)*v-u<0)}function An(l,e,r,c,p,u,m){return!(ri(l,e,c,p,u,m)||ri(e,r,c,p,u,m)||ri(r,l,c,p,u,m)||ri(c,p,l,e,r,m)||ri(p,u,l,e,r,m)||ri(u,c,l,e,r,m))}function Qn(l,e,r){let c=e.paint.get(l).value;return c.kind==="constant"?c.value:r.programConfigurations.get(e.id).getMaxValue(l)}function un(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Xn(l,e,r,c,p){if(!e[0]&&!e[1])return l;let u=lt.convert(e)._mult(p);r==="viewport"&&u._rotate(-c);let m=[];for(let v=0;v<l.length;v++)m.push(l[v].sub(u));return m}function Gn(l,e,r,c){let p=lt.convert(l)._mult(c);return e==="viewport"&&p._rotate(-r),p}let Fn,ui;gt(Ke,"CircleBucket",{omit:["layers"]});var Vi,Jr={exports:{}},uo=(Vi||(Vi=1,function(l,e){(function(r){function c(u,m,v){var E=p(256*u,256*(m=Math.pow(2,v)-m-1),v),T=p(256*(u+1),256*(m+1),v);return E[0]+","+E[1]+","+T[0]+","+T[1]}function p(u,m,v){var E=2*Math.PI*6378137/256/Math.pow(2,v);return[u*E-2*Math.PI*6378137/2,m*E-2*Math.PI*6378137/2]}r.getURL=function(u,m,v,E,T,_){return _=_||{},u+"?"+["bbox="+c(v,E,T),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+m].join("&")},r.getTileBBox=c,r.getMercCoords=p,Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,Jr.exports)),Jr.exports);class Gi{constructor(e,r,c){this.z=e,this.x=r,this.y=c,this.key=Pn(0,e,e,r,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){let c=uo.getTileBBox(this.x,this.y,this.z),p=function(u,m,v){let E,T="";for(let _=u;_>0;_--)E=1<<_-1,T+=(m&E?1:0)+(v&E?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cn{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Pn(e,r.z,r.z,r.x,r.y)}}class gn{constructor(e,r,c,p,u){this.overscaledZ=e,this.wrap=r,this.canonical=new Gi(c,+p,+u),this.key=r===0&&e===c?this.canonical.key:Pn(r,e,c,p,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let r=this.canonical.z-e;return e>this.canonical.z?new gn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Pn(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{let c=this.canonical.z-e;return Pn(this.wrap*+r,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new gn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new gn(r,this.wrap,r,c,p),new gn(r,this.wrap,r,c+1,p),new gn(r,this.wrap,r,c,p+1),new gn(r,this.wrap,r,c+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new gn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new gn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Pn(l,e,r,c,p){let u=1<<Math.min(r,22),m=u*(p%u)+c%u;return l&&r<22&&(m+=u*u*((l<0?-2*l-1:2*l)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}let ni=[l=>{let e=l.canonical.x-1,r=l.wrap;return e<0&&(e=(1<<l.canonical.z)-1,r--),new gn(l.overscaledZ,r,l.canonical.z,e,l.canonical.y)},l=>{let e=l.canonical.x+1,r=l.wrap;return e===1<<l.canonical.z&&(e=0,r++),new gn(l.overscaledZ,r,l.canonical.z,e,l.canonical.y)},l=>new gn(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new gn(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];gt(Gi,"CanonicalTileID"),gt(gn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Si=Dn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:di}=Si,Yi=Dn([{name:"a_pos_3",components:3,type:"Int16"}]);var Zo=Dn([{name:"a_pos",type:"Int16",components:2}]);class Or{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,c){let p=Ee.vec3.dot(r,this.dir);if(Math.abs(p)<1e-6)return!1;let u=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/p;return c[0]=this.pos[0]+this.dir[0]*u,c[1]=this.pos[1]+this.dir[1]*u,c[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,r,c){if(Ee.vec3.equals(this.pos,e)||r===0)return c[0]=c[1]=c[2]=0,!1;let[p,u,m]=this.dir,v=this.pos[0]-e[0],E=this.pos[1]-e[1],T=this.pos[2]-e[2],_=p*p+u*u+m*m,C=2*(v*p+E*u+T*m),S=C*C-4*_*(v*v+E*E+T*T-r*r);if(S<0){let w=Math.max(-C/2,0),M=v+p*w,D=E+u*w,L=T+m*w,F=Math.hypot(M,D,L);return c[0]=M*r/F,c[1]=D*r/F,c[2]=L*r/F,!1}{let w=(-C-Math.sqrt(S))/(2*_);if(w<0){let M=Math.hypot(v,E,T);return c[0]=v*r/M,c[1]=E*r/M,c[2]=T*r/M,!1}return c[0]=v+p*w,c[1]=E+u*w,c[2]=T+m*w,!0}}}class Lr{constructor(e,r,c,p,u){this.TL=e,this.TR=r,this.BR=c,this.BL=p,this.horizon=u}static fromInvProjectionMatrix(e,r,c){let p=[-1,1,1],u=[1,1,1],m=[1,-1,1],v=[-1,-1,1],E=Ee.vec3.transformMat4(p,p,e),T=Ee.vec3.transformMat4(u,u,e),_=Ee.vec3.transformMat4(m,m,e),C=Ee.vec3.transformMat4(v,v,e);return new Lr(E,T,_,C,r/c)}}function ho(l,e,r){let c=1/0,p=-1/0,u=[];for(let m of l){Ee.vec3.sub(u,m,e);let v=Ee.vec3.dot(u,r);c=Math.min(c,v),p=Math.max(p,v)}return[c,p]}function Ro(l,e){let r=!0;for(let c=0;c<l.planes.length;c++){let p=l.planes[c],u=0;for(let m=0;m<e.length;m++)u+=Ee.vec3.dot(p,e[m])+p[3]>=0;if(u===0)return 0;u!==e.length&&(r=!1)}return r?2:1}function Fr(l,e){for(let r of l.projections){let c=ho(e,l.points[0],r.axis);if(r.projection[1]<c[0]||r.projection[0]>c[1])return 0}return 1}function Ts(l,e){let r=0,c=[0,0,0,0];for(let p=0;p<l.length;p++)c[0]=l[p][0],c[1]=l[p][1],c[2]=l[p][2],c[3]=1,Ee.vec4.dot(c,e)>=0&&r++;return r}class fo{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Bn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ee.vec3.sub([],this.points[2],this.points[3]),Ee.vec3.sub([],this.points[0],this.points[3]),Ee.vec3.sub([],this.points[4],this.points[0]),Ee.vec3.sub([],this.points[5],this.points[1]),Ee.vec3.sub([],this.points[6],this.points[2]),Ee.vec3.sub([],this.points[7],this.points[3])];for(let c of this.frustumEdges){let p=[0,-c[2],c[1]],u=[c[2],0,-c[0]];this.projections.push({axis:p,projection:ho(this.points,this.points[0],p)}),this.projections.push({axis:u,projection:ho(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,r,c,p){let u=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{let _=Ee.vec4.transformMat4([],T,e),C=1/_[3]/r*u;return Ee.vec4.mul(_,_,[C,C,p?1/_[3]:C,C])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{let _=Ee.vec3.sub([],m[T[0]],m[T[1]]),C=Ee.vec3.sub([],m[T[2]],m[T[1]]),S=Ee.vec3.normalize([],Ee.vec3.cross([],_,C)),w=-Ee.vec3.dot(S,m[T[1]]);return S.concat(w)}),E=[];for(let T=0;T<m.length;T++)E.push([m[T][0],m[T][1],m[T][2]]);return new fo(E,v)}intersectsPrecise(e,r,c){for(let p=0;p<r.length;p++)if(!Ts(e,r[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!Ts(e,this.planes[p]))return 0;for(let p of c)for(let u of this.frustumEdges){let m=Ee.vec3.cross([],p,u),v=Ee.vec3.length(m);if(v===0)continue;Ee.vec3.scale(m,m,1/v);let E=ho(this.points,this.points[0],m),T=ho(e,this.points[0],m);if(E[0]>T[1]||T[0]>E[1])return 0}return 1}containsPoint(e){for(let r of this.planes){let c=r[3];if(Ee.vec3.dot([r[0],r[1],r[2]],e)+c<0)return!1}return!0}}class Bn{static fromPoints(e){let r=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(let p of e)Ee.vec3.min(r,r,p),Ee.vec3.max(c,c,p);return new Bn(r,c)}static fromTileIdAndHeight(e,r,c){let p=1<<e.canonical.z,u=e.canonical.x,m=e.canonical.y;return new Bn([u/p,m/p,r],[(u+1)/p,(m+1)/p,c])}static applyTransform(e,r){let c=e.getCorners();for(let p=0;p<c.length;++p)Ee.vec3.transformMat4(c[p],c[p],r);return Bn.fromPoints(c)}static applyTransformFast(e,r){let c=[r[12],r[13],r[14]],p=[...c];for(let u=0;u<3;u++)for(let m=0;m<3;m++){let v=r[4*m+u],E=v*e.min[m],T=v*e.max[m];c[u]+=Math.min(E,T),p[u]+=Math.max(E,T)}return new Bn(c,p)}static projectAabbCorners(e,r){let c=e.getCorners();for(let p=0;p<c.length;++p)Ee.vec3.transformMat4(c[p],c[p],r);return c}constructor(e,r){this.min=e,this.max=r,this.center=Ee.vec3.scale([],Ee.vec3.add([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],c=Ee.vec3.clone(this.min),p=Ee.vec3.clone(this.max);for(let u=0;u<r.length;u++)c[u]=r[u]?this.min[u]:this.center[u],p[u]=r[u]?this.center[u]:this.max[u];return p[2]=this.max[2],new Bn(c,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ro(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ro(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?Fr(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?Fr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Ql(l){return l*cr/A}gt(Bn,"Aabb");let Up=[new Bn([g,g,g],[y,y,y]),new Bn([g,g,g],[0,0,y]),new Bn([0,g,g],[y,0,y]),new Bn([g,0,g],[0,y,y]),new Bn([0,0,g],[y,y,y])];function ec(l,e,r,c=!0){let p=Ee.vec3.scale([],l._camera.position,l.worldSize),u=[e,r,1,1];Ee.vec4.transformMat4(u,u,l.pixelMatrixInverse),Ee.vec4.scale(u,u,1/u[3]);let m=Ee.vec3.sub([],u,p),v=Ee.vec3.normalize([],m),E=l.globeMatrix,T=[E[12],E[13],E[14]],_=Ee.vec3.sub([],T,p),C=Ee.vec3.length(_),S=Ee.vec3.normalize([],_),w=l.worldSize/(2*Math.PI),M=Ee.vec3.dot(S,v),D=Math.asin(w/C);if(D<Math.acos(M)){if(!c)return null;let ge=[],te=[];Ee.vec3.scale(ge,v,C/M),Ee.vec3.normalize(te,Ee.vec3.sub(te,ge,_)),Ee.vec3.normalize(v,Ee.vec3.add(v,_,Ee.vec3.scale(v,te,Math.tan(D)*C)))}let L=[];new Or(p,v).closestPointOnSphere(T,w,L);let F=Ee.vec3.normalize([],ml(E,0)),B=Ee.vec3.normalize([],ml(E,1)),V=Ee.vec3.normalize([],ml(E,2)),N=Ee.vec3.dot(F,L),U=Ee.vec3.dot(B,L),H=Ee.vec3.dot(V,L),J=Ki(Math.asin(-U/w)),oe=Ki(Math.atan2(N,H));oe=l.center.lng+function(ge,te){let pe=(te-ge+180)%360-180;return pe<-180?pe+360:pe}(l.center.lng,oe);let ee=q(oe),ne=Wt(X(J),0,1);return new we(ee,ne)}class $p{constructor(e,r,c){this.a=Ee.vec3.sub([],e,c),this.b=Ee.vec3.sub([],r,c),this.center=c;let p=Ee.vec3.normalize([],this.a),u=Ee.vec3.normalize([],this.b);this.angle=Math.acos(Ee.vec3.dot(p,u))}}function Mu(l,e){if(l.angle===0)return null;let r;return r=l.a[e]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[e]/l.a[e]/Math.sin(l.angle)-1/Math.tan(l.angle)),r<0||r>1?null:function(c,p,u,m){let v=Math.sin(u);return c*(Math.sin((1-m)*u)/v)+p*(Math.sin(m*u)/v)}(l.a[e],l.b[e],l.angle,Wt(r,0,1))+l.center[e]}function ta(l){if(l.z<=1)return Up[l.z+2*l.y+l.x];let e=Nx(N_(l));return Bn.fromPoints(e)}function ja(l,e,r){return Ee.vec3.scale(l,l,1-r),Ee.vec3.scaleAndAdd(l,l,e,r)}function kE(l,e,r){for(let c of l)Ee.vec3.transformMat4(c,c,e),Ee.vec3.scale(c,c,r)}function NE(l,e,r,c){let p=e/l.worldSize,u=l.globeMatrix;if(r.z<=1){let ee=ta(r).getCorners();return kE(ee,u,p),Bn.fromPoints(ee)}let m=N_(r,c),v=Nx(m,cr+Ql(l._tileCoverLift));kE(v,u,p);let E=Number.MAX_VALUE,T=[-E,-E,-E],_=[E,E,E];if(m.contains(l.center)){for(let ge of v)Ee.vec3.min(_,_,ge),Ee.vec3.max(T,T,ge);T[2]=0;let ee=l.point,ne=[ee.x*p,ee.y*p,0];return Ee.vec3.min(_,_,ne),Ee.vec3.max(T,T,ne),new Bn(_,T)}if(l._tileCoverLift>0){for(let ee of v)Ee.vec3.min(_,_,ee),Ee.vec3.max(T,T,ee);return new Bn(_,T)}let C=[u[12]*p,u[13]*p,u[14]*p],S=m.getCenter(),w=Wt(l.center.lat,-ae,ae),M=Wt(S.lat,-ae,ae),D=q(l.center.lng),L=X(w),F=D-q(S.lng),B=L-X(M);F>.5?F-=1:F<-.5&&(F+=1);let V=0;if(Math.abs(F)>Math.abs(B))V=F>=0?1:3;else{V=B>=0?0:2;let ee=[u[4]*p,u[5]*p,u[6]*p],ne=-Math.sin(pn(B>=0?m.getSouth():m.getNorth()))*cr;Ee.vec3.scaleAndAdd(C,C,ee,ne)}let N=v[V],U=v[(V+1)%4],H=new $p(N,U,C),J=[Mu(H,0)||N[0],Mu(H,1)||N[1],Mu(H,2)||N[2]],oe=tc(l.zoom);if(oe>0){let ee=function({x:ge,y:te,z:pe},xe,be,Se,Re){let Le=1/(1<<pe),De=ge*Le,He=De+Le,et=te*Le,je=et+Le,pt=0,at=(De+He)/2-Se;return at>.5?pt=-1:at<-.5&&(pt=1),De=((De+pt)*xe-(Se*=xe))*be+Se,He=((He+pt)*xe-Se)*be+Se,et=(et*xe-(Re*=xe))*be+Re,je=(je*xe-Re)*be+Re,[[De,je,0],[He,je,0],[He,et,0],[De,et,0]]}(r,e,l._pixelsPerMercatorPixel,D,L);for(let ge=0;ge<v.length;ge++)ja(v[ge],ee[ge],oe);let ne=Ee.vec3.add([],ee[V],ee[(V+1)%4]);Ee.vec3.scale(ne,ne,.5),ja(J,ne,oe)}for(let ee of v)Ee.vec3.min(_,_,ee),Ee.vec3.max(T,T,ee);return _[2]=Math.min(N[2],U[2]),Ee.vec3.min(_,_,J),Ee.vec3.max(T,T,J),new Bn(_,T)}function N_({x:l,y:e,z:r},c=!1){let p=1/(1<<r),u=new P(Q(l*p),e===(1<<r)-1&&c?-90:ie((e+1)*p)),m=new P(Q((l+1)*p),e===0&&c?90:ie(e*p));return new k(u,m)}function Nx(l,e=cr){let r=pn(l.getNorth()),c=pn(l.getSouth()),p=Math.cos(r),u=Math.cos(c),m=Math.sin(r),v=Math.sin(c),E=l.getWest(),T=l.getEast();return[b(u,v,E,e),b(u,v,T,e),b(p,m,T,e),b(p,m,E,e)]}function Gp(l,e,r,c){let p=1<<r.z,u=(l/ct+r.x)/p;return I(ie((e/ct+r.y)/p),Q(u),c)}function z_({min:l,max:e}){return t/Math.max(e[0]-l[0],e[1]-l[1],e[2]-l[2])}let zE=new Float64Array(16);function B_(l){let e=z_(l),r=Ee.mat4.fromScaling(zE,[e,e,e]);return Ee.mat4.translate(r,r,Ee.vec3.negate([],l.min))}function zx(l){let e=Ee.mat4.fromTranslation(zE,l.min),r=1/z_(l);return Ee.mat4.scale(e,e,[r,r,r])}function Bx(l){let e=ct/(2*Math.PI);return l/(2*Math.PI)/e}function BE(l,e){return ct/(512*Math.pow(2,l))*z_(ta(e))}function VE(l,e,r,c,p){let u=Bx(r),m=[l,e,-r/(2*Math.PI)],v=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.translate(v,v,m),Ee.mat4.scale(v,v,[u,u,u]),Ee.mat4.rotateX(v,v,pn(-p)),Ee.mat4.rotateY(v,v,pn(-c)),v}function tc(l){return hl(k_,d,l)}function jE(l,e){let r=I(e.lat,e.lng),c=function(u){let m=I(u._center.lat,u._center.lng),v=Ee.vec3.fromValues(0,1,0),E=Ee.vec3.cross([],v,m),T=Ee.mat4.fromRotation([],-u.angle,m);E=Ee.vec3.transformMat4(E,E,T),Ee.mat4.fromRotation(T,-u._pitch,E);let _=Ee.vec3.normalize([],m);return Ee.vec3.scale(_,_,Ql(u.cameraToCenterDistance/u.pixelsPerMeter)),Ee.vec3.transformMat4(_,_,T),Ee.vec3.add([],m,_)}(l),p=Ee.vec3.subtract([],c,r);return Ee.vec3.angle(p,r)}function Vx(l,e){return jE(l,e)>Math.PI/2*1.01}let UE=pn(85),hO=Math.cos(UE),fO=Math.sin(UE),pO=Ee.mat4.create(),$E=l=>{let e=[];return l.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function GE(l,e,r,c,p,u,m,v,E){if(u&&l.queryGeometry.isAboveHorizon)return!1;u&&(E*=l.pixelToTileUnitsFactor);let T=l.tileID.canonical,_=r.projection.upVectorScale(T,r.center.lat,r.worldSize).metersToTile;for(let C of e)for(let S of C){let w=S.add(v),M=p&&r.elevation?r.elevation.exaggeration()*p.getElevationAt(w.x,w.y,!0):0,D=r.projection.projectTilePoint(w.x,w.y,T);if(M>0){let V=r.projection.upVector(T,w.x,w.y);D.x+=V[0]*_*M,D.y+=V[1]*_*M,D.z+=V[2]*_*M}let L=u?w:mO(D.x,D.y,D.z,c),F=u?l.tilespaceRays.map(V=>_O(V,M)):l.queryGeometry.screenGeometry,B=Ee.vec4.transformMat4([],[D.x,D.y,D.z,1],c);if(!m&&u?E*=B[3]/r.cameraToCenterDistance:m&&!u&&(E*=r.cameraToCenterDistance/B[3]),u){let V=ie((S.y/ct+T.y)/(1<<T.z));E/=r.projection.pixelsPerMeter(V,1)/Z(1,V)}if(ut(F,L,E))return!0}return!1}function mO(l,e,r,c){let p=Ee.vec4.transformMat4([],[l,e,r,1],c);return new lt(p[0]/p[3],p[1]/p[3])}let HE=Ee.vec3.fromValues(0,0,0),gO=Ee.vec3.fromValues(0,0,1);function _O(l,e){let r=Ee.vec3.create();return HE[2]=e,l.intersectsPlane(HE,gO,r),new lt(r[0],r[1])}class qE extends Ke{}let WE,ZE,XE,YE;function JE(l,{width:e,height:r},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*r*c);return l.width=e,l.height=r,l.data=p,l}function KE(l,e,r){let{width:c,height:p}=e;c===l.width&&p===l.height||(jx(l,e,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,c),height:Math.min(l.height,p)},r,null),l.width=c,l.height=p,l.data=e.data)}function jx(l,e,r,c,p,u,m,v){if(p.width===0||p.height===0)return e;if(p.width>l.width||p.height>l.height||r.x>l.width-p.width||r.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||c.x>e.width-p.width||c.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");let E=l.data,T=e.data,_=u===4&&v;for(let C=0;C<p.height;C++){let S=((r.y+C)*l.width+r.x)*u,w=((c.y+C)*e.width+c.x)*u;if(_)for(let M=0;M<p.width;M++){let D=S+M*u+3,L=w+M*u;T[L+0]=255,T[L+1]=255,T[L+2]=255,T[L+3]=E[D]}else if(m)for(let M=0;M<p.width;M++){let D=S+M*u,L=w+M*u,F=E[D+3],B=new Un(E[D+0]/255*F,E[D+1]/255*F,E[D+2]/255*F,F).toRenderColor(m).toArray();T[L+0]=B[0],T[L+1]=B[1],T[L+2]=B[2],T[L+3]=B[3]}else for(let M=0;M<p.width*u;M++)T[w+M]=E[S+M]}return e}gt(qE,"HeatmapBucket",{omit:["layers"]});class nc{constructor(e,r){JE(this,e,1,r)}resize(e){KE(this,new nc(e),1)}clone(){return new nc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,c,p,u){jx(e,r,c,p,u,1,null)}}class Tr{constructor(e,r){JE(this,e,4,r)}resize(e){KE(this,new Tr(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Tr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,c,p,u,m,v){jx(e,r,c,p,u,4,m,v)}}class QE{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function Hp(l){let e={},r=l.resolution||256,c=l.clips?l.clips.length:1,p=l.image||new Tr({width:r,height:c}),u=(m,v,E)=>{e[l.evaluationKey]=E;let T=l.expression.evaluate(e);T&&(p.data[m+v+0]=Math.floor(255*T.r/T.a),p.data[m+v+1]=Math.floor(255*T.g/T.a),p.data[m+v+2]=Math.floor(255*T.b/T.a),p.data[m+v+3]=Math.floor(255*T.a))};if(l.clips)for(let m=0,v=0;m<c;++m,v+=4*r)for(let E=0,T=0;E<r;E++,T+=4){let _=E/(r-1),{start:C,end:S}=l.clips[m];u(v,T,C*(1-_)+S*_)}else for(let m=0,v=0;m<r;m++,v+=4)u(0,v,m/(r-1));return p}gt(nc,"AlphaImage"),gt(Tr,"RGBAImage");let yO=Dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:vO}=yO;function qp(l,e,r=2){let c=e&&e.length,p=c?e[0]*r:l.length,u=eM(l,0,p,r,!0),m=[];if(!u||u.next===u.prev)return m;let v,E,T;if(c&&(u=function(_,C,S,w){let M=[];for(let D=0,L=C.length;D<L;D++){let F=eM(_,C[D]*w,D<L-1?C[D+1]*w:_.length,w,!1);F===F.next&&(F.steiner=!0),M.push(TO(F))}M.sort(EO);for(let D=0;D<M.length;D++)S=MO(M[D],S);return S}(l,e,u,r)),l.length>80*r){v=1/0,E=1/0;let _=-1/0,C=-1/0;for(let S=r;S<p;S+=r){let w=l[S],M=l[S+1];w<v&&(v=w),M<E&&(E=M),w>_&&(_=w),M>C&&(C=M)}T=Math.max(_-v,C-E),T=T!==0?32767/T:0}return Wp(u,m,r,v,E,T,0),m}function eM(l,e,r,c,p){let u;if(p===function(m,v,E,T){let _=0;for(let C=v,S=E-T;C<E;C+=T)_+=(m[S]-m[C])*(m[C+1]+m[S+1]),S=C;return _}(l,e,r,c)>0)for(let m=e;m<r;m+=c)u=iM(m/c|0,l[m],l[m+1],u);else for(let m=r-c;m>=e;m-=c)u=iM(m/c|0,l[m],l[m+1],u);return u&&V_(u,u.next)&&(Xp(u),u=u.next),u}function Su(l,e){if(!l)return l;e||(e=l);let r,c=l;do if(r=!1,c.steiner||!V_(c,c.next)&&Hi(c.prev,c,c.next)!==0)c=c.next;else{if(Xp(c),c=e=c.prev,c===c.next)break;r=!0}while(r||c!==e);return e}function Wp(l,e,r,c,p,u,m){if(!l)return;!m&&u&&function(E,T,_,C){let S=E;do S.z===0&&(S.z=Ux(S.x,S.y,T,_,C)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==E);S.prevZ.nextZ=null,S.prevZ=null,function(w){let M,D=1;do{let L,F=w;w=null;let B=null;for(M=0;F;){M++;let V=F,N=0;for(let H=0;H<D&&(N++,V=V.nextZ,V);H++);let U=D;for(;N>0||U>0&&V;)N!==0&&(U===0||!V||F.z<=V.z)?(L=F,F=F.nextZ,N--):(L=V,V=V.nextZ,U--),B?B.nextZ=L:w=L,L.prevZ=B,B=L;F=V}B.nextZ=null,D*=2}while(M>1)}(S)}(l,c,p,u);let v=l;for(;l.prev!==l.next;){let E=l.prev,T=l.next;if(u?bO(l,c,p,u):xO(l))e.push(E.i,l.i,T.i),Xp(l),l=T.next,v=T.next;else if((l=T)===v){m?m===1?Wp(l=wO(Su(l),e),e,r,c,p,u,2):m===2&&CO(l,e,r,c,p,u):Wp(Su(l),e,r,c,p,u,1);break}}}function xO(l){let e=l.prev,r=l,c=l.next;if(Hi(e,r,c)>=0)return!1;let p=e.x,u=r.x,m=c.x,v=e.y,E=r.y,T=c.y,_=p<u?p<m?p:m:u<m?u:m,C=v<E?v<T?v:T:E<T?E:T,S=p>u?p>m?p:m:u>m?u:m,w=v>E?v>T?v:T:E>T?E:T,M=c.next;for(;M!==e;){if(M.x>=_&&M.x<=S&&M.y>=C&&M.y<=w&&sh(p,v,u,E,m,T,M.x,M.y)&&Hi(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function bO(l,e,r,c){let p=l.prev,u=l,m=l.next;if(Hi(p,u,m)>=0)return!1;let v=p.x,E=u.x,T=m.x,_=p.y,C=u.y,S=m.y,w=v<E?v<T?v:T:E<T?E:T,M=_<C?_<S?_:S:C<S?C:S,D=v>E?v>T?v:T:E>T?E:T,L=_>C?_>S?_:S:C>S?C:S,F=Ux(w,M,e,r,c),B=Ux(D,L,e,r,c),V=l.prevZ,N=l.nextZ;for(;V&&V.z>=F&&N&&N.z<=B;){if(V.x>=w&&V.x<=D&&V.y>=M&&V.y<=L&&V!==p&&V!==m&&sh(v,_,E,C,T,S,V.x,V.y)&&Hi(V.prev,V,V.next)>=0||(V=V.prevZ,N.x>=w&&N.x<=D&&N.y>=M&&N.y<=L&&N!==p&&N!==m&&sh(v,_,E,C,T,S,N.x,N.y)&&Hi(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;V&&V.z>=F;){if(V.x>=w&&V.x<=D&&V.y>=M&&V.y<=L&&V!==p&&V!==m&&sh(v,_,E,C,T,S,V.x,V.y)&&Hi(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;N&&N.z<=B;){if(N.x>=w&&N.x<=D&&N.y>=M&&N.y<=L&&N!==p&&N!==m&&sh(v,_,E,C,T,S,N.x,N.y)&&Hi(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function wO(l,e){let r=l;do{let c=r.prev,p=r.next.next;!V_(c,p)&&tM(c,r,r.next,p)&&Zp(c,p)&&Zp(p,c)&&(e.push(c.i,r.i,p.i),Xp(r),Xp(r.next),r=l=p),r=r.next}while(r!==l);return Su(r)}function CO(l,e,r,c,p,u){let m=l;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&IO(m,v)){let E=nM(m,v);return m=Su(m,m.next),E=Su(E,E.next),Wp(m,e,r,c,p,u,0),void Wp(E,e,r,c,p,u,0)}v=v.next}m=m.next}while(m!==l)}function EO(l,e){return l.x-e.x}function MO(l,e){let r=function(p,u){let m=u,v=p.x,E=p.y,T,_=-1/0;do{if(E<=m.y&&E>=m.next.y&&m.next.y!==m.y){let D=m.x+(E-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(D<=v&&D>_&&(_=D,T=m.x<m.next.x?m:m.next,D===v))return T}m=m.next}while(m!==u);if(!T)return null;let C=T,S=T.x,w=T.y,M=1/0;m=T;do{if(v>=m.x&&m.x>=S&&v!==m.x&&sh(E<w?v:_,E,S,w,E<w?_:v,E,m.x,m.y)){let D=Math.abs(E-m.y)/(v-m.x);Zp(m,p)&&(D<M||D===M&&(m.x>T.x||m.x===T.x&&SO(T,m)))&&(T=m,M=D)}m=m.next}while(m!==C);return T}(l,e);if(!r)return e;let c=nM(r,l);return Su(c,c.next),Su(r,r.next)}function SO(l,e){return Hi(l.prev,l,e.prev)<0&&Hi(e.next,l,l.next)<0}function Ux(l,e,r,c,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-r)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function TO(l){let e=l,r=l;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==l);return r}function sh(l,e,r,c,p,u,m,v){return(p-m)*(e-v)>=(l-m)*(u-v)&&(l-m)*(c-v)>=(r-m)*(e-v)&&(r-m)*(u-v)>=(p-m)*(c-v)}function IO(l,e){return l.next.i!==e.i&&l.prev.i!==e.i&&!function(r,c){let p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==c.i&&p.next.i!==c.i&&tM(p,p.next,r,c))return!0;p=p.next}while(p!==r);return!1}(l,e)&&(Zp(l,e)&&Zp(e,l)&&function(r,c){let p=r,u=!1,m=(r.x+c.x)/2,v=(r.y+c.y)/2;do p.y>v!=p.next.y>v&&p.next.y!==p.y&&m<(p.next.x-p.x)*(v-p.y)/(p.next.y-p.y)+p.x&&(u=!u),p=p.next;while(p!==r);return u}(l,e)&&(Hi(l.prev,l,e.prev)||Hi(l,e.prev,e))||V_(l,e)&&Hi(l.prev,l,l.next)>0&&Hi(e.prev,e,e.next)>0)}function Hi(l,e,r){return(e.y-l.y)*(r.x-e.x)-(e.x-l.x)*(r.y-e.y)}function V_(l,e){return l.x===e.x&&l.y===e.y}function tM(l,e,r,c){let p=U_(Hi(l,e,r)),u=U_(Hi(l,e,c)),m=U_(Hi(r,c,l)),v=U_(Hi(r,c,e));return p!==u&&m!==v||!(p!==0||!j_(l,r,e))||!(u!==0||!j_(l,c,e))||!(m!==0||!j_(r,l,c))||!(v!==0||!j_(r,e,c))}function j_(l,e,r){return e.x<=Math.max(l.x,r.x)&&e.x>=Math.min(l.x,r.x)&&e.y<=Math.max(l.y,r.y)&&e.y>=Math.min(l.y,r.y)}function U_(l){return l>0?1:l<0?-1:0}function Zp(l,e){return Hi(l.prev,l,l.next)<0?Hi(l,e,l.next)>=0&&Hi(l,l.prev,e)>=0:Hi(l,e,l.prev)<0||Hi(l,l.next,e)<0}function nM(l,e){let r=$x(l.i,l.x,l.y),c=$x(e.i,e.x,e.y),p=l.next,u=e.prev;return l.next=e,e.prev=l,r.next=p,p.prev=r,c.next=r,r.prev=c,u.next=c,c.prev=u,c}function iM(l,e,r,c){let p=$x(l,e,r);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Xp(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function $x(l,e,r){return{i:l,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $_(l,e){let r=l.length;if(r<=1)return[l];let c=[],p,u;for(let m=0;m<r;m++){let v=ld(l[m]);v!==0&&(l[m].area=Math.abs(v),u===void 0&&(u=v<0),u===v<0?(p&&c.push(p),p=[l[m]]):p.push(l[m]))}if(p&&c.push(p),e>1)for(let m=0;m<c.length;m++)c[m].length<=e||(Ng(c[m],e,1,c[m].length-1,DO),c[m]=c[m].slice(0,e));return c}function DO(l,e){return e.area-l.area}function Gx(l,e,r){let c=r.patternDependencies,p=!1;for(let u of e){let m=u.paint.get(`${l}-pattern`);m.isConstant()||(p=!0);let v=m.constantOr(null);v&&(p=!0,c[v]=!0)}return p}function Hx(l,e,r,c,p){let u=p.patternDependencies;for(let m of e){let v=m.paint.get(`${l}-pattern`).value;if(v.kind!=="constant"){let E=v.evaluate({zoom:c},r,{},p.availableImages);E=E&&E.name?E.name:E,u[E]=!0,r.patterns[m.id]=E}}return r}class qx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ks,this.indexArray=new _i,this.indexArray2=new ea,this.programConfigurations=new Wo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Mi,this.segments2=new Mi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}updateFootprints(e,r){}populate(e,r,c,p){this.hasPattern=Gx("fill",this.layers,r);let u=this.layers[0].layout.get("fill-sort-key"),m=[];for(let{feature:v,id:E,index:T,sourceLayerIndex:_}of e){let C=this.layers[0]._featureFilter.needGeometry,S=Ze(v,C);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),S,c))continue;let w=u?u.evaluate(S,{},c,r.availableImages):void 0,M={id:E,properties:v.properties,type:v.type,sourceLayerIndex:_,index:T,geometry:C?S.geometry:Ie(v,c,p),patterns:{},sortKey:w};m.push(M)}u&&m.sort((v,E)=>v.sortKey-E.sortKey);for(let v of m){let{geometry:E,index:T,sourceLayerIndex:_}=v;if(this.hasPattern){let C=Hx("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(v,E,T,c,{},r.availableImages,r.brightness);r.featureIndex.insert(e[T].feature,E,T,_,this.index)}}update(e,r,c,p,u){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,c,p,u)}addFeatures(e,r,c,p,u,m){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,c,p,u,m=[],v){for(let E of $_(r,500)){let T=0;for(let D of E)T+=D.length;let _=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),C=_.vertexLength,S=[],w=[];for(let D of E){if(D.length===0)continue;D!==E[0]&&w.push(S.length/2);let L=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),F=L.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(F+D.length-1,F),S.push(D[0].x),S.push(D[0].y);for(let B=1;B<D.length;B++)this.layoutVertexArray.emplaceBack(D[B].x,D[B].y),this.indexArray2.emplaceBack(F+B-1,F+B),S.push(D[B].x),S.push(D[B].y);L.vertexLength+=D.length,L.primitiveLength+=D.length}let M=qp(S,w);for(let D=0;D<M.length;D+=3)this.indexArray.emplaceBack(C+M[D],C+M[D+1],C+M[D+2]);_.vertexLength+=T,_.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,v)}}let rM,oM,sM,aM;gt(qx,"FillBucket",{omit:["layers","patternFeatures"]});class Wx{constructor(e,r,c,p){if(this.triangleCount=r.length/3,this.min=new lt(0,0),this.max=new lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[u,m]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){let S=e[C];u.x=Math.min(u.x,S.x),u.y=Math.min(u.y,S.y),m.x=Math.max(m.x,S.x),m.y=Math.max(m.y,S.y)}if(p){let C=Math.ceil(Math.max(m.x-u.x,m.y-u.y)/p);c=Math.max(c,C)}if(c===0)return;this.min=u,this.max=m;let v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);let E=Math.max(v.x,v.y)/c;this.cellsX=Math.max(1,Math.ceil(v.x/E)),this.cellsY=Math.max(1,Math.ceil(v.y/E)),this.xScale=1/E,this.yScale=1/E;let T=[];for(let C=0;C<this.triangleCount;C++){let S=e[r[3*C+0]].sub(this.min),w=e[r[3*C+1]].sub(this.min),M=e[r[3*C+2]].sub(this.min),D=na(Math.floor(Math.min(S.x,w.x,M.x)),this.xScale,this.cellsX),L=na(Math.floor(Math.max(S.x,w.x,M.x)),this.xScale,this.cellsX),F=na(Math.floor(Math.min(S.y,w.y,M.y)),this.yScale,this.cellsY),B=na(Math.floor(Math.max(S.y,w.y,M.y)),this.yScale,this.cellsY),V=new lt(0,0),N=new lt(0,0),U=new lt(0,0),H=new lt(0,0);for(let J=F;J<=B;++J){V.y=N.y=J*E,U.y=H.y=(J+1)*E;for(let oe=D;oe<=L;++oe)V.x=U.x=oe*E,N.x=H.x=(oe+1)*E,(An(S,w,M,V,N,H)||An(S,w,M,V,H,U))&&T.push({cellIdx:J*this.cellsX+oe,triIdx:C})}}if(T.length===0)return;T.sort((C,S)=>C.cellIdx-S.cellIdx||C.triIdx-S.triIdx);let _=0;for(;_<T.length;){let C=T[_].cellIdx,S={start:this.payload.length,len:0};for(;_<T.length&&T[_].cellIdx===C;)++S.len,this.payload.push(T[_++].triIdx);this.cells[C]=S}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let c=na(e.x-this.min.x,this.xScale,this.cellsX),p=na(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[p*this.cellsX+c];if(u){this._lazyInitLookup();for(let m=0;m<u.len;m++){let v=this.payload[u.start+m],E=Math.floor(v/8),T=1<<v%8;if(!(this.lookup[E]&T)&&(this.lookup[E]|=T,r.push(v),r.length===this.triangleCount))return}}}query(e,r,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();let p=na(e.x-this.min.x,this.xScale,this.cellsX),u=na(r.x-this.min.x,this.xScale,this.cellsX),m=na(e.y-this.min.y,this.yScale,this.cellsY),v=na(r.y-this.min.y,this.yScale,this.cellsY);for(let E=m;E<=v;E++)for(let T=p;T<=u;T++){let _=this.cells[E*this.cellsX+T];if(_)for(let C=0;C<_.len;C++){let S=this.payload[_.start+C],w=Math.floor(S/8),M=1<<S%8;if(!(this.lookup[w]&M)&&(this.lookup[w]|=M,c.push(S),c.length===this.triangleCount))return}}}}function na(l,e,r){return Math.max(0,Math.min(r-1,Math.floor(l*e)))}gt(Wx,"TriangleGridIndex");class lM{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(let c of this.footprints)r.push({footprint:c,id:e})}populate(e,r,c,p){let u=[];for(let{feature:m,id:v,index:E,sourceLayerIndex:T}of e){let _=this.layers[0]._featureFilter.needGeometry,C=Ze(m,_);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),C,c))continue;let S={id:v,properties:m.properties,type:m.type,sourceLayerIndex:T,index:E,geometry:_?C.geometry:Ie(m,c,p),patterns:{}};u.push(S)}for(let m of u){let{geometry:v,index:E,sourceLayerIndex:T}=m;this.addFeature(m,v,E,c,{},r.availableImages,r.brightness),r.featureIndex.insert(e[E].feature,v,E,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,c,p,u){}destroy(){}addFeature(e,r,c,p,u,m=[],v){for(let E of $_(r,2)){let T=[],_=[],C=[],S=new lt(1/0,1/0),w=new lt(-1/0,-1/0);for(let L of E)if(L.length!==0){L!==E[0]&&C.push(_.length/2);for(let F=0;F<L.length;F++)_.push(L[F].x),_.push(L[F].y),T.push(L[F]),S.x=Math.min(S.x,L[F].x),S.y=Math.min(S.y,L[F].y),w.x=Math.max(w.x,L[F].x),w.y=Math.max(w.y,L[F].y)}let M=qp(_,C),D=new Wx(T,M,8,256);this.footprints.push({vertices:T,indices:M,grid:D,min:S,max:w})}}}gt(lM,"ClipBucket",{omit:["layers"]});let AO=Dn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),PO=Dn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),RO=Dn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),OO=Dn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),LO=Dn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),FO=Dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:kO}=AO;var Zx,cM,Xx,uM,Yx,dM,hM,G_={};function fM(){if(cM)return Zx;cM=1;var l=Vc();function e(p,u,m,v,E){this.properties={},this.extent=m,this.type=0,this._pbf=p,this._geometry=-1,this._keys=v,this._values=E,p.readFields(r,this,u)}function r(p,u,m){p==1?u.id=m.readVarint():p==2?function(v,E){for(var T=v.readVarint()+v.pos;v.pos<T;){var _=E._keys[v.readVarint()],C=E._values[v.readVarint()];E.properties[_]=C}}(m,u):p==3?u.type=m.readVarint():p==4&&(u._geometry=m.pos)}function c(p){for(var u,m,v=0,E=0,T=p.length,_=T-1;E<T;_=E++)v+=((m=p[_]).x-(u=p[E]).x)*(u.y+m.y);return v}return Zx=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var u,m=p.readVarint()+p.pos,v=1,E=0,T=0,_=0,C=[];p.pos<m;){if(E<=0){var S=p.readVarint();v=7&S,E=S>>3}if(E--,v===1||v===2)T+=p.readSVarint(),_+=p.readSVarint(),v===1&&(u&&C.push(u),u=[]),u.push(new l(T,_));else{if(v!==7)throw new Error("unknown command "+v);u&&u.push(u[0].clone())}}return u&&C.push(u),C},e.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var u=p.readVarint()+p.pos,m=1,v=0,E=0,T=0,_=1/0,C=-1/0,S=1/0,w=-1/0;p.pos<u;){if(v<=0){var M=p.readVarint();m=7&M,v=M>>3}if(v--,m===1||m===2)(E+=p.readSVarint())<_&&(_=E),E>C&&(C=E),(T+=p.readSVarint())<S&&(S=T),T>w&&(w=T);else if(m!==7)throw new Error("unknown command "+m)}return[_,S,C,w]},e.prototype.toGeoJSON=function(p,u,m){var v,E,T=this.extent*Math.pow(2,m),_=this.extent*p,C=this.extent*u,S=this.loadGeometry(),w=e.types[this.type];function M(F){for(var B=0;B<F.length;B++){var V=F[B];F[B]=[360*(V.x+_)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+C)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(v=0;v<S.length;v++)D[v]=S[v][0];M(S=D);break;case 2:for(v=0;v<S.length;v++)M(S[v]);break;case 3:for(S=function(F){var B=F.length;if(B<=1)return[F];for(var V,N,U=[],H=0;H<B;H++){var J=c(F[H]);J!==0&&(N===void 0&&(N=J<0),N===J<0?(V&&U.push(V),V=[F[H]]):V.push(F[H]))}return V&&U.push(V),U}(S),v=0;v<S.length;v++)for(E=0;E<S[v].length;E++)M(S[v][E])}S.length===1?S=S[0]:w="Multi"+w;var L={type:"Feature",geometry:{type:w,coordinates:S},properties:this.properties};return"id"in this&&(L.id=this.id),L},Zx}function pM(){if(uM)return Xx;uM=1;var l=fM();function e(c,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(r,this,p),this.length=this._features.length}function r(c,p,u){c===15?p.version=u.readVarint():c===1?p.name=u.readString():c===5?p.extent=u.readVarint():c===2?p._features.push(u.pos):c===3?p._keys.push(u.readString()):c===4&&p._values.push(function(m){for(var v=null,E=m.readVarint()+m.pos;m.pos<E;){var T=m.readVarint()>>3;v=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return v}(u))}return Xx=e,e.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var p=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,p,this.extent,this._keys,this._values)},Xx}function mM(){return hM||(hM=1,G_.VectorTile=function(){if(dM)return Yx;dM=1;var l=pM();function e(r,c,p){if(r===3){var u=new l(p,p.readVarint()+p.pos);u.length&&(c[u.name]=u)}}return Yx=function(r,c){this.layers=r.readFields(e,{},c)},Yx}(),G_.VectorTileFeature=fM(),G_.VectorTileLayer=pM()),G_}var ah=mM();class Tu extends lt{constructor(e,r,c){super(e,r),this.z=c}}class gM extends Tu{constructor(e,r,c,p){super(e,r,c),this.w=p}}function H_(l,e,r,c){let p=[],u=c===0?(m,v,E,T,_,C)=>{m.push(new lt(C,E+(C-v)/(T-v)*(_-E)))}:(m,v,E,T,_,C)=>{m.push(new lt(v+(C-E)/(_-E)*(T-v),C))};for(let m of l){let v=[];for(let E of m){if(E.length<=2)continue;let T=[];for(let S=0;S<E.length-1;S++){let w=E[S].x,M=E[S].y,D=E[S+1].x,L=E[S+1].y,F=c===0?w:M,B=c===0?D:L;F<e?B>e&&u(T,w,M,D,L,e):F>r?B<r&&u(T,w,M,D,L,r):T.push(E[S]),B<e&&F>=e&&u(T,w,M,D,L,e),B>r&&F<=r&&u(T,w,M,D,L,r)}let _=E[E.length-1],C=c===0?_.x:_.y;C>=e&&C<=r&&T.push(_),T.length&&(_=T[T.length-1],T[0].x===_.x&&T[0].y===_.y||T.push(T[0]),v.push(T))}v.length&&p.push(v)}return p}function _M(l,e,r,c){let p=r==="x"?"y":"x",u=(c-l[r])/(e[r]-l[r]);l[p]=l[p]+(e[p]-l[p])*u,l[r]=c,l.hasOwnProperty("z")&&(l.z=kt(l.z,e.z,u)),l.hasOwnProperty("w")&&(l.w=kt(l.w,e.w,u))}function yM(l,e,r,c){let p=r,u=c;for(let m of["x","y"]){let v=l,E=e;v[m]>=E[m]&&(v=e,E=l),v[m]<p&&E[m]>p&&_M(v,E,m,p),v[m]<u&&E[m]>u&&_M(E,v,m,u)}}let q_=Number.MAX_SAFE_INTEGER;function vM(l,e,r,c){return l.order<e||l.order===q_||!(l.clipMask&r)||function(p,u){return u.length!==0&&u.find(m=>m===p)===void 0}(c,l.clipScope)}function W_(l,e){return l.x-e.x||l.y-e.y}function xM(l,e){return W_(l.min,e.min)===0&&W_(l.max,e.max)===0}function Jx(l,e){return!(l.min.x>e.max.x||l.max.x<e.min.x||l.min.y>e.max.y||l.max.y<e.min.y)}function Kx(l,e){if(l.length!==e.length)return!1;for(let r=0;r<l.length;r++)if(l[r].sourceId!==e[r].sourceId||!xM(l[r],e[r])||l[r].order!==e[r].order||l[r].clipMask!==e[r].clipMask||!wa(l[r].clipScope,e[r].clipScope))return!1;return!0}function bM(l,e,r){let c=1/ct,p=1/(1<<r.canonical.z),u=(e.x*c+r.canonical.x)*p+r.wrap,m=(e.y*c+r.canonical.y)*p;return{min:new lt((l.x*c+r.canonical.x)*p+r.wrap,(l.y*c+r.canonical.y)*p),max:new lt(u,m)}}function NO(l,e,r){let c=1<<r.canonical.z,p=((e.x-r.wrap)*c-r.canonical.x)*ct,u=(e.y*c-r.canonical.y)*ct;return{min:new lt(((l.x-r.wrap)*c-r.canonical.x)*ct,(l.y*c-r.canonical.y)*ct),max:new lt(p,u)}}function wM(l,e,r,c,p,u,m){let v=l.indices,E=l.vertices,T=[];for(let _=c;_<c+p;_+=3){let C=e[r[_+0]+u],S=e[r[_+1]+u],w=e[r[_+2]+u],M=Math.min(C.x,S.x,w.x),D=Math.max(C.x,S.x,w.x),L=Math.min(C.y,S.y,w.y),F=Math.max(C.y,S.y,w.y);T.length=0,l.grid.query(new lt(M,L),new lt(D,F),T);for(let B=0;B<T.length;B++){let V=T[B];if(An(E[v[3*V+0]],E[v[3*V+1]],E[v[3*V+2]],C,S,w,m))return!0}}return!1}function CM(l,e,r,c){if(!l||!r)return!1;let p=l.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(r.vertices.length<l.vertices.length)return CM(r,c,l,e);let u=e.canonical,m=c.canonical,v=Math.pow(2,m.z-u.z);p=l.vertices.map(E=>new lt((E.x+u.x*ct)*v-m.x*ct,(E.y+u.y*ct)*v-m.y*ct))}return wM(r,p,l.indices,0,l.indices.length,0,0)}function EM(l,e,r,c){let p=Math.pow(2,c.z-r.z);return new lt((l+r.x*ct)*p-c.x*ct,(e+r.y*ct)*p-c.y*ct)}function MM(l,e){let r=[];e.grid.queryPoint(l,r);let c=e.indices,p=e.vertices;for(let u=0;u<r.length;u++){let m=r[u];if(mn([p[c[3*m+0]],p[c[3*m+1]],p[c[3*m+2]]],l))return!0}return!1}let Qx=[new lt(0,0),new lt(ct,0),new lt(ct,ct),new lt(0,ct)];function SM(l,e){let r=[],c=[];if(!e||l.length<2)return[l];if(l.length===2)return Mn(l[0],l[1],Qx)?[l]:[];for(let p=0;p<l.length+2;p++){let u=l[p%l.length],m=l[(p+1)%l.length],v=Mn(p===0?l[l.length-1]:l[(p-1)%l.length],u,Qx),E=Mn(u,m,Qx),T=v||E;T&&c.push(u),T&&E||c.length>0&&(c.length>1&&r.push(c),c=[])}return c.length>1&&r.push(c),r}let e1=ah.VectorTileFeature.types,zO=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],BO=["fill-extrusion-flood-light-ground-radius"],VO=Math.pow(2,13),jO=Math.pow(2,15)-1,TM=new lt(0,1),ic=2147483648;function Yp(l,e,r,c,p,u,m,v){l.emplaceBack((e<<1)+m,(r<<1)+u,(Math.floor(c*VO)<<1)+p,Math.round(v))}function Jp(l,e,r){l.emplaceBack(e.x*ct,e.y*ct,r?1:0)}function Z_(l,e,r,c,p,u){l.emplaceBack(e.x,e.y,(r.x<<1)+c,(r.y<<1)+p,u)}function Kp(l,e,r){l.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class IM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class DM{constructor(){this.centroidXY=new lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class AM{constructor(){this.acc=new lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,c){this.accCount++,this.acc._add(r);let p=!!this.borders;r.x<e.min.x?(e.min.x=r.x,p=!0):r.x>e.max.x&&(e.max.x=r.x,p=!0),r.y<e.min.y?(e.min.y=r.y,p=!0):r.y>e.max.y&&(e.max.y=r.y,p=!0),((r.x===0||r.x===ct)&&r.x===c.x)!=((r.y===0||r.y===ct)&&r.y===c.y)&&this.processBorderOverlap(r,c),p&&this.checkBorderIntersection(r,c)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,kt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>ct!=e.x>ct&&this.addBorderIntersection(1,kt(r.y,e.y,(ct-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,kt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>ct!=e.y>ct&&this.addBorderIntersection(3,kt(r.x,e.x,(ct-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let c=this.borders[e];r<c[0]&&(c[0]=r),r>c[1]&&(c[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;let c=e.x===0?0:1;this.addBorderIntersection(c,r.y),this.addBorderIntersection(c,e.y)}else{let c=e.y===0?2:3;this.addBorderIntersection(c,r.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new lt(0,0):new lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function PM(l,e){let r=l.add(e)._unit(),c=Wt(l.x*r.x+l.y*r.y,-1,1);var p,u,m;return m=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(m)))/4*jO*((p=l).x*(u=e).y-p.y*u.x<0?-1:1)}let UO=[l=>l.x<0,l=>l.x>ct,l=>l.y<0,l=>l.y>ct];function $O(l,e,r,c){let p=[4];if(c===0)return p;r._mult(c);let u=l.sub(r),m=e.sub(r),v=[l,e,u,m];for(let E=0;E<4;E++)for(let T of v)if(UO[E](T)){p.push(E);break}return p}class RM{constructor(e){this.vertexArray=new Dp,this.indexArray=new _i,this.programConfigurations=new Wo(e.layers,{zoom:e.zoom,lut:e.lut},r=>BO.includes(r)),this._segments=new Mi,this.hiddenByLandmarkVertexArray=new eh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Mi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,c,p=!1){let u=e.length;if(u>2){let m=Math.max(0,this._segments.get().length-1),v=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[m].length),E;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{let T=e[0],_=e[1];E=PM(T.sub(e[u-1])._perp()._unit(),_.sub(T)._perp()._unit())}for(let T=0;T<u;T++){let _=T===u-1?0:T+1,C=e[T],S=e[_],w=e[_===u-1?0:_+1],M=S.sub(C)._perp()._unit(),D=PM(M,w.sub(S)._perp()._unit()),L=E,F=D;if(t1(C,S,r)||p&&FM(C,r)&&FM(S,r)){E=D;continue}let B=v.vertexLength;Z_(this.vertexArray,C,S,1,1,L),Z_(this.vertexArray,C,S,1,0,L),Z_(this.vertexArray,C,S,0,1,F),Z_(this.vertexArray,C,S,0,0,F),v.vertexLength+=4;let V=$O(C,S,M,c);for(let N of V)this._segmentToGroundQuads[m].push({id:B,region:N}),this._segmentToRegionTriCounts[m][N]+=2,v.primitiveLength+=2;E=D}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),r=e.length;for(let c=0;c<r;c++)this._segmentToGroundQuads[c].sort((p,u)=>p.region-u.region);for(let c=0;c<r;c++){let p=this._segmentToGroundQuads[c],u=e[c],m=this._segmentToRegionTriCounts[c];m.reduce((E,T)=>E+T,0);let v=0;for(let E=0;E<=4;E++){let T=m[E];if(T!==0){let _=this.regionSegments[E];_||(_=this.regionSegments[E]=new Mi);let C={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+v,vertexLength:u.vertexLength,primitiveLength:T};_.get().push(C)}v+=T}for(let E=0;E<p.length;E++){let T=p[E].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,c,p,u,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,c,p,u,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,PO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,c,p,u,m){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,c,p,u,m)}updateHiddenByLandmark(e){if(!this.hasData())return;let r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let c=e.flags&ic?1:0;for(let p=e.groundVertexArrayOffset;p<r;++p)this.hiddenByLandmarkVertexArray.emplace(p,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,LO.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let r=this.regionSegments[e];r&&r.destroy()}}}}class X_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new _i,this.footprintVertices=new Ks,this.footprintSegments=[],this.layoutVertexArray=new Hl,this.centroidVertexArray=new D_,this.wallVertexArray=new zp,this.indexArray=new _i,this.programConfigurations=new Wo(e.layers,{zoom:e.zoom,lut:e.lut},r=>zO.includes(r)),this.segments=new Mi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new RM(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,c,p){this.features=[],this.hasPattern=Gx("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=_e(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:u,id:m,index:v,sourceLayerIndex:E}of e){let T=this.layers[0]._featureFilter.needGeometry,_=Ze(u,T);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),_,c))continue;let C={id:m,sourceLayerIndex:E,index:v,geometry:T?_.geometry:Ie(u,c,p),properties:u.properties,type:u.type,patterns:{}},S=this.layoutVertexArray.length,w=e1[C.type]==="Polygon";if(this.hasPattern)this.features.push(Hx("fill-extrusion",this.layers,C,this.zoom,r));else if(this.wallMode)for(let M of C.geometry)for(let D of SM(M,w))this.addFeature(C,[D],v,c,{},r.availableImages,p,r.brightness);else this.addFeature(C,C.geometry,v,c,{},r.availableImages,p,r.brightness);r.featureIndex.insert(u,C.geometry,v,E,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,c,p,u,m){for(let v of this.features){let E=e1[v.type]==="Polygon",{geometry:T}=v;if(this.wallMode)for(let _ of T)for(let C of SM(_,E))this.addFeature(v,[C],v.index,r,c,p,u,m);else this.addFeature(v,T,v.index,r,c,p,u,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,c,p,u){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let v=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,v,c,p,u),this.groundEffect.update(e,r,v,c,p,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,OO.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,FO.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,RO.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,c,p,u,m,v,E){let T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new lt(0,0),new lt(ct,ct)],C=v.projection,S=C.name==="globe",w=this.wallMode||e1[e.type]==="Polygon",M=new AM;M.centroidDataIndex=this.centroidData.length;let D=new DM,L=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},p)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},p),B;if(D.height=F,D.vertexArrayOffset=this.layoutVertexArray.length,D.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _u),this.wallMode){if(S)return void xn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;B=function(ne){let ge=ne[0].x===ne[ne.length-1].x&&ne[0].y===ne[ne.length-1].y;(function(rt){let Qe=0,Dt=rt.length;for(let ft=0;ft<Dt;ft++)Qe+=(rt[(ft+1)%Dt].x-rt[ft].x)*(rt[(ft+1)%Dt].y+rt[ft].y);return Qe>=0})(ne)||(ne=ne.reverse());let pe={geometry:[],joinNormals:[],indices:[]},xe=[],be=[],Se=[],Re=ne.length;if(Re<(ge?3:2))return pe;for(;Re>=2&&ne[Re-1].equals(ne[Re-2]);)Re--;let Le,De,He,et,je,pt=0;for(;pt<Re-1&&ne[pt].equals(ne[pt+1]);)pt++;ge&&(Le=ne[Re-2],je=ne[pt].sub(Le)._unit()._perp());for(let rt=pt;rt<Re;rt++){if(He=rt===Re-1?ge?ne[pt+1]:void 0:ne[rt+1],He&&ne[rt].equals(He))continue;je&&(et=je),Le&&(De=Le),Le=ne[rt],je=He?He.sub(Le)._unit()._perp():et,et=et||je;let Qe=et.add(je);Qe.x===0&&Qe.y===0||Qe._unit();let Dt=Qe.x*je.x+Qe.y*je.y,ft=Dt!==0?1/Dt:1/0,yt=et.x*je.y-et.y*je.x>0,Gt="miter",tn=2;Gt==="miter"&&ft>tn&&(Gt="bevel"),Gt==="bevel"&&(ft>100&&(Gt="flipbevel"),ft<tn&&(Gt="miter"));let rn=(Qt,dn,cn,ii)=>{let Yn=new lt(Qt.x,Qt.y),Nt=new lt(Qt.x,Qt.y);Yn.x+=dn.x*ii,Yn.y+=dn.y*ii,Nt.x-=dn.x*Math.max(cn,1),Nt.y-=dn.y*Math.max(cn,1),Se.push(dn),xe.push(Yn),be.push(Nt)};if(Gt==="miter")Qe._mult(ft),rn(Le,Qe,0,0);else if(Gt==="flipbevel")Qe=je.mult(-1),rn(Le,Qe,0,0),rn(Le,Qe.mult(-1),0,0);else{let Qt=-Math.sqrt(ft*ft-1),dn=yt?Qt:0,cn=yt?0:Qt;De&&rn(Le,et,dn,cn),He&&rn(Le,je,dn,cn)}}pe.geometry=[...xe,...be.reverse(),xe[0]],pe.joinNormals=[...Se,...Se.reverse(),Se[Se.length-1]];let at=pe.geometry.length-1;for(let rt=0;rt<at/2;rt++)if(rt+1<at/2){let Qe=rt,Dt=rt+1,ft=at-1-rt,yt=at-2-rt;Qe=Qe===0?at-1:Qe-1,Dt=Dt===0?at-1:Dt-1,ft=ft===0?at-1:ft-1,yt=yt===0?at-1:yt-1,pe.indices.push(ft),pe.indices.push(Dt),pe.indices.push(Qe),pe.indices.push(ft),pe.indices.push(yt),pe.indices.push(Dt)}return pe}(r[0]),r=[B.geometry]}let V=(ne,ge)=>ne<(ge.length-1)/2||ne===ge.length-1,N=this.wallMode?[r]:$_(r,500);for(let ne=N.length-1;ne>=0;ne--){let ge=N[ne];(ge.length===0||(U=ge[0]).every(te=>te.x<=0)||U.every(te=>te.x>=ct)||U.every(te=>te.y<=0)||U.every(te=>te.y>=ct))&&N.splice(ne,1)}var U;let H;if(S)H=BM(N,_,p);else{H=[];for(let ne of N)H.push({polygon:ne,bounds:_})}let J=w?this.edgeRadius:0,oe=J>0&&this.zoom<17,ee=(ne,ge)=>{if(ne.length===0)return!1;let te=ne[ne.length-1];return ge.x===te.x&&ge.y===te.y};for(let{polygon:ne,bounds:ge}of H){let te=0,pe=0;for(let Re of ne)w&&!Re[0].equals(Re[Re.length-1])&&Re.push(Re[0]),pe+=w?Re.length-1:Re.length;let xe=this.segments.prepareSegment((w?5:4)*pe,this.layoutVertexArray,this.indexArray);D.footprintSegIdx<0&&(D.footprintSegIdx=this.footprintSegments.length),D.polygonSegIdx<0&&(D.polygonSegIdx=this.polygonSegments.length);let be={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Se=new IM;if(Se.vertexOffset=this.footprintVertices.length,Se.indexOffset=3*this.footprintIndices.length,Se.ringIndices=[],w){let Re=[],Le=[];te=xe.vertexLength;for(let He=0;He<ne.length;He++){let et=ne[He];et.length&&He!==0&&Le.push(Re.length/2);let je=[],pt,at;pt=et[1].sub(et[0])._perp()._unit(),Se.ringIndices.push(et.length-1);for(let rt=1;rt<et.length;rt++){let Qe=et[rt],Dt=et[rt===et.length-1?1:rt+1],ft=Qe.clone();if(J){at=Dt.sub(Qe)._perp()._unit();let yt=pt.add(at)._unit(),Gt=J*Math.min(4,1/(pt.x*yt.x+pt.y*yt.y));ft.x+=Gt*yt.x,ft.y+=Gt*yt.y,ft.x=Math.round(ft.x),ft.y=Math.round(ft.y),pt=at}if(!L||J!==0&&!oe||ee(je,ft)||je.push(ft),Yp(this.layoutVertexArray,ft.x,ft.y,0,0,1,1,0),this.wallMode){let yt=V(rt,et);Jp(this.wallVertexArray,B.joinNormals[rt],!yt)}xe.vertexLength++,this.footprintVertices.emplaceBack(Qe.x,Qe.y),Re.push(Qe.x,Qe.y),S&&Kp(this.layoutVertexExtArray,C.projectTilePoint(ft.x,ft.y,p),C.upVector(p,ft.x,ft.y))}L&&(J===0||oe)&&(je.length!==0&&ee(je,je[0])&&je.pop(),this.groundEffect.addData(je,ge,T))}let De=this.wallMode?B.indices:qp(Re,Le);for(let He=0;He<De.length;He+=3)this.footprintIndices.emplaceBack(Se.vertexOffset+De[He+0],Se.vertexOffset+De[He+1],Se.vertexOffset+De[He+2]),this.indexArray.emplaceBack(te+De[He],te+De[He+2],te+De[He+1]),xe.primitiveLength++;Se.indexCount+=De.length,Se.vertexCount+=this.footprintVertices.length-Se.vertexOffset}for(let Re=0;Re<ne.length;Re++){let Le=ne[Re];M.startRing(D,Le[0]);let De=Le.length>4&&kM(Le[Le.length-2],Le[0],Le[1]),He=J?GO(Le[Le.length-2],Le[0],Le[1],J):0,et=[],je,pt,at;pt=Le[1].sub(Le[0])._perp()._unit();let rt=!0;for(let Qe=1,Dt=0;Qe<Le.length;Qe++){let ft=Le[Qe-1],yt=Le[Qe],Gt=Le[Qe===Le.length-1?1:Qe+1];if(M.appendEdge(D,yt,ft),t1(yt,ft,ge)){J&&(pt=Gt.sub(yt)._perp()._unit(),rt=!rt);continue}let tn=yt.sub(ft)._perp(),rn=tn.x/(Math.abs(tn.x)+Math.abs(tn.y)),Qt=tn.y>0?1:0,dn=ft.dist(yt);if(Dt+dn>32768&&(Dt=0),J){at=Gt.sub(yt)._perp()._unit();let Nt=LM(ft,yt,Gt,OM(pt,at),J);isNaN(Nt)&&(Nt=0);let kn=yt.sub(ft)._unit();ft=ft.add(kn.mult(He))._round(),yt=yt.add(kn.mult(-Nt))._round(),He=Nt,pt=at,L&&this.zoom>=17&&(ee(et,ft)||et.push(ft),ee(et,yt)||et.push(yt))}let cn=xe.vertexLength,ii=Le.length>4&&kM(ft,yt,Gt),Yn=NM(Dt,De,rt);if(Yp(this.layoutVertexArray,ft.x,ft.y,rn,Qt,0,0,Yn),Yp(this.layoutVertexArray,ft.x,ft.y,rn,Qt,0,1,Yn),this.wallMode){let Nt=V(Qe-1,Le),kn=B.joinNormals[Qe-1];Jp(this.wallVertexArray,kn,Nt),Jp(this.wallVertexArray,kn,Nt)}if(Dt+=dn,Yn=NM(Dt,ii,!rt),De=ii,Yp(this.layoutVertexArray,yt.x,yt.y,rn,Qt,0,0,Yn),Yp(this.layoutVertexArray,yt.x,yt.y,rn,Qt,0,1,Yn),this.wallMode){let Nt=V(Qe,Le),kn=B.joinNormals[Qe];Jp(this.wallVertexArray,kn,Nt),Jp(this.wallVertexArray,kn,Nt)}if(xe.vertexLength+=4,this.indexArray.emplaceBack(cn+0,cn+1,cn+2),this.indexArray.emplaceBack(cn+1,cn+3,cn+2),xe.primitiveLength+=2,J){let Nt=te+(Qe===1?Le.length-2:Qe-2),kn=Qe===1?te:Nt+1;if(this.indexArray.emplaceBack(cn+1,Nt,cn+3),this.indexArray.emplaceBack(Nt,kn,cn+3),xe.primitiveLength+=2,je===void 0&&(je=cn),!t1(Gt,Le[Qe],ge)){let Vn=Qe===Le.length-1?je:xe.vertexLength;this.indexArray.emplaceBack(cn+2,cn+3,Vn),this.indexArray.emplaceBack(cn+3,Vn+1,Vn),this.indexArray.emplaceBack(cn+3,kn,Vn+1),xe.primitiveLength+=3}rt=!rt}if(S){let Nt=this.layoutVertexExtArray,kn=C.projectTilePoint(ft.x,ft.y,p),Vn=C.projectTilePoint(yt.x,yt.y,p),hi=C.upVector(p,ft.x,ft.y),Di=C.upVector(p,yt.x,yt.y);Kp(Nt,kn,hi),Kp(Nt,kn,hi),Kp(Nt,Vn,Di),Kp(Nt,Vn,Di)}}w&&(te+=Le.length-1),L&&J&&this.zoom>=17&&(et.length!==0&&ee(et,et[0])&&et.pop(),this.groundEffect.addData(et,ge,T,J>0))}this.footprintSegments.push(Se),be.triangleCount=this.indexArray.length-be.triangleArrayOffset,this.polygonSegments.push(be),++D.footprintSegLen,++D.polygonSegLen}if(D.vertexCount=this.layoutVertexArray.length-D.vertexArrayOffset,D.groundVertexCount=this.groundEffect.vertexArray.length-D.groundVertexArrayOffset,D.vertexCount!==0){if(D.centroidXY=M.borders?TM:this.encodeCentroid(M,D),this.centroidData.push(D),M.borders){this.featuresOnBorder.push(M);let ne=this.featuresOnBorder.length-1;for(let ge=0;ge<M.borders.length;ge++)M.borders[ge][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ge].push(ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,E),this.groundEffect.addPaintPropertiesData(e,c,u,m,p,E),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,c)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}splitToSubtiles(){let e=[];for(let v=0;v<this.centroidData.length;v++){let E=this.centroidData[v],T=+(E.min.y+E.max.y>ct),_=2*T+(+(E.min.x+E.max.x>ct)^T);for(let C=0;C<E.polygonSegLen;C++){let S=E.polygonSegIdx+C;e.push({centroidIdx:v,subtile:_,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}let r=new _i;e.sort((v,E)=>v.triangleSegmentIdx===E.triangleSegmentIdx?v.subtile-E.subtile:v.triangleSegmentIdx-E.triangleSegmentIdx);let c=0,p=0,u=0;for(let v of e){if(v.triangleSegmentIdx!==c)break;u++}let m=e.length;for(;p!==e.length;){c=e[p].triangleSegmentIdx;let v=0,E=p,T=p;for(let _=E;_<u&&e[_].subtile===v;_++)T++;for(;E!==u;){let _=e[E];v=_.subtile;let C=this.centroidData[_.centroidIdx].min.clone(),S=this.centroidData[_.centroidIdx].max.clone(),w={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=E;M<T;M++){let D=e[M],L=this.polygonSegments[D.polygonSegmentIdx],F=this.centroidData[D.centroidIdx].min,B=this.centroidData[D.centroidIdx].max,V=this.indexArray.uint16;for(let N=L.triangleArrayOffset;N<L.triangleArrayOffset+L.triangleCount;N++)r.emplaceBack(V[3*N],V[3*N+1],V[3*N+2]);w.primitiveLength+=L.triangleCount,C.x=Math.min(C.x,F.x),C.y=Math.min(C.y,F.y),S.x=Math.max(S.x,B.x),S.y=Math.max(S.y,B.y)}w.primitiveLength>0&&this.triangleSubSegments.push({segment:w,min:C,max:S}),E=T;for(let M=E;M<u&&e[M].subtile===e[E].subtile;M++)T++}p=u;for(let _=p;_<m&&e[_].triangleSegmentIdx===e[p].triangleSegmentIdx;_++)u++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,c){let p=new Mi;if(this.wallMode){for(let D of this.triangleSubSegments)p.segments.push(D.segment);return p}let u=0,m=0,v=1<<e.canonical.z;if(r){let D=r.getMinMaxForTile(e);D&&(u=D.min,m=D.max)}m+=this.maxHeight;let E=e.toUnwrapped(),T,_=[E.canonical.x/v+E.wrap,E.canonical.y/v],C=[(E.canonical.x+1)/v+E.wrap,(E.canonical.y+1)/v],S=(D,L,F)=>[D[0]*(1-F[0])+L[0]*F[0],D[1]*(1-F[1])+L[1]*F[1]],w=[],M=[];for(let D of this.triangleSubSegments){w[0]=D.min.x/ct,w[1]=D.min.y/ct,M[0]=D.max.x/ct,M[1]=D.max.y/ct;let L=S(_,C,w),F=S(_,C,M);if(new Bn([L[0],L[1],u],[F[0],F[1],m]).intersectsPrecise(c)===0){T&&(p.segments.push(T),T=void 0);continue}let B=D.segment;T&&T.vertexOffset!==B.vertexOffset&&(p.segments.push(T),T=void 0),T?(T.vertexLength+=B.vertexLength,T.primitiveLength+=B.primitiveLength):T={vertexOffset:B.vertexOffset,primitiveLength:B.primitiveLength,vertexLength:B.vertexLength,primitiveOffset:B.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&p.segments.push(T),p}encodeCentroid(e,r){let c=e.centroid(),p=r.span(),u=Math.min(7,Math.round(p.x*this.tileToMeter/10)),m=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new lt(Wt(c.x,1,ct-1)<<3|u,Wt(c.y,1,ct-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new lt(0,0);let r=e.borders,c=Number.MAX_VALUE;if(r[0][0]!==c||r[1][0]!==c){let p=r[0][0]!==c?0:1;return new lt(6|(r[0][0]!==c?0:65528),(r[p][0]+r[p][1])/2<<3|6)}{let p=r[2][0]!==c?2:3;return new lt((r[p][0]+r[p][1])/2<<3|6,6|(r[2][0]!==c?0:65528))}}showCentroid(e){let r=this.centroidData[e.centroidDataIndex];r.flags&=ic,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let r=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,p=e.flags&ic?TM:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==p.y||u!==p.x){for(let m=r;m<c;++m)this.centroidVertexArray.emplace(m,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,c){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let p=r.getReplacementRegionsForTile(e.toUnwrapped());if(Kx(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let m of this.centroidData)m.flags&=2147483647;let u=[];for(let m of this.activeReplacements){if(m.order<c)continue;let v=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(let E of this.centroidData)if(!(E.flags&ic||m.min.x>E.max.x||E.min.x>m.max.x||m.min.y>E.max.y||E.min.y>m.max.y))for(let T=0;T<E.footprintSegLen;T++){let _=this.footprintSegments[E.footprintSegIdx+T];if(u.length=0,HO(this.footprintVertices,_.vertexOffset,_.vertexCount,m.footprintTileId.canonical,e.canonical,u),wM(m.footprint,u,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-v)){E.flags|=ic;break}}}for(let m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,c){let p=!1;for(let u=0;u<c.footprintSegLen;u++){let m=this.footprintSegments[c.footprintSegIdx+u],v=0;for(let E of m.ringIndices){for(let T=v,_=E+v-1;T<E+v;_=T++){let C=this.footprintVertices.int16[2*(T+m.vertexOffset)+0],S=this.footprintVertices.int16[2*(T+m.vertexOffset)+1],w=this.footprintVertices.int16[2*(_+m.vertexOffset)+1];S>r!=w>r&&e<(this.footprintVertices.int16[2*(_+m.vertexOffset)+0]-C)*(r-S)/(w-S)+C&&(p=!p)}v=E}}return p}getHeightAtTileCoord(e,r){let c=Number.NEGATIVE_INFINITY,p=!0,u=4*(e+ct)*ct+(r+ct);if(this.partLookup.hasOwnProperty(u)){let m=this.partLookup[u];return m?{height:m.height,hidden:!!(m.flags&ic)}:void 0}for(let m of this.centroidData)e>m.max.x||m.min.x>e||r>m.max.y||m.min.y>r||this.footprintContainsPoint(e,r,m)&&m&&m.height>c&&(c=m.height,this.partLookup[u]=m,p=!!(m.flags&ic));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:p};this.partLookup[u]=void 0}}function OM(l,e){let r=l.add(e)._unit();return l.x*r.x+l.y*r.y}function GO(l,e,r,c){let p=e.sub(l)._perp()._unit(),u=r.sub(e)._perp()._unit();return LM(l,e,r,OM(p,u),c)}function LM(l,e,r,c,p){let u=Math.sqrt(1-c*c);return Math.min(l.dist(e)/3,e.dist(r)/3,p*u/c)}function t1(l,e,r){return l.x<r[0].x&&e.x<r[0].x||l.x>r[1].x&&e.x>r[1].x||l.y<r[0].y&&e.y<r[0].y||l.y>r[1].y&&e.y>r[1].y}function FM(l,e){return l.x<e[0].x||l.x>e[1].x||l.y<e[0].y||l.y>e[1].y}function kM(l,e,r){if(l.x<0||l.x>=ct||e.x<0||e.x>=ct||r.x<0||r.x>=ct)return!1;let c=r.sub(e),p=c.perp(),u=l.sub(e);return(c.x*u.x+c.y*u.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(u.x*u.x+u.y*u.y))>-.866&&p.x*u.x+p.y*u.y<0}function NM(l,e,r){let c=e?2|l:-3&l;return r?1|c:-2&c}function zM(){let l=Math.PI/32,e=Math.tan(l),r=A;return r*Math.sqrt(1+2*e*e)-r}function BM(l,e,r){let c=1<<r.z,p=Q(r.x/c),u=Q((r.x+1)/c),m=ie(r.y/c),v=ie((r.y+1)/c);return function(E,T,_,C,S=0,w){let M=[];if(!E.length||!_||!C)return M;let D=(H,J)=>{for(let oe of H)M.push({polygon:oe,bounds:J})},L=Math.ceil(Math.log2(_)),F=Math.ceil(Math.log2(C)),B=L-F,V=[];for(let H=0;H<Math.abs(B);H++)V.push(B>0?0:1);for(let H=0;H<Math.min(L,F);H++)V.push(0),V.push(1);let N=E;if(N=H_(N,T[0].y-S,T[1].y+S,1),N=H_(N,T[0].x-S,T[1].x+S,0),!N.length)return M;let U=[];for(V.length?U.push({polygons:N,bounds:T,depth:0}):D(N,T);U.length;){let H=U.pop(),J=H.depth,oe=V[J],ee=H.bounds[0],ne=H.bounds[1],ge=oe===0?ee.x:ee.y,te=oe===0?ne.x:ne.y,pe=w?w(oe,ge,te):.5*(ge+te),xe=H_(H.polygons,ge-S,pe+S,oe),be=H_(H.polygons,pe-S,te+S,oe);if(xe.length){let Se=[ee,new lt(oe===0?pe:ne.x,oe===1?pe:ne.y)];V.length>J+1?U.push({polygons:xe,bounds:Se,depth:J+1}):D(xe,Se)}if(be.length){let Se=[new lt(oe===0?pe:ee.x,oe===1?pe:ee.y),ne];V.length>J+1?U.push({polygons:be,bounds:Se,depth:J+1}):D(be,Se)}}return M}(l,e,Math.ceil((u-p)/11.25),Math.ceil((m-v)/11.25),1,(E,T,_)=>{if(E===0)return .5*(T+_);{let C=ie((r.y+T/ct)/c);return(X(.5*(ie((r.y+_/ct)/c)+C))*c-r.y)*ct}})}function HO(l,e,r,c,p,u){let m=Math.pow(2,c.z-p.z);for(let v=0;v<r;v++){let E=l.int16[2*(v+e)+0],T=l.int16[2*(v+e)+1];E=(E+p.x*ct)*m-c.x*ct,T=(T+p.y*ct)*m-c.y*ct,u.push(new lt(E,T))}}let VM,jM;function Qp(l,e){return l.x*e.x+l.y*e.y}function UM(l,e){if(l.length===1){let r=0,c=e[r++],p;for(;!p||c.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){let u=e[r],m=l[0],v=p.sub(c),E=u.sub(c),T=m.sub(c),_=Qp(v,v),C=Qp(v,E),S=Qp(E,E),w=Qp(T,v),M=Qp(T,E),D=_*S-C*C,L=(S*w-C*M)/D,F=(_*M-C*w)/D,B=c.z*(1-L-F)+p.z*L+u.z*F;if(isFinite(B))return B}return 1/0}{let r=1/0;for(let c of e)r=Math.min(r,c.z);return r}}function $M(l,e,r,c,p,u,m,v){let E=m*p.getElevationAt(l,e,!0,!0),T=u[0]!==0,_=T?u[1]===0?m*(u[0]/7-450):m*function(C,S,w){let M=Math.floor(S[0]/8),D=Math.floor(S[1]/8),L=10*(S[0]-8*M),F=10*(S[1]-8*D),B=C.getElevationAt(M,D,!0,!0),V=C.getMeterToDEM(w),N=Math.floor(.5*(L*V-1)),U=Math.floor(.5*(F*V-1)),H=C.tileCoordToPixel(M,D),J=2*N+1,oe=2*U+1,ee=function(be,Se,Re,Le,De){return[be.getElevationAtPixel(Se,Re,!0),be.getElevationAtPixel(Se+De,Re,!0),be.getElevationAtPixel(Se,Re+De,!0),be.getElevationAtPixel(Se+Le,Re+De,!0)]}(C,H.x-N,H.y-U,J,oe),ne=Math.abs(ee[0]-ee[1]),ge=Math.abs(ee[2]-ee[3]),te=Math.abs(ee[0]-ee[2])+Math.abs(ee[1]-ee[3]),pe=Math.min(.25,.5*V*(ne+ge)/J),xe=Math.min(.25,.5*V*te/oe);return B+Math.max(pe*L,xe*F)}(p,u,v):E;return{base:E+(r===0?-1:r),top:T?Math.max(_+c,E+r+2):E+c}}gt(X_,"FillExtrusionBucket",{omit:["layers","features"]}),gt(DM,"PartData"),gt(IM,"FootprintSegment"),gt(AM,"BorderCentroidData"),gt(RM,"GroundEffect");let qO=Dn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),WO=Dn([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:ZO}=qO,XO=Dn([{name:"a_packed",components:4,type:"Float32"}]),{members:YO}=XO,JO=Dn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:KO}=JO;class GM{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new nc({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){let c=this.getKey(e,r);return this.positions[c]}trim(){let e=this.width,r=this.height=Uc(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,c){let p=[],u=e.length%2==1?-e[e.length-1]*c:0,m=e[0]*c,v=!0;p.push({left:u,right:m,isDash:v,zeroLength:e[0]===0});let E=e[0];for(let T=1;T<e.length;T++){v=!v;let _=e[T];u=E*c,E+=_,m=E*c,p.push({left:u,right:m,isDash:v,zeroLength:_===0})}return p}addRoundDash(e,r,c){let p=r/2;for(let u=-c;u<=c;u++){let m=this.width*(this.nextRow+c+u),v=0,E=e[v];for(let T=0;T<this.width;T++){T/E.right>1&&(E=e[++v]);let _=Math.abs(T-E.left),C=Math.abs(T-E.right),S=Math.min(_,C),w,M=u/c*(p+1);if(E.isDash){let D=p-Math.abs(M);w=Math.sqrt(S*S+D*D)}else w=p-Math.sqrt(S*S+M*M);this.image.data[m+T]=Math.max(0,Math.min(255,w+128))}}}addRegularDash(e,r){for(let E=e.length-1;E>=0;--E){let T=e[E],_=e[E+1];T.zeroLength?e.splice(E,1):_&&_.isDash===T.isDash&&(_.left=T.left,e.splice(E,1))}let c=e[0],p=e[e.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);let u=this.width*this.nextRow,m=0,v=e[m];for(let E=0;E<this.width;E++){E/v.right>1&&(v=e[++m]);let T=Math.abs(E-v.left),_=Math.abs(E-v.right),C=Math.min(T,_);this.image.data[u+E]=Math.max(0,Math.min(255,(v.isDash?C:-C)+r+128))}}addDash(e,r){let c=this.getKey(e,r);if(this.positions[c])return this.positions[c];let p=r==="round",u=p?7:0,m=2*u+1;if(this.nextRow+m>this.height)return xn("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let _=0;_<e.length;_++)e[_]<0&&(xn("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),v+=e[_];if(v!==0){let _=this.width/v,C=this.getDashRanges(e,this.width,_);p?this.addRoundDash(C,_,u):this.addRegularDash(C,r==="square"?.5*_:0)}let E=this.nextRow+u;this.nextRow+=m;let T={tl:[E,u],br:[v,0]};return this.positions[c]=T,T}}gt(GM,"LineAtlas");let QO=ah.VectorTileFeature.types,eL=Math.cos(Math.PI/180*37.5),tL=Math.cos(Math.PI/180*5);class n1{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new gu,this.layoutVertexArray2=new bs,this.patternVertexArray=new Qs,this.indexArray=new _i,this.programConfigurations=new Wo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Mi,this.maxLineLength=0,this.zOffsetVertexArray=new Yl,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:ct/64}updateFootprints(e,r){}populate(e,r,c,p){this.hasPattern=Gx("line",this.layers,r);let u=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();let m=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&m==="none"&&xn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);let v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&v!==void 0;let E=[];for(let{feature:S,id:w,index:M,sourceLayerIndex:D}of e){let L=this.layers[0]._featureFilter.needGeometry,F=Ze(S,L);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),F,c))continue;let B=u?u.evaluate(F,{},c):void 0,V={id:w,properties:S.properties,type:S.type,sourceLayerIndex:D,index:M,geometry:L?F.geometry:Ie(S,c,p),patterns:{},sortKey:B};E.push(V)}u&&E.sort((S,w)=>S.sortKey-w.sortKey);let{lineAtlas:T,featureIndex:_}=r,C=this.addConstantDashes(T);for(let S of E){let{geometry:w,index:M,sourceLayerIndex:D}=S;if(C&&this.addFeatureDashes(S,T),this.hasPattern){let L=Hx("line",this.layers,S,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(S,w,M,c,T.positions,r.availableImages,r.brightness);_.insert(e[M].feature,w,M,D,this.index)}}addConstantDashes(e){let r=!1;for(let c of this.layers){let p=c.paint.get("line-dasharray").value,u=c.layout.get("line-cap").value;if(p.kind!=="constant"||u.kind!=="constant")r=!0;else{let m=u.value,v=p.value;if(!v)continue;e.addDash(v,m)}}return r}addFeatureDashes(e,r){let c=this.zoom;for(let p of this.layers){let u=p.paint.get("line-dasharray").value,m=p.layout.get("line-cap").value;if(u.kind==="constant"&&m.kind==="constant")continue;let v,E;if(u.kind==="constant"){if(v=u.value,!v)continue}else v=u.evaluate({zoom:c},e);E=m.kind==="constant"?m.value:m.evaluate({zoom:c},e),r.addDash(v,E),e.patterns[p.id]=r.getKey(v,E)}}update(e,r,c,p,u){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,m?this.stateDependentLayers:this.layers,c,p,u)}addFeatures(e,r,c,p,u,m){for(let v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,r,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,YO)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,KO)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,WO.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ZO),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,c,p,u,m,v){let E=this.layers[0].layout,T=E.get("line-join").evaluate(e,{}),_=E.get("line-cap").evaluate(e,{}),C=E.get("line-miter-limit"),S=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=E.get("line-z-offset").value;for(let w of r)this.addLine(w,e,p,T,_,C,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,v)}addLine(e,r,c,p,u,m,v){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;let E=p==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let T=QO[r.type]==="Polygon",_=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let C=0;for(;C<_-1&&e[C].equals(e[C+1]);)C++;if(_<(T?3:2))return;p==="bevel"&&(m=1.05);let S=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray),w,M,D,L,F,B;this.e1=this.e2=-1,T&&(w=e[_-2],F=e[C].sub(w)._unit()._perp());for(let V=C;V<_;V++){if(D=V===_-1?T?e[C+1]:void 0:e[V+1],D&&e[V].equals(D))continue;F&&(L=F),w&&(M=w),w=e[V],B=this.hasZOffset?this.evaluateElevationValue(M?M.dist(w):0):null,F=D?D.sub(w)._unit()._perp():L,L=L||F;let N=M&&D,U=N?p:T||E?"butt":u,H=L.x*F.x+L.y*F.y;if(E){let xe=function(be){if(be.patternJoinNone){let Se=be.segmentPoints.length/2,Re=be.lineSoFar-be.segmentStart;for(let Le=0;Le<Se;++Le){let De=be.segmentPoints[2*Le+1],He=Math.round(be.segmentPoints[2*Le])+.5+.25*De;be.patternVertexArray.emplaceBack(He,Re,be.segmentStart),be.patternVertexArray.emplaceBack(He,Re,be.segmentStart)}be.segmentPoints.length=0}be.e1=be.e2=-1};if(N&&H<tL){this.updateDistance(M,w),this.addCurrentVertex(w,L,1,1,S,B),xe(this),this.addCurrentVertex(w,F,-1,-1,S,B);continue}if(M){if(!D){this.updateDistance(M,w),this.addCurrentVertex(w,L,1,1,S,B),xe(this);continue}U="miter"}}let J=L.add(F);J.x===0&&J.y===0||J._unit();let oe=J.x*F.x+J.y*F.y,ee=oe!==0?1/oe:1/0,ne=2*Math.sqrt(2-2*oe),ge=oe<eL&&M&&D,te=L.x*F.y-L.y*F.x>0,pe=this.overscaling<=16?15*ct/(512*this.overscaling):0;if(N&&U==="round"){if(ee<v)U="miter";else if(ee<=2){let xe=i1(w,-10,ct+10);U=this.hasZOffset&&(xe||this.hasCrossSlope)?"miter":"fakeround"}}if(U==="miter"&&ee>m&&(U="bevel"),U==="bevel"&&(ee>2&&(U="flipbevel"),ee<m&&(U="miter")),M&&!(U==="miter"&&ge)&&this.updateDistance(M,w),U==="miter")if(ge){let xe=w.dist(M);if(xe>2*pe){let Se=w.sub(w.sub(M)._mult(pe/xe)._round());this.updateDistance(M,Se),this.addCurrentVertex(Se,L,0,0,S,B),M=Se}this.updateDistance(M,w),J._mult(ee),this.addCurrentVertex(w,J,0,0,S,B);let be=w.dist(D);if(be>2*pe){let Se=w.add(D.sub(w)._mult(pe/be)._round());this.updateDistance(w,Se),this.addCurrentVertex(Se,F,0,0,S,B),w=Se}}else J._mult(ee),this.addCurrentVertex(w,J,0,0,S,B);else if(U==="flipbevel"){if(ee>100)J=F.mult(-1);else{let xe=ee*L.add(F).mag()/L.sub(F).mag();J._perp()._mult(xe*(te?-1:1))}this.addCurrentVertex(w,J,0,0,S,B),this.addCurrentVertex(w,J.mult(-1),0,0,S,B)}else if(U==="bevel"||U==="fakeround"){B!=null&&M&&this.addCurrentVertex(w,L,-1,-1,S,B);let xe=w.dist(M)<=2*pe&&U!=="bevel",be=J.mult(te?1:-1);be._mult(ee);let Se=F.mult(te?-1:1),Re=L.mult(te?-1:1),Le=this.evaluateElevationValue(this.distance);if(B==null&&(this.addHalfVertex(w,be.x,be.y,!1,!te,0,S,Le),xe||this.addHalfVertex(w,be.x+2*Re.x,be.y+2*Re.y,!1,te,0,S,Le)),U==="fakeround"){let De=Math.round(180*ne/Math.PI/20);this.addHalfVertex(w,Re.x,Re.y,!1,te,0,S,Le);for(let He=0;He<De;He++){let et=He/De;if(et!==.5){let pt=et-.5;et+=et*pt*(et-1)*((1.0904+H*(H*(3.55645-1.43519*H)-3.2452))*pt*pt+(.848013+H*(.215638*H-1.06021)))}let je=Se.sub(Re)._mult(et)._add(Re)._unit();this.addHalfVertex(w,je.x,je.y,!1,te,0,S,Le)}this.addHalfVertex(w,Se.x,Se.y,!1,te,0,S,Le)}xe||B!=null||this.addHalfVertex(w,be.x+2*Se.x,be.y+2*Se.y,!1,te,0,S,Le),B!=null&&D&&this.addCurrentVertex(w,F,1,1,S,B)}else U==="butt"?this.addCurrentVertex(w,J,0,0,S,B):U==="square"?(M||this.addCurrentVertex(w,J,-1,-1,S,B),this.addCurrentVertex(w,J,0,0,S,B),M&&this.addCurrentVertex(w,J,1,1,S,B)):U==="round"&&(M&&(this.addCurrentVertex(w,L,0,0,S,B),this.addCurrentVertex(w,L,1,1,S,B,!0)),D&&(this.addCurrentVertex(w,F,-1,-1,S,B,!0),this.addCurrentVertex(w,F,0,0,S,B)))}}addVerticesTo(e,r,c,p,u,m,v,E,T,_){let C=(r.w-e.w)/this.tessellationStep|0,S=0,w=this.scaledDistance;if(C>1){this.lineSoFar=e.w;let D=(r.x-e.x)/C,L=(r.y-e.y)/C,F=(r.z-e.z)/C,B=(r.w-e.w)/C;for(let V=1;V<C;++V){e.x+=D,e.y+=L,e.z+=F,this.lineSoFar+=B,S+=B;let N=this.evaluateElevationValue(this.prevDistance+S);this.scaledDistance=(this.prevDistance+S)/this.totalDistance,this.addHalfVertex(e,c,p,_,!1,v,T,N),this.addHalfVertex(e,u,m,_,!0,-E,T,N)}}this.lineSoFar=r.w,this.scaledDistance=w;let M=this.evaluateElevationValue(this.distance);this.addHalfVertex(r,c,p,_,!1,v,T,M),this.addHalfVertex(r,u,m,_,!0,-E,T,M)}evaluateElevationValue(e){return this.hasZOffset?this.zOffsetValue.kind==="constant"?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):xn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(e,r,c,p,u,m,v=!1){let E=r.x+r.y*c,T=r.y-r.x*c,_=r.y*p-r.x,C=-r.y-r.x*p;if(m!=null){let w=ct+10,M=m,D=new gM(e.x,e.y,M,this.lineSoFar),L=i1(e,-10,w),F=this.lineSoFar,B=this.distance;if(this.currentVertex)if(L){let V=this.currentVertexIsOutside,N=this.currentVertex,U=new gM(e.x,e.y,M,this.lineSoFar);if(yM(N,U,-10,w),!i1(U,-10,w)){if(V){this.e1=this.e2=-1,this.distance-=N.dist(D),this.lineSoFar=N.w;let H=this.evaluateElevationValue(N.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(N,E,T,v,!1,c,u,H),this.addHalfVertex(N,_,C,v,!0,-p,u,H),this.prevDistance=this.distance}this.distance=this.prevDistance+N.dist(U),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(N,U,E,T,_,C,c,p,u,v),this.distance=B,this.scaledDistance=this.distance/this.totalDistance}}else{let V=this.currentVertex;if(this.currentVertexIsOutside){yM(V,D,-10,w),this.e1=this.e2=-1,this.distance-=V.dist(D),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=V.w;let N=this.evaluateElevationValue(V.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(V,E,T,v,!1,c,u,N),this.addHalfVertex(V,_,C,v,!0,-p,u,N),this.prevDistance=this.distance,this.distance=B,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(V,D,E,T,_,C,c,p,u,v)}else L||(this.addHalfVertex(e,E,T,v,!1,c,u,m),this.addHalfVertex(e,_,C,v,!0,-p,u,m));this.currentVertex=D,this.currentVertexIsOutside=L,this.lineSoFar=F}else this.addHalfVertex(e,E,T,v,!1,c,u,m),this.addHalfVertex(e,_,C,v,!0,-p,u,m)}addHalfVertex({x:e,y:r},c,p,u,m,v,E,T){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let _=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),E.primitiveLength++),m?this.e2=_:this.e1=_,T!=null&&this.zOffsetVertexArray.emplaceBack(T)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function i1(l,e,r){return l.x<e||l.x>r||l.y<e||l.y>r}let HM,qM;function WM(l,e,r){return e*(ct/(l.tileSize*Math.pow(2,r-l.tileID.overscaledZ)))}gt(n1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let ZM=(l,e,r)=>(1-r)*l+r*e;function XM(l,e){return 1/WM(l,1,e.tileZoom)}function YM(l,e,r,c){return l.translatePosMatrix(c||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}let JM=l=>{let e=[];KM(l)&&e.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let r=l.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let c=l.layout.get("line-join").constantOr("miter")==="none",p=!!l.paint.get("line-pattern").constantOr(1);return c&&p&&e.push("LINE_JOIN_NONE"),e};function KM(l){let e=l.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let r1,QM=()=>r1||(r1={layout:HM||(HM=new si({"line-cap":new Tt(Oe.layout_line["line-cap"]),"line-join":new Tt(Oe.layout_line["line-join"]),"line-miter-limit":new ot(Oe.layout_line["line-miter-limit"]),"line-round-limit":new ot(Oe.layout_line["line-round-limit"]),"line-sort-key":new Tt(Oe.layout_line["line-sort-key"]),"line-z-offset":new Tt(Oe.layout_line["line-z-offset"]),"line-elevation-reference":new ot(Oe.layout_line["line-elevation-reference"]),"line-cross-slope":new ot(Oe.layout_line["line-cross-slope"]),visibility:new ot(Oe.layout_line.visibility)})),paint:qM||(qM=new si({"line-opacity":new Tt(Oe.paint_line["line-opacity"]),"line-color":new Tt(Oe.paint_line["line-color"]),"line-translate":new ot(Oe.paint_line["line-translate"]),"line-translate-anchor":new ot(Oe.paint_line["line-translate-anchor"]),"line-width":new Tt(Oe.paint_line["line-width"]),"line-gap-width":new Tt(Oe.paint_line["line-gap-width"]),"line-offset":new Tt(Oe.paint_line["line-offset"]),"line-blur":new Tt(Oe.paint_line["line-blur"]),"line-dasharray":new Tt(Oe.paint_line["line-dasharray"]),"line-pattern":new Tt(Oe.paint_line["line-pattern"]),"line-gradient":new Gl(Oe.paint_line["line-gradient"]),"line-trim-offset":new ot(Oe.paint_line["line-trim-offset"]),"line-trim-fade-range":new ot(Oe.paint_line["line-trim-fade-range"]),"line-trim-color":new ot(Oe.paint_line["line-trim-color"]),"line-emissive-strength":new ot(Oe.paint_line["line-emissive-strength"]),"line-border-width":new Tt(Oe.paint_line["line-border-width"]),"line-border-color":new Tt(Oe.paint_line["line-border-color"]),"line-occlusion-opacity":new ot(Oe.paint_line["line-occlusion-opacity"])}))},r1);class nL extends Tt{possiblyEvaluate(e,r){return r=new bi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,c,p){return r=pr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,c,p)}}let em;function eS(l,e){return e>0?e+2*l:l}let iL=Dn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rL=Dn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),oL=Dn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Dn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let sL=Dn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),aL=Dn([{name:"a_texb",components:2,type:"Uint16"}]),lL=Dn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),cL=Dn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let tS=Dn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),uL=Dn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Dn([{name:"triangle",components:3,type:"Uint16"}]),Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Dn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Dn([{type:"Float32",name:"offsetX"}]),Dn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ur=24;let Is=128;function o1(l,e){let{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new bi(l+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:c,interpolationType:p}=r,u=0;for(;u<c.length&&c[u]<=l;)u++;u=Math.max(0,u-1);let m=u;for(;m<c.length&&c[m]<l+1;)m++;m=Math.min(c.length-1,m);let v=c[u],E=c[m];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:v,maxZoom:E,minSize:r.evaluate(new bi(v)),maxSize:r.evaluate(new bi(E)),interpolationType:p}}}function Y_(l,{uSize:e,uSizeT:r},{lowerSize:c,upperSize:p}){return l.kind==="source"?c/Is:l.kind==="composite"?kt(c/Is,p/Is,r):e}function lh(l,e,r=1){let c=0,p=0;if(l.kind==="constant")p=l.layoutSize*r;else if(l.kind!=="source"){let{interpolationType:u,minZoom:m,maxZoom:v}=l,E=u?Wt(Zr.interpolationFactor(u,e,m,v),0,1):0;l.kind==="camera"?p=kt(l.minSize,l.maxSize,E)*r:c=E*r}return{uSizeT:c,uSize:p}}var dL=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Is,evaluateSizeForFeature:Y_,evaluateSizeForZoom:lh,getSizeData:o1});function hL(l,e,r){return l.sections.forEach(c=>{c.text=function(p,u,m){let v=u.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?p=p.toLocaleUpperCase():v==="lowercase"&&(p=p.toLocaleLowerCase()),Yr.applyArabicShaping&&(p=Yr.applyArabicShaping(p)),p}(c.text,e,r)}),l}let tm={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function fL(l){return l==="\uFE36"||l==="\uFE48"||l==="\uFE38"||l==="\uFE44"||l==="\uFE42"||l==="\uFE3E"||l==="\uFE3C"||l==="\uFE3A"||l==="\uFE18"||l==="\uFE40"||l==="\uFE10"||l==="\uFE13"||l==="\uFE14"||l==="\uFF40"||l==="\uFFE3"||l==="\uFE11"||l==="\uFE12"}function pL(l){return l==="\uFE35"||l==="\uFE47"||l==="\uFE37"||l==="\uFE43"||l==="\uFE41"||l==="\uFE3D"||l==="\uFE3B"||l==="\uFE39"||l==="\uFE17"||l==="\uFE3F"}var nS,s1,iS,a1={};function mL(){return nS||(nS=1,a1.read=function(l,e,r,c,p){var u,m,v=8*p-c-1,E=(1<<v)-1,T=E>>1,_=-7,C=r?p-1:0,S=r?-1:1,w=l[e+C];for(C+=S,u=w&(1<<-_)-1,w>>=-_,_+=v;_>0;u=256*u+l[e+C],C+=S,_-=8);for(m=u&(1<<-_)-1,u>>=-_,_+=c;_>0;m=256*m+l[e+C],C+=S,_-=8);if(u===0)u=1-T;else{if(u===E)return m?NaN:1/0*(w?-1:1);m+=Math.pow(2,c),u-=T}return(w?-1:1)*m*Math.pow(2,u-c)},a1.write=function(l,e,r,c,p,u){var m,v,E,T=8*u-p-1,_=(1<<T)-1,C=_>>1,S=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=c?0:u-1,M=c?1:-1,D=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,m=_):(m=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-m))<1&&(m--,E*=2),(e+=m+C>=1?S/E:S*Math.pow(2,1-C))*E>=2&&(m++,E/=2),m+C>=_?(v=0,m=_):m+C>=1?(v=(e*E-1)*Math.pow(2,p),m+=C):(v=e*Math.pow(2,C-1)*Math.pow(2,p),m=0));p>=8;l[r+w]=255&v,w+=M,v/=256,p-=8);for(m=m<<p|v,T+=p;T>0;l[r+w]=255&m,w+=M,m/=256,T-=8);l[r+w-M]|=128*D}),a1}function rS(){if(iS)return s1;iS=1,s1=e;var l=mL();function e(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,c=1/r,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function u(N){return N.type===e.Bytes?N.readVarint()+N.pos:N.pos+1}function m(N,U,H){return H?4294967296*U+(N>>>0):4294967296*(U>>>0)+(N>>>0)}function v(N,U,H){var J=U<=16383?1:U<=2097151?2:U<=268435455?3:Math.floor(Math.log(U)/(7*Math.LN2));H.realloc(J);for(var oe=H.pos-1;oe>=N;oe--)H.buf[oe+J]=H.buf[oe]}function E(N,U){for(var H=0;H<N.length;H++)U.writeVarint(N[H])}function T(N,U){for(var H=0;H<N.length;H++)U.writeSVarint(N[H])}function _(N,U){for(var H=0;H<N.length;H++)U.writeFloat(N[H])}function C(N,U){for(var H=0;H<N.length;H++)U.writeDouble(N[H])}function S(N,U){for(var H=0;H<N.length;H++)U.writeBoolean(N[H])}function w(N,U){for(var H=0;H<N.length;H++)U.writeFixed32(N[H])}function M(N,U){for(var H=0;H<N.length;H++)U.writeSFixed32(N[H])}function D(N,U){for(var H=0;H<N.length;H++)U.writeFixed64(N[H])}function L(N,U){for(var H=0;H<N.length;H++)U.writeSFixed64(N[H])}function F(N,U){return(N[U]|N[U+1]<<8|N[U+2]<<16)+16777216*N[U+3]}function B(N,U,H){N[H]=U,N[H+1]=U>>>8,N[H+2]=U>>>16,N[H+3]=U>>>24}function V(N,U){return(N[U]|N[U+1]<<8|N[U+2]<<16)+(N[U+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(N,U,H){for(H=H||this.length;this.pos<H;){var J=this.readVarint(),oe=J>>3,ee=this.pos;this.type=7&J,N(oe,U,this),this.pos===ee&&this.skip(J)}return U},readMessage:function(N,U){return this.readFields(N,U,this.readVarint()+this.pos)},readFixed32:function(){var N=F(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=V(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=F(this.buf,this.pos)+F(this.buf,this.pos+4)*r;return this.pos+=8,N},readSFixed64:function(){var N=F(this.buf,this.pos)+V(this.buf,this.pos+4)*r;return this.pos+=8,N},readFloat:function(){var N=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var U,H,J=this.buf;return U=127&(H=J[this.pos++]),H<128?U:(U|=(127&(H=J[this.pos++]))<<7,H<128?U:(U|=(127&(H=J[this.pos++]))<<14,H<128?U:(U|=(127&(H=J[this.pos++]))<<21,H<128?U:function(oe,ee,ne){var ge,te,pe=ne.buf;if(ge=(112&(te=pe[ne.pos++]))>>4,te<128||(ge|=(127&(te=pe[ne.pos++]))<<3,te<128)||(ge|=(127&(te=pe[ne.pos++]))<<10,te<128)||(ge|=(127&(te=pe[ne.pos++]))<<17,te<128)||(ge|=(127&(te=pe[ne.pos++]))<<24,te<128)||(ge|=(1&(te=pe[ne.pos++]))<<31,te<128))return m(oe,ge,ee);throw new Error("Expected varint not more than 10 bytes")}(U|=(15&(H=J[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,U=this.pos;return this.pos=N,N-U>=12&&p?function(H,J,oe){return p.decode(H.subarray(J,oe))}(this.buf,U,N):function(H,J,oe){for(var ee="",ne=J;ne<oe;){var ge,te,pe,xe=H[ne],be=null,Se=xe>239?4:xe>223?3:xe>191?2:1;if(ne+Se>oe)break;Se===1?xe<128&&(be=xe):Se===2?(192&(ge=H[ne+1]))==128&&(be=(31&xe)<<6|63&ge)<=127&&(be=null):Se===3?(te=H[ne+2],(192&(ge=H[ne+1]))==128&&(192&te)==128&&((be=(15&xe)<<12|(63&ge)<<6|63&te)<=2047||be>=55296&&be<=57343)&&(be=null)):Se===4&&(te=H[ne+2],pe=H[ne+3],(192&(ge=H[ne+1]))==128&&(192&te)==128&&(192&pe)==128&&((be=(15&xe)<<18|(63&ge)<<12|(63&te)<<6|63&pe)<=65535||be>=1114112)&&(be=null)),be===null?(be=65533,Se=1):be>65535&&(be-=65536,ee+=String.fromCharCode(be>>>10&1023|55296),be=56320|1023&be),ee+=String.fromCharCode(be),ne+=Se}return ee}(this.buf,U,N)},readBytes:function(){var N=this.readVarint()+this.pos,U=this.buf.subarray(this.pos,N);return this.pos=N,U},readPackedVarint:function(N,U){if(this.type!==e.Bytes)return N.push(this.readVarint(U));var H=u(this);for(N=N||[];this.pos<H;)N.push(this.readVarint(U));return N},readPackedSVarint:function(N){if(this.type!==e.Bytes)return N.push(this.readSVarint());var U=u(this);for(N=N||[];this.pos<U;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==e.Bytes)return N.push(this.readBoolean());var U=u(this);for(N=N||[];this.pos<U;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==e.Bytes)return N.push(this.readFloat());var U=u(this);for(N=N||[];this.pos<U;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==e.Bytes)return N.push(this.readDouble());var U=u(this);for(N=N||[];this.pos<U;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed32());var U=u(this);for(N=N||[];this.pos<U;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed32());var U=u(this);for(N=N||[];this.pos<U;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed64());var U=u(this);for(N=N||[];this.pos<U;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed64());var U=u(this);for(N=N||[];this.pos<U;)N.push(this.readSFixed64());return N},skip:function(N){var U=7&N;if(U===e.Varint)for(;this.buf[this.pos++]>127;);else if(U===e.Bytes)this.pos=this.readVarint()+this.pos;else if(U===e.Fixed32)this.pos+=4;else{if(U!==e.Fixed64)throw new Error("Unimplemented type: "+U);this.pos+=8}},writeTag:function(N,U){this.writeVarint(N<<3|U)},realloc:function(N){for(var U=this.length||16;U<this.pos+N;)U*=2;if(U!==this.length){var H=new Uint8Array(U);H.set(this.buf),this.buf=H,this.length=U}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),B(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),B(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),B(this.buf,-1&N,this.pos),B(this.buf,Math.floor(N*c),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),B(this.buf,-1&N,this.pos),B(this.buf,Math.floor(N*c),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function(U,H){var J,oe;if(U>=0?(J=U%4294967296|0,oe=U/4294967296|0):(oe=~(-U/4294967296),4294967295^(J=~(-U%4294967296))?J=J+1|0:(J=0,oe=oe+1|0)),U>=18446744073709552e3||U<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");H.realloc(10),function(ee,ne,ge){ge.buf[ge.pos++]=127&ee|128,ee>>>=7,ge.buf[ge.pos++]=127&ee|128,ee>>>=7,ge.buf[ge.pos++]=127&ee|128,ee>>>=7,ge.buf[ge.pos++]=127&ee|128,ge.buf[ge.pos]=127&(ee>>>=7)}(J,0,H),function(ee,ne){var ge=(7&ee)<<4;ne.buf[ne.pos++]|=ge|((ee>>>=3)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee)))))}(oe,H)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var U=this.pos;this.pos=function(J,oe,ee){for(var ne,ge,te=0;te<oe.length;te++){if((ne=oe.charCodeAt(te))>55295&&ne<57344){if(!ge){ne>56319||te+1===oe.length?(J[ee++]=239,J[ee++]=191,J[ee++]=189):ge=ne;continue}if(ne<56320){J[ee++]=239,J[ee++]=191,J[ee++]=189,ge=ne;continue}ne=ge-55296<<10|ne-56320|65536,ge=null}else ge&&(J[ee++]=239,J[ee++]=191,J[ee++]=189,ge=null);ne<128?J[ee++]=ne:(ne<2048?J[ee++]=ne>>6|192:(ne<65536?J[ee++]=ne>>12|224:(J[ee++]=ne>>18|240,J[ee++]=ne>>12&63|128),J[ee++]=ne>>6&63|128),J[ee++]=63&ne|128)}return ee}(this.buf,N,this.pos);var H=this.pos-U;H>=128&&v(U,H,this),this.pos=U-1,this.writeVarint(H),this.pos+=H},writeFloat:function(N){this.realloc(4),l.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),l.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var U=N.length;this.writeVarint(U),this.realloc(U);for(var H=0;H<U;H++)this.buf[this.pos++]=N[H]},writeRawMessage:function(N,U){this.pos++;var H=this.pos;N(U,this);var J=this.pos-H;J>=128&&v(H,J,this),this.pos=H-1,this.writeVarint(J),this.pos+=J},writeMessage:function(N,U,H){this.writeTag(N,e.Bytes),this.writeRawMessage(U,H)},writePackedVarint:function(N,U){U.length&&this.writeMessage(N,E,U)},writePackedSVarint:function(N,U){U.length&&this.writeMessage(N,T,U)},writePackedBoolean:function(N,U){U.length&&this.writeMessage(N,S,U)},writePackedFloat:function(N,U){U.length&&this.writeMessage(N,_,U)},writePackedDouble:function(N,U){U.length&&this.writeMessage(N,C,U)},writePackedFixed32:function(N,U){U.length&&this.writeMessage(N,w,U)},writePackedSFixed32:function(N,U){U.length&&this.writeMessage(N,M,U)},writePackedFixed64:function(N,U){U.length&&this.writeMessage(N,D,U)},writePackedSFixed64:function(N,U){U.length&&this.writeMessage(N,L,U)},writeBytesField:function(N,U){this.writeTag(N,e.Bytes),this.writeBytes(U)},writeFixed32Field:function(N,U){this.writeTag(N,e.Fixed32),this.writeFixed32(U)},writeSFixed32Field:function(N,U){this.writeTag(N,e.Fixed32),this.writeSFixed32(U)},writeFixed64Field:function(N,U){this.writeTag(N,e.Fixed64),this.writeFixed64(U)},writeSFixed64Field:function(N,U){this.writeTag(N,e.Fixed64),this.writeSFixed64(U)},writeVarintField:function(N,U){this.writeTag(N,e.Varint),this.writeVarint(U)},writeSVarintField:function(N,U){this.writeTag(N,e.Varint),this.writeSVarint(U)},writeStringField:function(N,U){this.writeTag(N,e.Bytes),this.writeString(U)},writeFloatField:function(N,U){this.writeTag(N,e.Fixed32),this.writeFloat(U)},writeDoubleField:function(N,U){this.writeTag(N,e.Fixed64),this.writeDouble(U)},writeBooleanField:function(N,U){this.writeVarintField(N,!!U)}},s1}var J_=R(rS());let l1=3;function gL(l,e,r){e.glyphs=[],l===1&&r.readMessage(_L,e)}function _L(l,e,r){if(l===3){let{id:c,bitmap:p,width:u,height:m,left:v,top:E,advance:T}=r.readMessage(yL,{});e.glyphs.push({id:c,bitmap:new nc({width:u+2*l1,height:m+2*l1},p),metrics:{width:u,height:m,left:v,top:E,advance:T}})}else l===4?e.ascender=r.readSVarint():l===5&&(e.descender=r.readSVarint())}function yL(l,e,r){l===1?e.id=r.readVarint():l===2?e.bitmap=r.readBytes():l===3?e.width=r.readVarint():l===4?e.height=r.readVarint():l===5?e.left=r.readSVarint():l===6?e.top=r.readSVarint():l===7&&(e.advance=r.readVarint())}let oS=l1,Oo={horizontal:1,vertical:2,horizontalOnly:3};class nm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){let c=new nm;return c.scale=e||1,c.fontStack=r,c}static forImage(e){let r=new nm;return r.imageName=e,r}}class ch{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){let c=new ch;for(let p=0;p<e.sections.length;p++){let u=e.sections[p];u.image?c.addImageSection(u):c.addTextSection(u,r)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,c){let p="";for(let u=0;u<r.length;u++){let m=r.charCodeAt(u+1)||null,v=r.charCodeAt(u-1)||null;p+=!c&&(m&&yp(m)&&!tm[r[u+1]]||v&&yp(v)&&!tm[r[u-1]])||!tm[r[u]]?r[u]:tm[r[u]]}return p}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&K_[this.text.charCodeAt(c)];c++)e++;let r=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&K_[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){let c=new ch;return c.text=this.text.substring(e,r),c.sectionIndex=this.sectionIndex.slice(e,r),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(nm.forText(e.scale,e.fontStack||r));let c=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(c)}addImageSection(e){let r=e.image?e.image.namePrimary:"";if(r.length===0)return void xn("Can't add FormattedSection with an empty image.");let c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(nm.forImage(r)),this.sectionIndex.push(this.sections.length-1)):xn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function c1(l,e,r,c,p,u,m,v,E,T,_,C,S,w,M){let D=ch.fromFeature(l,p);C===Oo.vertical&&D.verticalizePunctuation(S);let L=[],F=function(H,J,oe,ee,ne,ge){if(!H)return[];let te=[],pe=function(Re,Le,De,He,et,je){let pt=0;for(let at=0;at<Re.length();at++){let rt=Re.getSection(at);pt+=sS(Re.getCodePoint(at),rt,He,et,Le,je)}return pt/Math.max(1,Math.ceil(pt/De))}(H,J,oe,ee,ne,ge),xe=H.text.indexOf("\u200B")>=0,be=0;for(let Re=0;Re<H.length();Re++){let Le=H.getSection(Re),De=H.getCodePoint(Re);if(K_[De]||(be+=sS(De,Le,ee,ne,J,ge)),Re<H.length()-1){let He=!((Se=De)<11904||!(Et["Bopomofo Extended"](Se)||Et.Bopomofo(Se)||Et["CJK Compatibility Forms"](Se)||Et["CJK Compatibility Ideographs"](Se)||Et["CJK Compatibility"](Se)||Et["CJK Radicals Supplement"](Se)||Et["CJK Strokes"](Se)||Et["CJK Symbols and Punctuation"](Se)||Et["CJK Unified Ideographs Extension A"](Se)||Et["CJK Unified Ideographs"](Se)||Et["Enclosed CJK Letters and Months"](Se)||Et["Halfwidth and Fullwidth Forms"](Se)||Et.Hiragana(Se)||Et["Ideographic Description Characters"](Se)||Et["Kangxi Radicals"](Se)||Et["Katakana Phonetic Extensions"](Se)||Et.Katakana(Se)||Et["Vertical Forms"](Se)||Et["Yi Radicals"](Se)||Et["Yi Syllables"](Se)));(vL[De]||He||Le.imageName)&&te.push(lS(Re+1,be,pe,te,xL(De,H.getCodePoint(Re+1),He&&xe),!1))}}var Se;return cS(lS(H.length(),be,pe,te,0,!0))}(D,T,u,e,c,w),{processBidirectionalText:B,processStyledBidirectionalText:V}=Yr;if(B&&D.sections.length===1){let H=B(D.toString(),F);for(let J of H){let oe=new ch;oe.text=J,oe.sections=D.sections;for(let ee=0;ee<J.length;ee++)oe.sectionIndex.push(0);L.push(oe)}}else if(V){let H=V(D.text,D.sectionIndex,F);for(let J of H){let oe=new ch;oe.text=J[0],oe.sectionIndex=J[1],oe.sections=D.sections,L.push(oe)}}else L=function(H,J){let oe=[],ee=H.text,ne=0;for(let ge of J)oe.push(H.substring(ne,ge)),ne=ge;return ne<ee.length&&oe.push(H.substring(ne,ee.length)),oe}(D,F);let N=[],U={positionedLines:N,text:D.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(H,J,oe,ee,ne,ge,te,pe,xe,be,Se,Re){let Le=0,De=0,He=0,et=pe==="right"?1:pe==="left"?0:.5,je=!1;for(let ft of ne){let yt=ft.getSections();for(let Gt of yt){if(Gt.imageName)continue;let tn=J[Gt.fontStack];if(tn&&(je=tn.ascender!==void 0&&tn.descender!==void 0,!je))break}if(!je)break}let pt=0;for(let ft of ne){ft.trim();let yt=ft.getMaxScale(),Gt=(yt-1)*ur,tn={positionedGlyphs:[],lineOffset:0};H.positionedLines[pt]=tn;let rn=tn.positionedGlyphs,Qt=0;if(!ft.length()){De+=ge,++pt;continue}let dn=0,cn=0;for(let Yn=0;Yn<ft.length();Yn++){let Nt=ft.getSection(Yn),kn=ft.getSectionIndex(Yn),Vn=ft.getCodePoint(Yn),hi=Nt.scale,Di=null,Fi=null,Ai=null,Ei=ur,Ri=0,ji=!(xe===Oo.horizontal||!Se&&!jl(Vn)||Se&&(K_[Vn]||(at=Vn,Et.Arabic(at)||Et["Arabic Supplement"](at)||Et["Arabic Extended-A"](at)||Et["Arabic Presentation Forms-A"](at)||Et["Arabic Presentation Forms-B"](at))));if(Nt.imageName){let dr=ee[Nt.imageName];if(!dr)continue;Ai=Nt.imageName,H.iconsInText=H.iconsInText||!0,Fi=dr.paddedRect;let li=dr.displaySize;hi=hi*ur/Re,Di={width:li[0],height:li[1],left:0,top:-oS,advance:ji?li[1]:li[0],localGlyph:!1},Ri=je?-Di.height*hi:yt*ur-17-li[1]*hi,Ei=Di.advance;let Kr=(ji?li[0]:li[1])*hi-ur*yt;Kr>0&&Kr>Qt&&(Qt=Kr)}else{let dr=oe[Nt.fontStack];if(!dr)continue;dr[Vn]&&(Fi=dr[Vn]);let li=J[Nt.fontStack];if(!li)continue;let Kr=li.glyphs[Vn];if(!Kr)continue;if(Di=Kr.metrics,Ei=Vn!==8203?ur:0,je){let Os=li.ascender!==void 0?Math.abs(li.ascender):0,Yo=li.descender!==void 0?Math.abs(li.descender):0,Jo=(Os+Yo)*hi;dn<Jo&&(dn=Jo,cn=(Os-Yo)/2*hi),Ri=-Os*hi}else Ri=(yt-hi)*ur-17}ji?(H.verticalizable=!0,rn.push({glyph:Vn,imageName:Ai,x:Le,y:De+Ri,vertical:ji,scale:hi,localGlyph:Di.localGlyph,fontStack:Nt.fontStack,sectionIndex:kn,metrics:Di,rect:Fi}),Le+=Ei*hi+be):(rn.push({glyph:Vn,imageName:Ai,x:Le,y:De+Ri,vertical:ji,scale:hi,localGlyph:Di.localGlyph,fontStack:Nt.fontStack,sectionIndex:kn,metrics:Di,rect:Fi}),Le+=Di.advance*hi+be)}rn.length!==0&&(He=Math.max(Le-be,He),je?uS(rn,et,Qt,cn,ge*yt/2):uS(rn,et,Qt,0,ge/2)),Le=0;let ii=ge*yt+Qt;tn.lineOffset=Math.max(Qt,Gt),De+=ii,++pt}var at;let rt=De,{horizontalAlign:Qe,verticalAlign:Dt}=u1(te);(function(ft,yt,Gt,tn,rn,Qt){let dn=(yt-Gt)*rn,cn=-Qt*tn;for(let ii of ft)for(let Yn of ii.positionedGlyphs)Yn.x+=dn,Yn.y+=cn})(H.positionedLines,et,Qe,Dt,He,rt),H.top+=-Dt*rt,H.bottom=H.top+rt,H.left+=-Qe*He,H.right=H.left+He,H.hasBaseline=je}(U,e,r,c,L,m,v,E,C,T,S,M),!function(H){for(let J of H)if(J.positionedGlyphs.length!==0)return!1;return!0}(N)&&U}let K_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function sS(l,e,r,c,p,u){if(e.imageName){let m=c[e.imageName];return m?m.displaySize[0]*e.scale*ur/u+p:0}{let m=r[e.fontStack],v=m&&m.glyphs[l];return v?v.metrics.advance*e.scale+p:0}}function aS(l,e,r,c){let p=Math.pow(l-e,2);return c?l<e?p/2:2*p:p+Math.abs(r)*r}function xL(l,e,r){let c=0;return l===10&&(c-=1e4),r&&(c+=150),l!==40&&l!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function lS(l,e,r,c,p,u){let m=null,v=aS(e,r,p,u);for(let E of c){let T=aS(e-E.x,r,p,u)+E.badness;T<=v&&(m=E,v=T)}return{index:l,x:e,priorBreak:m,badness:v}}function cS(l){return l?cS(l.priorBreak).concat(l.index):[]}function u1(l){let e=.5,r=.5;switch(l){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function uS(l,e,r,c,p){if(!(e||r||c||p))return;let u=l.length-1,m=l[u],v=(m.x+m.metrics.advance*m.scale)*e;for(let E=0;E<=u;E++)l[E].x-=v,l[E].y+=r+c+p}function bL(l,e,r,c){let{horizontalAlign:p,verticalAlign:u}=u1(c),m=r[0]-l.displaySize[0]*p,v=r[1]-l.displaySize[1]*u;return{imagePrimary:l,imageSecondary:e,top:v,bottom:v+l.displaySize[1],left:m,right:m+l.displaySize[0]}}function dS(l,e,r,c,p,u){let m=l.imagePrimary,v;if(m.content){let L=m.content,F=m.pixelRatio||1;v=[L[0]/F,L[1]/F,m.displaySize[0]-L[2]/F,m.displaySize[1]-L[3]/F]}let E=e.left*u,T=e.right*u,_,C,S,w;r==="width"||r==="both"?(w=p[0]+E-c[3],C=p[0]+T+c[1]):(w=p[0]+(E+T-m.displaySize[0])/2,C=w+m.displaySize[0]);let M=e.top*u,D=e.bottom*u;return r==="height"||r==="both"?(_=p[1]+M-c[0],S=p[1]+D+c[2]):(_=p[1]+(M+D-m.displaySize[1])/2,S=_+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:_,right:C,bottom:S,left:w,collisionPadding:v}}class Ua extends lt{constructor(e,r,c,p,u){super(e,r),this.angle=p,this.z=c,u!==void 0&&(this.segment=u)}clone(){return new Ua(this.x,this.y,this.z,this.angle,this.segment)}}function hS(l,e,r,c,p){if(e.segment===void 0)return!0;let u=e,m=e.segment+1,v=0;for(;v>-r/2;){if(m--,m<0)return!1;v-=l[m].dist(u),u=l[m]}v+=l[m].dist(l[m+1]),m++;let E=[],T=0;for(;v<r/2;){let _=l[m],C=l[m+1];if(!C)return!1;let S=l[m-1].angleTo(_)-_.angleTo(C);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:v,angleDelta:S}),T+=S;v-E[0].distance>c;)T-=E.shift().angleDelta;if(T>p)return!1;m++,v+=_.dist(C)}return!0}function fS(l){let e=0;for(let r=0;r<l.length-1;r++)e+=l[r].dist(l[r+1]);return e}function pS(l,e,r){return l?.6*e*r:0}function mS(l,e){return Math.max(l?l.right-l.left:0,e?e.right-e.left:0)}function wL(l,e,r,c,p,u){let m=pS(r,p,u),v=mS(r,c)*u,E=0,T=fS(l)/2;for(let _=0;_<l.length-1;_++){let C=l[_],S=l[_+1],w=C.dist(S);if(E+w>T){let M=(T-E)/w,D=kt(C.x,S.x,M),L=kt(C.y,S.y,M),F=new Ua(D,L,0,S.angleTo(C),_);return!m||hS(l,F,v,m,e)?F:void 0}E+=w}}function CL(l,e,r,c,p,u,m,v,E){let T=pS(c,u,m),_=mS(c,p),C=_*m,S=l[0].x===0||l[0].x===E||l[0].y===0||l[0].y===E;return e-C<e/4&&(e=C+e/4),gS(l,S?e/2*v%e:(_/2+2*u)*m*v%e,e,T,r,C,S,!1,E)}function gS(l,e,r,c,p,u,m,v,E){let T=u/2,_=fS(l),C=0,S=e-r,w=[];for(let M=0;M<l.length-1;M++){let D=l[M],L=l[M+1],F=D.dist(L),B=L.angleTo(D);for(;S+r<C+F;){S+=r;let V=(S-C)/F,N=kt(D.x,L.x,V),U=kt(D.y,L.y,V);if(N>=0&&N<E&&U>=0&&U<E&&S-T>=0&&S+T<=_){let H=new Ua(N,U,0,B,M);c&&!hS(l,H,u,c,p)||w.push(H)}}C+=F}return v||w.length||m||(w=gS(l,C/2,r,c,p,u,m,!0,E)),w}function _S(l,e,r,c,p){let u=[];for(let m=0;m<l.length;m++){let v=l[m],E;for(let T=0;T<v.length-1;T++){let _=v[T],C=v[T+1];_.x<e&&C.x<e||(_.x<e?_=new lt(e,_.y+(e-_.x)/(C.x-_.x)*(C.y-_.y))._round():C.x<e&&(C=new lt(e,_.y+(e-_.x)/(C.x-_.x)*(C.y-_.y))._round()),_.y<r&&C.y<r||(_.y<r?_=new lt(_.x+(r-_.y)/(C.y-_.y)*(C.x-_.x),r)._round():C.y<r&&(C=new lt(_.x+(r-_.y)/(C.y-_.y)*(C.x-_.x),r)._round()),_.x>=c&&C.x>=c||(_.x>=c?_=new lt(c,_.y+(c-_.x)/(C.x-_.x)*(C.y-_.y))._round():C.x>=c&&(C=new lt(c,_.y+(c-_.x)/(C.x-_.x)*(C.y-_.y))._round()),_.y>=p&&C.y>=p||(_.y>=p?_=new lt(_.x+(p-_.y)/(C.y-_.y)*(C.x-_.x),p)._round():C.y>=p&&(C=new lt(_.x+(p-_.y)/(C.y-_.y)*(C.x-_.x),p)._round()),E&&_.equals(E[E.length-1])||(E=[_],u.push(E)),E.push(C)))))}}return u}function yS(l){let e=0,r=0;for(let m of l)e+=m.w*m.h,r=Math.max(r,m.w);l.sort((m,v)=>v.h-m.h);let c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],p=0,u=0;for(let m of l)for(let v=c.length-1;v>=0;v--){let E=c[v];if(!(m.w>E.w||m.h>E.h)){if(m.x=E.x,m.y=E.y,u=Math.max(u,m.y+m.h),p=Math.max(p,m.x+m.w),m.w===E.w&&m.h===E.h){let T=c.pop();v<c.length&&(c[v]=T)}else m.h===E.h?(E.x+=m.w,E.w-=m.w):m.w===E.w?(E.y+=m.h,E.h-=m.h):(c.push({x:E.x+m.w,y:E.y,w:E.w-m.w,h:m.h}),E.y+=m.h,E.h-=m.h);break}}return{w:p,h:u,fill:e/(p*u)||0}}gt(Ua,"Anchor");let im=1;class d1{constructor(e,{pixelRatio:r,version:c,stretchX:p,stretchY:u,content:m},v){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=u,this.content=m,this.version=c,this.padding=v}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class vS{constructor(e,r,c){let p={},u={};this.haveRenderCallbacks=[];let m=[];this.addImages(e,p,im,m),this.addImages(r,u,2,m);let{w:v,h:E}=yS(m),T=new Tr({width:v||1,height:E||1});for(let _ in e){let C=e[_],S=p[_].paddedRect;Tr.copy(C.data,T,{x:0,y:0},{x:S.x+im,y:S.y+im},C.data,c,C.sdf)}for(let _ in r){let C=r[_],S=u[_].paddedRect,w=u[_].padding,M=S.x+w,D=S.y+w,L=C.data.width,F=C.data.height;w=w>1?w-1:w,Tr.copy(C.data,T,{x:0,y:0},{x:M,y:D},C.data,c),Tr.copy(C.data,T,{x:0,y:F-w},{x:M,y:D-w},{width:L,height:w},c),Tr.copy(C.data,T,{x:0,y:0},{x:M,y:D+F},{width:L,height:w},c),Tr.copy(C.data,T,{x:L-w,y:0},{x:M-w,y:D},{width:w,height:F},c),Tr.copy(C.data,T,{x:0,y:0},{x:M+L,y:D},{width:w,height:F},c),Tr.copy(C.data,T,{x:L-w,y:F-w},{x:M-w,y:D-w},{width:w,height:w},c),Tr.copy(C.data,T,{x:0,y:F-w},{x:M+L,y:D-w},{width:w,height:w},c),Tr.copy(C.data,T,{x:0,y:0},{x:M+L,y:D+F},{width:w,height:w},c),Tr.copy(C.data,T,{x:L-w,y:0},{x:M-w,y:D+F},{width:w,height:w},c)}this.image=T,this.iconPositions=p,this.patternPositions=u}addImages(e,r,c,p){for(let u in e){let m=e[u],v={x:0,y:0,w:m.data.width+2*c,h:m.data.height+2*c};p.push(v),r[u]=new d1(v,m,c),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>e.hasImage(p,c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(let p in e.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[p],e.getImage(p,c),r),this.patchUpdatedImage(this.patternPositions[p],e.getImage(p,c),r)}patchUpdatedImage(e,r,c){if(!e||!r||e.version===r.version)return;e.version=r.version;let[p,u]=e.tl;c.update(r.data,{position:{x:p,y:u}})}}gt(d1,"ImagePosition"),gt(vS,"ImageAtlas");let rm=1e20;function xS(l,e,r,c,p,u,m,v,E){for(let T=e;T<e+c;T++)bS(l,r*u+T,u,p,m,v,E);for(let T=r;T<r+p;T++)bS(l,T*u+e,1,c,m,v,E)}function bS(l,e,r,c,p,u,m){u[0]=0,m[0]=-rm,m[1]=rm,p[0]=l[e];for(let v=1,E=0,T=0;v<c;v++){p[v]=l[e+v*r];let _=v*v;do{let C=u[E];T=(p[v]-p[C]+_-C*C)/(v-C)/2}while(T<=m[E]&&--E>-1);E++,u[E]=v,m[E]=T,m[E+1]=rm}for(let v=0,E=0;v<c;v++){for(;m[E+1]<v;)E++;let T=u[E],_=v-T;l[e+v*r]=p[T]+_*_}}let Ds=2,h1={none:0,ideographs:1,all:2};class uh{constructor(e,r,c){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,c){let p=[],u=this.urls[r]||ce.GLYPHS_URL;for(let m in e)for(let v of e[m])p.push({stack:m,id:v});Ea(p,({stack:m,id:v},E)=>{let T=this.entries[m];T||(T=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=T.glyphs[v];if(_!==void 0)return void E(null,{stack:m,id:v,glyph:_});if(_=this._tinySDF(T,m,v),_)return T.glyphs[v]=_,void E(null,{stack:m,id:v,glyph:_});let C=Math.floor(v/256);if(256*C>65535)return xn("glyphs > 65535 not supported"),void E(null,{stack:m,id:v,glyph:_});if(T.ranges[C])return void E(null,{stack:m,id:v,glyph:_});let S=T.requests[C];S||(S=T.requests[C]=[],uh.loadGlyphRange(m,C,u,this.requestManager,(w,M)=>{if(M){T.ascender=M.ascender,T.descender=M.descender;for(let D in M.glyphs)this._doesCharSupportLocalGlyph(+D)||(T.glyphs[+D]=M.glyphs[+D]);T.ranges[C]=!0}for(let D of S)D(w,M);delete T.requests[C]})),S.push((w,M)=>{w?E(w):M&&E(null,{stack:m,id:v,glyph:M.glyphs[v]||null})})},(m,v)=>{if(m)c(m);else if(v){let E={};for(let{stack:T,id:_,glyph:C}of v)E[T]===void 0&&(E[T]={}),E[T].glyphs===void 0&&(E[T].glyphs={}),E[T].glyphs[_]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},E[T].ascender=this.entries[T].ascender,E[T].descender=this.entries[T].descender;c(null,E)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==h1.none&&(this.localGlyphMode===h1.all?!!this.localFontFamily:!!this.localFontFamily&&(Et["CJK Unified Ideographs"](e)||Et["Hangul Syllables"](e)||Et.Hiragana(e)||Et.Katakana(e)||Et["CJK Symbols and Punctuation"](e)||Et["CJK Unified Ideographs Extension A"](e)||Et["CJK Unified Ideographs Extension B"](e)||Et.Osage(e)))}_tinySDF(e,r,c){let p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let u=e.tinySDF;if(!u){let D="400";/bold/i.test(r)?D="900":/medium/i.test(r)?D="500":/light/i.test(r)&&(D="200"),u=e.tinySDF=new uh.TinySDF({fontFamily:p,fontWeight:D,fontSize:24*Ds,buffer:3*Ds,radius:8*Ds}),u.fontWeight=D}if(this.localGlyphs[u.fontWeight][c])return this.localGlyphs[u.fontWeight][c];let m=String.fromCodePoint(c),{data:v,width:E,height:T,glyphWidth:_,glyphHeight:C,glyphLeft:S,glyphTop:w,glyphAdvance:M}=u.draw(m);return this.localGlyphs[u.fontWeight][c]={id:c,bitmap:new nc({width:E,height:T},v),metrics:{width:_/Ds,height:C/Ds,left:S/Ds,top:w/Ds-27,advance:M/Ds,localGlyph:!0}}}}uh.loadGlyphRange=function(l,e,r,c,p){let u=256*e,m=u+255,v=c.transformRequest(c.normalizeGlyphsURL(r).replace("{fontstack}",l).replace("{range}",`${u}-${m}`),dd.Glyphs);_l(v,(E,T)=>{if(E)p(E);else if(T){let _={},C=function(S){return new J_(S).readFields(gL,{})}(T);for(let S of C.glyphs)_[S.id]=S;p(null,{glyphs:_,ascender:C.ascender,descender:C.descender})}})},uh.TinySDF=class{constructor({fontSize:l=24,buffer:e=3,radius:r=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:u="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=r;let v=this.size=l+4*e,E=this._createCanvas(v),T=this.ctx=E.getContext("2d",{willReadFrequently:!0});T.font=`${m} ${u} ${l}px ${p}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(l){let e=document.createElement("canvas");return e.width=e.height=l,e}draw(l){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:u}=this.ctx.measureText(l),m=Math.ceil(r),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-p))),E=Math.min(this.size-this.buffer,m+Math.ceil(c)),T=v+2*this.buffer,_=E+2*this.buffer,C=Math.max(T*_,0),S=new Uint8ClampedArray(C),w={data:S,width:T,height:_,glyphWidth:v,glyphHeight:E,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(v===0||E===0)return w;let{ctx:M,buffer:D,gridInner:L,gridOuter:F}=this;M.clearRect(D,D,v,E),M.fillText(l,D,D+m);let B=M.getImageData(D,D,v,E);F.fill(rm,0,C),L.fill(0,0,C);for(let V=0;V<E;V++)for(let N=0;N<v;N++){let U=B.data[4*(V*v+N)+3]/255;if(U===0)continue;let H=(V+D)*T+N+D;if(U===1)F[H]=0,L[H]=rm;else{let J=.5-U;F[H]=J>0?J*J:0,L[H]=J<0?J*J:0}}xS(F,0,0,T,_,T,this.f,this.v,this.z),xS(L,D,D,v,E,T,this.f,this.v,this.z);for(let V=0;V<C;V++){let N=Math.sqrt(F[V])-Math.sqrt(L[V]);S[V]=Math.round(255-255*(N/this.radius+this.cutoff))}return w}};let rc=im;function wS(l,e,r,c,p=1){let u=[],m=l.imagePrimary,v=m.pixelRatio,E=m.paddedRect.w-2*rc,T=m.paddedRect.h-2*rc,_=(l.right-l.left)*p,C=(l.bottom-l.top)*p,S=m.stretchX||[[0,E]],w=m.stretchY||[[0,T]],M=(te,pe)=>te+pe[1]-pe[0],D=S.reduce(M,0),L=w.reduce(M,0),F=E-D,B=T-L,V=0,N=D,U=0,H=L,J=0,oe=F,ee=0,ne=B;if(m.content&&c){let te=m.content;V=Q_(S,0,te[0]),U=Q_(w,0,te[1]),N=Q_(S,te[0],te[2]),H=Q_(w,te[1],te[3]),J=te[0]-V,ee=te[1]-U,oe=te[2]-te[0]-N,ne=te[3]-te[1]-H}let ge=(te,pe,xe,be)=>{let Se=ey(te.stretch-V,N,_,l.left*p),Re=ty(te.fixed-J,oe,te.stretch,D),Le=ey(pe.stretch-U,H,C,l.top*p),De=ty(pe.fixed-ee,ne,pe.stretch,L),He=ey(xe.stretch-V,N,_,l.left*p),et=ty(xe.fixed-J,oe,xe.stretch,D),je=ey(be.stretch-U,H,C,l.top*p),pt=ty(be.fixed-ee,ne,be.stretch,L),at=new lt(Se,Le),rt=new lt(He,Le),Qe=new lt(He,je),Dt=new lt(Se,je),ft=new lt(Re/v,De/v),yt=new lt(et/v,pt/v),Gt=e*Math.PI/180;if(Gt){let ii=Math.sin(Gt),Yn=Math.cos(Gt),Nt=[Yn,-ii,ii,Yn];at._matMult(Nt),rt._matMult(Nt),Dt._matMult(Nt),Qe._matMult(Nt)}let tn=te.stretch+te.fixed,rn=xe.stretch+xe.fixed,Qt=pe.stretch+pe.fixed,dn=be.stretch+be.fixed,cn=l.imageSecondary;return{tl:at,tr:rt,bl:Dt,br:Qe,texPrimary:{x:m.paddedRect.x+rc+tn,y:m.paddedRect.y+rc+Qt,w:rn-tn,h:dn-Qt},texSecondary:cn?{x:cn.paddedRect.x+rc+tn,y:cn.paddedRect.y+rc+Qt,w:rn-tn,h:dn-Qt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ft,pixelOffsetBR:yt,minFontScaleX:oe/v/_,minFontScaleY:ne/v/C,isSDF:r}};if(c&&(m.stretchX||m.stretchY)){let te=CS(S,F,D),pe=CS(w,B,L);for(let xe=0;xe<te.length-1;xe++){let be=te[xe],Se=te[xe+1];for(let Re=0;Re<pe.length-1;Re++)u.push(ge(be,pe[Re],Se,pe[Re+1]))}}else u.push(ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:T+1}));return u}function Q_(l,e,r){let c=0;for(let p of l)c+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return c}function CS(l,e,r){let c=[{fixed:-rc,stretch:0}];for(let[p,u]of l){let m=c[c.length-1];c.push({fixed:p-m.stretch,stretch:m.stretch}),c.push({fixed:p-m.stretch,stretch:m.stretch+(u-p)})}return c.push({fixed:e+rc,stretch:r}),c}function ey(l,e,r,c){return l/e*r+c}function ty(l,e,r,c){return l-e*r/c}function EL(l,e,r,c){let p=e+l.positionedLines[c].lineOffset;return c===0?r+p/2:r+(p+(e+l.positionedLines[c-1].lineOffset))/2}function ML(l,e=1,r=!1){let c=1/0,p=1/0,u=-1/0,m=-1/0,v=l[0];for(let w=0;w<v.length;w++){let M=v[w];(!w||M.x<c)&&(c=M.x),(!w||M.y<p)&&(p=M.y),(!w||M.x>u)&&(u=M.x),(!w||M.y>m)&&(m=M.y)}let E=Math.min(u-c,m-p),T=E/2,_=new Uf([],SL);if(E===0)return new lt(c,p);for(let w=c;w<u;w+=E)for(let M=p;M<m;M+=E)_.push(new dh(w+T,M+T,T,l));let C=function(w){let M=0,D=0,L=0,F=w[0];for(let B=0,V=F.length,N=V-1;B<V;N=B++){let U=F[B],H=F[N],J=U.x*H.y-H.x*U.y;D+=(U.x+H.x)*J,L+=(U.y+H.y)*J,M+=3*J}return new dh(D/M,L/M,0,w)}(l),S=_.length;for(;_.length;){let w=_.pop();(w.d>C.d||!C.d)&&(C=w,r&&console.log("found best %d after %d probes",Math.round(1e4*w.d)/1e4,S)),w.max-C.d<=e||(T=w.h/2,_.push(new dh(w.p.x-T,w.p.y-T,T,l)),_.push(new dh(w.p.x+T,w.p.y-T,T,l)),_.push(new dh(w.p.x-T,w.p.y+T,T,l)),_.push(new dh(w.p.x+T,w.p.y+T,T,l)),S+=4)}return r&&(console.log(`num probes: ${S}`),console.log(`best distance: ${C.d}`)),C.p}function SL(l,e){return e.max-l.max}class dh{constructor(e,r,c,p){this.p=new lt(e,r),this.h=c,this.d=function(u,m){let v=!1,E=1/0;for(let T=0;T<m.length;T++){let _=m[T];for(let C=0,S=_.length,w=S-1;C<S;w=C++){let M=_[C],D=_[w];M.y>u.y!=D.y>u.y&&u.x<(D.x-M.x)*(u.y-M.y)/(D.y-M.y)+M.x&&(v=!v),E=Math.min(E,Lt(u,M,D))}}return(v?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}let f1=Number.POSITIVE_INFINITY,TL=Math.sqrt(2);function ES(l,[e,r]){let c=0,p=0;if(r===f1){e<0&&(e=0);let u=e/TL;switch(l){case"top-right":case"top-left":p=u-7;break;case"bottom-right":case"bottom-left":p=7-u;break;case"bottom":p=7-e;break;case"top":p=e-7}switch(l){case"top-right":case"bottom-right":c=-u;break;case"top-left":case"bottom-left":c=u;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),l){case"top-right":case"top-left":case"top":p=r-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-r}switch(l){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,p]}function p1(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function IL(l,e,r,c,p,u,m,v,E,T,_,C,S,w,M){let D=u.textMaxSize.evaluate(e,{},C);D===void 0?D=m*u.textScaleFactor:D*=u.textScaleFactor;let L=l.layers[0].layout,F=L.get("icon-offset").evaluate(e,{},C),B=SS(r.horizontal)||r.vertical,V=S.name==="globe",N=ur,U=m*u.textScaleFactor/N,H=l.tilePixelRatio*D/N,J=(be=l.overscaling,l.zoom>18&&be>2&&(be>>=1),Math.max(ct/(512*be),1)*L.get("symbol-spacing")),oe=L.get("text-padding")*l.tilePixelRatio,ee=L.get("icon-padding")*l.tilePixelRatio,ne=pn(L.get("text-max-angle")),ge=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",te=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",pe=L.get("symbol-placement"),xe=J/2;var be;let Se=L.get("icon-text-fit").evaluate(e,{},C),Re=L.get("icon-text-fit-padding").evaluate(e,{},C),Le=Se!=="none",De;l.hasAnyIconTextFit===!1&&Le&&(l.hasAnyIconTextFit=!0),c&&Le&&(l.allowVerticalPlacement&&r.vertical&&(De=dS(c,r.vertical,Se,Re,F,U)),B&&(c=dS(c,B,Se,Re,F,U)));let He=(et,je,pt)=>{if(je.x<0||je.x>=ct||je.y<0||je.y>=ct)return;let at=null;if(V){let{x:rt,y:Qe,z:Dt}=S.projectTilePoint(je.x,je.y,pt);at={anchor:new Ua(rt,Qe,Dt,0,void 0),up:S.upVector(pt,je.x,je.y)}}(function(rt,Qe,Dt,ft,yt,Gt,tn,rn,Qt,dn,cn,ii,Yn,Nt,kn,Vn,hi,Di,Fi,Ai,Ei,Ri,ji,dr,li,Kr,Os){let Yo=rt.addToLineVertexArray(Qe,ft),Jo,Pu,cc,Ru,Cm,qT,WT,ZT=0,XT=0,YT=0,JT=0,G1=-1,H1=-1,ia={},KT=Ar(""),Ou=Dt?Dt.anchor:Qe,q1=Qt.layout.get("icon-text-fit").evaluate(Ei,{},li)!=="none",W1=0,Z1=0;if(Qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[W1,Z1]=Qt.layout.get("text-offset").evaluate(Ei,{},li).map(po=>po*ur):(W1=Qt.layout.get("text-radial-offset").evaluate(Ei,{},li)*ur,Z1=f1),rt.allowVerticalPlacement&&yt.vertical){let po=yt.vertical;if(kn)qT=m1(po),rn&&(WT=m1(rn));else{let mo=Qt.layout.get("text-rotate").evaluate(Ei,{},li)+90;cc=ny(dn,Ou,Qe,cn,ii,Yn,po,Nt,mo,Vn),rn&&(Ru=ny(dn,Ou,Qe,cn,ii,Yn,rn,Di,mo))}}if(Gt){let po=Qt.layout.get("icon-rotate").evaluate(Ei,{},li),mo=wS(Gt,po,ji,q1,Ri.iconScaleFactor),yh=rn?wS(rn,po,ji,q1,Ri.iconScaleFactor):void 0;Pu=ny(dn,Ou,Qe,cn,ii,Yn,Gt,Di,po),ZT=4*mo.length;let QT=rt.iconSizeData,Lu=null;QT.kind==="source"?(Lu=[Is*Qt.layout.get("icon-size").evaluate(Ei,{},li)*Ri.iconScaleFactor],Lu[0]>oc&&xn(`${rt.layerIds[0]}: Value for "icon-size" is >= ${om}. Reduce your "icon-size".`)):QT.kind==="composite"&&(Lu=[Is*Ri.compositeIconSizes[0].evaluate(Ei,{},li)*Ri.iconScaleFactor,Is*Ri.compositeIconSizes[1].evaluate(Ei,{},li)*Ri.iconScaleFactor],(Lu[0]>oc||Lu[1]>oc)&&xn(`${rt.layerIds[0]}: Value for "icon-size" is >= ${om}. Reduce your "icon-size".`)),rt.addSymbols(rt.icon,mo,Lu,Ai,Fi,Ei,!1,Dt,Qe,Yo.lineStartIndex,Yo.lineLength,-1,dr,li,Kr,Os),G1=rt.icon.placedSymbolArray.length-1,yh&&(XT=4*yh.length,rt.addSymbols(rt.icon,yh,Lu,Ai,Fi,Ei,Oo.vertical,Dt,Qe,Yo.lineStartIndex,Yo.lineLength,-1,dr,li,Kr,Os),H1=rt.icon.placedSymbolArray.length-1)}for(let po in yt.horizontal){let mo=yt.horizontal[po];Jo||(KT=Ar(mo.text),kn?Cm=m1(mo):Jo=ny(dn,Ou,Qe,cn,ii,Yn,mo,Nt,Qt.layout.get("text-rotate").evaluate(Ei,{},li),Vn));let yh=mo.positionedLines.length===1;if(YT+=MS(rt,Dt,Qe,mo,tn,Qt,kn,Ei,Vn,Yo,yt.vertical?Oo.horizontal:Oo.horizontalOnly,yh?Object.keys(yt.horizontal):[po],ia,G1,Ri,dr,li,Kr),yh)break}yt.vertical&&(JT+=MS(rt,Dt,Qe,yt.vertical,tn,Qt,kn,Ei,Vn,Yo,Oo.vertical,["vertical"],ia,H1,Ri,dr,li,Kr));let uc=-1,X1=(po,mo)=>po?Math.max(po,mo):mo;uc=X1(Cm,uc),uc=X1(qT,uc),uc=X1(WT,uc);let $F=uc>-1?1:0;rt.glyphOffsetArray.length>=65535&&xn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ei.sortKey!==void 0&&rt.addToSortKeyRanges(rt.symbolInstances.length,Ei.sortKey),rt.symbolInstances.emplaceBack(Qe.x,Qe.y,Ou.x,Ou.y,Ou.z,ia.right>=0?ia.right:-1,ia.center>=0?ia.center:-1,ia.left>=0?ia.left:-1,ia.vertical>=0?ia.vertical:-1,G1,H1,KT,Jo!==void 0?Jo:rt.collisionBoxArray.length,Jo!==void 0?Jo+1:rt.collisionBoxArray.length,cc!==void 0?cc:rt.collisionBoxArray.length,cc!==void 0?cc+1:rt.collisionBoxArray.length,Pu!==void 0?Pu:rt.collisionBoxArray.length,Pu!==void 0?Pu+1:rt.collisionBoxArray.length,Ru||rt.collisionBoxArray.length,Ru?Ru+1:rt.collisionBoxArray.length,cn,YT,JT,ZT,XT,$F,0,W1,Z1,uc,0,q1?1:0)})(l,je,at,et,r,c,p,De,l.layers[0],l.collisionBoxArray,e.index,e.sourceLayerIndex,l.index,oe,ge,E,0,ee,te,F,e,u,T,_,C,w,M)};if(pe==="line")for(let et of _S(e.geometry,0,0,ct,ct)){let je=CL(et,J,ne,r.vertical||B,c,N,H,l.overscaling,ct);for(let pt of je)B&&DL(l,B.text,xe,pt)||He(et,pt,C)}else if(pe==="line-center"){for(let et of e.geometry)if(et.length>1){let je=wL(et,ne,r.vertical||B,c,N,H);je&&He(et,je,C)}}else if(e.type==="Polygon")for(let et of $_(e.geometry,0)){let je=ML(et,16);He(et[0],new Ua(je.x,je.y,0,0,void 0),C)}else if(e.type==="LineString")for(let et of e.geometry)He(et,new Ua(et[0].x,et[0].y,0,0,void 0),C);else if(e.type==="Point")for(let et of e.geometry)for(let je of et)He([je],new Ua(je.x,je.y,0,0,void 0),C)}let om=255,oc=om*Is;function MS(l,e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L,F){let B=function(U,H,J,oe,ee,ne,ge,te){let pe=[];if(H.positionedLines.length===0)return pe;let xe=oe.layout.get("text-rotate").evaluate(ne,{})*Math.PI/180,be=function(He){let et=He[0],je=He[1],pt=et*je;return pt>0?[et,-je]:pt<0?[-et,je]:et===0?[je,et]:[je,-et]}(J),Se=Math.abs(H.top-H.bottom);for(let He of H.positionedLines)Se-=He.lineOffset;let Re=H.positionedLines.length,Le=Se/Re,De=H.top-J[1];for(let He=0;He<Re;++He){let et=H.positionedLines[He];De=EL(H,Le,De,He);for(let je of et.positionedGlyphs){if(!je.rect)continue;let pt=je.rect||{},at=oS+1,rt=!0,Qe=1,Dt=0;if(je.imageName){let Ai=ge[je.imageName];if(!Ai)continue;if(Ai.sdf){xn("SDF images are not supported in formatted text and will be ignored.");continue}rt=!1,Qe=Ai.pixelRatio,at=im/Qe}let ft=(ee||te)&&je.vertical,yt=je.metrics.advance*je.scale/2,Gt=je.metrics,tn=je.rect;if(tn===null)continue;te&&H.verticalizable&&(Dt=je.imageName?yt-je.metrics.width*je.scale/2:0);let rn=ee?[je.x+yt,je.y]:[0,0],Qt=[0,0],dn=[0,0],cn=!1;ee||(ft?(dn=[je.x+yt+be[0],je.y+be[1]-Dt],cn=!0):Qt=[je.x+yt+J[0],je.y+J[1]-Dt]);let ii=tn.w*je.scale/(Qe*(je.localGlyph?Ds:1)),Yn=tn.h*je.scale/(Qe*(je.localGlyph?Ds:1)),Nt,kn,Vn,hi;if(ft){let Ai=je.y-De,Ei=new lt(-yt,yt-Ai),Ri=-Math.PI/2,ji=new lt(...dn);Nt=new lt(-yt+Qt[0],Qt[1]),Nt._rotateAround(Ri,Ei)._add(ji),Nt.x+=-Ai+yt,Nt.y-=(Gt.left-at)*je.scale;let dr=je.imageName?Gt.advance*je.scale:ur*je.scale,li=String.fromCodePoint(je.glyph);fL(li)?Nt.x+=(1-at)*je.scale:pL(li)?Nt.x+=dr-Gt.height*je.scale+(-at-1)*je.scale:Nt.x+=je.imageName||Gt.width+2*at===tn.w&&Gt.height+2*at===tn.h?(dr-Yn)/2:(dr-(Gt.height+2*at)*je.scale)/2,kn=new lt(Nt.x,Nt.y-ii),Vn=new lt(Nt.x+Yn,Nt.y),hi=new lt(Nt.x+Yn,Nt.y-ii)}else{let Ai=(Gt.left-at)*je.scale-yt+Qt[0],Ei=(-Gt.top-at)*je.scale+Qt[1],Ri=Ai+ii,ji=Ei+Yn;Nt=new lt(Ai,Ei),kn=new lt(Ri,Ei),Vn=new lt(Ai,ji),hi=new lt(Ri,ji)}if(xe){let Ai;Ai=ee?new lt(0,0):cn?new lt(be[0],be[1]):new lt(J[0],J[1]),Nt._rotateAround(xe,Ai),kn._rotateAround(xe,Ai),Vn._rotateAround(xe,Ai),hi._rotateAround(xe,Ai)}let Di=new lt(0,0),Fi=new lt(0,0);pe.push({tl:Nt,tr:kn,bl:Vn,br:hi,texPrimary:pt,texSecondary:void 0,writingMode:H.writingMode,glyphOffset:rn,sectionIndex:je.sectionIndex,isSDF:rt,pixelOffsetTL:Di,pixelOffsetBR:Fi,minFontScaleX:0,minFontScaleY:0})}}return pe}(0,c,E,u,m,v,p,l.allowVerticalPlacement),V=l.textSizeData,N=null;V.kind==="source"?(N=[Is*u.layout.get("text-size").evaluate(v,{},L)*M.textScaleFactor],N[0]>oc&&xn(`${l.layerIds[0]}: Value for "text-size" is >= ${om}. Reduce your "text-size".`)):V.kind==="composite"&&(N=[Is*M.compositeTextSizes[0].evaluate(v,{},L)*M.textScaleFactor,Is*M.compositeTextSizes[1].evaluate(v,{},L)*M.textScaleFactor],(N[0]>oc||N[1]>oc)&&xn(`${l.layerIds[0]}: Value for "text-size" is >= ${om}. Reduce your "text-size".`)),l.addSymbols(l.text,B,N,E,m,v,_,e,r,T.lineStartIndex,T.lineLength,w,D,L,F,!1);for(let U of C)S[U]=l.text.placedSymbolArray.length-1;return 4*B.length}function SS(l){for(let e in l)return l[e];return null}function ny(l,e,r,c,p,u,m,v,E,T){let _=m.top,C=m.bottom,S=m.left,w=m.right,M=m.collisionPadding;if(M&&(S-=M[0],_-=M[1],w+=M[2],C+=M[3]),E){let D=new lt(S,_),L=new lt(w,_),F=new lt(S,C),B=new lt(w,C),V=pn(E),N=new lt(0,0);T&&(N=new lt(T[0],T[1])),D._rotateAround(V,N),L._rotateAround(V,N),F._rotateAround(V,N),B._rotateAround(V,N),S=Math.min(D.x,L.x,F.x,B.x),w=Math.max(D.x,L.x,F.x,B.x),_=Math.min(D.y,L.y,F.y,B.y),C=Math.max(D.y,L.y,F.y,B.y)}return l.emplaceBack(e.x,e.y,e.z,r.x,r.y,S,_,w,C,v,c,p,u),l.length-1}function m1(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);let e=l.bottom-l.top;return e>0?Math.max(10,e):null}function DL(l,e,r,c){let p=l.compareText;if(e in p){let u=p[e];for(let m=u.length-1;m>=0;m--)if(c.dist(u[m])<r)return!0}else p[e]=[];return p[e].push(c),!1}function TS(l,e){let r=l.fovAboveCenter,c=l.elevation?l.elevation.getMinElevationBelowMSL()*e:0,p=(l._camera.position[2]*l.worldSize-c)/Math.cos(l._pitch),u=Math.sin(r)*p/Math.sin(Math.max(Math.PI/2-l._pitch-r,.01)),m=Math.sin(l._pitch)*u+p,v=p*(1/l._horizonShift);return l.elevation&&l.elevation.exaggeration()!==0||(m*=1+Math.max(l.zoom-17,0)),Math.min(1.01*m,v)}function sm(l,e){if(!e.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:e};let r=Math.pow(2,-l.z),c=l.x*r,p=(l.x+1)*r,u=l.y*r,m=(l.y+1)*r,v=Q(c),E=Q(p),T=ie(u),_=ie(m),C=e.project(v,T),S=e.project(E,T),w=e.project(E,_),M=e.project(v,_),D=Math.min(C.x,S.x,w.x,M.x),L=Math.min(C.y,S.y,w.y,M.y),F=Math.max(C.x,S.x,w.x,M.x),B=Math.max(C.y,S.y,w.y,M.y),V=r/16;function N(H,J,oe,ee,ne,ge){let te=(oe+ne)/2,pe=(ee+ge)/2,xe=e.project(Q(te),ie(pe)),be=Math.max(0,D-xe.x,L-xe.y,xe.x-F,xe.y-B);D=Math.min(D,xe.x),F=Math.max(F,xe.x),L=Math.min(L,xe.y),B=Math.max(B,xe.y),be>V&&(N(H,xe,oe,ee,te,pe),N(xe,J,te,pe,ne,ge))}N(C,S,c,u,p,u),N(S,w,p,u,p,m),N(w,M,p,m,c,m),N(M,C,c,m,c,u),D-=V,L-=V,F+=V,B+=V;let U=1/Math.max(F-D,B-L);return{scale:U,x:D*U,y:L*U,x2:F*U,y2:B*U,projection:e}}function IS(l,{x:e,y:r},c=0){return new lt(((e-c)*l.scale-l.x)*ct,(r*l.scale-l.y)*ct)}let AL=Ee.mat4.identity(new Float32Array(16));class sc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new P(0,0)}projectTilePoint(e,r,c){return{x:e,y:r,z:0}}locationPoint(e,r,c=!0){return e._coordinatePoint(e.locationCoordinate(r),c)}pixelsPerMeter(e,r){return Z(1,e)*r}pixelSpaceConversion(e,r,c){return 1}farthestPixelDistance(e){return TS(e,e.pixelsPerMeter)}pointCoordinate(e,r,c,p){let u=e.horizonLineFromTop(!1),m=new lt(r,Math.max(u,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,p))}pointCoordinate3D(e,r,c){let p=new lt(r,c);if(e.elevation)return e.elevation.pointCoordinate(p);{let u=this.pointCoordinate(e,p.x,p.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);let c=e.horizonLineFromTop();return r.y<c}createInversionMatrix(e,r){return AL}createTileMatrix(e,r,c){let p,u,m,v=c.canonical,E=Ee.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let T=sm(v,this);p=1,u=T.x+c.wrap*T.scale,m=T.y,Ee.mat4.scale(E,E,[p/T.scale,p/T.scale,e.pixelsPerMeter/r])}else p=r/e.zoomScale(v.z),u=(v.x+Math.pow(2,v.z)*c.wrap)*p,m=v.y*p;return Ee.mat4.translate(E,E,[u,m,0]),Ee.mat4.scale(E,E,[p/ct,p/ct,1]),E}upVector(e,r,c){return[0,0,1]}upVectorScale(e,r,c){return{metersToTile:1}}}class PL extends sc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[r,c]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(pn(r));this.n=(p+Math.sin(pn(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,r){let{n:c,c:p,r0:u}=this,m=pn(e-this.center[0]),v=pn(r),E=Math.sqrt(p-2*c*Math.sin(v))/c;return{x:E*Math.sin(m*c),y:E*Math.cos(m*c)-u,z:0}}unproject(e,r){let{n:c,c:p,r0:u}=this,m=u+r,v=Math.atan2(e,Math.abs(m))*Math.sign(m);m*c<0&&(v-=Math.PI*Math.sign(e)*Math.sign(m));let E=pn(this.center[0])*c;v=ps(v,-Math.PI-E,Math.PI-E);let T=Wt(Ki(v/c)+this.center[0],-180,180),_=Math.asin(Wt((p-(e*e+m*m)*c*c)/(2*c),-1,1)),C=Wt(Ki(_),-ae,ae);return new P(T,C)}}let am=1.340264,lm=-.081106,cm=893e-6,um=.003796,iy=Math.sqrt(3)/2;class RL extends sc{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;let c=Math.asin(iy*Math.sin(r)),p=c*c,u=p*p*p;return{x:.5*(e*Math.cos(c)/(iy*(am+3*lm*p+u*(7*cm+9*um*p)))/Math.PI+.5),y:1-.5*(c*(am+lm*p+u*(cm+um*p))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,p=c*c,u=p*p*p;for(let _,C,S,w=0;w<12&&(C=c*(am+lm*p+u*(cm+um*p))-r,S=am+3*lm*p+u*(7*cm+9*um*p),_=C/S,c=Wt(c-_,-Math.PI/3,Math.PI/3),p=c*c,u=p*p*p,!(Math.abs(_)<1e-12));++w);let m=iy*e*(am+3*lm*p+u*(7*cm+9*um*p))/Math.cos(c),v=Math.asin(Math.sin(c)/iy),E=Wt(180*m/Math.PI,-180,180),T=Wt(180*v/Math.PI,-ae,ae);return new P(E,T)}}class OL extends sc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){let c=360*(e-.5),p=Wt(360*(.5-r),-ae,ae);return new P(c,p)}}let hh=Math.PI/2;function ry(l){return Math.tan((hh+l)/2)}class LL extends sc{constructor(e){super(e),this.center=e.center||[0,30];let[r,c]=this.parallels=e.parallels||[30,30],p=pn(r),u=pn(c);this.southernCenter=p+u<0,this.southernCenter&&(p=-p,u=-u);let m=Math.cos(p),v=ry(p);this.n=p===u?Math.sin(p):Math.log(m/Math.cos(u))/Math.log(ry(u)/v),this.f=m*Math.pow(ry(p),this.n)/this.n}project(e,r){r=pn(r),this.southernCenter&&(r=-r),e=pn(e-this.center[0]);let c=1e-6,{n:p,f:u}=this;u>0?r<-hh+c&&(r=-hh+c):r>hh-c&&(r=hh-c);let m=u/Math.pow(ry(r),p),v=m*Math.sin(p*e),E=u-m*Math.cos(p*e);return v=.5*(v/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:v,y:this.southernCenter?E:1-E,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;let{n:c,f:p}=this,u=p-r,m=Math.sign(u),v=Math.sign(c)*Math.sqrt(e*e+u*u),E=Math.atan2(e,Math.abs(u))*m;u*c<0&&(E-=Math.PI*Math.sign(e)*m);let T=Wt(Ki(E/c)+this.center[0],-180,180),_=Wt(Ki(2*Math.atan(Math.pow(p/v,1/c))-hh),-ae,ae);return new P(T,this.southernCenter?-_:_)}}class DS extends sc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:q(e),y:X(r),z:0}}unproject(e,r){let c=Q(e),p=ie(r);return new P(c,p)}}let AS=pn(ae);class FL extends sc{project(e,r){let c=(r=pn(r))*r,p=c*c;return{x:.5*((e=pn(e))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,p=25,u=0,m=c*c;do{m=c*c;let T=m*m;u=(c*(1.007226+m*(.015085+T*(.028874*m-.044475-.005916*T)))-r)/(1.007226+m*(.045255+T*(.259866*m-.311325-.005916*11*T))),c=Wt(c-u,-AS,AS)}while(Math.abs(u)>1e-6&&--p>0);m=c*c;let v=Wt(Ki(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),E=Ki(c);return new P(v,E)}}let PS=pn(ae);class kL extends sc{project(e,r){r=pn(r),e=pn(e);let c=Math.cos(r),p=2/Math.PI,u=Math.acos(c*Math.cos(e/2)),m=Math.sin(u)/u,v=.5*(e*p+2*c*Math.sin(e/2)/m)||0,E=.5*(r+Math.sin(r)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,r){let c=e=(2*e-.5)*Math.PI,p=r=(2*(1-r)-1)*Math.PI,u=25,m=1e-6,v=0,E=0;do{let T=Math.cos(p),_=Math.sin(p),C=2*_*T,S=_*_,w=T*T,M=Math.cos(c/2),D=Math.sin(c/2),L=2*M*D,F=D*D,B=1-w*M*M,V=B?1/B:0,N=B?Math.acos(T*M)*Math.sqrt(1/B):0,U=.5*(2*N*T*D+2*c/Math.PI)-e,H=.5*(N*_+p)-r,J=.5*V*(w*F+N*T*M*S)+1/Math.PI,oe=V*(L*C/4-N*_*D),ee=.125*V*(C*D-N*_*w*L),ne=.5*V*(S*M+N*F*T)+.5,ge=oe*ee-ne*J;v=(H*oe-U*ne)/ge,E=(U*ee-H*J)/ge,c=Wt(c-v,-Math.PI,Math.PI),p=Wt(p-E,-PS,PS)}while((Math.abs(v)>m||Math.abs(E)>m)&&--u>0);return new P(Ki(c),Ki(p))}}class RS extends sc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){let{scale:c,cosPhi:p}=this;return{x:pn(e)*p*c+.5,y:-Math.sin(pn(r))/p*c+.5,z:0}}unproject(e,r){let{scale:c,cosPhi:p}=this,u=-(r-.5)/c,m=Wt(Ki((e-.5)/c)/p,-180,180),v=Math.asin(Wt(u*p,-1,1)),E=Wt(Ki(v),-ae,ae);return new P(m,E)}}class NL extends DS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,c){let p=Gp(e,r,c),u=B_(ta(c));return Ee.vec3.transformMat4(p,p,u),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,r){let c=I(r.lat,r.lng),p=Ee.vec3.normalize([],c),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,m=Z(1,0)*ct*u;Ee.vec3.scaleAndAdd(c,c,p,m);let v=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.multiply(v,e.pixelMatrix,e.globeMatrix),Ee.vec3.transformMat4(c,c,v),new lt(c[0],c[1])}pixelsPerMeter(e,r){return Z(1,0)*r}pixelSpaceConversion(e,r,c){let p=Z(1,e)*r,u=kt(Z(1,45)*r,p,c);return this.pixelsPerMeter(e,r)/u}createTileMatrix(e,r,c){let p=zx(ta(c.canonical));return Ee.mat4.multiply(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,r){let{center:c}=e,p=B_(ta(r));return Ee.mat4.rotateY(p,p,pn(c.lng)),Ee.mat4.rotateX(p,p,pn(c.lat)),Ee.mat4.scale(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,r,c,p){return ec(e,r,c,!0)||new we(0,0)}pointCoordinate3D(e,r,c){let p=this.pointCoordinate(e,r,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,r){return!ec(e,r.x,r.y,!1)}farthestPixelDistance(e){let r=function(p,u){let m=p.cameraToCenterDistance,v=p._centerAltitude*u,E=p._camera,T=p._camera.forward(),_=Ee.vec3.add([],Ee.vec3.scale([],T,-m),[0,0,v]),C=p.worldSize/(2*Math.PI),S=[0,0,-C],w=p.width/p.height,M=Math.tan(p.fovAboveCenter),D=Ee.vec3.scale([],E.up(),M),L=Ee.vec3.scale([],E.right(),M*w),F=Ee.vec3.normalize([],Ee.vec3.add([],Ee.vec3.add([],T,D),L)),B=[],V;if(new Or(_,F).closestPointOnSphere(S,C,B)){let N=Ee.vec3.add([],B,S),U=Ee.vec3.sub([],N,_);V=Math.cos(p.fovAboveCenter)*Ee.vec3.length(U)}else{let N=Ee.vec3.sub([],_,S),U=Ee.vec3.sub([],S,_);Ee.vec3.normalize(U,U);let H=Ee.vec3.length(N)-C;V=Math.sqrt(H*(H+2*C));let J=Math.acos(V/(C+H))-Math.acos(Ee.vec3.dot(T,U));V*=Math.cos(J)}return 1.01*V}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=tc(e.zoom);if(c>0){let p=TS(e,Z(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return kt(r,p+u*(1-Math.cos(m)),Math.pow(c,10))}return r}upVector(e,r,c){return Gp(r,c,e,1)}upVectorScale(e){return{metersToTile:Ql(z_(ta(e)))}}}function OS(l){let e=l.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(l.name){case"mercator":return new DS(l);case"equirectangular":return new OL(l);case"naturalEarth":return new FL(l);case"equalEarth":return new RL(l);case"winkelTripel":return new kL(l);case"albers":return r?new RS(l):new PL(l);case"lambertConformalConic":return r?new RS(l):new LL(l);case"globe":return new NL(l)}throw new Error(`Invalid projection name: ${l.name}`)}let zL=ah.VectorTileFeature.types,BL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function oy(l,e,r,c,p,u,m,v,E,T,_,C,S){let w=v?Math.min(oc,Math.round(v[0])):0,M=v?Math.min(oc,Math.round(v[1])):0;l.emplaceBack(e,r,Math.round(32*c),Math.round(32*p),u,m,(w<<1)+(E?1:0),M,16*T,16*_,256*C,256*S)}function sy(l,e,r){l.emplaceBack(e,r)}function ay(l,e,r,c,p,u,m){l.emplaceBack(e,r,c,p,u,m)}function ly(l,e,r,c,p){l.emplaceBack(e,r,c,p),l.emplaceBack(e,r,c,p),l.emplaceBack(e,r,c,p),l.emplaceBack(e,r,c,p)}function VL(l){for(let e of l.sections)if(Ex(e.text))return!0;return!1}class g1{constructor(e){this.layoutVertexArray=new ql,this.indexArray=new _i,this.programConfigurations=e,this.segments=new Mi,this.dynamicLayoutVertexArray=new bs,this.opacityVertexArray=new Pp,this.placedSymbolArray=new kp,this.iconTransitioningVertexArray=new ea,this.globeExtVertexArray=new Ap,this.zOffsetVertexArray=new Yl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,c,p,u){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,oL.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,BL,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,aL.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,rL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,sL.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}gt(g1,"SymbolBuffers");class _1{constructor(e,r,c){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new c,this.segments=new Mi,this.collisionVertexArray=new Zl,this.collisionVertexArrayExt=new bs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,lL.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,cL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}gt(_1,"CollisionBuffers");class cy{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ee.mat4.identity([]),this.placementViewportMatrix=Ee.mat4.identity([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=o1(this.zoom,r["text-size"]),this.iconSizeData=o1(this.zoom,r["icon-size"]);let c=this.layers[0].layout,p=c.get("symbol-sort-key"),u=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Oo[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new g1(new Wo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new g1(new Wo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new S_,this.lineVertexArray=new nh,this.symbolInstances=new Np}calculateGlyphDependencies(e,r,c,p,u){for(let m of e){let v=m.codePointAt(0);if(v===void 0)break;if(r[v]=!0,p&&u&&v<=65535){let E=tm[m];E&&(r[E.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let c=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Kx(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(e,r,c,p){let u=this.layers[0],m=u.layout,v=this.projection.name==="globe",E=m.get("text-font"),T=m.get("text-field"),_=m.get("icon-image"),C=(T.value.kind!=="constant"||T.value.value instanceof gr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),S=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,w=m.get("symbol-sort-key");if(this.features=[],!C&&!S)return;let M=r.iconDependencies,D=r.glyphDependencies,L=r.availableImages,F=new bi(this.zoom);for(let{feature:B,id:V,index:N,sourceLayerIndex:U}of e){let H=u._featureFilter.needGeometry,J=Ze(B,H);if(!u._featureFilter.filter(F,J,c))continue;if(H||(J.geometry=Ie(B,c,p)),v&&B.type!==1&&c.z<=5){let ge=J.geometry,te=.98078528056,pe=(xe,be)=>{let Se=Gp(xe.x,xe.y,c,1),Re=Gp(be.x,be.y,c,1);return Ee.vec3.dot(Se,Re)<te};for(let xe=0;xe<ge.length;xe++)ge[xe]=Ue(ge[xe],pe)}let oe,ee;if(C){let ge=u.getValueAndResolveTokens("text-field",J,c,L),te=gr.factory(ge);VL(te)&&(this.hasRTLText=!0),(!this.hasRTLText||wp()==="unavailable"||this.hasRTLText&&Yr.isParsed())&&(oe=hL(te,u,J))}if(S){let ge=u.getValueAndResolveTokens("icon-image",J,c,L);ee=ge instanceof Er?ge:Er.fromString(ge)}if(!oe&&!ee)continue;let ne=this.sortFeaturesByKey?w.evaluate(J,{},c):void 0;if(this.features.push({id:V,text:oe,icon:ee,index:N,sourceLayerIndex:U,geometry:J.geometry,properties:B.properties,type:zL[B.type],sortKey:ne}),ee&&(M[ee.namePrimary]=!0,ee.nameSecondary&&(M[ee.nameSecondary]=!0)),oe){let ge=E.evaluate(J,{},c).join(","),te=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Oo.vertical)>=0;for(let pe of oe.sections)if(pe.image)M[pe.image.namePrimary]=!0;else{let xe=_p(oe.toString()),be=pe.fontStack||ge,Se=D[be]=D[be]||{};this.calculateGlyphDependencies(pe.text,Se,te,this.allowVerticalPlacement,xe)}}}m.get("symbol-placement")==="line"&&(this.features=function(B){let V={},N={},U=[],H=0;function J(ge){U.push(B[ge]),H++}function oe(ge,te,pe){let xe=N[ge];return delete N[ge],N[te]=xe,U[xe].geometry[0].pop(),U[xe].geometry[0]=U[xe].geometry[0].concat(pe[0]),xe}function ee(ge,te,pe){let xe=V[te];return delete V[te],V[ge]=xe,U[xe].geometry[0].shift(),U[xe].geometry[0]=pe[0].concat(U[xe].geometry[0]),xe}function ne(ge,te,pe){let xe=pe?te[0][te[0].length-1]:te[0][0];return`${ge}:${xe.x}:${xe.y}`}for(let ge=0;ge<B.length;ge++){let te=B[ge],pe=te.geometry,xe=te.text?te.text.toString():null;if(!xe){J(ge);continue}let be=ne(xe,pe),Se=ne(xe,pe,!0);if(be in N&&Se in V&&N[be]!==V[Se]){let Re=ee(be,Se,pe),Le=oe(be,Se,U[Re].geometry);delete V[be],delete N[Se],N[ne(xe,U[Le].geometry,!0)]=Le,U[Re].geometry=null}else be in N?oe(be,Se,pe):Se in V?ee(be,Se,pe):(J(ge),V[be]=H-1,N[Se]=H-1)}return U.filter(ge=>ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((B,V)=>B.sortKey-V.sortKey)}update(e,r,c,p,u){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let v=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,v,c,p,u),this.icon.programConfigurations.updatePaintArrays(e,r,v,c,p,u)}updateZOffset(){let e=(u,m,v)=>{c+=m,c>u.length&&u.resize(c);for(let E=-m;E<0;E++)u.emplace(E+c,v)},r=(u,m,v)=>{p+=m,p>u.length&&u.resize(p);for(let E=-m;E<0;E++)u.emplace(E+p,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,p=0;for(let u=0;u<this.symbolInstances.length;u++){let m=this.symbolInstances.get(u),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:E,numIconVertices:T}=m,_=m.zOffset,C=T>0;if((v>0||E>0)&&(e(this.text.zOffsetVertexArray,v,_),e(this.text.zOffsetVertexArray,E,_)),C){let{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:w}=m;S>=0&&r(this.icon.zOffsetVertexArray,T,_),w>=0&&r(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=OS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){let c=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:p,y:u}of r)this.lineVertexArray.emplaceBack(p,u);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,r,c,p,u,m,v,E,T,_,C,S,w,M,D,L){let F=e.indexArray,B=e.layoutVertexArray,V=e.globeExtVertexArray,N=e.segments.prepareSegment(4*r.length,B,F,this.canOverlap?m.sortKey:void 0),U=this.glyphOffsetArray.length,H=N.vertexLength,J=this.allowVerticalPlacement&&v===Oo.vertical?Math.PI/2:0,oe=m.text&&m.text.sections;for(let ne=0;ne<r.length;ne++){let{tl:ge,tr:te,bl:pe,br:xe,texPrimary:be,texSecondary:Se,pixelOffsetTL:Re,pixelOffsetBR:Le,minFontScaleX:De,minFontScaleY:He,glyphOffset:et,isSDF:je,sectionIndex:pt}=r[ne],at=N.vertexLength,rt=et[1];if(oy(B,T.x,T.y,ge.x,rt+ge.y,be.x,be.y,c,je,Re.x,Re.y,De,He),oy(B,T.x,T.y,te.x,rt+te.y,be.x+be.w,be.y,c,je,Le.x,Re.y,De,He),oy(B,T.x,T.y,pe.x,rt+pe.y,be.x,be.y+be.h,c,je,Re.x,Le.y,De,He),oy(B,T.x,T.y,xe.x,rt+xe.y,be.x+be.w,be.y+be.h,c,je,Le.x,Le.y,De,He),E){let{x:Qe,y:Dt,z:ft}=E.anchor,[yt,Gt,tn]=E.up;ay(V,Qe,Dt,ft,yt,Gt,tn),ay(V,Qe,Dt,ft,yt,Gt,tn),ay(V,Qe,Dt,ft,yt,Gt,tn),ay(V,Qe,Dt,ft,yt,Gt,tn),ly(e.dynamicLayoutVertexArray,Qe,Dt,ft,J)}else ly(e.dynamicLayoutVertexArray,T.x,T.y,T.z,J);if(L){let Qe=Se||be;sy(e.iconTransitioningVertexArray,Qe.x,Qe.y),sy(e.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y),sy(e.iconTransitioningVertexArray,Qe.x,Qe.y+Qe.h),sy(e.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y+Qe.h)}F.emplaceBack(at,at+1,at+2),F.emplaceBack(at+1,at+2,at+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(et[0]),ne!==r.length-1&&pt===r[ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,m,m.index,{},w,M,D,oe&&oe[pt])}let ee=E?E.anchor:T;e.placedSymbolArray.emplaceBack(ee.x,ee.y,ee.z,T.x,T.y,U,this.glyphOffsetArray.length-U,H,_,C,T.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],v,0,!1,0,S,0)}_commitLayoutVertex(e,r,c,p,u,m,v){e.emplaceBack(r,c,p,u,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,r,c,p,u,m,v){let E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),T=E.vertexLength,_=v.tileAnchorX,C=v.tileAnchorY;for(let w=0;w<4;w++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,r,e.padding,v.zOffset),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,_,C,new lt(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,_,C,new lt(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,_,C,new lt(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,_,C,new lt(e.x1,e.y2)),E.vertexLength+=4;let S=c.indexArray;S.emplaceBack(T,T+1),S.emplaceBack(T+1,T+2),S.emplaceBack(T+2,T+3),S.emplaceBack(T+3,T),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,c,p,u,m){for(let v=p;v<u;v++){let E=c.get(v),T=this.getSymbolInstanceTextSize(e,m,r,v);this._addCollisionDebugVertices(E,T,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,c,p,u,m){for(let v=p;v<u;v++){let E=c.get(v),T=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(E,T,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _1(Yd,tS.members,ea),this.iconCollisionBox=new _1(Yd,tS.members,ea);let p=lh(this.iconSizeData,e),u=lh(this.textSizeData,e,c);for(let m=0;m<this.symbolInstances.length;m++){let v=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(u,e,r,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(u,e,r,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(p,e,r,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(p,e,r,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,r,c,p){let u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:p),m=Y_(this.textSizeData,e,u)/ur;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,c){let p=this.icon.placedSymbolArray.get(c),u=Y_(this.iconSizeData,e,p);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,r,c,p){e.emplaceBack(r,-c,-c,p),e.emplaceBack(r,c,-c,p),e.emplaceBack(r,c,c,p),e.emplaceBack(r,-c,c,p)}_updateTextDebugCollisionBoxes(e,r,c,p,u,m,v){for(let E=p;E<u;E++){let T=c.get(E),_=this.getSymbolInstanceTextSize(e,m,r,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,T.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,r,c,p,u,m,v){for(let E=p;E<u;E++){let T=c.get(E),_=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,T.padding,m.zOffset)}}updateCollisionDebugBuffers(e,r,c,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let u=lh(this.iconSizeData,e,p),m=lh(this.textSizeData,e,c);for(let v=0;v<this.symbolInstances.length;v++){let E=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(m,e,r,E.textBoxStartIndex,E.textBoxEndIndex,E,c),this._updateTextDebugCollisionBoxes(m,e,r,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,c),this._updateIconDebugCollisionBoxes(u,e,r,E.iconBoxStartIndex,E.iconBoxEndIndex,E,p),this._updateIconDebugCollisionBoxes(u,e,r,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,c,p,u,m,v,E,T){let _={};if(r<c){let{x1:C,y1:S,x2:w,y2:M,padding:D,projectedAnchorX:L,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:U}=e.get(r);_.textBox={x1:C,y1:S,x2:w,y2:M,padding:D,projectedAnchorX:L,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.textFeatureIndex=U}if(p<u){let{x1:C,y1:S,x2:w,y2:M,padding:D,projectedAnchorX:L,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:U}=e.get(p);_.verticalTextBox={x1:C,y1:S,x2:w,y2:M,padding:D,projectedAnchorX:L,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.verticalTextFeatureIndex=U}if(m<v){let{x1:C,y1:S,x2:w,y2:M,padding:D,projectedAnchorX:L,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:U}=e.get(m);_.iconBox={x1:C,y1:S,x2:w,y2:M,padding:D,projectedAnchorX:L,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.iconFeatureIndex=U}if(E<T){let{x1:C,y1:S,x2:w,y2:M,padding:D,projectedAnchorX:L,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:U}=e.get(E);_.verticalIconBox={x1:C,y1:S,x2:w,y2:M,padding:D,projectedAnchorX:L,projectedAnchorY:F,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.verticalIconFeatureIndex=U}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let c=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){let c=e.placedSymbolArray.get(r),p=c.vertexStartIndex+4*c.numGlyphs;for(let u=c.vertexStartIndex;u<p;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(e),c=Math.cos(e),p=[],u=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);let E=this.symbolInstances.get(v);p.push(0|Math.round(r*E.tileAnchorX+c*E.tileAnchorY)),u.push(E.featureIndex)}return m.sort((v,E)=>p[v]-p[E]||u[E]-u[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){let c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===r?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let c=this.symbolInstances.get(r);this.featureSortOrder.push(c.featureIndex);let{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:T}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),u>=0&&u!==p&&this.addIndicesForPlacedSymbol(this.text,u),m>=0&&m!==u&&m!==p&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let LS,FS,y1;gt(cy,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),cy.addDynamicAttributes=ly;class kS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:To,this.defaultValue=e}evaluate(e){if(e.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gt(kS,"FormatSectionOverride",{omit:["defaultValue"]});let v1=()=>y1||(y1={layout:LS||(LS=new si({"symbol-placement":new ot(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new ot(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ot(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ot(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ot(Oe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ot(Oe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ot(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ot(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new ot(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ot(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(Oe.layout_symbol["icon-size"]),"icon-size-scale-range":new ot(Oe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Tt(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tt(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(Oe.layout_symbol["icon-image"]),"icon-rotate":new Tt(Oe.layout_symbol["icon-rotate"]),"icon-padding":new ot(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new ot(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Tt(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ot(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ot(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ot(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(Oe.layout_symbol["text-field"]),"text-font":new Tt(Oe.layout_symbol["text-font"]),"text-size":new Tt(Oe.layout_symbol["text-size"]),"text-size-scale-range":new ot(Oe.layout_symbol["text-size-scale-range"]),"text-max-width":new Tt(Oe.layout_symbol["text-max-width"]),"text-line-height":new Tt(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Tt(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ot(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Tt(Oe.layout_symbol["text-anchor"]),"text-max-angle":new ot(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new ot(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(Oe.layout_symbol["text-rotate"]),"text-padding":new ot(Oe.layout_symbol["text-padding"]),"text-keep-upright":new ot(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Tt(Oe.layout_symbol["text-transform"]),"text-offset":new Tt(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new ot(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ot(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new ot(Oe.layout_symbol["text-optional"]),visibility:new ot(Oe.layout_symbol.visibility)})),paint:FS||(FS=new si({"icon-opacity":new Tt(Oe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Tt(Oe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Tt(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Tt(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new Tt(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Tt(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new ot(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new ot(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tt(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Tt(Oe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Tt(Oe.paint_symbol["text-occlusion-opacity"]),"text-color":new Tt(Oe.paint_symbol["text-color"],{runtimeType:Pr,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Tt(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(Oe.paint_symbol["text-halo-blur"]),"text-translate":new ot(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new ot(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ot(Oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ot(Oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ot(Oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ot(Oe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Tt(Oe.paint_symbol["symbol-z-offset"])}))},y1);class uy extends Sr{constructor(e,r,c,p){super(e,v1(),r,c,p),this._colorAdjustmentMatrix=Ee.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let c=this.layout.get("text-writing-mode");if(c){let p=[];for(let u of c)p.indexOf(u)<0&&p.push(u);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,c,p){return this._saturation===e&&this._contrast===r&&this._brightnessMin===c&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(u,m,v,E){u=K(u),m=Y(m);let T=Ee.mat4.create(),_=u/3,C=1-2*_,S=[C,_,_,0,_,C,_,0,_,_,C,0,0,0,0,1],w=.5-.5*m,M=E-v;return Ee.mat4.multiply(T,[M,0,0,0,0,M,0,0,0,0,M,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,w,w,w,1]),Ee.mat4.multiply(T,T,S),T}(e,r,c,p),this._saturation=e,this._contrast=r,this._brightnessMin=c,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,c,p){let u=this.layout.get(e).evaluate(r,{},c,p),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Nd(m.value)||!u?u:function(v,E){return E.replace(/{([^{}]+)}/g,(T,_)=>_ in v?String(v[_]):"")}(r.properties,u)}createBucket(e){return new cy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of v1().paint.overridableProperties){if(!uy.hasPaintOverride(this.layout,e))continue;let r=this.paint.get(e),c=new kS(r),p=new fp(c,r.property.specification,this.scope,this.options),u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new zd("source",p):new cu("composite",p,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Ul(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,c){return!(!this.layout||r.isDataDriven()||c.isDataDriven())&&uy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){let c=e.get("text-field"),p=v1().paint.properties[r],u=!1,m=v=>{for(let E of v)if(p.overrides&&p.overrides.hasOverride(E))return void(u=!0)};if(c.value.kind==="constant"&&c.value.value instanceof gr)m(c.value.value.sections);else if(c.value.kind==="source"){let v=T=>{u||(T instanceof Io&&Oi(T.value)===bl?m(T.value.sections):T instanceof Ml?m(T.sections):T.eachChild(v))},E=c.value;E._styleExpression&&v(E._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,c){return{config:new Ss(this,{zoom:r,lut:c}),overrideFog:!1}}}let NS,zS,BS,VS;var x1=Dn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function b1(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function w1(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class C1{constructor(e,r,c,p){this.context=e,this.format=c,this.useMipmap=p&&p.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:p&&p.premultiply})}update(e,r){let c=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,p=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:m}=u,{x:v,y:E}=r&&r.position?r.position:{x:0,y:0},T=Math.max(v+c,this.size?this.size[0]:0),_=Math.max(E+p,this.size?this.size[1]:0);!this.size||this.size[0]===T&&this.size[1]===_||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!r||r.premultiply!==!1));let C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&_>0){let S=this.useMipmap?Math.floor(Math.log2(Math.max(T,_)))+1:1;m.texStorage2D(m.TEXTURE_2D,S,this.format,T,_),this.size=[T,_]}if(this.size)if(C)m.texSubImage2D(m.TEXTURE_2D,0,v,E,b1(this.format),w1(this.format),e);else{let S=e.data;S&&m.texSubImage2D(m.TEXTURE_2D,0,v,E,c,p,b1(this.format),w1(this.format),S)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,r,c=!1){let{context:p}=this,{gl:u}=p;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,c,p){let{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),r!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),p!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class dy{constructor(e,r){this.context=e,this.texture=r}bind(e,r){let{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrapS=r)}}function hy(l,e,r,c,p,u,m,v){let E=[l,e,1,r,c,1,p,u,1],T=[m,v,1],_=Ee.mat3.adjoint([],E),[C,S,w]=Ee.vec3.transformMat3(T,T,_);return Ee.mat3.multiply(E,E,[C,0,0,0,S,0,0,0,w])}function jS(l,e,r,c,p,u,m,v){let E=function(T,_,C,S,w,M,D,L){let F=hy(0,0,1,0,1,1,0,1),B=hy(T,_,C,S,w,M,D,L),V=Ee.mat3.adjoint([],F);return Ee.mat3.multiply(B,B,V)}(l,e,r,c,p,u,m,v);return[E[2]/E[8]/ct,E[5]/E[8]/ct]}function fy(l){return[l[0],Math.min(Math.max(l[1],-ae),ae)]}class US extends vl{constructor(e,r,c,p){super(),this.id=e,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new qs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Uo(this.map._requestManager.transformRequest(this.url,dd.Image),(c,p)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Zc(c)):p&&(this.image=p instanceof HTMLImageElement?dt.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new dy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new qs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof dy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],c=e[0][1];for(let u of e)u[1]>c&&(c=u[1]),u[1]<r&&(r=u[1]);let p=(c+r)/2;if(p>ae?this.onNorthPole=!0:p<-ae&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(we.fromLngLat);this.tileID=function(m){let v=1/0,E=1/0,T=-1/0,_=-1/0;for(let D of m)v=Math.min(v,D.x),E=Math.min(E,D.y),T=Math.max(T,D.x),_=Math.max(_,D.y);let C=Math.max(T-v,_-E),S=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),w=Math.pow(2,S),M=Math.floor((v+T)/2*w);return M>1&&(M-=1),new Gi(S,M,Math.floor((E+_)/2*w))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new qs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let F in this.tiles){let B=this.tiles[F];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let r=sm(new Gi(0,0,0),this.map.transform.projection),c=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(F){let B=F[1].x-F[0].x,V=F[1].y-F[0].y,N=F[2].x-F[1].x,U=F[2].y-F[1].y,H=F[3].x-F[2].x,J=F[3].y-F[2].y,oe=F[0].x-F[3].x,ee=F[0].y-F[3].y,ne=B*U-N*V,ge=N*J-H*U,te=H*ee-oe*J,pe=oe*V-B*ee;return ne>0&&ge>0&&te>0&&pe>0||ne<0&&ge<0&&te<0&&pe<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let p=sm(this.tileID,this.map.transform.projection),[u,m,v,E]=this.coordinates.map(F=>{let B=p.projection.project(F[0],F[1]);return IS(p,B)._round()});this.perspectiveTransform=jS(u.x,u.y,m.x,m.y,v.x,v.y,E.x,E.y);let T=this._boundsArray=new Hl;T.emplaceBack(u.x,u.y,0,0),T.emplaceBack(m.x,m.y,ct,0),T.emplaceBack(E.x,E.y,0,ct),T.emplaceBack(v.x,v.y,ct,ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,x1.members),this.boundsSegments=Mi.simpleSegment(0,0,4,2);let _=[],C=[fy((S=this.coordinates)[0]),fy(S[1]),fy(S[2]),fy(S[3])];var S;let[w,M,D,L]=function(F){let B=F[0][0],V=B,N=F[0][1],U=N;for(let H=1;H<F.length;H++)F[H][0]<B?B=F[H][0]:F[H][0]>V&&(V=F[H][0]),F[H][1]<N?N=F[H][1]:F[H][1]>U&&(U=F[H][1]);return[B,N,V-B,U-N]}(C);{let F=new Hl,[B,V,N,U]=function(Re){let Le=Re[0].x,De=Le,He=Re[0].y,et=He;for(let je=1;je<Re.length;je++)Re[je].x<Le?Le=Re[je].x:Re[je].x>De&&(De=Re[je].x),Re[je].y<He?He=Re[je].y:Re[je].y>et&&(et=Re[je].y);return[Le,He,De-Le,et-He]}(c),H=Re=>[(Re.x-B)/N,(Re.y-V)/U],[J,oe,ee,ne]=c.map(H),ge=function(Re,Le,De,He,et,je,pt,at){let rt=hy(0,0,1,0,1,1,0,1),Qe=hy(Re,Le,De,He,et,je,pt,at),Dt=Ee.mat3.adjoint([],Qe);return Ee.mat3.multiply(rt,rt,Dt)}(J[0],J[1],oe[0],oe[1],ee[0],ee[1],ne[0],ne[1]);this.elevatedGlobePerspectiveTransform=jS(J[0],J[1],oe[0],oe[1],ee[0],ee[1],ne[0],ne[1]);let te=(Re,Le)=>{_.push(Re.lng);let De=Math.round((Re.lng-w)/D*ct),He=Math.round((Re.lat-M)/L*ct),et=H(Le),je=Ee.vec3.transformMat3([],[et[0],et[1],1],ge),pt=Math.round(je[0]/je[2]*ct),at=Math.round(je[1]/je[2]*ct);F.emplaceBack(De,He,pt,at)},pe=c[3].x-c[0].x,xe=c[3].y-c[0].y,be=c[2].x-c[1].x,Se=c[2].y-c[1].y;for(let Re=0;Re<65;Re++){let Le=Re/64,De=[c[0].x+Le*pe,c[0].y+Le*xe],He=[c[1].x+Le*be,c[1].y+Le*Se],et=He[0]-De[0],je=He[1]-De[1];for(let pt=0;pt<65;pt++){let at=pt/64,rt={x:De[0]+et*at,y:De[1]+je*at,z:0};te(r.projection.unproject(rt.x,rt.y),rt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(F,x1.members)}{this.maxLongitudeTriangleSize=0;let F=[],B=new _i,V=(N,U,H)=>{B.emplaceBack(N,U,H);let J=_[N],oe=_[U],ee=_[H],ne=Math.min(Math.min(J,oe),ee),ge=Math.max(Math.max(J,oe),ee)-ne;ge>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ge),F.push(ne+ge/2)};for(let N=0;N<64;N++)for(let U=0;U<64;U++){let H=65*N+U,J=H+1,oe=H+65,ee=oe+1;V(H,oe,J),V(J,oe,ee)}[F,B]=function(N,U){let H=Array.from({length:N.length},(ee,ne)=>ne);H.sort((ee,ne)=>N[ee]-N[ne]);let J=[],oe=new _i;for(let ee=0;ee<H.length;ee++){let ne=H[ee];J.push(N[ne]);let ge=3*ne,te=ge+1;oe.emplaceBack(U.uint16[ge],U.uint16[te],U.uint16[te+1])}return[J,oe]}(F,B),this.elevatedGlobeTrianglesCenterLongitudes=F,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(B)}this.elevatedGlobeSegments=Mi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,D/ct,0,L/ct,0,0,M,w,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let r=this.map.painter.context,c=r.gl;!this._dirty||this.texture instanceof dy||(this.texture?this.texture.update(this.image):(this.texture=new C1(r,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;let c=this.elevatedGlobeTrianglesCenterLongitudes,p=(u=e+180)+360*Math.round((c[0]-u)/360);var u;let m=new Mi,v=(C,S)=>{m.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:r.segments[0].vertexLength,primitiveLength:S,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-p)<=E){let C=Ve(c,0,c.length,p+E);return C===c.length||v(C,qc(c,C+1,c.length,p+360-E)-C),m}p<c[0]&&(p+=360);let T=qc(c,0,c.length,p-E);if(T===c.length)return v(0,c.length),m;v(0,T-0);let _=Ve(c,T+1,c.length,p+E);return _!==c.length&&v(_,c.length-_),m}}let jL=(Math.pow(256,2)-1)/16907520;class $S extends Sr{constructor(e,r,c,p){super(e,{layout:BS||(BS=new si({visibility:new ot(Oe.layout_raster.visibility)})),paint:VS||(VS=new si({"raster-opacity":new ot(Oe.paint_raster["raster-opacity"]),"raster-color":new Gl(Oe.paint_raster["raster-color"]),"raster-color-mix":new ot(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new ot(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new ot(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ot(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ot(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new ot(Oe.paint_raster["raster-saturation"]),"raster-contrast":new ot(Oe.paint_raster["raster-contrast"]),"raster-resampling":new ot(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new ot(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ot(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new ot(Oe.paint_raster["raster-array-band"]),"raster-elevation":new ot(Oe.paint_raster["raster-elevation"])}))},r,c,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof US&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let r=this._transitionablePaint._values["raster-color"].value.expression,[c,p]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(p)||c===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Hp({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,p])}}let GS,HS,qS,WS,ZS;class XS extends Sr{constructor(e,r,c,p){super(e,{layout:GS||(GS=new si({visibility:new ot(Oe["layout_raster-particle"].visibility)})),paint:HS||(HS=new si({"raster-particle-array-band":new ot(Oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ot(Oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Gl(Oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ot(Oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ot(Oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ot(Oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ot(Oe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ot(Oe["paint_raster-particle"]["raster-particle-elevation"])}))},r,c,p),this._updateColorRamp(),this.lastInvalidatedAt=dt.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Hp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=dt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class UL extends Sr{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function E1(l,e,r){let c=[0,0,1],p=Ee.quat.identity([]);return Ee.quat.rotateY(p,p,r?-pn(l)+Math.PI:pn(l)),Ee.quat.rotateX(p,p,-pn(e)),Ee.vec3.transformQuat(c,c,p),Ee.vec3.normalize(c,c)}function YS(l,e){let r=py(l.projection,l.zoom,l.width,l.height),c=function(u,m,v,E,T){let _=new P(v.lng-180*ac,v.lat),C=new P(v.lng+180*ac,v.lat),S=u.project(_.lng,_.lat),w=u.project(C.lng,C.lat),M=-Math.atan2(w.y-S.y,w.x-S.x),D=we.fromLngLat(v);D.y=Wt(D.y,-1+ac,1-ac);let L=D.toLngLat(),F=u.project(L.lng,L.lat),B=we.fromLngLat(L);B.x+=ac;let V=B.toLngLat(),N=u.project(V.lng,V.lat),U=KS(N.x-F.x,N.y-F.y,M),H=we.fromLngLat(L);H.y+=ac;let J=H.toLngLat(),oe=u.project(J.lng,J.lat),ee=KS(oe.x-F.x,oe.y-F.y,M),ne=Math.abs(U.x)/Math.abs(ee.y),ge=Ee.mat4.identity([]);Ee.mat4.rotateZ(ge,ge,-M*(1-(T?0:E)));let te=Ee.mat4.identity([]);return Ee.mat4.scale(te,te,[1,1-(1-ne)*E,1]),te[4]=-ee.x/ee.y*E,Ee.mat4.rotateZ(te,te,M),Ee.mat4.multiply(te,ge,te),te}(l.projection,0,l.center,r,e),p=JS(l);return Ee.mat4.scale(c,c,[p,p,1]),c}function JS(l){let e=l.projection,r=py(l.projection,l.zoom,l.width,l.height),c=M1(e,l.center),p=M1(e,P.convert(e.center));return Math.pow(2,c*r+(1-r)*p)}function py(l,e,r,c,p=1/0){let u=l.range;if(!u)return 0;let m=Math.min(p,Math.max(r,c)),v=Math.log(m/1024)/Math.LN2;return hl(u[0]+v,u[1]+v,e)}let ac=1/4e4;function M1(l,e){let r=Wt(e.lat,-ae,ae),c=new P(e.lng-180*ac,r),p=new P(e.lng+180*ac,r),u=l.project(c.lng,r),m=l.project(p.lng,r),v=we.fromLngLat(c),E=we.fromLngLat(p),T=m.x-u.x,_=m.y-u.y,C=E.x-v.x,S=E.y-v.y,w=Math.sqrt((C*C+S*S)/(T*T+_*_));return Math.log(w)/Math.LN2}function KS(l,e,r){let c=Math.cos(r),p=Math.sin(r);return{x:l*c-e*p,y:l*p+e*c}}function QS(l,e,r){Ee.mat4.identity(l),Ee.mat4.rotateZ(l,l,pn(e[2])),Ee.mat4.rotateX(l,l,pn(e[0])),Ee.mat4.rotateY(l,l,pn(e[1])),Ee.mat4.scale(l,l,r),Ee.mat4.multiply(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function my(l,e,r,c,p,u,m,v){let E=[r[0]-e[0],r[1]-e[1],0],T=[c[0]-e[0],c[1]-e[1],0];if(Ee.vec3.length(E)<1e-12||Ee.vec3.length(T)<1e-12)return Ee.quat.identity(l);let _=Ee.vec3.cross([],E,T);Ee.vec3.normalize(_,_),Ee.vec3.subtract(T,c,e),E[2]=(u-p)*v,T[2]=(m-p)*v;let C=E;return Ee.vec3.cross(C,E,T),Ee.vec3.normalize(C,C),Ee.quat.rotationTo(l,_,C)}function S1(l,e,r=!1){let c=tc(e.zoom),p=function(u,m,v){let E=m.worldSize,T=[u[12],u[13],u[14]],_=ie(T[1]/E),C=Q(T[0]/E),S=Ee.mat4.identity([]),w=Z(1,_)*E,M=Z(1,0)*E*le(_,m.zoom),D=1/Bx(E),L=M*D;if(v){let N=py(m.projection,m.zoom,m.width,m.height,1024);L=D*m.projection.pixelSpaceConversion(m.center.lat,E,N)}let F=I(_,C);Ee.vec3.add(F,F,Ee.vec3.scale([],Ee.vec3.normalize([],F),w*L*T[2]));let B=function(N){let U=[N[0],N[1],N[2]],H=[0,1,0],J=Ee.vec3.cross([],H,U);return Ee.vec3.cross(H,U,J),Ee.vec3.squaredLength(H)===0&&(H=[0,1,0],Ee.vec3.cross(J,U,H)),Ee.vec3.normalize(J,J),Ee.vec3.normalize(H,H),Ee.vec3.normalize(U,U),[J[0],J[1],J[2],0,H[0],H[1],H[2],0,U[0],U[1],U[2],0,N[0],N[1],N[2],1]}(F);Ee.mat4.scale(S,S,[L,L,L*w]),Ee.mat4.translate(S,S,[-T[0],-T[1],-T[2]]);let V=Ee.mat4.multiply([],m.globeMatrix,B);return Ee.mat4.multiply(V,V,S),Ee.mat4.multiply(V,V,u),V}(l,e,r);if(c>0){let u=function(m,v){let E=v.worldSize,T=Z(1,0)*E*le(v.center.lat,v.zoom)/Bx(E),_=Z(1,v.center.lat)*E,C=Ee.mat4.identity([]);return Ee.mat4.rotateY(C,C,pn(v.center.lng)),Ee.mat4.rotateX(C,C,pn(v.center.lat)),Ee.mat4.translate(C,C,[0,0,cr]),Ee.mat4.scale(C,C,[T,T,T*_]),Ee.mat4.translate(C,C,[v.point.x-.5*E,v.point.y-.5*E,0]),Ee.mat4.multiply(C,C,m),Ee.mat4.multiply(C,v.globeMatrix,C)}(l,e);return function(m,v,E){let T=(M,D,L)=>{let F=Ee.vec3.length(M),B=Ee.vec3.length(D),V=ja(M,D,L);return Ee.vec3.scale(V,V,1/Ee.vec3.length(V)*kt(F,B,L))},_=T([m[0],m[1],m[2]],[v[0],v[1],v[2]],E),C=T([m[4],m[5],m[6]],[v[4],v[5],v[6]],E),S=T([m[8],m[9],m[10]],[v[8],v[9],v[10]],E),w=ja([m[12],m[13],m[14]],[v[12],v[13],v[14]],E);return[_[0],_[1],_[2],0,C[0],C[1],C[2],0,S[0],S[1],S[2],0,w[0],w[1],w[2],1]}(p,u,c)}return p}function eT(l,e,r,c){let p=Bn.projectAabbCorners(c,r),u=Number.MAX_VALUE,m=-1;for(let T=0;T<p.length;++T){let _=p[T];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<u&&(m=T,u=_[2])}let v=T=>new lt(p[T][0],p[T][1]),E;switch(m){case 0:case 6:E=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:E=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:E=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:E=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(We(l,E))return u}let $L=Dn([{name:"a_pos_3f",components:3,type:"Float32"}]),GL=Dn([{name:"a_color_3f",components:3,type:"Float32"}]),HL=Dn([{name:"a_color_4f",components:4,type:"Float32"}]),qL=Dn([{name:"a_uv_2f",components:2,type:"Float32"}]),WL=Dn([{name:"a_normal_3f",components:3,type:"Float32"}]),ZL=Dn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),XL=Dn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),tT={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class gy{constructor(e,r,c,p){this.message=(e?`${e}: `:"")+c,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function nT(l,e){let r=l.indexOf("://")===-1;try{return new URL(l,r&&e?"http://example.com":void 0),!0}catch{return!1}}class iT{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class rT{constructor(){this.instancedDataArray=new xu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class T1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,c,p){this.tileToMeter=_e(c);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:m,id:v,index:E,sourceLayerIndex:T}of e){let _=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),C=Ze(m,u);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),C,c))continue;let S={id:_,sourceLayerIndex:T,index:E,geometry:u?C.geometry:Ie(m,c,p),properties:m.properties,type:m.type,patterns:{}},w=this.addFeature(S,S.geometry,C);w&&r.featureIndex.insert(m,S.geometry,E,T,this.index,this.instancesPerModel[w].instancedDataArray.length,ct/32)}this.lookup=null}update(e,r,c,p){for(let u in this.instancesPerModel){let m=this.instancesPerModel[u];for(let v in e)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],e[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let r in this.instancesPerModel){let c=this.instancesPerModel[r];for(let p of c.features){let u=this.layers[0],m=p.feature,v=this.canonical,E=u.paint.get("model-rotation").evaluate(m,{},v),T=u.paint.get("model-scale").evaluate(m,{},v),_=u.paint.get("model-translation").evaluate(m,{},v);Ee.vec3.exactEquals(p.rotation,E)&&Ee.vec3.exactEquals(p.scale,T)&&Ee.vec3.exactEquals(p.translation,_)||(this.evaluate(p,p.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,r,c,p){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;let u=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Kx(this.activeReplacements,u))return!1;this.activeReplacements=u;let m=!1;for(let v in this.instancesPerModel){let E=this.instancesPerModel[v],T=E.instancedDataArray;for(let _ of E.features){let C=_.instancedDataOffset,S=_.instancedDataCount;for(let w=0;w<S;w++){let M=16*(w+C),D=T.float32[M+0],L=D>ct;D=L?D-ct:D;let F=Math.floor(D),B=T.float32[M+1],V=!1;for(let N of this.activeReplacements)if(!vM(N,c,tT.Model,p)&&!(N.min.x>F||F>N.max.x||N.min.y>B||B>N.max.y)&&(V=MM(EM(F,B,e.canonical,N.footprintTileId.canonical),N.footprint),V))break;T.float32[M]=V?D+ct:D,m=m||V!==L}}}return m}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let r in this.instancesPerModel){let c=this.instancesPerModel[r];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,ZL.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let r in this.instancesPerModel){let c=this.instancesPerModel[r];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,c){let p=this.layers[0],u=p.layout.get("model-id").evaluate(c,{},this.canonical);if(!u)return xn(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),u;nT(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new rT);let m=this.instancesPerModel[u],v=m.instancedDataArray,E=new iT(c,v.length);for(let T of r)for(let _ of T){if(_.x<0||_.x>=ct||_.y<0||_.y>=ct)continue;let C=(this.lookupDim-1)/ct,S=this.lookupDim*(_.y*C|0)+_.x*C|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;let w=v.length;v.resize(w+1),m.instancesEvaluatedElevation.push(0),v.float32[16*w]=_.x,v.float32[16*w+1]=_.y}return E.instancedDataCount=m.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(E),this.evaluate(E,{},m,!1)),u}getModelUris(){return this.modelUris}evaluate(e,r,c,p){let u=this.layers[0],m=e.feature,v=this.canonical,E=e.rotation=u.paint.get("model-rotation").evaluate(m,r,v),T=e.scale=u.paint.get("model-scale").evaluate(m,r,v),_=e.translation=u.paint.get("model-translation").evaluate(m,r,v),C=u.paint.get("model-color").evaluate(m,r,v);C.a=u.paint.get("model-color-mix-intensity").evaluate(m,r,v);let S=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),QS(S,E,T);let w=Math.round(100*C.a)+C.b/1.05;for(let M=0;M<e.instancedDataCount;++M){let D=e.instancedDataOffset+M,L=16*D,F=c.instancedDataArray.float32,B=0;p&&(B=F[L+6]-c.instancesEvaluatedElevation[D]);let V=0|F[L+1];F[L]=(0|F[L])+C.r/1.05,F[L+1]=V+C.g/1.05,F[L+2]=w,F[L+3]=1/(v.z>10?this.tileToMeter:_e(v,V)),F[L+4]=_[0],F[L+5]=_[1],F[L+6]=_[2]+B,F[L+7]=S[0],F[L+8]=S[1],F[L+9]=S[2],F[L+10]=S[4],F[L+11]=S[5],F[L+12]=S[6],F[L+13]=S[8],F[L+14]=S[9],F[L+15]=S[10],c.instancesEvaluatedElevation[D]=_[2]}}}let oT,sT;gt(T1,"ModelBucket",{omit:["layers"]}),gt(rT,"PerModelAttributes"),gt(iT,"ModelFeature");let Iu=64,fh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function aT(l,e,r,c,p,u,m,v,E,T=!1){let _=r.zoom,C=r.project(c),S=le(c.lat,_),w=1/S;Ee.mat4.identity(l),Ee.mat4.translate(l,l,[C.x+m[0]*w,C.y+m[1]*w,m[2]]);let M=1,D=1,L=r.worldSize;if(T){if(r.projection.name==="mercator"){let N=0;r.elevation&&(N=r.elevation.getAtPointOrZero(new we(C.x/L,C.y/L),0));let U=Ee.vec4.transformMat4([],[C.x,C.y,N,1],r.projMatrix)[3]/r.cameraToCenterDistance;M=U,D=U*le(r.center.lat,_)}else if(r.projection.name==="globe"){let N=S1(l,r),U=Ee.mat4.multiply([],r.projMatrix,N),H=[0,0,0,1];Ee.vec4.transformMat4(H,H,U);let J=H[3]/r.cameraToCenterDistance,oe=tc(_),ee=r.projection.pixelsPerMeter(c.lat,L)*le(c.lat,_),ne=r.projection.pixelsPerMeter(r.center.lat,L)*le(r.center.lat,_);M=J/kt(ee,de(r.center.lat),oe),D=J*S/ee,M*=ne,D*=ne}}else M=w;Ee.mat4.scale(l,l,[M,M,D]);let F=[...l],B=e.orientation,V=[];if(QS(V,[B[0]+p[0],B[1]+p[1],B[2]+p[2]],u),Ee.mat4.multiply(l,F,V),v&&r.elevation){let N=0,U=[];if(E&&r.elevation){N=function(oe,ee,ne,ge,te){let pe=ee.elevation;if(!pe)return 0;let xe=Bn.projectAabbCorners(ne,ge),be=Z(1,te.lat)*ee.worldSize,Se=function(Dt,ft){let yt=[0,0,1],Gt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let tn of Gt){let rn=Dt[tn.corners[0]],Qt=Dt[tn.corners[1]],dn=Dt[tn.corners[2]],cn=[Qt[0]-rn[0],Qt[1]-rn[1],ft*(Qt[2]-rn[2])],ii=Ee.vec3.cross(cn,cn,[dn[0]-rn[0],dn[1]-rn[1],ft*(dn[2]-rn[2])]);Ee.vec3.normalize(ii,ii),tn.dotProductWithUp=Ee.vec3.dot(ii,yt)}return Gt.sort((tn,rn)=>tn.dotProductWithUp-rn.dotProductWithUp),Gt[0].corners}(xe,be),Re=xe[Se[0]],Le=xe[Se[1]],De=xe[Se[2]],He=xe[Se[3]],et=pe.getAtPointOrZero(new we(Re[0]/ee.worldSize,Re[1]/ee.worldSize),0),je=pe.getAtPointOrZero(new we(Le[0]/ee.worldSize,Le[1]/ee.worldSize),0),pt=pe.getAtPointOrZero(new we(De[0]/ee.worldSize,De[1]/ee.worldSize),0),at=pe.getAtPointOrZero(new we(He[0]/ee.worldSize,He[1]/ee.worldSize),0),rt=(et+at)/2,Qe=(je+pt)/2;return rt>Qe?je<pt?my(oe,Le,He,Re,je,at,et,be):my(oe,De,Re,He,pt,et,at,be):et<at?my(oe,Re,Le,De,et,je,pt,be):my(oe,He,De,Le,at,pt,je,be),Math.max(rt,Qe)}(U,r,e.aabb,l,c);let H=Ee.mat4.fromQuat([],U),J=Ee.mat4.multiply([],H,V);Ee.mat4.multiply(l,F,J)}else N=r.elevation.getAtPointOrZero(new we(C.x/L,C.y/L),0);N!==0&&(l[14]+=N)}}function dm(l,e,r=!1){l.uploaded||(l.gfxTexture=new C1(e,l.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:l.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function YL(l,e,r){l.indexBuffer=e.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=e.createVertexBuffer(l.vertexArray,$L.members,!1,!0),l.normalArray&&(l.normalBuffer=e.createVertexBuffer(l.normalArray,WL.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=e.createVertexBuffer(l.texcoordArray,qL.members,!1,!0)),l.colorArray&&(l.colorBuffer=e.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?GL:HL).members,!1,!0)),l.featureArray&&(l.pbrBuffer=e.createVertexBuffer(l.featureArray,XL.members,!0)),l.segments=Mi.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);let c=l.material;c.pbrMetallicRoughness.baseColorTexture&&dm(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&dm(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&dm(c.normalTexture,e),c.occlusionTexture&&dm(c.occlusionTexture,e,r),c.emissionTexture&&dm(c.emissionTexture,e)}function I1(l,e,r){if(l.meshes)for(let c of l.meshes)YL(c,e,r);if(l.children)for(let c of l.children)I1(c,e,r)}function _y(l){if(l.meshes)for(let e of l.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(l.children)for(let e of l.children)_y(e)}function D1(l){if(l.meshes)for(let r of l.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(l.children)for(let r of l.children)D1(r)}class ph{constructor(e,r,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=c}static create(e,r,c){let p=c||e.findDEMTileFor(r);if(!p||!p.dem)return;let u=p.dem,m=p.tileID,v=1<<r.canonical.z-m.canonical.z;return new ph(p,u.dim/ct/v,[(r.canonical.x/v-m.canonical.x)*u.dim,(r.canonical.y/v-m.canonical.y)*u.dim])}tileCoordToPixel(e,r){let c=r*this._scale+this._offset[1],p=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(c);return new lt(p,u)}getElevationAt(e,r,c,p){let u=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],v=Math.floor(u),E=Math.floor(m),T=this._dem;return p=!!p,c?kt(kt(T.get(v,E,p),T.get(v,E+1,p),m-E),kt(T.get(v+1,E,p),T.get(v+1,E+1,p),m-E),u-v):T.get(v,E,p)}getElevationAtPixel(e,r,c){return this._dem.get(e,r,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Z(1,e)*this._dem.stride}}let A1=new Float32Array(262144),Du=new Uint8Array(262144);function lT(l){let e=0;if(l.meshes)for(let r of l.meshes)e=Math.max(e,r.aabb.max[2]);if(l.children)for(let r of l.children)e=Math.max(e,lT(r));return e}function cT(l,e,r){if(l.meshes)for(let c of l.meshes){if(c.aabb.min[0]===1/0)continue;let p=Bn.applyTransform(c.aabb,l.matrix);r.insert(e,p.min[0],p.min[1],p.max[0],p.max[1])}if(l.children)for(let c of l.children)cT(c,e,r)}let uT=["","wall","door","roof","window","lamp","logo"];class dT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:lT(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,r=new Bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=Bn.applyTransformFast(c.aabb,this.node.matrix),r.encapsulate(c.transformedAabb)),e++;this.aabb=r}return this.aabb}}class yy{constructor(e,r,c,p,u,m,v){this.id=c,this.layers=e,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=fh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=fh.HasMapboxMeshFeatures),u&&(this.modelTraits|=fh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let E of r)this.nodesInfo.push(new dT(E)),cT(E,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0)}updateFootprints(e,r){for(let c of this.getNodesInfo()){let p=c.node;p.footprint&&r.push({footprint:p.footprint,id:e})}}update(e){let r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;let c=r?this.stateDependentLayers:this.layers;for(let p of c)this.evaluate(p,e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let r=this.getNodesInfo();for(let c of r){let p=c.node;this.uploaded?this.updatePbrBuffer(p):I1(p,e,!0)}for(let c of r)_y(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(let c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),r=!0);return r}needsReEvaluation(e,r,c){let p=e.transform.projectionOptions,u=e.style.getBrightness(),m=this.brightness!==u;return!!(!this.uploaded||this.dirty||p.name!==this.projection.name||hm(c.paint.get("model-color").value,m)||hm(c.paint.get("model-color-mix-intensity").value,m)||hm(c.paint.get("model-roughness").value,m)||hm(c.paint.get("model-emissive-strength").value,m)||hm(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=p,this.brightness=u,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let c=this.getNodesInfo(),p=this.id.canonical;for(let u of c){let m=u.feature;u.evaluatedScale=r.paint.get("model-scale").evaluate(m,{},p)}}evaluate(e,r){let c=this.getNodesInfo();for(let p of c){if(!p.node.meshes)continue;let u=p.feature,m=r&&r[u.id],v=p.node.meshes&&p.node.meshes[0].featureData,E=p.evaluatedColor[2],T=p.evaluatedRMEA[2],_=this.id.canonical;if(p.hasTranslucentParts=!1,v){for(let C=0;C<uT.length;C++){let S=uT[C];S.length&&(u.properties.part=S);let w=e.paint.get("model-color").evaluate(u,m,_).toRenderColor(null),M=e.paint.get("model-color-mix-intensity").evaluate(u,m,_);p.evaluatedColor[C]=[w.r,w.g,w.b,M],p.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(u,m,_),p.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(u,m,_),p.evaluatedRMEA[C][3]=w.a,p.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,m,_),!p.hasTranslucentParts&&w.a<1&&(p.hasTranslucentParts=!0)}delete u.properties.part,KL(p,E!==p.evaluatedColor[2]||T!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,m,_);p.evaluatedScale=e.paint.get("model-scale").evaluate(u,m,_),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,c,p){let u=e.findDEMTileFor(c);if(u&&(u.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let m=ph.create(e,c,u);if(!m)return;this.modelTraits&fh.HasMapboxMeshFeatures&&this.updateDEM(e,m,c,p);for(let v of this.getNodesInfo()){let E=v.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;let T=E.footprint.vertices,_=m.getElevationAt(T[0].x,T[0].y,!0,!0);for(let C=1;C<T.length;C++)_=Math.min(_,m.getElevationAt(T[C].x,T[C].y,!0,!0));E.elevation=_}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,c,p){let u=r._dem._modifiedForSources[p];if(u===void 0&&(r._dem._modifiedForSources[p]=[],u=r._dem._modifiedForSources[p]),u.includes(c.canonical))return;let m=r._dem.dim;u.push(c.canonical);let v=!1;for(let E of this.getNodesInfo()){let T=E.node;if(!T.footprint||!T.footprint.grid)continue;let _=T.footprint.grid,C=r.tileCoordToPixel(_.min.x,_.min.y),S=r.tileCoordToPixel(_.max.x,_.max.y),w=Math.min(Math.min(m-S.y,C.x),Math.min(C.y,m-S.x));if(w<0)continue;let M=Wt(w,2,5),D=Math.max(0,C.x-M),L=Math.max(0,C.y-M),F=Math.min(S.x+M,m-1),B=Math.min(S.y+M,m-1);for(let H=L;H<=B;++H)for(let J=D;J<=F;++J)Du[H*m+J]=255;let V=0,N=0;for(let H=0;H<_.cellsY;++H)for(let J=0;J<_.cellsX;++J){if(!_.cells[H*_.cellsX+J])continue;let oe=r.tileCoordToPixel(_.min.x+J/_.xScale,_.min.y+H/_.yScale),ee=r.tileCoordToPixel(_.min.x+(J+1)/_.xScale,_.min.y+(H+1)/_.yScale);for(let ne=oe.y;ne<=Math.min(ee.y+1,m-1);++ne)for(let ge=oe.x;ge<=Math.min(ee.x+1,m-1);++ge)Du[ne*m+ge]===255&&(Du[ne*m+ge]=0,V+=r.getElevationAtPixel(ge,ne),N++)}let U=V/N;D=Math.max(1,C.x-M),L=Math.max(1,C.y-M),F=Math.min(S.x+M,m-2),B=Math.min(S.y+M,m-2),v=!0;for(let H=L;H<=B;++H)for(let J=D;J<=F;++J)Du[H*m+J]===0&&(A1[H*m+J]=r._dem.set(J,H,U));for(let H=1;H<M;++H){D=Math.max(1,C.x-H),L=Math.max(1,C.y-H),F=Math.min(S.x+H,m-2),B=Math.min(S.y+H,m-2);for(let J=L;J<=B;++J)for(let oe=D;oe<=F;++oe){let ee=J*m+oe;if(Du[ee]===255){let ne=0,ge=0,te=-1,pe=-1;for(let xe=-1;xe<=1;++xe)for(let be=-1;be<=1;++be){let Se=(J+xe)*m+oe+be;if(Du[Se]>=H)continue;let Re=A1[Se],Le=Math.abs(Re);Le>ge&&(ne=Re,ge=Le,te=be,pe=xe)}if(ge>.1){let xe=1-(H+.5*Math.abs(te*pe))/M,be=r._dem.get(oe,J)+ne*xe,Se=r._dem.get(oe+te,J+pe),Re=r._dem.get(oe-te,J-pe,!0);(be-Se)*(be-Re)>0&&(be=(Se+Re)/2),A1[ee]=r._dem.set(oe,J,be),Du[ee]=H}}}}}v&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=dt.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let r of e)_y(r.node),D1(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;let c=r.getReplacementRegionsForTile(e.toUnwrapped()),p=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let m=p[u].node;p[u].hiddenByReplacement=!!m.footprint&&!c.find(v=>v.footprint===m.footprint)}}getHeightAtTileCoord(e,r){let c=this.getNodesInfo(),p=[],u=[0,0,0],m=Ee.mat4.identity([]);for(let v=0;v<this.nodesInfo.length;v++){let E=c[v],T=E.node.meshes[0],_=T.transformedAabb;if(e<_.min[0]||r<_.min[1]||e>_.max[0]||r>_.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};Ee.mat4.invert(m,E.node.matrix),u[0]=e,u[1]=r,Ee.vec3.transformMat4(u,u,m);let C=(u[0]-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*Iu|0,S=Math.min(63,(u[1]-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*Iu|0)*Iu+Math.min(63,C),w=T.heightmap[S];if(!(w<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:w,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new lt(e,r),new lt(e,r),p),p.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function hm(l,e){return!l.isLightConstant&&e}function JL(l,e,r,c,p,u,m,v){let E=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;r[3]>0&&(E=kt(E,255*r[0],r[3]),T=kt(T,255*r[1],r[3]),_=kt(_,255*r[2],r[3]));let C=E<<8|T,S=_<<8|Math.floor(255*c[3]),w=function(H){let J=Wt(H,0,2);return Math.min(Math.round(.5*J*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],M=Wt(p[0],0,1),D=Wt(p[1],0,1),L=Wt(p[2],0,1),F=Wt(p[3],0,1),B,V,N,U;if(M!==D&&m!==u&&D!==M){let H=m-u;V=1/(H*(D-M)),N=-(u+H*M)/(H*(D-M));let J=Wt(p[4],-1,1);U=Math.pow(10,J),B=255*L<<8|255*F}else B=65535,V=0,N=1,U=1;if(l.emplaceBack(C,S,w,B,V,N,U),v){let H=v.length;v.clear();for(let J=0;J<H;J++)v.emplaceBack(C,S,w,B,V,N,U)}}function KL(l,e,r){let c=l.node,p=0,u=r&fh.HasMeshoptCompression;for(let m of c.meshes){if(c.lights&&c.lightMeshIndex===p||!m.featureData)continue;m.featureArray=new Kd,m.featureArray.reserve(m.featureData.length);let v=e;for(let E of m.featureData){let T=u?65535&E:E>>16&65535,_=u?E>>16&65535:65535&E,C=(15&_)<8?15&_:0,S=l.evaluatedRMEA[C],w=l.evaluatedColor[C],M=l.emissionHeightBasedParams[C],D;if(v&&C===2&&c.lights&&(D=new Kd,D.resize(10*c.lights.length)),JL(m.featureArray,T,w,S,M,m.aabb.min[2],m.aabb.max[2],D),D&&v){v=!1;let L=c.meshes[c.lightMeshIndex];L.featureArray=D,L.featureArray._trim()}}m.featureArray._trim(),p++}}gt(yy,"Tiled3dModelBucket",{omit:["layers"]}),gt(dT,"Tiled3dModelFeature");let QL=["id","tile","layer","source","sourceLayer","state"];class fm{constructor(e,r,c,p,u){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=c,this._y=p,this.properties=e.properties,this.id=u}clone(){let e=new fm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Mt({},this.state)),this.layer&&(e.layer=Mt({},this.layer)),this.namespace&&(e.namespace=this.namespace),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let r of QL)this[r]!==void 0&&(e[r]=this[r]);return e}}function hT(l,e,r,c){let p=1<<l.z;e.lat=ie((c/ct+l.y)/p),e.lng=Q((r/ct+l.x)/p)}let eF={circle:class extends Sr{constructor(l,e,r,c){super(l,{layout:Fn||(Fn=new si({"circle-sort-key":new Tt(Oe.layout_circle["circle-sort-key"]),visibility:new ot(Oe.layout_circle.visibility)})),paint:ui||(ui=new si({"circle-radius":new Tt(Oe.paint_circle["circle-radius"]),"circle-color":new Tt(Oe.paint_circle["circle-color"]),"circle-blur":new Tt(Oe.paint_circle["circle-blur"]),"circle-opacity":new Tt(Oe.paint_circle["circle-opacity"]),"circle-translate":new ot(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new ot(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ot(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ot(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ot(Oe.paint_circle["circle-emissive-strength"])}))},e,r,c)}createBucket(l){return new Ke(l)}queryRadius(l){let e=l;return Qn("circle-radius",this,e)+Qn("circle-stroke-width",this,e)+un(this.paint.get("circle-translate"))}queryIntersectsFeature(l,e,r,c,p,u,m,v){let E=Gn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,l.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return GE(l,c,u,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,e,r){let c=$E(this);return{config:new Ss(this,{zoom:e,lut:r}),defines:c,overrideFog:!1}}},heatmap:class extends Sr{createBucket(l){return new qE(l)}constructor(l,e,r,c){super(l,{layout:WE||(WE=new si({visibility:new ot(Oe.layout_heatmap.visibility)})),paint:ZE||(ZE=new si({"heatmap-radius":new Tt(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ot(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gl(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ot(Oe.paint_heatmap["heatmap-opacity"])}))},e,r,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return Qn("heatmap-radius",this,l)}queryIntersectsFeature(l,e,r,c,p,u,m,v){let E=this.paint.get("heatmap-radius").evaluate(e,r);return GE(l,c,u,m,v,!0,!0,new lt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,e,r){return l==="heatmap"?{config:new Ss(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Sr{constructor(l,e,r,c){super(l,{layout:XE||(XE=new si({visibility:new ot(Oe.layout_hillshade.visibility)})),paint:YE||(YE=new si({"hillshade-illumination-direction":new ot(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ot(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ot(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ot(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ot(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ot(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ot(Oe.paint_hillshade["hillshade-emissive-strength"])}))},e,r,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,e,r){return{overrideFog:!1}}},fill:class extends Sr{constructor(l,e,r,c){super(l,{layout:rM||(rM=new si({"fill-sort-key":new Tt(Oe.layout_fill["fill-sort-key"]),visibility:new ot(Oe.layout_fill.visibility),"fill-elevation-reference":new ot(Oe.layout_fill["fill-elevation-reference"])})),paint:oM||(oM=new si({"fill-antialias":new ot(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Tt(Oe.paint_fill["fill-opacity"]),"fill-color":new Tt(Oe.paint_fill["fill-color"]),"fill-outline-color":new Tt(Oe.paint_fill["fill-outline-color"]),"fill-translate":new ot(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new ot(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Tt(Oe.paint_fill["fill-pattern"]),"fill-emissive-strength":new ot(Oe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Tt(Oe.paint_fill["fill-z-offset"])}))},e,r,c)}getProgramIds(){let l=this.paint.get("fill-pattern"),e=l&&l.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(l,e,r){return{config:new Ss(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(l,e){super.recalculate(l,e);let r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new qx(l)}queryRadius(){return un(this.paint.get("fill-translate"))}queryIntersectsFeature(l,e,r,c,p,u){return!l.queryGeometry.isAboveHorizon&&bt(Xn(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,l.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Sr{constructor(l,e,r,c){super(l,{layout:VM||(VM=new si({visibility:new ot(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ot(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:jM||(jM=new si({"fill-extrusion-opacity":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Tt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Tt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Tt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Tt(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Tt(Oe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ot(Oe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},e,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new X_(l)}queryRadius(){return un(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,e,r,c,p,u,m,v,E){let T=Gn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,l.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,r),C=this.paint.get("fill-extrusion-base").evaluate(e,r),S=[0,0],w=v&&u.elevation,M=u.elevation?u.elevation.exaggeration():1,D=l.tile.getBucket(this);if(w&&D instanceof X_){let N=D.centroidVertexArray,U=E+1;U<N.length&&(S[0]=N.geta_centroid_pos0(U),S[1]=N.geta_centroid_pos1(U))}if(S[0]===0&&S[1]===1)return!1;u.projection.name==="globe"&&(c=BM([c],[new lt(0,0),new lt(ct,ct)],l.tileID.canonical).map(N=>N.polygon).flat());let L=w?v:null,[F,B]=function(N,U,H,J,oe,ee,ne,ge,te,pe,xe){return N.projection.name==="globe"?function(be,Se,Re,Le,De,He,et,je,pt,at,rt){let Qe=[],Dt=[],ft=be.projection.upVectorScale(rt,be.center.lat,be.worldSize).metersToTile,yt=[0,0,0,1],Gt=[0,0,0,1],tn=(Qt,dn,cn,ii)=>{Qt[0]=dn,Qt[1]=cn,Qt[2]=ii,Qt[3]=1},rn=zM();Re>0&&(Re+=rn),Le+=rn;for(let Qt of Se){let dn=[],cn=[];for(let ii of Qt){let Yn=ii.x+De.x,Nt=ii.y+De.y,kn=be.projection.projectTilePoint(Yn,Nt,rt),Vn=be.projection.upVector(rt,ii.x,ii.y),hi=Re,Di=Le;if(et){let Fi=$M(Yn,Nt,Re,Le,et,je,pt,at);hi+=Fi.base,Di+=Fi.top}Re!==0?tn(yt,kn.x+Vn[0]*ft*hi,kn.y+Vn[1]*ft*hi,kn.z+Vn[2]*ft*hi):tn(yt,kn.x,kn.y,kn.z),tn(Gt,kn.x+Vn[0]*ft*Di,kn.y+Vn[1]*ft*Di,kn.z+Vn[2]*ft*Di),Ee.vec3.transformMat4(yt,yt,He),Ee.vec3.transformMat4(Gt,Gt,He),dn.push(new Tu(yt[0],yt[1],yt[2])),cn.push(new Tu(Gt[0],Gt[1],Gt[2]))}Qe.push(dn),Dt.push(cn)}return[Qe,Dt]}(N,U,H,J,oe,ee,ne,ge,te,pe,xe):ne?function(be,Se,Re,Le,De,He,et,je,pt){let at=[],rt=[],Qe=[0,0,0,1];for(let Dt of be){let ft=[],yt=[];for(let Gt of Dt){let tn=Gt.x+Le.x,rn=Gt.y+Le.y,Qt=$M(tn,rn,Se,Re,He,et,je,pt);Qe[0]=tn,Qe[1]=rn,Qe[2]=Qt.base,Qe[3]=1,Ee.vec4.transformMat4(Qe,Qe,De),Qe[3]=Math.max(Qe[3],1e-5);let dn=new Tu(Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]);Qe[0]=tn,Qe[1]=rn,Qe[2]=Qt.top,Qe[3]=1,Ee.vec4.transformMat4(Qe,Qe,De),Qe[3]=Math.max(Qe[3],1e-5);let cn=new Tu(Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]);ft.push(dn),yt.push(cn)}at.push(ft),rt.push(yt)}return[at,rt]}(U,H,J,oe,ee,ne,ge,te,pe):function(be,Se,Re,Le,De){let He=[],et=[],je=De[8]*Se,pt=De[9]*Se,at=De[10]*Se,rt=De[11]*Se,Qe=De[8]*Re,Dt=De[9]*Re,ft=De[10]*Re,yt=De[11]*Re;for(let Gt of be){let tn=[],rn=[];for(let Qt of Gt){let dn=Qt.x+Le.x,cn=Qt.y+Le.y,ii=De[0]*dn+De[4]*cn+De[12],Yn=De[1]*dn+De[5]*cn+De[13],Nt=De[2]*dn+De[6]*cn+De[14],kn=De[3]*dn+De[7]*cn+De[15],Vn=ii+je,hi=Yn+pt,Di=Nt+at,Fi=Math.max(kn+rt,1e-5),Ai=ii+Qe,Ei=Yn+Dt,Ri=Nt+ft,ji=Math.max(kn+yt,1e-5);tn.push(new Tu(Vn/Fi,hi/Fi,Di/Fi)),rn.push(new Tu(Ai/ji,Ei/ji,Ri/ji))}He.push(tn),et.push(rn)}return[He,et]}(U,H,J,oe,ee)}(u,c,C,_,T,m,L,S,M,u.center.lat,l.tileID.canonical),V=l.queryGeometry;return function(N,U,H){let J=1/0;bt(H,U)&&(J=UM(H,U[0]));for(let oe=0;oe<U.length;oe++){let ee=U[oe],ne=N[oe];for(let ge=0;ge<ee.length-1;ge++){let te=ee[ge],pe=[te,ee[ge+1],ne[ge+1],ne[ge],te];We(H,pe)&&(J=Math.min(J,UM(H,pe)))}}return J!==1/0&&J}(F,B,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends Sr{constructor(l,e,r,c){let p=QM();super(l,p,e,r,c),p.layout&&(this.layout=new $l(p.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof iu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,e){super.recalculate(l,e),this.paint._values["line-floorwidth"]=(()=>{if(em)return em;let r=QM();return em=new nL(r.paint.properties["line-width"].specification),em.useIntegerZoom=!0,em})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new n1(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,e,r){let c=JM(this);return{config:new Ss(this,{zoom:e,lut:r}),defines:c,overrideFog:!1}}queryRadius(l){let e=l,r=eS(Qn("line-width",this,e),Qn("line-gap-width",this,e)),c=Qn("line-offset",this,e);return r/2+Math.abs(c)+un(this.paint.get("line-translate"))}queryIntersectsFeature(l,e,r,c,p,u){if(l.queryGeometry.isAboveHorizon)return!1;let m=Xn(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,l.pixelToTileUnitsFactor),v=l.pixelToTileUnitsFactor/2*eS(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),E=this.paint.get("line-offset").evaluate(e,r);return E&&(c=function(T,_){let C=[],S=new lt(0,0);for(let w=0;w<T.length;w++){let M=T[w],D=[];for(let L=0;L<M.length;L++){let F=M[L],B=M[L+1],V=L===0?S:F.sub(M[L-1])._unit()._perp(),N=L===M.length-1?S:B.sub(F)._unit()._perp(),U=V._add(N)._unit();U._mult(1/(U.x*N.x+U.y*N.y)),D.push(U._mult(_)._add(F))}C.push(D)}return C}(c,E*l.pixelToTileUnitsFactor)),function(T,_,C){for(let S=0;S<_.length;S++){let w=_[S];if(T.length>=3){for(let M=0;M<w.length;M++)if(mn(T,w[M]))return!0}if(It(T,w,C))return!0}return!1}(m,c,v)}isTileClipped(){return!0}isDraped(l){let e=this.layout.get("line-z-offset"),r=e.isConstant()&&!e.constantOr(0),c=this.layout.get("line-elevation-reference");return!(c==="sea"||c==="ground")&&(r||c!=="none")}},symbol:uy,background:class extends Sr{constructor(l,e,r,c){super(l,{layout:NS||(NS=new si({visibility:new ot(Oe.layout_background.visibility)})),paint:zS||(zS=new si({"background-pitch-alignment":new ot(Oe.paint_background["background-pitch-alignment"]),"background-color":new ot(Oe.paint_background["background-color"]),"background-pattern":new ot(Oe.paint_background["background-pattern"]),"background-opacity":new ot(Oe.paint_background["background-opacity"]),"background-emissive-strength":new ot(Oe.paint_background["background-emissive-strength"])}))},e,r,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,e,r){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:$S,"raster-particle":XS,sky:class extends Sr{constructor(l,e,r,c){super(l,{layout:qS||(qS=new si({visibility:new ot(Oe.layout_sky.visibility)})),paint:WS||(WS=new si({"sky-type":new ot(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new ot(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ot(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ot(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ot(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Gl(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ot(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ot(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ot(Oe.paint_sky["sky-opacity"])}))},e,r,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Hp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(l,e){if(this.paint.get("sky-type")==="atmosphere"){let c=this.paint.get("sky-atmosphere-sun"),p=!c,u=l.style.light,m=u.properties.get("position");return p&&u.properties.get("anchor")==="viewport"&&xn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?E1(m.azimuthal,90-m.polar,e):E1(c[0],90-c[1],e)}let r=this.paint.get("sky-gradient-center");return E1(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends Sr{constructor(l,e,r,c){super(l,{paint:ZS||(ZS=new si({}))},e,null)}},model:class extends Sr{constructor(l,e,r,c){super(l,{layout:oT||(oT=new si({visibility:new ot(Oe.layout_model.visibility),"model-id":new Tt(Oe.layout_model["model-id"])})),paint:sT||(sT=new si({"model-opacity":new ot(Oe.paint_model["model-opacity"]),"model-rotation":new Tt(Oe.paint_model["model-rotation"]),"model-scale":new Tt(Oe.paint_model["model-scale"]),"model-translation":new Tt(Oe.paint_model["model-translation"]),"model-color":new Tt(Oe.paint_model["model-color"]),"model-color-mix-intensity":new Tt(Oe.paint_model["model-color-mix-intensity"]),"model-type":new ot(Oe.paint_model["model-type"]),"model-cast-shadows":new ot(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new ot(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ot(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Tt(Oe.paint_model["model-emissive-strength"]),"model-roughness":new Tt(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Tt(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ot(Oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ot(Oe.paint_model["model-front-cutoff"])}))},e,r,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new T1(l)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof yy?ct-1:0}queryIntersectsFeature(l,e,r,c,p,u){if(!this.modelManager)return!1;let m=this.modelManager,v=l.tile.getBucket(this);if(!(v&&v instanceof T1))return!1;let E=v;for(let T in E.instancesPerModel){let _=E.instancesPerModel[T],C=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(_.idToFeaturesIndex.hasOwnProperty(C)){let S=_.features[_.idToFeaturesIndex[C]],w=m.getModel(T,this.scope);if(!w)return!1;let M=Ee.mat4.create(),D=new P(0,0),L=E.canonical,F=Number.MAX_VALUE;for(let B=0;B<S.instancedDataCount;++B){let V=16*(S.instancedDataOffset+B),N=_.instancedDataArray.float32,U=[N[V+4],N[V+5],N[V+6]];hT(L,D,N[V],0|N[V+1]),aT(M,w,u,D,S.rotation,S.scale,U,!1,!1,!1),u.projection.name==="globe"&&(M=S1(M,u));let H=Ee.mat4.multiply([],u.projMatrix,M),J=l.queryGeometry,oe=eT(J.isPointQuery()?J.screenBounds:J.screenGeometry,u,H,w.aabb);oe!=null&&(F=Math.min(oe,F))}return F!==Number.MAX_VALUE&&F}}return!1}_handleOverridablePaintPropertyUpdate(l,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){let e=this._transitionablePaint._values[l];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof cu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(l,e,r,c){let p=l.tile,u=p.getBucket(this),m=null,v=Number.MAX_VALUE;if(!(u&&u instanceof yy))return{queryFeature:m,intersectionZ:v};let E=u.getNodesInfo()[e];if(E.hiddenByReplacement||!E.node.meshes||!r.filter(new bi(p.tileID.overscaledZ),E.feature,p.tileID.canonical))return{queryFeature:m,intersectionZ:v};let T=E.node,_=c.calculatePosMatrix(p.tileID.toUnwrapped(),c.worldSize),C=E.evaluatedScale,S=0;c.elevation&&T.elevation&&(S=T.elevation*c.elevation.exaggeration()),Ee.mat4.translate(_,_,[(T.anchor?T.anchor[0]:0)*(C[0]-1),(T.anchor?T.anchor[1]:0)*(C[1]-1),S]),Ee.mat4.scale(_,_,C);let w=l.queryGeometry,M=w.isPointQuery()?w.screenBounds:w.screenGeometry,D=function(N){let U=Ee.mat4.multiply([],_,N.matrix);Ee.mat4.multiply(U,c.expandedFarZProjMatrix,U);for(let H=0;H<N.meshes.length;++H){let J=N.meshes[H];if(H===N.lightMeshIndex)continue;let oe=eT(M,c,U,J.aabb);oe!=null&&(v=Math.min(oe,v))}if(N.children)for(let H of N.children)D(H)};if(D(T),v===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:v};let L=new P(0,0);hT(p.tileID.canonical,L,E.node.anchor[0],E.node.anchor[1]);let{z:F,x:B,y:V}=p.tileID.canonical;return m=new fm({},F,B,V,E.feature.id),m.properties=E.feature.properties,m.geometry={type:"Point",coordinates:[L.lng,L.lat]},m.layer=ei(Mt({},this.serialize()),{id:this.fqid}),m.state={},m.tile=p.tileID.canonical,{queryFeature:m,intersectionZ:v}}},clip:class extends Sr{constructor(l,e,r,c){super(l,{layout:sM||(sM=new si({"clip-layer-types":new ot(Oe.layout_clip["clip-layer-types"]),"clip-layer-scope":new ot(Oe.layout_clip["clip-layer-scope"])})),paint:aM||(aM=new si({}))},e,r,c)}recalculate(l,e){super.recalculate(l,e)}createBucket(l){return new lM(l)}isTileClipped(){return!0}is3D(){return!0}}};class tF{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nF{constructor(){this.tasks={},this.taskQueue=[],fl(["process"],this),this.invoker=new tF(this.process),this.nextId=0}add(e,r){let c=this.nextId++,p=function({type:u,isSymbolTile:m,zoom:v}){return v=v||0,u==="message"?0:u!=="maybePrepare"||m?u!=="parseTile"||m?u==="parseTile"&&m?300-v:u==="maybePrepare"&&m?400-v:500:200-v:100-v}(r);if(p===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:r,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let p=0;p<this.taskQueue.length;p++){let u=this.tasks[this.taskQueue[p]];u.priority<r&&(r=u.priority,e=p)}if(e===null)return null;let c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class fT{constructor(e,r,c){this.target=e,this.parent=r,this.mapId=c,this.callbacks={},this.cancelCallbacks={},fl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new nF}send(e,r,c,p,u=!1,m){let v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[v]=c);let E=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!c,targetMapId:p,mustQueue:u,sourceMapId:this.mapId,data:ka(r,E)},E),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(e){let r=e.data,c=r.id;if(c&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){let p=this.cancelCallbacks[c];delete this.cancelCallbacks[c],p&&p.cancel()}else if(r.mustQueue||Sa()){let p=this.callbacks[c],u=this.scheduler.add(()=>this.processTask(c,r),p&&p.metadata||{type:"message"});u&&(this.cancelCallbacks[c]=u)}else this.processTask(c,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){let c=this.callbacks[e];delete this.callbacks[e],c&&(r.error?c(Js(r.error)):c(null,Js(r.data)))}else{let c=new Set,p=r.hasCallback?(m,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?ka(m):null,data:ka(v,c)},c)}:()=>{},u=Js(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,u,p);else if(this.parent.getWorkerSource){let m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],u.source,u.scope)[m[1]](u,p)}else p(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let P1=(()=>{class l{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=jc();let p=this.workerPool.acquire(this.id);for(let u=0;u<p.length;u++){let m=new l.Actor(p[u],c,this.id);m.name=`Worker ${u}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,p){Ea(this.actors,(u,m)=>{u.send(r,c,m)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}return l.Actor=fT,l})();class pT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){let c=this.toIdx(e,r);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function mT(l,e,r,c){let p=0,u=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(r[m]<l[m]||r[m]>e[m])return null}else{let v=1/c[m],E=(l[m]-r[m])*v,T=(e[m]-r[m])*v;if(E>T){let _=E;E=T,T=_}if(E>p&&(p=E),T<u&&(u=T),p>u)return null}return p}function gT(l,e,r,c,p,u,m,v,E,T,_){let C=c-l,S=p-e,w=u-r,M=m-l,D=v-e,L=E-r,F=_[1]*L-_[2]*D,B=_[2]*M-_[0]*L,V=_[0]*D-_[1]*M,N=C*F+S*B+w*V;if(Math.abs(N)<1e-15)return null;let U=1/N,H=T[0]-l,J=T[1]-e,oe=T[2]-r,ee=(H*F+J*B+oe*V)*U;if(ee<0||ee>1)return null;let ne=J*w-oe*S,ge=oe*C-H*w,te=H*S-J*C,pe=(_[0]*ne+_[1]*ge+_[2]*te)*U;return pe<0||ee+pe>1?null:(M*ne+D*ge+L*te)*U}function _T(l,e,r){return(l-e)/(r-e)}function yT(l,e,r,c,p,u,m,v,E){let T=1<<r,_=u-c,C=m-p,S=(l+1)/T*_+c,w=(e+0)/T*C+p,M=(e+1)/T*C+p;v[0]=(l+0)/T*_+c,v[1]=w,E[0]=S,E[1]=M}class vT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(u){let m=Math.ceil(Math.log2(u.dim/8)),v=[],E=Math.ceil(Math.pow(2,m)),T=1/E,_=(w,M,D,L,F)=>{let B=L?1:0,V=(w+1)*D-B,N=M*D,U=(M+1)*D-B;F[0]=w*D,F[1]=N,F[2]=V,F[3]=U},C=new pT(E),S=[];for(let w=0;w<E*E;w++){_(w%E,Math.floor(w/E),T,!1,S);let M=lc(S[0],S[1],u),D=lc(S[2],S[1],u),L=lc(S[2],S[3],u),F=lc(S[0],S[3],u);C.minimums.push(Math.min(M,D,L,F)),C.maximums.push(Math.max(M,D,L,F)),C.leaves.push(1)}for(v.push(C),E/=2;E>=1;E/=2){let w=v[v.length-1];C=new pT(E);for(let M=0;M<E*E;M++){_(M%E,Math.floor(M/E),2,!0,S);let D=w.getElevation(S[0],S[1]),L=w.getElevation(S[2],S[1]),F=w.getElevation(S[2],S[3]),B=w.getElevation(S[0],S[3]),V=w.isLeaf(S[0],S[1]),N=w.isLeaf(S[2],S[1]),U=w.isLeaf(S[2],S[3]),H=w.isLeaf(S[0],S[3]),J=Math.min(D.min,L.min,F.min,B.min),oe=Math.max(D.max,L.max,F.max,B.max),ee=V&&N&&U&&H;C.maximums.push(oe),C.minimums.push(J),C.leaves.push(oe-J<=5&&ee?1:0)}v.push(C)}return v}(this.dem),c=r.length-1,p=r[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(r,0,0,c,0)}raycastRoot(e,r,c,p,u,m,v=1){return mT([e,r,-100],[c,p,this.maximums[0]*v],u,m)}raycast(e,r,c,p,u,m,v=1){if(!this.nodeCount)return null;let E=this.raycastRoot(e,r,c,p,u,m,v);if(E==null)return null;let T=[],_=[],C=[],S=[],w=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;w.length>0;){let{idx:M,t:D,nodex:L,nodey:F,depth:B}=w.pop();if(this.leaves[M]){yT(L,F,B,e,r,c,p,C,S);let N=1<<B,U=(L+0)/N,H=(L+1)/N,J=(F+0)/N,oe=(F+1)/N,ee=lc(U,J,this.dem)*v,ne=lc(H,J,this.dem)*v,ge=lc(H,oe,this.dem)*v,te=lc(U,oe,this.dem)*v,pe=gT(C[0],C[1],ee,S[0],C[1],ne,S[0],S[1],ge,u,m),xe=gT(S[0],S[1],ge,C[0],S[1],te,C[0],C[1],ee,u,m),be=Math.min(pe!==null?pe:Number.MAX_VALUE,xe!==null?xe:Number.MAX_VALUE);if(be!==Number.MAX_VALUE)return be;{let Se=Ee.vec3.scaleAndAdd([],u,m,D);if(xT(ee,ne,te,ge,_T(Se[0],C[0],S[0]),_T(Se[1],C[1],S[1]))>=Se[2])return D}continue}let V=0;for(let N=0;N<this._siblingOffset.length;N++){yT((L<<1)+this._siblingOffset[N][0],(F<<1)+this._siblingOffset[N][1],B+1,e,r,c,p,C,S),C[2]=-100,S[2]=this.maximums[this.childOffsets[M]+N]*v;let U=mT(C,S,u,m);if(U!=null){let H=U;T[N]=H;let J=!1;for(let oe=0;oe<V&&!J;oe++)H>=T[_[oe]]&&(_.splice(oe,0,N),J=!0);J||(_[V]=N),V++}}for(let N=0;N<V;N++){let U=_[N];w.push({idx:this.childOffsets[M]+U,t:T[U],nodex:(L<<1)+this._siblingOffset[U][0],nodey:(F<<1)+this._siblingOffset[U][1],depth:B+1})}}return null}_addNode(e,r,c){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,c,p,u){if(e[p].isLeaf(r,c)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let m=p-1,v=e[m],E=0,T=0;for(let _=0;_<this._siblingOffset.length;_++){let C=2*r+this._siblingOffset[_][0],S=2*c+this._siblingOffset[_][1],w=v.getElevation(C,S),M=v.isLeaf(C,S),D=this._addNode(w.min,w.max,M);M&&(E|=1<<_),T||(T=D)}for(let _=0;_<this._siblingOffset.length;_++)E&1<<_||this._construct(e,2*r+this._siblingOffset[_][0],2*c+this._siblingOffset[_][1],m,T+_)}}function xT(l,e,r,c,p,u){return kt(kt(l,r,u),kt(e,c,u),p)}function lc(l,e,r){let c=r.dim,p=Wt(l*c-.5,0,c-1),u=Wt(e*c-.5,0,c-1),m=Math.floor(p),v=Math.floor(u),E=Math.min(m+1,c-1),T=Math.min(v+1,c-1);return xT(r.get(m,v),r.get(E,v),r.get(m,T),r.get(E,T),p-m,u-v)}let iF={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function rF(l,e,r){return(256*l*256+256*e+r)/10-1e4}function oF(l,e,r){return 256*l+e+r/256-32768}class vy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,c,p=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void xn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let u=this.dim=r.height-2,m=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let E=0;E<u;E++)m[this._idx(-1,E)]=m[this._idx(0,E)],m[this._idx(u,E)]=m[this._idx(u-1,E)],m[this._idx(E,-1)]=m[this._idx(E,0)],m[this._idx(E,u)]=m[this._idx(E,u-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(u,-1)]=m[this._idx(u-1,0)],m[this._idx(-1,u)]=m[this._idx(0,u-1)],m[this._idx(u,u)]=m[this._idx(u-1,u-1)]}let v=c==="terrarium"?oF:rF;for(let E=0;E<m.length;++E){let T=4*E;this.floatView[E]=v(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=dt.now()}_buildQuadTree(){this._tree=new vT(this)}get(e,r,c=!1){c&&(e=Wt(e,-1,this.dim),r=Wt(r,-1,this.dim));let p=this._idx(e,r);return this.floatView[p]}set(e,r,c){let p=this._idx(e,r),u=this.floatView[p];return this.floatView[p]=c,c-u}static getUnpackVector(e){return iF[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){let c=[0,0,0,0],p=vy.getUnpackVector(r),u=Math.floor((e+p[3])/p[2]);return c[2]=u%256,u=Math.floor(u/256),c[1]=u%256,u=Math.floor(u/256),c[0]=u,c}getPixels(){return new QE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,u=r*this.dim+this.dim,m=c*this.dim,v=c*this.dim+this.dim;switch(r){case-1:p=u-1;break;case 1:u=p+1}switch(c){case-1:m=v-1;break;case 1:v=m+1}let E=-r*this.dim,T=-c*this.dim;for(let _=m;_<v;_++)for(let C=p;C<u;C++){let S=4*this._idx(C,_),w=4*this._idx(C+E,_+T);this.pixels[S+0]=e.pixels[w+0],this.pixels[S+1]=e.pixels[w+1],this.pixels[S+2]=e.pixels[w+2],this.pixels[S+3]=e.pixels[w+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function sF(l,e,r){l===1?e.headerLength=r.readFixed32():l===2?e.x=r.readVarint():l===3?e.y=r.readVarint():l===4?e.z=r.readVarint():l===5&&e.layers.push(function(c,p){return c.readFields(dF,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(r,r.readVarint()+r.pos))}function aF(l,e,r){l===1?(e.delta_filter=function(c,p){return c.readFields(lF,{blockSize:0},p)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):l===2?(r.readVarint(),e.filter="zigzag_filter"):l===3?(r.readVarint(),e.filter="bitshuffle_filter"):l===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function lF(l,e,r){l===1&&(e.blockSize=r.readVarint())}function cF(l,e,r){l===1?(r.readVarint(),e.codec="gzip_data"):l===2?(r.readVarint(),e.codec="jpeg_image"):l===3?(r.readVarint(),e.codec="webp_image"):l===4&&(r.readVarint(),e.codec="png_image")}function uF(l,e,r){let c=0,p=0;l===1?e.firstByte=r.readFixed64():l===2?e.lastByte=r.readFixed64():l===3?e.filters.push(function(u,m){return u.readFields(aF,{},m)}(r,r.readVarint()+r.pos)):l===4?e.codec=function(u,m){return u.readFields(cF,{},m)}(r,r.readVarint()+r.pos):l===5?p=r.readFloat():l===6?c=r.readFloat():l===7?e.bands.push(r.readString()):l===8?e.offset=r.readDouble():l===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=p),e.scale===0&&(e.scale=c)}function dF(l,e,r){l===1?e.version=r.readVarint():l===2?e.name=r.readString():l===3?e.units=r.readString():l===4?e.tileSize=r.readVarint():l===5?e.buffer=r.readVarint():l===6?e.pixelFormat=r.readVarint():l===7&&e.dataIndex.push(function(c,p){return c.readFields(uF,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(r,r.readVarint()+r.pos))}function hF(l,e,r){if(l===2)(function(c,p,u){c.readFields(fF,u,p)})(r,r.readVarint()+r.pos,e);else if(l===3)throw new Error("Not implemented")}function fF(l,e,r){if(l===1){let c=0,p=r.readVarint()+r.pos;for(;r.pos<p;)e[c++]=r.readVarint()}}gt(vy,"DEMData"),gt(vT,"DemMinMaxQuadTree",{omit:["dem"]});class pF{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}}function mF(l,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let c=2;c>=1;c--){let p=c===1?1:0,u=c===2?1:0;for(let m=0;m<e[0];m++){let v=e[1]*m;for(let E=p;E<e[1];E++){let T=e[2]*(E+v);for(let _=u;_<e[2];_++){let C=e[3]*(_+T);for(let S=0;S<e[3];S++){let w=C+S;l[w]+=l[w-r]}}}}r*=e[c]}return l}function gF(l){for(let e=0,r=l.length;e<r;e++)l[e]=l[e]>>>1^-(1&l[e]);return l}function _F(l,e){switch(e){case"uint32":return l;case"uint16":for(let r=0;r<l.length;r+=2){let c=l[r],p=l[r+1];l[r]=(240&c)>>4|(61440&c)>>8|(240&p)<<4|61440&p,l[r+1]=15&c|(3840&c)>>4|(15&p)<<8|(3840&p)<<4}return l;case"uint8":for(let r=0;r<l.length;r+=4){let c=l[r],p=l[r+1],u=l[r+2],m=l[r+3];l[r+0]=(192&c)>>6|(192&p)>>4|(192&u)>>2|192&m,l[r+1]=(48&c)>>4|(48&p)>>2|48&u|(48&m)<<2,l[r+2]=(12&c)>>2|12&p|(12&u)<<2|(12&m)<<4,l[r+3]=3&c|(3&p)<<2|(3&u)<<4|(3&m)<<6}return l;default:throw new Error(`Invalid pixel format, "${e}"`)}}var Lo=Uint8Array,pm=Uint16Array,yF=Int32Array,bT=new Lo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wT=new Lo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vF=new Lo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),CT=function(l,e){for(var r=new pm(31),c=0;c<31;++c)r[c]=e+=1<<l[c-1];var p=new yF(r[30]);for(c=1;c<30;++c)for(var u=r[c];u<r[c+1];++u)p[u]=u-r[c]<<5|c;return{b:r,r:p}},ET=CT(bT,2),MT=ET.b,xF=ET.r;MT[28]=258,xF[258]=28;for(var bF=CT(wT,0).b,ST=new pm(32768),Li=0;Li<32768;++Li){var mh=(43690&Li)>>1|(21845&Li)<<1;ST[Li]=((65280&(mh=(61680&(mh=(52428&mh)>>2|(13107&mh)<<2))>>4|(3855&mh)<<4))>>8|(255&mh)<<8)>>1}var mm=function(l,e,r){for(var c=l.length,p=0,u=new pm(e);p<c;++p)l[p]&&++u[l[p]-1];var m,v=new pm(e);for(p=1;p<e;++p)v[p]=v[p-1]+u[p-1]<<1;m=new pm(1<<e);var E=15-e;for(p=0;p<c;++p)if(l[p])for(var T=p<<4|l[p],_=e-l[p],C=v[l[p]-1]++<<_,S=C|(1<<_)-1;C<=S;++C)m[ST[C]>>E]=T;return m},gm=new Lo(288);for(Li=0;Li<144;++Li)gm[Li]=8;for(Li=144;Li<256;++Li)gm[Li]=9;for(Li=256;Li<280;++Li)gm[Li]=7;for(Li=280;Li<288;++Li)gm[Li]=8;var TT=new Lo(32);for(Li=0;Li<32;++Li)TT[Li]=5;var wF=mm(gm,9),CF=mm(TT,5),R1=function(l){for(var e=l[0],r=1;r<l.length;++r)l[r]>e&&(e=l[r]);return e},As=function(l,e,r){var c=e/8|0;return(l[c]|l[c+1]<<8)>>(7&e)&r},O1=function(l,e){var r=e/8|0;return(l[r]|l[r+1]<<8|l[r+2]<<16)>>(7&e)},EF=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ps=function(l,e,r){var c=new Error(e||EF[l]);if(c.code=l,Error.captureStackTrace&&Error.captureStackTrace(c,Ps),!r)throw c;return c},MF=new Lo(0),SF=typeof TextDecoder<"u"&&new TextDecoder;try{SF.decode(MF,{stream:!0})}catch{}let TF={gzip_data:"gzip"};class Xo extends Error{constructor(e){super(e),this.name="MRTError"}}let IF={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},IT={uint32:1,uint16:2,uint8:4},DF={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},L1;class F1{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let r=this.layers[e];if(!r)throw new Xo(`Layer '${e}' not found`);return r}getHeaderLength(e){let r=new Uint8Array(e),c=new DataView(e);if(r[0]!==13)throw new Xo("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){let r=new Uint8Array(e),c=this.getHeaderLength(e);if(r.length<c)throw new Xo(`Expected header with length >= ${c} but got buffer of length ${r.length}`);let p=function(u,m){return u.readFields(sF,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new L1(r.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Xo(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(let u of p.layers)this.layers[u.name]=new AF(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let r=[],c=this.getLayer(e.layerName);for(let p of e.blockIndices){let u=c.dataIndex[p],m=u.firstByte-e.firstByte,v=u.lastByte-e.firstByte;if(c._blocksInProgress.has(p))continue;let E={layerName:c.name,firstByte:m,lastByte:v,pixelFormat:c.pixelFormat,blockIndex:p,blockShape:[u.bands.length].concat(c.bandShape),buffer:c.buffer,codec:u.codec.codec,filters:u.filters.map(T=>T.filter)};c._blocksInProgress.add(p),r.push(E)}return new DT(r,()=>{r.forEach(p=>c._blocksInProgress.delete(p.blockIndex))},(p,u)=>{if(r.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),p)throw p;u.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class AF{constructor({version:e,name:r,units:c,tileSize:p,pixelFormat:u,buffer:m,dataIndex:v},E){if(this.version=e,this.version!==1)throw new Xo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=c,this.tileSize=p,this.buffer=m,this.pixelFormat=IF[u],this.dataIndex=v,this.bandShape=[p+2*m,p+2*m,IT[this.pixelFormat]],this._decodedBlocks=new pF(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return IT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(let[c,p]of this.dataIndex.entries()){for(let[u,m]of p.bands.entries())if(m===e)return{bandIndex:r+u,blockIndex:c,blockBandIndex:u};r+=p.bands.length}break;case"number":for(let[c,p]of this.dataIndex.entries()){if(e>=r&&e<r+p.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-r};r+=p.bands.length}break;default:throw new Xo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Xo(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,c=-1/0,p=[],u=new Set;for(let m of e){let{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new Xo(`Invalid band: ${JSON.stringify(m)}`);let E=this.dataIndex[v];p.includes(v)||p.push(v),u.add(v),r=Math.min(r,E.firstByte),c=Math.max(c,E.lastByte)}if(u.size>this.cacheSize)throw new Xo(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:c,blockIndices:p}}hasBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){let{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){let{blockIndex:r,blockBandIndex:c}=this.getBlockForBand(e),p=this._decodedBlocks.get(r.toString());if(!p)throw new Xo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let u=this.dataIndex[r],m=this.bandShape.reduce((T,_)=>T*_,1),v=c*m,E=p.subarray(v,v+m);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}F1.setPbf=function(l){L1=l};class DT{constructor(e,r,c){this.tasks=e,this._onCancel=r,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}F1.performDecoding=function(l,e){let r=new Uint8Array(l);return Promise.all(e.tasks.map(c=>{let{layerName:p,firstByte:u,lastByte:m,pixelFormat:v,blockShape:E,blockIndex:T,filters:_,codec:C}=c,S=r.subarray(u,m+1),w=new Uint32Array(E[0]*E[1]*E[2]),M;if(C!=="gzip_data")throw new Xo(`Unhandled codec: ${C}`);return M=function(D,L){if(!globalThis.DecompressionStream&&L==="gzip_data")return Promise.resolve(((N=function(J){J[0]==31&&J[1]==139&&J[2]==8||Ps(6,"invalid gzip data");var oe=J[3],ee=10;4&oe&&(ee+=2+(J[10]|J[11]<<8));for(var ne=(oe>>3&1)+(oe>>4&1);ne>0;ne-=!J[ee++]);return ee+(2&oe)}(V=D))+8>V.length&&Ps(6,"invalid gzip data"),function(J,oe,ee,ne){var ge=J.length;if(!ge||oe.f&&!oe.l)return ee||new Lo(0);var te=!ee,pe=te||oe.i!=2,xe=oe.i;te&&(ee=new Lo(3*ge));var be,Se,Re=function(cc){var Ru=ee.length;if(cc>Ru){var Cm=new Lo(Math.max(2*Ru,cc));Cm.set(ee),ee=Cm}},Le=oe.f||0,De=oe.p||0,He=oe.b||0,et=oe.l,je=oe.d,pt=oe.m,at=oe.n,rt=8*ge;do{if(!et){Le=As(J,De,1);var Qe=As(J,De+1,3);if(De+=3,!Qe){var Dt=J[(Nt=4+((De+7)/8|0))-4]|J[Nt-3]<<8,ft=Nt+Dt;if(ft>ge){xe&&Ps(0);break}pe&&Re(He+Dt),ee.set(J.subarray(Nt,ft),He),oe.b=He+=Dt,oe.p=De=8*ft,oe.f=Le;continue}if(Qe==1)et=wF,je=CF,pt=9,at=5;else if(Qe==2){var yt=As(J,De,31)+257,Gt=As(J,De+10,15)+4,tn=yt+As(J,De+5,31)+1;De+=14;for(var rn=new Lo(tn),Qt=new Lo(19),dn=0;dn<Gt;++dn)Qt[vF[dn]]=As(J,De+3*dn,7);De+=3*Gt;var cn=R1(Qt),ii=(1<<cn)-1,Yn=mm(Qt,cn);for(dn=0;dn<tn;){var Nt,kn=Yn[As(J,De,ii)];if(De+=15&kn,(Nt=kn>>4)<16)rn[dn++]=Nt;else{var Vn=0,hi=0;for(Nt==16?(hi=3+As(J,De,3),De+=2,Vn=rn[dn-1]):Nt==17?(hi=3+As(J,De,7),De+=3):Nt==18&&(hi=11+As(J,De,127),De+=7);hi--;)rn[dn++]=Vn}}var Di=rn.subarray(0,yt),Fi=rn.subarray(yt);pt=R1(Di),at=R1(Fi),et=mm(Di,pt),je=mm(Fi,at)}else Ps(1);if(De>rt){xe&&Ps(0);break}}pe&&Re(He+131072);for(var Ai=(1<<pt)-1,Ei=(1<<at)-1,Ri=De;;Ri=De){var ji=(Vn=et[O1(J,De)&Ai])>>4;if((De+=15&Vn)>rt){xe&&Ps(0);break}if(Vn||Ps(2),ji<256)ee[He++]=ji;else{if(ji==256){Ri=De,et=null;break}var dr=ji-254;ji>264&&(dr=As(J,De,(1<<(Os=bT[dn=ji-257]))-1)+MT[dn],De+=Os);var li=je[O1(J,De)&Ei],Kr=li>>4;if(li||Ps(3),De+=15&li,Fi=bF[Kr],Kr>3){var Os=wT[Kr];Fi+=O1(J,De)&(1<<Os)-1,De+=Os}if(De>rt){xe&&Ps(0);break}pe&&Re(He+131072);var Yo=He+dr;if(He<Fi){var Jo=0-Fi,Pu=Math.min(Fi,Yo);for(Jo+He<0&&Ps(3);He<Pu;++He)ee[He]=(void 0)[Jo+He]}for(;He<Yo;++He)ee[He]=ee[He-Fi]}}oe.l=et,oe.p=Ri,oe.b=He,oe.f=Le,et&&(Le=1,oe.m=pt,oe.d=je,oe.n=at)}while(!Le);return He!=ee.length&&te?(be=ee,((Se=He)==null||Se>be.length)&&(Se=be.length),new Lo(be.subarray(0,Se))):ee.subarray(0,He)}(V.subarray(N,-8),{i:2},new Lo(((F=V)[(B=F.length)-4]|F[B-3]<<8|F[B-2]<<16|F[B-1]<<24)>>>0))));var F,B,V,N;let U=TF[L];if(!U)throw new Error(`Unhandled codec: ${L}`);let H=new globalThis.DecompressionStream(U);return new Response(new Blob([D]).stream().pipeThrough(H)).arrayBuffer().then(J=>new Uint8Array(J))}(S,C).then(D=>(function(L,F){L.readFields(hF,F)}(new L1(D),w),new DF[v](w.buffer))),M.then(D=>{for(let L=_.length-1;L>=0;L--)switch(_[L]){case"delta_filter":mF(D,E);break;case"zigzag_filter":gF(D);break;case"bitshuffle_filter":_F(D,v);break;default:throw new Xo(`Unhandled filter "${_[L]}"`)}return{layerName:p,blockIndex:T,data:D}}).catch(D=>{throw D})}))},gt(DT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var _m={workerUrl:"",workerClass:null,workerParams:void 0};let k1="mapboxgl_preloaded_worker_pool";class ym{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ym.workerCount;)this.workers.push(_m.workerClass!=null?new _m.workerClass:new self.Worker(_m.workerUrl,_m.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[k1]}numActive(){return Object.keys(this.active).length}}let vm;function xy(){return vm||(vm=new ym),vm}ym.workerCount=2;let xm,N1,Rs,gh,z1,_h=null;function AT(){return Sa()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:N1||ce.DRACO_URL}function PT(){if(Sa()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(gh)return gh;let l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return gh=WebAssembly.validate(l)?ce.MESHOPT_SIMD_URL:ce.MESHOPT_URL,gh}let by={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},PF={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},bm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function RT(l,e,r){let c=r.json.bufferViews.length,p=r.buffers.length;e.bufferView=c,r.json.bufferViews[c]={buffer:p,byteLength:l.byteLength},r.buffers[p]=l}let B1="KHR_draco_mesh_compression";function RF(l,e){let r=l.extensions&&l.extensions[B1];if(!r)return;let c=new Rs.Decoder,p=kT(e,r.bufferView),u=new Rs.Mesh;if(!c.DecodeArrayToMesh(p,p.byteLength,u))throw new Error("Failed to decode Draco mesh");let m=e.json.accessors[l.indices],v=by[m.componentType],E=m.count*v.BYTES_PER_ELEMENT,T=Rs._malloc(E);v===Uint16Array?c.GetTrianglesUInt16Array(u,E,T):c.GetTrianglesUInt32Array(u,E,T),RT(Rs.memory.buffer.slice(T,T+E),m,e),Rs._free(T);for(let _ of Object.keys(r.attributes)){let C=c.GetAttributeByUniqueId(u,r.attributes[_]),S=e.json.accessors[l.attributes[_]],w=PF[S.componentType],M=S.count*bm[S.type]*by[S.componentType].BYTES_PER_ELEMENT,D=Rs._malloc(M);c.GetAttributeDataArrayForAllPoints(u,C,Rs[w],M,D),RT(Rs.memory.buffer.slice(D,D+M),S,e),Rs._free(D)}c.destroy(),u.destroy(),delete l.extensions[B1]}let wy="EXT_meshopt_compression";function OF(l,e){if(!l.extensions||!l.extensions[wy])return;let r=l.extensions[wy],c=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),p=new Uint8Array(r.count*r.byteStride);z1.decodeGltfBuffer(p,r.count,r.byteStride,c,r.mode,r.filter),l.buffer=e.buffers.length,l.byteOffset=0,e.buffers[l.buffer]=p.buffer,delete l.extensions[wy]}let OT=1179937895,LT=new TextDecoder("utf8");function FT(l,e){return new URL(l,e).href}function LF(l,e,r,c){return fetch(FT(l.uri,c)).then(p=>p.arrayBuffer()).then(p=>{e.buffers[r]=p})}function kT(l,e){let r=l.json.bufferViews[e];return new Uint8Array(l.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function FF(l,e,r,c){if(l.uri){let p=FT(l.uri,c);return fetch(p).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[r]=u})}if(l.bufferView!==void 0){let p=kT(e,l.bufferView),u=new Blob([p],{type:l.mimeType});return createImageBitmap(u).then(m=>{e.images[r]=m})}}function NT(l,e=0,r){let c={json:null,images:[],buffers:[]};if(new Uint32Array(l,e,1)[0]===OT){let _=new Uint32Array(l,e),C=2,S=(_[C++]>>2)-3,w=_[C++]>>2;if(C++,c.json=JSON.parse(LT.decode(_.subarray(C,C+w))),C+=w,C<S){let M=_[C++];C++;let D=e+(C<<2);c.buffers[0]=l.slice(D,D+M)}}else c.json=JSON.parse(LT.decode(new Uint8Array(l,e)));let{buffers:p,images:u,meshes:m,extensionsUsed:v,bufferViews:E}=c.json,T=Promise.resolve();if(p){let _=[];for(let C=0;C<p.length;C++){let S=p[C];S.uri?_.push(LF(S,c,C,r)):c.buffers[C]||(c.buffers[C]=null)}T=Promise.all(_)}return T.then(()=>{let _=[],C=v&&v.includes(B1),S=v&&v.includes(wy);if(C&&_.push(function(){if(!Rs)return xm??(xm=function(w){let M,D=null;function L(){M=new Uint8Array(D.buffer)}function F(){throw new Error("Unexpected Draco error.")}let B={a:{a:F,d:function(V,N,U){return M.copyWithin(V,N,N+U)},c:function(V){let N=M.length,U=Math.max(V>>>0,Math.ceil(1.2*N)),H=Math.ceil((U-N)/65536);try{return D.grow(H),L(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(w,B):w.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,B))).then(V=>{let{Rb:N,Qb:U,P:H,T:J,X:oe,Ja:ee,La:ne,Qa:ge,Va:te,Wa:pe,eb:xe,jb:be,f:Se,e:Re,yb:Le,zb:De,Ab:He,Bb:et,Db:je,Gb:pt}=V.instance.exports;D=Re;let at=(()=>{let rt=0,Qe=0,Dt=0,ft=0;return yt=>{Dt&&(N(ft),N(rt),Qe+=Dt,Dt=rt=0),rt||(Qe+=128,rt=U(Qe));let Gt=yt.length+7&-8,tn=rt;Gt>=Qe&&(Dt=Gt,tn=ft=U(Gt));for(let rn=0;rn<yt.length;rn++)M[tn+rn]=yt[rn];return tn}})();return L(),Se(),{memory:Re,_free:N,_malloc:U,Mesh:class{constructor(){this.ptr=H()}destroy(){J(this.ptr)}},Decoder:class{constructor(){this.ptr=ee()}destroy(){be(this.ptr)}DecodeArrayToMesh(rt,Qe,Dt){let ft=at(rt),yt=ne(this.ptr,ft,Qe,Dt.ptr);return!!oe(yt)}GetAttributeByUniqueId(rt,Qe){return{ptr:ge(this.ptr,rt.ptr,Qe)}}GetTrianglesUInt16Array(rt,Qe,Dt){te(this.ptr,rt.ptr,Qe,Dt)}GetTrianglesUInt32Array(rt,Qe,Dt){pe(this.ptr,rt.ptr,Qe,Dt)}GetAttributeDataArrayForAllPoints(rt,Qe,Dt,ft,yt){xe(this.ptr,rt.ptr,Qe.ptr,Dt,ft,yt)}},DT_INT8:Le(),DT_UINT8:De(),DT_INT16:He(),DT_UINT16:et(),DT_UINT32:je(),DT_FLOAT32:pt()}})}(fetch(AT())),xm.then(w=>{Rs=w,xm=void 0}))}()),S&&_.push(function(){if(z1)return;let w=function(M){let D,L=WebAssembly.instantiateStreaming(M,{}).then(V=>{D=V.instance,D.exports.__wasm_call_ctors()}),F={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},B={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:L,supported:!0,decodeGltfBuffer(V,N,U,H,J,oe){(function(ee,ne,ge,te,pe,xe,be){let Se=ee.exports.sbrk,Re=te+3&-4,Le=Se(Re*pe),De=Se(xe.length),He=new Uint8Array(ee.exports.memory.buffer);He.set(xe,De);let et=ne(Le,te,pe,De,xe.length);if(et===0&&be&&be(Le,Re,pe),ge.set(He.subarray(Le,Le+te*pe)),Se(Le-Se(0)),et!==0)throw new Error(`Malformed buffer data: ${et}`)})(D,D.exports[B[J]],V,N,U,H,D.exports[F[oe]])}}}(fetch(PT()));return w.ready.then(()=>{z1=w})}()),u)for(let w=0;w<u.length;w++)_.push(FF(u[w],c,w,r));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(C&&m)for(let{primitives:w}of m)for(let M of w)RF(M,c);if(S&&m&&E)for(let w of E)OF(w,c);return c})})}function Au(l,e){let r=l.json.bufferViews[e.bufferView],c=by[e.componentType];return new c(l.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==bm[e.type]*c.BYTES_PER_ELEMENT?r.byteStride/c.BYTES_PER_ELEMENT:bm[e.type]))}function V1(l,e,r,c){let p=by[e.componentType],u=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),m=l.json.bufferViews[e.bufferView],v=m.byteStride?m.byteStride/p.BYTES_PER_ELEMENT:bm[e.type],E=r.float32,T=E.length/r.capacity;for(let _=0,C=0;_<e.count*v;_+=v,C+=T)for(let S=0;S<T;S++)E[C+S]=c[_+S]*u;r._trim()}function kF(l,e,r){let c=l.indices,p=l.attributes,u={};u.indexArray=new _i;let m=e.json.accessors[c],v=m.count/3;u.indexArray.reserve(v);let E=Au(e,m);for(let S=0;S<v;S++)u.indexArray.emplaceBack(E[3*S],E[3*S+1],E[3*S+2]);u.indexArray._trim(),u.vertexArray=new Qs;let T=e.json.accessors[p.POSITION];u.vertexArray.reserve(T.count);let _=Au(e,T);for(let S=0;S<T.count;S++)u.vertexArray.emplaceBack(_[3*S],_[3*S+1],_[3*S+2]);if(u.vertexArray._trim(),u.aabb=new Bn(T.min,T.max),u.centroid=function(S,w){let M=[0,0,0],D=S.length;if(D>0){for(let L=0;L<D;L++){let F=3*S[L];M[0]+=w[F],M[1]+=w[F+1],M[2]+=w[F+2]}M[0]/=D,M[1]/=D,M[2]/=D}return M}(E,_),p.COLOR_0!==void 0){let S=e.json.accessors[p.COLOR_0],w=bm[S.type],M=Au(e,S);u.colorArray=w===3?new Qs:new bs,u.colorArray.resize(S.count),V1(e,S,u.colorArray,M)}if(p.NORMAL!==void 0){u.normalArray=new Qs;let S=e.json.accessors[p.NORMAL];u.normalArray.resize(S.count);let w=Au(e,S);V1(e,S,u.normalArray,w)}if(p.TEXCOORD_0!==void 0&&r.length>0){u.texcoordArray=new vu;let S=e.json.accessors[p.TEXCOORD_0];u.texcoordArray.resize(S.count);let w=Au(e,S);V1(e,S,u.texcoordArray,w)}if(p._FEATURE_ID_RGBA4444!==void 0){let S=e.json.accessors[p._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Au(e,S))}p._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Au(e,e.json.accessors[p._FEATURE_RGBA4444]).buffer));let C=l.material;return u.material=function(S,w){let{emissiveFactor:M=[0,0,0],alphaMode:D="OPAQUE",alphaCutoff:L=.5,normalTexture:F,occlusionTexture:B,emissiveTexture:V,doubleSided:N}=S,{baseColorFactor:U=[1,1,1,1],metallicFactor:H=1,roughnessFactor:J=1,baseColorTexture:oe,metallicRoughnessTexture:ee}=S.pbrMetallicRoughness||{},ne=B?w[B.index]:void 0;if(B&&B.extensions&&B.extensions.KHR_texture_transform&&ne){let ge=B.extensions.KHR_texture_transform;ne.offsetScale=[ge.offset[0],ge.offset[1],ge.scale[0],ge.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Un(...U),metallicFactor:H,roughnessFactor:J,baseColorTexture:oe?w[oe.index]:void 0,metallicRoughnessTexture:ee?w[ee.index]:void 0},doubleSided:N,emissiveFactor:M,alphaMode:D,alphaCutoff:L,normalTexture:F?w[F.index]:void 0,occlusionTexture:ne,emissionTexture:V?w[V.index]:void 0,defined:S.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},r),u}function zT(l,e,r){let{matrix:c,rotation:p,translation:u,scale:m,mesh:v,extras:E,children:T}=l,_={};if(_.matrix=c||Ee.mat4.fromRotationTranslationScale([],p||[0,0,0,1],u||[0,0,0],m||[1,1,1]),v!==void 0){_.meshes=r[v];let C=_.anchor=[0,0];for(let S of _.meshes){let{min:w,max:M}=S.aabb;C[0]+=w[0]+M[0],C[1]+=w[1]+M[1]}C[0]=Math.floor(C[0]/_.meshes.length/2),C[1]=Math.floor(C[1]/_.meshes.length/2)}if(E&&(E.id&&(_.id=E.id),E.lights&&(_.lights=function(C){if(!C.length)return[];let S=function(F){let B=atob(F),V=new Uint8Array(B.length);for(let N=0;N<B.length;N++)V[N]=B.codePointAt(N);return V}(C),w=[],M=S.length/24,D=new Uint16Array(S.buffer),L=new Float32Array(S.buffer);for(let F=0;F<M;F++){let B=D[2*F*6]/30,V=D[2*F*6+1]/30,N=D[2*F*6+10]/100,U=L[6*F+1],H=L[6*F+2],J=L[6*F+3],oe=L[6*F+4],ee=J-U,ne=oe-H,ge=Math.hypot(ee,ne);w.push({pos:[U+.5*ee,H+.5*ne,V],normal:[ne/ge,-ee/ge,0],width:ge,height:B,depth:N,points:[U,H,J,oe]})}return w}(E.lights))),T){let C=[];for(let S of T)C.push(zT(e.json.nodes[S],e,r));_.children=C}return _}function NF(l){if(l.vertices.length===0||l.indices.length===0)return null;let e=new Wx(l.vertices,l.indices,8,256),[r,c]=[e.min.clone(),e.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:e,min:r,max:c}}function zF(l){if(!l.extras||!l.extras.ground)return null;let e=l.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;let c=[];for(let m of r){if(!Array.isArray(m)||m.length!==2)continue;let v=m[0],E=m[1];typeof v=="number"&&typeof E=="number"&&c.push(new lt(v,E))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let p=0;for(let m=0;m<c.length;m++){let v=c[m],E=c[(m+1)%c.length],T=c[(m+2)%c.length];p+=(v.x-E.x)*(T.y-E.y)-(T.x-E.x)*(v.y-E.y)}p>0&&c.reverse();let u=qp(c.flatMap(m=>[m.x,m.y]),[]);return u.length===0?null:{vertices:c,indices:u}}function BF(l,e){let r=[],c=[],p=0,u=[];for(let m of l){p=r.length;let v=m.vertexArray.float32,E=m.indexArray.uint16;for(let T=0;T<m.vertexArray.length;T++)u[0]=v[3*T+0],u[1]=v[3*T+1],u[2]=v[3*T+2],Ee.vec3.transformMat4(u,u,e),r.push(new lt(u[0],u[1]));for(let T=0;T<3*m.indexArray.length;T++)c.push(E[T]+p)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){let v=r[c[m+0]],E=r[c[m+1]],T=r[c[m+2]];(v.x-E.x)*(T.y-E.y)-(T.x-E.x)*(v.y-E.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:r,indices:c}}function BT(l){let e=function(E,T){let _=[],C=WebGL2RenderingContext;if(E.json.textures)for(let S of E.json.textures){let w={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};S.sampler!==void 0&&Object.assign(w,E.json.samplers[S.sampler]),_.push({image:T[S.source],sampler:w,uploaded:!1})}return _}(l,l.images),r=function(E,T){let _=[];for(let C of E.json.meshes){let S=[];for(let w of C.primitives)S.push(kF(w,E,T));_.push(S)}return _}(l,e),{scenes:c,scene:p,nodes:u}=l.json,m=c?c[p||0].nodes:u,v=[];for(let E of m)v.push(zT(u[E],l,r));return function(E,T,_){let C={},S=new Set;for(let w=0;w<E.length;w++){let M=_[T[w]];if(!M.extras)continue;let D=M.extras["mapbox:footprint:version"],L=M.extras["mapbox:footprint:id"];(D||L)&&S.add(w),D==="1.0.0"&&L&&(C[L]=w)}for(let w=0;w<E.length;w++){if(S.has(w))continue;let M=E[w],D=_[T[w]];if(!D.extras)continue;let L=null;M.id in C&&(L=BF(E[C[M.id]].meshes,M.matrix)),L||(L=zF(D)),L&&(M.footprint=NF(L))}if(S.size>0){let w=Array.from(S.values()).sort((M,D)=>M-D);for(let M=w.length-1;M>=0;M--)E.splice(w[M],1)}}(v,m,l.json.nodes),v}function VF(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);let e=l.vertexArray.float32,r=l.aabb.min[0]-1,c=l.aabb.min[1]-1,p=Iu/(l.aabb.max[0]-r+2),u=Iu/(l.aabb.max[1]-c+2);for(let m=0;m<e.length;m+=3){let v=e[m+2],E=(e[m+0]-r)*p|0,T=(e[m+1]-c)*u|0;v>l.heightmap[T*Iu+E]&&(l.heightmap[T*Iu+E]=v)}}function jF(l,e){let r={};r.indexArray=new _i,r.indexArray.reserve(4*l.length),r.vertexArray=new Qs,r.vertexArray.reserve(10*l.length),r.colorArray=new bs,r.vertexArray.reserve(10*l.length);let c=0;for(let m of l){let v=Math.min(10,Math.max(4,1.3*m.height))*e,E=[-m.normal[1],m.normal[0],0],T=Math.min(.29,.1*m.width/m.depth),_=m.width-2*m.depth*e*(T+.01),C=Ee.vec3.scaleAndAdd([],m.pos,E,_/2),S=Ee.vec3.scaleAndAdd([],m.pos,E,-_/2),w=[C[0],C[1],C[2]+m.height],M=[S[0],S[1],S[2]+m.height],D=Ee.vec3.scaleAndAdd([],m.normal,E,T);Ee.vec3.scale(D,D,v);let L=Ee.vec3.scaleAndAdd([],m.normal,E,-T);Ee.vec3.scale(L,L,v),Ee.vec3.add(D,C,D),Ee.vec3.add(L,S,L),C[2]+=.1,S[2]+=.1,r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]);let F=_/v/2;r.colorArray.emplaceBack(-F-T,-1,F,.8),r.colorArray.emplaceBack(F+T,-1,F,.8),r.colorArray.emplaceBack(-F,0,F,1.3),r.colorArray.emplaceBack(F,0,F,1.3),r.colorArray.emplaceBack(F+T,-.8,F,.7),r.colorArray.emplaceBack(F+T,-.8,F,.7),r.colorArray.emplaceBack(0,0,F,1.3),r.colorArray.emplaceBack(0,0,F,1.3),r.colorArray.emplaceBack(F+T,-1.2,F,.8),r.colorArray.emplaceBack(F+T,-1.2,F,.8),r.indexArray.emplaceBack(6+c,4+c,8+c),r.indexArray.emplaceBack(7+c,9+c,5+c),r.indexArray.emplaceBack(0+c,1+c,2+c),r.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}let p={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Un.white,p.pbrMetallicRoughness=u,r.material=p,r.aabb=new Bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class VT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){let c=e[r];this._stringToNumber[c]=r,this._numberToString[r]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class jT{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Fa(ct,16,0),this.featureIndexArray=new I_,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,c,p,u,m=0,v=0){let E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,u,m);let T=this.grid;for(let _=0;_<r.length;_++){let C=r[_],S=[1/0,1/0,-1/0,-1/0];for(let w=0;w<C.length;w++){let M=C[w];S[0]=Math.min(S[0],M.x),S[1]=Math.min(S[1],M.y),S[2]=Math.max(S[2],M.x),S[3]=Math.max(S[3],M.y)}v!==0&&(S[0]-=v,S[1]-=v,S[2]+=v,S[3]+=v),S[0]<ct&&S[1]<ct&&S[2]>=0&&S[3]>=0&&T.insert(E,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ah.VectorTile(new J_(this.rawTileData)).layers,this.sourceLayerCoder=new VT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,c){this.loadVTLayers(),this.serializedLayersCache.clear();let p=Gd(e.filter),u=e.tileResult,m=e.transform,v=u.bufferedTilespaceBounds,E=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(S,w,M,D)=>Kn(u.bufferedTilespaceGeometry,S,w,M,D));E.sort(UF);let T=null;m.elevation&&E.length>0&&(T=ph.create(m.elevation,this.tileID));let _={},C;for(let S=0;S<E.length;S++){let w=E[S];if(w===C)continue;C=w;let M=this.featureIndexArray.get(w),D=null;if(this.is3DTile){let L=this.bucketLayerIDs[0][0],F=r[L];if(F.type!=="model")continue;let{queryFeature:B,intersectionZ:V}=F.queryIntersectsMatchingFeature(u,M.featureIndex,p,m);B&&this.appendToResult(_,L,M.featureIndex,B,V)}else this.loadMatchingFeature(_,M,p,e.layers,e.availableImages,r,c,(L,F,B,V=0)=>(D||(D=Ie(L,this.tileID.canonical,e.tileTransform)),F.queryIntersectsFeature(u,L,B,D,this.z,e.transform,e.pixelPosMatrix,T,V)))}return _}loadMatchingFeature(e,r,c,p,u,m,v,E){let{featureIndex:T,bucketIndex:_,sourceLayerIndex:C,layoutVertexArrayOffset:S}=r,w=this.bucketLayerIDs[_];if(p.length&&!function(F,B){for(let V=0;V<F.length;V++)if(B.indexOf(F[V])>=0)return!0;return!1}(p,w))return;let M=this.sourceLayerCoder.decode(C),D=this.vtLayers[M].feature(T);if(c.needGeometry){let F=Ze(D,!0);if(!c.filter(new bi(this.tileID.overscaledZ),F,this.tileID.canonical))return}else if(!c.filter(new bi(this.tileID.overscaledZ),D))return;let L=this.getId(D,M);for(let F=0;F<w.length;F++){let B=w[F];if(p.length&&p.indexOf(B)<0)continue;let V=m[B];if(!V)continue;let N={};L!==void 0&&v&&(N=v.getState(V.sourceLayer||"_geojsonTileLayer",L));let U=!E||E(D,V,N,S);if(!U)continue;let H=new fm(D,this.z,this.x,this.y,L),J=this.serializedLayersCache.get(B);J||(J=V.serialize(),J.id=B,this.serializedLayersCache.set(B,J)),H.layer=pr({},J),H.tile=this.tileID.canonical,H.layer.paint=UT(J.paint,V.paint,D,N,u),H.layer.layout=UT(J.layout,V.layout,D,N,u),this.appendToResult(e,B,T,H,U)}}appendToResult(e,r,c,p,u){let m=e[r];m===void 0&&(m=e[r]=[]),m.push({featureIndex:c,feature:p,intersectionZ:u})}lookupSymbolFeatures(e,r,c,p,u,m,v){let E={};this.loadVTLayers();let T=Gd(p);for(let _ of e)this.loadMatchingFeature(E,{bucketIndex:r,sourceLayerIndex:c,featureIndex:_,layoutVertexArrayOffset:0},T,u,m,v);return E}loadFeature(e){let{featureIndex:r,sourceLayerIndex:c}=e;this.loadVTLayers();let p=this.sourceLayerCoder.decode(c),u=this.vtFeatures[p];if(u[r])return u[r];let m=this.vtLayers[p].feature(r);return u[r]=m,m}hasLayer(e){for(let r of this.bucketLayerIDs)for(let c of r)if(e===c)return!0;return!1}getId(e,r){let c=e.id;if(this.promoteId){let p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];p!=null&&(c=e.properties[p]),typeof c=="boolean"&&(c=Number(c))}return c}}function UT(l,e,r,c,p){return Ma(l,(u,m)=>{let v=e instanceof $l?e.get(m):null;return v&&v.evaluate?v.evaluate(r,c,p):v})}function UF(l,e){return e-l}gt(jT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let $T=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class j1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,c]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);let u=$T[15&c];if(!u)throw new Error("Unrecognized array type.");let[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new j1(v,m,u,e)}constructor(e,r=64,c=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=$T.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-v%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){let c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=r,c}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return U1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:m,nodeSize:v}=this,E=[0,u.length-1,0],T=[];for(;E.length;){let _=E.pop()||0,C=E.pop()||0,S=E.pop()||0;if(C-S<=v){for(let L=S;L<=C;L++){let F=m[2*L],B=m[2*L+1];F>=e&&F<=c&&B>=r&&B<=p&&T.push(u[L])}continue}let w=S+C>>1,M=m[2*w],D=m[2*w+1];M>=e&&M<=c&&D>=r&&D<=p&&T.push(u[w]),(_===0?e<=M:r<=D)&&(E.push(S),E.push(w-1),E.push(1-_)),(_===0?c>=M:p>=D)&&(E.push(w+1),E.push(C),E.push(1-_))}return T}within(e,r,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:u,nodeSize:m}=this,v=[0,p.length-1,0],E=[],T=c*c;for(;v.length;){let _=v.pop()||0,C=v.pop()||0,S=v.pop()||0;if(C-S<=m){for(let L=S;L<=C;L++)HT(u[2*L],u[2*L+1],e,r)<=T&&E.push(p[L]);continue}let w=S+C>>1,M=u[2*w],D=u[2*w+1];HT(M,D,e,r)<=T&&E.push(p[w]),(_===0?e-c<=M:r-c<=D)&&(v.push(S),v.push(w-1),v.push(1-_)),(_===0?e+c>=M:r+c>=D)&&(v.push(w+1),v.push(C),v.push(1-_))}return E}}function U1(l,e,r,c,p,u){if(p-c<=r)return;let m=c+p>>1;GT(l,e,m,c,p,u),U1(l,e,r,c,m-1,1-u),U1(l,e,r,m+1,p,1-u)}function GT(l,e,r,c,p,u){for(;p>c;){if(p-c>600){let T=p-c+1,_=r-c+1,C=Math.log(T),S=.5*Math.exp(2*C/3),w=.5*Math.sqrt(C*S*(T-S)/T)*(_-T/2<0?-1:1);GT(l,e,r,Math.max(c,Math.floor(r-_*S/T+w)),Math.min(p,Math.floor(r+(T-_)*S/T+w)),u)}let m=e[2*r+u],v=c,E=p;for(wm(l,e,c,r),e[2*p+u]>m&&wm(l,e,c,p);v<E;){for(wm(l,e,v,E),v++,E--;e[2*v+u]<m;)v++;for(;e[2*E+u]>m;)E--}e[2*c+u]===m?wm(l,e,c,E):(E++,wm(l,e,E,p)),E<=r&&(c=E+1),r<=E&&(p=E-1)}}function wm(l,e,r,c){$1(l,r,c),$1(e,2*r,2*c),$1(e,2*r+1,2*c+1)}function $1(l,e,r){let c=l[e];l[e]=l[r],l[r]=c}function HT(l,e,r,c){let p=l-r,u=e-c;return p*p+u*u}n.$=g_,n.A=class extends gy{},n.B=Da,n.C=xl,n.D=Ep,n.E=vl,n.F=cp,n.G=Oa,n.H=lp,n.I=d1,n.J=Nd,n.K=Na,n.L=La,n.M=Vl,n.N=Dd,n.O=Fl,n.P=lt,n.Q=tu,n.R=dd,n.S=Rr,n.T=C1,n.U=kf,n.V=gy,n.W=Mp,n.X=up,n.Y=c_,n.Z=function(l){let e=l.value,r=[];if(!e)return r;let c=Da(e);return c!=="string"?(r=r.concat([new gy(l.key,e,`string expected, "${c}" found`)]),r):(nT(e,!0)||(r=r.concat([new gy(l.key,e,`invalid url "${e}"`)])),r)},n._=Oe,n.a=function(l){return ce.API_CDN_URL_REGEX.test(l)},n.a$=Ks,n.a0=si,n.a1=ot,n.a2=class{constructor(l){this.specification=l}possiblyEvaluate(l,e){return $r(l.expression.evaluate(e))}interpolate(l,e,r){return{x:kt(l.x,e.x,r),y:kt(l.y,e.y,r),z:kt(l.z,e.z,r),azimuthal:kt(l.azimuthal,e.azimuthal,r),polar:kt(l.polar,e.polar,r)}}},n.a3=bi,n.a4=cu,n.a5=we,n.a6=Ee,n.a7=hl,n.a8=$l,n.a9=tc,n.aA=gn,n.aB=$S,n.aC=XS,n.aD=US,n.aE=function(l,e){let r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let c=0;c<l.length;c++){let p=document.createElement("source");co(l[c])||(r.crossOrigin="Anonymous"),p.src=l[c],r.appendChild(p)}return{cancel:()=>{}}},n.aF=dy,n.aG=function(l){return fetch(l).then(e=>e.arrayBuffer()).then(e=>NT(e,0,l))},n.aH=BT,n.aI=class{constructor(l,e,r,c){this.id=l,this.position=e!=null?new P(e[0],e[1]):new P(0,0),this.orientation=r??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new Bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,e){if(Ee.mat4.multiply(l.matrix,e,l.matrix),l.meshes)for(let r of l.meshes){let c=Bn.applyTransformFast(r.aabb,l.matrix);this.aabb.encapsulate(c)}if(l.children)for(let r of l.children)this._applyTransformations(r,l.matrix)}computeBoundsAndApplyParent(){let l=Ee.mat4.identity([]);for(let e of this.nodes)this._applyTransformations(e,l)}computeModelMatrix(l,e,r,c,p,u,m=!1){aT(this.matrix,this,l.transform,this.position,e,r,c,p,u,m)}upload(l){if(!this.uploaded){for(let e of this.nodes)I1(e,l);for(let e of this.nodes)_y(e);this.uploaded=!0}}destroy(){for(let l of this.nodes)D1(l)}},n.aJ=fl,n.aK=function(l){return l.indexOf(pu)>=0},n.aL=sm,n.aM=Q,n.aN=ie,n.aO=Hl,n.aP=_i,n.aQ=jc,n.aR=th,n.aS=cy,n.aT=function(){Yr.isLoading()||Yr.isLoaded()||wp()!=="deferred"||m_()},n.aU=Gd,n.aV=Ze,n.aW=fm,n.aX=Gc,n.aY=n1,n.aZ=qx,n.a_=Ie,n.aa=kt,n.ab=ct,n.ac=Xc,n.ad=class{constructor(l){this.specification=l}possiblyEvaluate(l,e){return function([r,c]){let p=$r([1,r,c]);return{x:p.x,y:p.y,z:p.z}}(l.expression.evaluate(e))}interpolate(l,e,r){return{x:kt(l.x,e.x,r),y:kt(l.y,e.y,r),z:kt(l.z,e.z,r)}}},n.ae=function(l,e,r=0,c=!0){let p=new lt(r,r),u=l.sub(p),m=e.add(p),v=[u,new lt(m.x,u.y),m,new lt(u.x,m.y)];return c&&v.push(u.clone()),v},n.af=function(l,e){let r=[];for(let c=0;c<l.length;c++){let p=ps(c-1,-1,l.length-1),u=ps(c+1,-1,l.length-1),m=l[c],v=l[u],E=l[p].sub(m).unit(),T=v.sub(m).unit(),_=T.angleWithSep(E.x,E.y),C=E.add(T).unit().mult(-1*e/Math.sin(_/2));r.push(m.add(C))}return r},n.ag=IS,n.ah=Kn,n.ai=function(l,e,r=0){return Ee.vec3.fromValues(((e.x-r)*l.scale-l.x)*ct,(e.y*l.scale-l.y)*ct,re(e.z,e.y))},n.aj=Or,n.ak=WM,n.al=function(l){let e=1/0,r=1/0,c=-1/0,p=-1/0;for(let u of l)e=Math.min(e,u.x),r=Math.min(r,u.y),c=Math.max(c,u.x),p=Math.max(p,u.y);return{min:new lt(e,r),max:new lt(c,p)}},n.am=q,n.an=mn,n.ao=ye,n.ap=Wt,n.aq=cr,n.ar=function(l,e){let r={};for(let c=0;c<e.length;c++){let p=e[c];p in l&&(r[p]=l[p])}return r},n.as=k,n.at=X,n.au=class{constructor(l){this.entries={},this.scheduler=l}request(l,e,r,c){let p=this.entries[l]=this.entries[l]||{callbacks:[]};if(p.result){let[u,m]=p.result;return this.scheduler?this.scheduler.add(()=>{c(u,m)},e):c(u,m),()=>{}}return p.callbacks.push(c),p.cancel||(p.cancel=r((u,m)=>{p.result=[u,m];for(let v of p.callbacks)this.scheduler?this.scheduler.add(()=>{v(u,m)},e):v(u,m);setTimeout(()=>delete this.entries[l],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(u=>u!==c),p.callbacks.length||(p.cancel(),delete this.entries[l]))}}},n.av=Wd,n.aw=function(l,e,r){let c=JSON.stringify(l.request);return l.data&&(this.deduped.entries[c]={result:[null,l.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},p=>{let u=_l(l.request,(m,v,E,T)=>{m?p(m):v&&p(null,{vectorTile:r?void 0:new ah.VectorTile(new J_(v)),rawData:v,cacheControl:E,expires:T})});return()=>{u.cancel(),p()}},e)},n.ax=function(l){Zi++,Zi>Vt&&(l.getActor().send("enforceCacheSizeLimit",Xt),Zi=0)},n.ay=it,n.az=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},n.b=function(l){return ce.API_FONTS_REGEX.test(l)},n.b$=Lr,n.b0=Fp,n.b1=Zo,n.b2=Mi,n.b3=qp,n.b4=x1,n.b5=function(l,e){let r=tc(e.zoom);if(r===0)return ta(l);let c=N_(l),p=Nx(c),u=q(c.getWest())*e.worldSize,m=q(c.getEast())*e.worldSize,v=X(c.getNorth())*e.worldSize,E=X(c.getSouth())*e.worldSize,T=[u,v,0],_=[m,v,0],C=[u,E,0],S=[m,E,0],w=Ee.mat4.invert([],e.globeMatrix);return Ee.vec3.transformMat4(T,T,w),Ee.vec3.transformMat4(_,_,w),Ee.vec3.transformMat4(C,C,w),Ee.vec3.transformMat4(S,S,w),p[0]=ja(p[0],C,r),p[1]=ja(p[1],S,r),p[2]=ja(p[2],_,r),p[3]=ja(p[3],T,r),Bn.fromPoints(p)},n.b6=B_,n.b7=Gp,n.b8=ja,n.b9=Zd,n.bA=Un,n.bB=ps,n.bC=pn,n.bD=ml,n.bE=Z,n.bF=function(l,e,r){l[4*e+0]=r[0],l[4*e+1]=r[1],l[4*e+2]=r[2],l[4*e+3]=r[3]},n.bG=Cu,n.bH=qo,n.bI=Bp,n.bJ=$i,n.bK=Va,n.bL=P,n.bM=OS,n.bN=Cn,n.bO=fo,n.bP=JS,n.bQ=Gi,n.bR=NE,n.bS=function(l,e,r,c,p,u,m,v,E){if(E.name==="globe")return NE(l,e,new Gi(r,c,p),!1);let T=sm({z:r,x:c,y:p},E);return new Bn([(u+T.x/T.scale)*e,e*(T.y/T.scale),m],[(u+T.x2/T.scale)*e,e*(T.y2/T.scale),v])},n.bT=function(l,e,r){let c=0;for(let p=0;p<2;++p)l[p]>0&&(c+=(l[p]-0)*(l[p]-0)),e[p]<0&&(c+=(0-e[p])*(0-e[p]));return c},n.bU=ae,n.bV=d,n.bW=function(l){let e=Ee.mat4.identity(new Float64Array(16));Ee.mat4.multiply(e,l.pixelMatrix,l.globeMatrix);let r=[0,g,0],c=[0,y,0];return Ee.vec3.transformMat4(r,r,e),Ee.vec3.transformMat4(c,c,e),[r[0]>0&&r[0]<=l.width&&r[1]>0&&r[1]<=l.height&&!Vx(l,new P(l.center.lat,90)),c[0]>0&&c[0]<=l.width&&c[1]>0&&c[1]<=l.height&&!Vx(l,new P(l.center.lat,-90))]},n.bX=function(l,e){let{scale:r}=l.tileTransform,c=r*ct/(l.tileSize*Math.pow(2,e.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return Ee.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},n.bY=py,n.bZ=YS,n.b_=function(l){let e=YS(l,!0);return Ee.mat2.invert([],[e[0],e[1],e[4],e[5]])},n.ba=Yi,n.bb=F1,n.bc=J_,n.bd=_l,n.be=function(l){let e=[];for(let r in l)e.push(l[r]);return e},n.bf=function(l,e){let r=[];for(let c in l)c in e||r.push(c);return r},n.bg=Ea,n.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bi=wa,n.bj=function(l,e){let{x:r,y:c}=l.point,p=VE(r,c,l.worldSize/l._pixelsPerMercatorPixel,0,0);return Ee.mat4.multiply(p,p,zx(ta(e)))},n.bk=lh,n.bl=Oo,n.bm=Y_,n.bn=function(l,e,r,c,p){let u=5*e+2;l.float32[u+0]=r,l.float32[u+1]=c,l.float32[u+2]=p},n.bo=ly,n.bp=_S,n.bq=We,n.br=ur,n.bs=vM,n.bt=tT,n.bu=EM,n.bv=MM,n.bw=p1,n.bx=ES,n.by=u1,n.bz=j1,n.c=me,n.c$=ni,n.c0=function(l){let{x:e,y:r}=l.point,{lng:c,lat:p}=l._center;return VE(e,r,l.worldSize,c,p)},n.c1=Ki,n.c2=Pn,n.c3=k_,n.c4=function(l){let e=Math.round((l+45+360)%360/90)%4;return Co[e]},n.c5=45,n.c6=W,n.c7=rh,n.c8=function(l,e,r){let c=Math.sqrt(l*l+e*e+r*r),p=c>0?Math.acos(r/c)*fs:0,u=l!==0||e!==0?Math.atan2(-e,-l)*fs+90:0;return u<0&&(u+=360),[c,u,p]},n.c9=_e,n.cA=function(l){let e=ae-5;l=Wt(l,-e,e)/e*90;let r=Math.pow(Math.abs(Math.sin(pn(l))),3);return Math.round(r*(h.length-1))},n.cB=function(l,e,r,c){let p=e.getNorth(),u=e.getSouth(),m=e.getWest(),v=e.getEast(),E=1<<l.z,T=v-m,_=p-u,C=T/o,S=-_/h[r],w=[0,C,0,S,0,0,p,m,0];if(l.z>0){let M=180/c;Ee.mat3.multiply(w,w,[M/T+1,0,0,0,M/_+1,0,-.5*M/C,.5*M/S,1])}return w[2]=E,w[5]=l.x,w[8]=l.y,w},n.cC=ta,n.cD=function(l,e,r){let c=Ee.mat4.identity(new Float64Array(16)),p=(e/(1<<l)-.5)*Math.PI*2;return Ee.mat4.rotateY(c,r.globeMatrix,p),Float32Array.from(c)},n.cE=class{isDataAvailableAtPoint(l){let e=this._source();if(this.isUsingMockSource()||!e||l.y<0||l.y>1)return!1;let r=e.getSource().maxzoom,c=1<<r,p=Math.floor(l.x),u=Math.floor((l.x-p)*c),m=Math.floor(l.y*c),v=this.findDEMTileFor(new gn(r,p,r,u,m));return!(!v||!v.dem)}getAtPointOrZero(l,e=0){return this.getAtPoint(l,e)||0}getAtPoint(l,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let c=this._source();if(!c||l.y<0||l.y>1)return e;let p=c.getSource().maxzoom,u=1<<p,m=Math.floor(l.x),v=l.x-m,E=new gn(p,m,p,Math.floor(v*u),Math.floor(l.y*u)),T=this.findDEMTileFor(E);if(!T||!T.dem)return e;let _=T.dem,C=1<<T.tileID.canonical.z,S=(v*C-T.tileID.canonical.x)*_.dim,w=(l.y*C-T.tileID.canonical.y)*_.dim,M=Math.floor(S),D=Math.floor(w);return(r?this.exaggeration():1)*kt(kt(_.get(M,D),_.get(M,D+1),w-D),kt(_.get(M+1,D),_.get(M+1,D+1),w-D),S-M)}getAtTileOffset(l,e,r){let c=1<<l.canonical.z;return this.getAtPointOrZero(new we(l.wrap+(l.canonical.x+e/ct)/c,(l.canonical.y+r/ct)/c))}getAtTileOffsetFunc(l,e,r,c){return p=>{let u=this.getAtTileOffset(l,p.x,p.y),m=c.upVector(l.canonical,p.x,p.y),v=c.upVectorScale(l.canonical,e,r).metersToTile;return Ee.vec3.scale(m,m,u*v),m}}getForTilePoints(l,e,r,c){if(this.isUsingMockSource())return!1;let p=ph.create(this,l,c);return!!p&&(e.forEach(u=>{u[2]=this.exaggeration()*p.getElevationAt(u[0],u[1],r)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(l);if(!e||!e.dem)return null;let r=e.dem.tree,c=e.tileID,p=1<<l.canonical.z-c.canonical.z,u=l.canonical.x/p-c.canonical.x,m=l.canonical.y/p-c.canonical.y,v=0;for(let E=0;E<l.canonical.z-c.canonical.z&&!r.leaves[v];E++){u*=2,m*=2;let T=2*Math.floor(m)+Math.floor(u);v=r.childOffsets[v]+T,u%=1,m%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let l=this.visibleDemTiles;if(l.length===0)return null;let e=!1,r=Number.MAX_VALUE,c=Number.MIN_VALUE;for(let p of l){let u=this.getMinMaxForTile(p.tileID);u&&(r=Math.min(r,u.min),c=Math.max(c,u.max),e=!0)}return e?{min:r,max:c}:null}},n.cF=QE,n.cG=Ql,n.cH=function(l,e){return[Math.pow(l[0],2.2)*e,Math.pow(l[1],2.2)*e,Math.pow(l[2],2.2)*e]},n.cI=BE,n.cJ=K,n.cK=Y,n.cL=256,n.cM=function(l,e){let r=[0,0,0],c=B_(ta(e.canonical));return Ee.vec3.transformMat4(r,r,c),Ee.vec3.transformMat4(r,r,l),r},n.cN=l=>({u_camera_to_center_distance:new $i(l),u_extrude_scale:new oh(l),u_device_pixel_ratio:new $i(l),u_matrix:new Cu(l),u_inv_rot_matrix:new Cu(l),u_merc_center:new qo(l),u_tile_id:new Bp(l),u_zoom_transition:new $i(l),u_up_dir:new Bp(l),u_emissive_strength:new $i(l)}),n.cO=l=>({u_matrix:new Cu(l),u_pixels_to_tile_units:new oh(l),u_device_pixel_ratio:new $i(l),u_units_to_pixels:new qo(l),u_dash_image:new Va(l),u_gradient_image:new Va(l),u_image_height:new $i(l),u_texsize:new qo(l),u_tile_units_to_pixels:new $i(l),u_alpha_discard_threshold:new $i(l),u_trim_offset:new qo(l),u_trim_fade_range:new qo(l),u_trim_color:new rh(l),u_emissive_strength:new $i(l),u_zbias_factor:new $i(l),u_tile_to_meter:new $i(l)}),n.cP=l=>({u_matrix:new Cu(l),u_texsize:new qo(l),u_pixels_to_tile_units:new oh(l),u_device_pixel_ratio:new $i(l),u_image:new Va(l),u_units_to_pixels:new qo(l),u_tile_units_to_pixels:new $i(l),u_alpha_discard_threshold:new $i(l),u_trim_offset:new qo(l),u_emissive_strength:new $i(l),u_zbias_factor:new $i(l),u_tile_to_meter:new $i(l)}),n.cQ=Wl,n.cR=uL,n.cS=dL,n.cT=$E,n.cU=(l,e,r,c,p,u)=>{let m=l.transform,v=m.projection.name==="globe",E;if(u.paint.get("circle-pitch-alignment")==="map")if(v){let _=BE(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;E=Float32Array.from([_,0,0,_])}else E=m.calculatePixelsToTileUnitsMatrix(r);else E=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);let T={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(m.projection),u_matrix:l.translatePosMatrix(e.projMatrix,r,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:dt.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:pO,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(v){T.u_inv_rot_matrix=c,T.u_merc_center=p,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=tc(m.zoom);let _=p[0]*ct,C=p[1]*ct;T.u_up_dir=m.projection.upVector(new Gi(0,0,0),_,C)}return T},n.cV=JM,n.cW=(l,e,r,c,p,u)=>{let m=l.transform,v=m.pitch<15?ZM(.07,.7,Wt((14-m.zoom)/5,0,1)):.07;return{u_matrix:YM(l,e,r,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:XM(e,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u,u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:v,u_tile_to_meter:_e(e.tileID.canonical,0)}},n.cX=(l,e,r,c,p,u,m)=>{let v=l.transform,E=v.calculatePixelsToTileUnitsMatrix(e),T=v.pitch<15?ZM(.07,.7,Wt((14-v.zoom)/5,0,1)):.07;return{u_matrix:YM(l,e,r,c),u_pixels_to_tile_units:E,u_device_pixel_ratio:u,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:KM(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:XM(e,l.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:T,u_tile_to_meter:_e(e.tileID.canonical,0)}},n.cY=Uc,n.cZ=Hp,n.c_=zM,n.ca=Bn,n.cb=$r,n.cc=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},n.cd=function(l){return l({pluginStatus:lr,pluginURL:Xr}),bp.on("pluginStateChange",l),l},n.ce=P1,n.cf=xy,n.cg=uh,n.ch=h1,n.ci=Pf,n.cj=p_,n.ck=Bt,n.cl=Ar,n.cm=lo,n.cn=function(l){let e=l.indexOf(pu);return e>=0?l.slice(0,e):l},n.co=function(l){let e=l.indexOf(pu);return e>=0?l.slice(e+1):""},n.cp=function(l){let e=[],r=l.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),l.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},n.cq=function(l,e,r,c){return l.type==="custom"?new UL(l,e):new eF[l.type](l,e,r,c)},n.cr=pl,n.cs=bp,n.ct=gl,n.cu=Vp,n.cv=class extends Cs{constructor(l){super(l),this.current=Rx}set(l,e,r){if(this.fetchUniformLocation(l,e)){for(let c=0;c<9;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},n.cw=Ca,n.cx=function(l,e,r){let c=tc(r.zoom),p=l.style.map._antialias,u=e.options.extStandardDerivativesForceOff||l.terrain&&l.terrain.exaggeration()>0;return c===0&&!p&&!u},n.cy=function(l){let e=l.pixelsPerMeter,r=e/Z(1,l.center.lat),c=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.translate(c,c,[l.point.x,l.point.y,0]),Ee.mat4.scale(c,c,[r,r,e]),Float32Array.from(c)},n.cz=N_,n.d=function(l){return ce.API_TILEJSON_REGEX.test(l)},n.d$=R,n.d0=X_,n.d1=ic,n.d2=450,n.d3=7,n.d4=jL,n.d5=Dn,n.d6=Qd,n.d7=256,n.d8=zx,n.d9=Qs,n.dA=jE,n.dB=function(l){let e=[0,0,0],r=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.multiply(r,l.pixelMatrix,l.globeMatrix),Ee.vec3.transformMat4(e,e,r),new lt(e[0],e[1])},n.dC=function(l,e,r=!1){if(lr===vp||lr===hu||lr===fu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xr=dt.resolveURL(l),lr=vp,Ud=e,xp(),r||m_()},n.dD=wp,n.dE=function(){xy().acquire(k1)},n.dF=function(){let l=vm;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(k1),vm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dG=ym,n.dH=function(l){let e=Zn();if(!e)return;let r=e.delete(Zt);l&&r.catch(l).then(()=>l())},n.dI=_m,n.dJ=AT,n.dK=function(l){N1=dt.resolveURL(l),_h||(_h=new P1(xy(),new vl)),_h.broadcast("setDracoUrl",N1)},n.dL=PT,n.dM=function(l){gh=dt.resolveURL(l),_h||(_h=new P1(xy(),new vl)),_h.broadcast("setMeshoptUrl",gh)},n.dN=gt,n.dO=nc,n.dP=Ds,n.dQ=VT,n.dR=jT,n.dS=GM,n.dT=Ma,n.dU=vS,n.dV=function(l,e,r,c,p,u,m,v,E,T,_=1,C){l.createArrays(),l.tilePixelRatio=ct/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;let S=l.layers[0].layout,w=l.layers[0]._unevaluatedLayout._values,M={};if(M.scaleFactor=_,M.textSizeScaleRange=S.get("text-size-scale-range"),M.iconSizeScaleRange=S.get("icon-size-scale-range"),M.textScaleFactor=Wt(M.scaleFactor,M.textSizeScaleRange[0],M.textSizeScaleRange[1]),M.iconScaleFactor=Wt(M.scaleFactor,M.iconSizeScaleRange[0],M.iconSizeScaleRange[1]),l.textSizeData.kind==="composite"){let{minZoom:B,maxZoom:V}=l.textSizeData;M.compositeTextSizes=[w["text-size"].possiblyEvaluate(new bi(B),v),w["text-size"].possiblyEvaluate(new bi(V),v)]}if(l.iconSizeData.kind==="composite"){let{minZoom:B,maxZoom:V}=l.iconSizeData;M.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new bi(B),v),w["icon-size"].possiblyEvaluate(new bi(V),v)]}M.layoutTextSize=w["text-size"].possiblyEvaluate(new bi(E+1),v),M.layoutIconSize=w["icon-size"].possiblyEvaluate(new bi(E+1),v),M.textMaxSize=w["text-size"].possiblyEvaluate(new bi(18),v);let D=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",L=S.get("text-size"),F=!1;for(let B of l.features)if(B.icon&&B.icon.nameSecondary){F=!0;break}for(let B of l.features){let V=S.get("text-font").evaluate(B,{},v).join(","),N=L.evaluate(B,{},v)*M.textScaleFactor,U=M.layoutTextSize.evaluate(B,{},v)*M.textScaleFactor,H=(M.layoutIconSize.evaluate(B,{},v),{horizontal:{},vertical:void 0}),J=B.text,oe,ee=[0,0];if(J){let te=J.toString(),pe=S.get("text-letter-spacing").evaluate(B,{},v)*ur,xe=S.get("text-line-height").evaluate(B,{},v)*ur,be=h_(te)?pe:0,Se=S.get("text-anchor").evaluate(B,{},v),Re=S.get("text-variable-anchor");if(!Re){let je=S.get("text-radial-offset").evaluate(B,{},v);ee=je?ES(Se,[je*ur,f1]):S.get("text-offset").evaluate(B,{},v).map(pt=>pt*ur)}let Le=D?"center":S.get("text-justify").evaluate(B,{},v),De=S.get("symbol-placement")==="point",He=De?S.get("text-max-width").evaluate(B,{},v)*ur:1/0,et=je=>{l.allowVerticalPlacement&&_p(te)&&(H.vertical=c1(J,e,r,p,V,He,xe,Se,je,be,ee,Oo.vertical,!0,U,N))};if(!D&&Re){let je=Le==="auto"?Re.map(at=>p1(at)):[Le],pt=!1;for(let at=0;at<je.length;at++){let rt=je[at];if(!H.horizontal[rt])if(pt)H.horizontal[rt]=H.horizontal[0];else{let Qe=c1(J,e,r,p,V,He,xe,"center",rt,be,ee,Oo.horizontal,!1,U,N);Qe&&(H.horizontal[rt]=Qe,pt=Qe.positionedLines.length===1)}}et("left")}else{if(Le==="auto"&&(Le=p1(Se)),De||S.get("text-writing-mode").indexOf("horizontal")>=0||!_p(te)){let je=c1(J,e,r,p,V,He,xe,Se,Le,be,ee,Oo.horizontal,!1,U,N);je&&(H.horizontal[Le]=je)}et(De?"left":Le)}}let ne=!1;if(B.icon&&B.icon.namePrimary){let te=c[B.icon.namePrimary];te&&(oe=bL(p[B.icon.namePrimary],B.icon.nameSecondary?p[B.icon.nameSecondary]:void 0,S.get("icon-offset").evaluate(B,{},v),S.get("icon-anchor").evaluate(B,{},v)),ne=te.sdf,l.sdfIcons===void 0?l.sdfIcons=te.sdf:l.sdfIcons!==te.sdf&&xn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(te.pixelRatio!==l.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}let ge=SS(H.horizontal)||H.vertical;l.iconsInText||(l.iconsInText=!!ge&&ge.iconsInText),(ge||oe)&&IL(l,B,H,oe,c,M,U,0,ee,ne,m,v,T,C,F)}u&&l.generateCollisionDebugBuffers(E,l.collisionBoxArray,M.textScaleFactor)},n.dW=ah,n.dX=vy,n.dY=Vc,n.dZ=mM,n.d_=rS,n.da=Ba,n.db=Lp,n.dc=function(l,e,r,c,p){return Wt((l-e)/(r-e)*(p-c)+c,c,p)},n.dd=Fd,n.de=le,n.df=class{constructor(l,e,r,c){this.context=l,this.format=c,this.size=r,this.texture=l.gl.createTexture();let[p,u,m]=this.size,{gl:v}=l;v.bindTexture(v.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),v.texImage3D(v.TEXTURE_3D,0,this.format,p,u,m,0,b1(this.format),w1(this.format),e.data)}bind(l,e){let{context:r}=this,{gl:c}=r;c.bindTexture(c.TEXTURE_3D,this.texture),l!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,l),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,l),this.minFilter=l),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},n.dg=S1,n.dh=[1,1,1],n.di=ph,n.dj=fh,n.dk=ea,n.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new lt(1/0,1/0),max:new lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,e=!1){let r=bM(new lt(0,0),new lt(ct,ct),l),c=[];if(e&&!Jx(r,this._globalClipBounds))return c;for(let p of this._activeRegions){if(p.hiddenByOverlap||!Jx(r,p))continue;let u=NO(p.min,p.max,l);c.push({min:u.min,max:u.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return c}setSources(l){this._setSources(l.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let r=[];for(let c of e.cache.getVisibleCoordinates()){let p=e.cache.getTile(c).buckets[e.layer];p&&p.updateFootprints(c.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(l){let e=l.getFootprints();if(e.length===0)return;let r=l.getOrder(),c=l.getClipMask(),p=l.getClipScope();for(let u of e){if(!u.footprint)continue;let m=bM(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:r,clipMask:c,clipScope:p})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||W_(e.min,r.min)||W_(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(c,p){let u=(m,v)=>m+v;return c.length-p.length||c.reduce(u,"").localeCompare(p.reduce(u,""))}(e.clipScope,r.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let e=0;for(;!l&&e!==this._activeRegions.length;){let r=this._activeRegions[e],c=this._prevRegions[e];l=r.priority!==c.priority||!xM(r,c)||r.order!==c.order||r.clipMask!==c.clipMask||!wa(r.clipScope,c.clipScope),++e}}if(l){++this._updateTime;for(let r of this._activeRegions)r.order!==q_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));let e=r=>{let c=this._activeRegions;if(r>=c.length)return r;let p=c[r].priority;for(;r<c.length&&c[r].priority===p;)++r;return r};if(this._sourceIds.length>1){let r=0,c=e(r);for(;r!==c;){let p=r,u=r;for(;p!==c;){let m=this._activeRegions[p];m.hiddenByOverlap=!1;for(let v=0;v<u;v++){let E=this._activeRegions[v];if(!E.hiddenByOverlap&&m.order===q_&&Jx(m,E)&&(m.hiddenByOverlap=CM(m.footprint,m.tileId,E.footprint,E.tileId),m.hiddenByOverlap))break}++p}r=c,c=e(r)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=l.length-1;e>=0;e--)this._addSource(l[e]);this._computeReplacement()}},n.dm=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let l of this._poleSegments)l.destroy();for(let l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,e){let r=new Ks,c=new _i,p=[],u=l+1+2,m=e[0]+1,v=e[0]+1+(1+e.length),E=(T,_,C)=>{let S=T===u-1?T-2:T===0?T:T-1;return S+=C?24575:0,[S,_]};for(let T=0;T<u;++T)r.emplaceBack(...E(T,0,!0));for(let T=0;T<m;++T)for(let _=0;_<u;++_)r.emplaceBack(...E(_,T,(_===0||_===u-1)&&!0));for(let T=0;T<e.length;++T){let _=e[T];for(let C=0;C<u;++C)r.emplaceBack(...E(C,_,!0))}for(let T=0;T<e.length;++T){let _=c.length,C=e[T]+1+2,S=new _i;for(let D=0;D<C-1;D++){let L=D===C-2,F=L?u*(v-e.length+T-D):u;for(let B=0;B<u-1;B++){let V=D*u+B;D===0||L||B===0||B===u-2?(S.emplaceBack(V+1,V,V+F),S.emplaceBack(V+F,V+F+1,V+1)):(c.emplaceBack(V+1,V,V+F),c.emplaceBack(V+F,V+F+1,V+1))}}let w=Mi.simpleSegment(0,_,r.length,c.length-_);for(let D=0;D<S.uint16.length;D+=3)c.emplaceBack(S.uint16[D],S.uint16[D+1],S.uint16[D+2]);let M=Mi.simpleSegment(0,_,r.length,c.length-_);p.push({withoutSkirts:w,withSkirts:M})}return{vertices:r,indices:c,segments:p}}_createGrid(l){let e=this._fillGridMeshWithLods(o,h);this._gridSegments=e.segments,this._gridBuffer=l.createVertexBuffer(e.vertices,Zo.members),this._gridIndexBuffer=l.createIndexBuffer(e.indices,!0)}_createPoles(l){let e=new _i;for(let m=0;m<=o;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=l.createIndexBuffer(e,!0);let r=new Ba,c=new Ba,p=new Ba,u=new Ba;this._poleSegments=[];for(let m=0,v=0;m<k_;m++){let E=360/(1<<m);r.emplaceBack(0,-cr,0,.5,0),c.emplaceBack(0,-cr,0,.5,1),p.emplaceBack(0,-cr,0,.5,.5),u.emplaceBack(0,-cr,0,.5,.5);for(let T=0;T<=o;T++){let _=T/o,C=0,S=kt(0,E,_),[w,M,D]=b(hO,fO,S,cr);r.emplaceBack(w,M,D,_,C),c.emplaceBack(w,M,D,_,1-C);let L=pn(S);_=.5+.5*Math.sin(L),C=.5+.5*Math.cos(L),p.emplaceBack(w,M,D,_,C),u.emplaceBack(w,M,D,_,1-C)}this._poleSegments.push(Mi.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(r,di,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(c,di,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(p,di,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(u,di,!1)}getGridBuffers(l,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},n.dn=q_,n.dp=Gs,n.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.dr=dl,n.ds=he,n.dt=I,n.du=function([l,e,r]){let c=Math.hypot(l,e,r),p=Math.atan2(l,r),u=.5*Math.PI-Math.acos(-e/c);return new P(Ki(p),Ki(u))},n.dv=M1,n.dw=A,n.dx=function(l){let e=l.navigator?l.navigator.userAgent:null;return!!function(r){if(Hc==null){let c=r.navigator?r.navigator.userAgent:null;Hc=!!r.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Hc}(l)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dy=function(l,e){Xt=l,Vt=e},n.dz=Vx,n.e=ce,n.e0=function(l){let e=0;if(new Uint32Array(l,0,1)[0]!==OT){let r=new Uint32Array(l,0,7),[,,c,p,u,m]=r;e=r.byteLength+p+u+m+u,(c!==l.byteLength||e>=l.byteLength)&&xn("Invalid b3dm header information.")}return NT(l,e)},n.e1=function(l,e){let r=BT(l);for(let c of r){for(let p of c.meshes)VF(p);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(jF(c.lights,e)))}return r},n.e2=yy,n.e3=fT,n.e4=Yr,n.e5=function(l){ci(),Sn?.then(e=>{e.keys().then(r=>{for(let c=0;c<r.length-l;c++)e.delete(r[c])})})},n.f=function(l){return l.indexOf("mapbox:")===0},n.g=function(l,e){return gl(pr(l,{method:"GET"}),e)},n.h=Ce,n.i=function(l){return ce.API_STYLE_REGEX.test(l)&&!me(l)},n.j=function(l){return decodeURIComponent(atob(l).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},n.l=pr,n.m=tr,n.n=function(l,e){return gl(pr(l,{type:"json"}),e)},n.o=Uo,n.p=function(l,e){return gl(pr(l,{method:"POST"}),e)},n.q=dt,n.r=Tr,n.s=function(l){try{let e=self[l];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Zc,n.u=function(){return function l(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},n.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},n.w=xn,n.x=qs,n.y=2,n.z=yS}),f(["./shared"],function(n){function R(Ve){let Y=Ve?Ve.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function $(Ve){if(typeof Ve=="number"||typeof Ve=="boolean"||typeof Ve=="string"||Ve==null)return JSON.stringify(Ve);if(Array.isArray(Ve)){let K="[";for(let ce of Ve)K+=`${$(ce)},`;return`${K}]`}let Y="{";for(let K of Object.keys(Ve).sort())Y+=`${K}:${$(Ve[K])},`;return`${Y}}`}function G(Ve){let Y="";for(let K of n.bh)Y+=`/${$(Ve[K])}`;return Y}class se{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,K){this._layerConfigs={},this._layers={},this.update(Y,[],K)}update(Y,K,ce){this._options=ce;for(let me of Y)this._layerConfigs[me.id]=me,(this._layers[me.id]=n.cq(me,this.scope,null,this._options)).compileFilter(ce),this.keyCache[me.id]&&delete this.keyCache[me.id];for(let me of K)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};let Ce=function(me,Te){let ze={};for(let Be=0;Be<me.length;Be++){let $e=Te&&Te[me[Be].id]||G(me[Be]);Te&&(Te[me[Be].id]=$e);let Ge=ze[$e];Ge||(Ge=ze[$e]=[]),Ge.push(me[Be])}let Ae=[];for(let Be in ze)Ae.push(ze[Be]);return Ae}(n.be(this._layerConfigs),this.keyCache);for(let me of Ce){let Te=me.map(it=>this._layers[it.id]),ze=Te[0];if(ze.visibility==="none")continue;let Ae=ze.source||"",Be=this.familiesBySource[Ae];Be||(Be=this.familiesBySource[Ae]={});let $e=ze.sourceLayer||"_geojsonTileLayer",Ge=Be[$e];Ge||(Ge=Be[$e]=[]),Ge.push(Te)}}}let Me=1*n.dP;class ke{constructor(Y){let K={},ce=[];for(let ze in Y){let Ae=Y[ze],Be=K[ze]={};for(let $e in Ae.glyphs){let Ge=Ae.glyphs[+$e];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;let it=Ge.metrics.localGlyph?Me:1,dt={x:0,y:0,w:Ge.bitmap.width+2*it,h:Ge.bitmap.height+2*it};ce.push(dt),Be[$e]=dt}}let{w:Ce,h:me}=n.z(ce),Te=new n.dO({width:Ce||1,height:me||1});for(let ze in Y){let Ae=Y[ze];for(let Be in Ae.glyphs){let $e=Ae.glyphs[+Be];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;let Ge=K[ze][Be],it=$e.metrics.localGlyph?Me:1;n.dO.copy($e.bitmap,Te,{x:0,y:0},{x:Ge.x+it,y:Ge.y+it},$e.bitmap)}}this.image=Te,this.positions=K}}n.dN(ke,"GlyphAtlas");class tt{constructor(Y){this.tileID=new n.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=n.aL(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor}parse(Y,K,ce,Ce,me){this.status="parsing",this.data=Y,this.collisionBoxArray=new n.aR;let Te=new n.dQ(Object.keys(Y.layers).sort()),ze=new n.dR(this.tileID,this.promoteId);ze.bucketLayerIDs=[];let Ae={},Be=new n.dS(256,256),$e={featureIndex:ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Be,availableImages:ce,brightness:this.brightness},Ge=K.familiesBySource[this.source];for(let Vt in Ge){let zn=Y.layers[Vt];if(!zn)continue;let Sn=!1,ln=!1,Zn=!1;for(let tr of Ge[Vt])tr[0].type==="symbol"?Sn=!0:ln=!0,tr[0].is3D()&&tr[0].type!=="model"&&(Zn=!0);if(this.extraShadowCaster&&!Zn||this.isSymbolTile===!0&&!Sn||this.isSymbolTile===!1&&!ln)continue;zn.version===1&&n.w(`Vector tile source "${this.source}" layer "${Vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ci=Te.encode(Vt),Zi=[];for(let tr=0,Bi=0;tr<zn.length;tr++){let nr=zn.feature(tr),Hs=ze.getId(nr,Vt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Vt)){let jo=nr.properties?nr.properties.worldview:null;if(this.worldview&&typeof jo=="string")if(jo==="all")nr.properties.$localized=!0;else{if(!jo.split(",").includes(this.worldview))continue;nr.properties.$localized=!0,nr.properties.worldview=this.worldview}}Zi.push({feature:nr,id:Hs,index:Bi,sourceLayerIndex:ci}),Bi++}for(let tr of Ge[Vt]){let Bi=tr[0];(!this.extraShadowCaster||Bi.is3D()&&Bi.type!=="model")&&(this.isSymbolTile!==void 0&&Bi.type==="symbol"!==this.isSymbolTile||Bi.minzoom&&this.zoom<Math.floor(Bi.minzoom)||Bi.maxzoom&&this.zoom>=Bi.maxzoom||Bi.visibility!=="none"&&(Ye(tr,this.zoom,$e.brightness,ce),(Ae[Bi.id]=Bi.createBucket({index:ze.bucketLayerIDs.length,layers:tr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ci,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Zi,$e,this.tileID.canonical,this.tileTransform),ze.bucketLayerIDs.push(tr.map(nr=>n.av(nr.id,nr.scope)))))}}let it,dt,xt,Bt;Be.trim();let Zt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Xt=()=>{if(it)return this.status="done",me(it);if(this.extraShadowCaster)this.status="done",me(null,{buckets:n.be(Ae).filter(Vt=>!Vt.isEmpty()),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:$e.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(dt&&xt&&Bt){let Vt=new ke(dt),zn=new n.dU(xt,Bt,this.lut);for(let Sn in Ae){let ln=Ae[Sn];ln instanceof n.aS?(Ye(ln.layers,this.zoom,$e.brightness,ce),n.dV(ln,dt,Vt.positions,xt,zn.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):ln.hasPattern&&(ln instanceof n.aY||ln instanceof n.aZ||ln instanceof n.d0)&&(Ye(ln.layers,this.zoom,$e.brightness,ce),ln.addFeatures($e,this.tileID.canonical,zn.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",me(null,{buckets:n.be(Ae).filter(Sn=>!Sn.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vt.image,lineAtlas:Be,imageAtlas:zn,brightness:$e.brightness})}};if(!this.extraShadowCaster){let Vt=n.dT($e.glyphDependencies,ln=>Object.keys(ln).map(Number));Object.keys(Vt).length?Ce.send("getGlyphs",{uid:this.uid,stacks:Vt,scope:this.scope},(ln,Zn)=>{it||(it=ln,dt=Zn,Xt())},void 0,!1,Zt):dt={};let zn=Object.keys($e.iconDependencies);zn.length?Ce.send("getImages",{icons:zn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ln,Zn)=>{it||(it=ln,xt=Zn,Xt())},void 0,!1,Zt):xt={};let Sn=Object.keys($e.patternDependencies);Sn.length?Ce.send("getImages",{icons:Sn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ln,Zn)=>{it||(it=ln,Bt=Zn,Xt())},void 0,!1,Zt):Bt={}}Xt()}}function Ye(Ve,Y,K,ce){let Ce=new n.a3(Y,{brightness:K});for(let me of Ve)me.recalculate(Ce,ce)}class wt extends n.E{constructor(Y,K,ce,Ce,me,Te){super(),this.actor=Y,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=me||n.aw,this.loading={},this.loaded={},this.deduped=new n.au(Y.scheduler),this.isSpriteLoaded=Ce,this.scheduler=Y.scheduler,this.brightness=Te}loadTile(Y,K){let ce=Y.uid,Ce=Y&&Y.request,me=Ce&&Ce.collectResourceTiming,Te=this.loading[ce]=new tt(Y);Te.abort=this.loadVectorData(Y,(ze,Ae)=>{let Be=!this.loading[ce];if(delete this.loading[ce],Be||ze||!Ae)return Te.status="done",Be||(this.loaded[ce]=Te),K(ze);let $e=Ae.rawData,Ge={};Ae.expires&&(Ge.expires=Ae.expires),Ae.cacheControl&&(Ge.cacheControl=Ae.cacheControl),Te.vectorTile=Ae.vectorTile||new n.dW.VectorTile(new n.bc($e));let it=()=>{Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.actor,(dt,xt)=>{if(dt||!xt)return K(dt);let Bt={};if(me){let Zt=R(Ce);Zt.length>0&&(Bt.resourceTiming=JSON.parse(JSON.stringify(Zt)))}K(null,n.l({rawTileData:$e.slice(0)},xt,Ge,Bt))})};this.isSpriteLoaded?it():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(it,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):it()}),this.loaded=this.loaded||{},this.loaded[ce]=Te})}reloadTile(Y,K){let ce=this.loaded,Ce=Y.uid;if(ce&&ce[Ce]){let me=ce[Ce];me.scaleFactor=Y.scaleFactor,me.showCollisionBoxes=Y.showCollisionBoxes,me.projection=Y.projection,me.brightness=Y.brightness,me.tileTransform=n.aL(Y.tileID.canonical,Y.projection),me.extraShadowCaster=Y.extraShadowCaster,me.lut=Y.lut;let Te=(ze,Ae)=>{let Be=me.reloadCallback;Be&&(delete me.reloadCallback,me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,Be)),K(ze,Ae)};me.status==="parsing"?me.reloadCallback=Te:me.status==="done"&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,Te):Te())}else K(null,void 0)}abortTile(Y,K){let ce=Y.uid,Ce=this.loading[ce];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ce]),K()}removeTile(Y,K){let ce=this.loaded,Ce=Y.uid;ce&&ce[Ce]&&delete ce[Ce],K()}}class mt{loadTile(Y,K){let{uid:ce,encoding:Ce,rawImageData:me,padding:Te}=Y,ze=ImageBitmap&&me instanceof ImageBitmap?this.getImageData(me,Te):me;K(null,new n.dX(ce,ze,Ce,Te<1))}getImageData(Y,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);let ce=this.offscreenCanvasContext.getImageData(-K,-K,Y.width+2*K,Y.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}n.bb.setPbf(n.bc);class Ht{decodeRasterArray({task:Y,buffer:K},ce){n.bb.performDecoding(K,Y).then(Ce=>{ce(null,Ce)},Ce=>{ce(Ce)})}}let _n=n.dW.VectorTileFeature.prototype.toGeoJSON;class Ut{constructor(Y){this._feature=Y,this.extent=n.ab,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){let Y=[];for(let K of this._feature.geometry)Y.push([new n.P(K[0],K[1])]);return Y}{let Y=[];for(let K of this._feature.geometry){let ce=[];for(let Ce of K)ce.push(new n.P(Ce[0],Ce[1]));Y.push(ce)}return Y}}toGeoJSON(Y,K,ce){return _n.call(this,Y,K,ce)}}class Ln{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ab,this.length=Y.length,this._features=Y}feature(Y){return new Ut(this._features[Y])}}let mi=64/4096,Pt=128;class xi{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],K){for(let ce of Y){let Ce=ce.id;if(Ce==null)continue;let me=this.features.get(Ce);me&&this.updateCache(me,K),ce.geometry?(me=zt(ce),this.updateCache(me,K),this.features.set(Ce,me)):this.features.delete(Ce),this.updateCache(me,K)}}updateCache(Y,K){for(let{canonical:ce,uid:Ce}of Object.values(K)){let{z:me,x:Te,y:ze}=ce;Qi(Y,Math.pow(2,me),Te,ze)&&delete K[Ce]}}getTile(Y,K,ce){let Ce=Math.pow(2,Y),me=[];for(let Te of this.features.values())Qi(Te,Ce,K,ce)&&me.push(ad(Te,Ce,K,ce));return{features:me}}getFeatures(){return[...this.features.values()]}}function Qi({minX:Ve,minY:Y,maxX:K,maxY:ce},Ce,me,Te){return Ve<(me+1+mi)/Ce&&Y<(Te+1+mi)/Ce&&K>(me-mi)/Ce&&ce>(Te-mi)/Ce}function zt(Ve){let{id:Y,geometry:K,properties:ce}=Ve;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:Ce,coordinates:me}=K,Te={id:Y,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ze=Te.geometry;if(Ce==="Point")$t(me,ze,Te);else if(Ce==="MultiPoint")for(let Ae of me)$t(Ae,ze,Te);else if(Ce==="LineString")Te.type=2,va(me,ze,Te);else if(Ce==="MultiLineString")Te.type=2,Us(me,ze,Te);else if(Ce==="Polygon")Te.type=3,Us(me,ze,Te,!0);else{if(Ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Te.type=3;for(let Ae of me)Us(Ae,ze,Te,!0)}return Te}function $t([Ve,Y],K,ce){let Ce=n.am(Ve),me=n.at(Y);me=me<0?0:me>1?1:me,K.push(Ce,me),ce.minX=Math.min(ce.minX,Ce),ce.minY=Math.min(ce.minY,me),ce.maxX=Math.max(ce.maxX,Ce),ce.maxY=Math.max(ce.maxY,me)}function va(Ve,Y,K,ce=!1,Ce=!1){let me=[];for(let Te of Ve)$t(Te,me,K);Y.push(me),ce&&function(Te,ze){let Ae=0;for(let Be=0,$e=Te.length,Ge=$e-2;Be<$e;Ge=Be,Be+=2)Ae+=(Te[Be]-Te[Ge])*(Te[Be+1]+Te[Ge+1]);if(Ae>0===ze)for(let Be=0,$e=Te.length;Be<$e/2;Be+=2){let Ge=Te[Be],it=Te[Be+1];Te[Be]=Te[$e-2-Be],Te[Be+1]=Te[$e-1-Be],Te[$e-2-Be]=Ge,Te[$e-1-Be]=it}}(me,Ce)}function Us(Ve,Y,K,ce=!1){for(let Ce=0;Ce<Ve.length;Ce++)va(Ve[Ce],Y,K,ce,Ce===0)}function ad(Ve,Y,K,ce){let{id:Ce,type:me,geometry:Te,tags:ze}=Ve,Ae=[];if(me===1)(function(Be,$e,Ge,it,dt){for(let xt=0;xt<Be.length;xt+=2){let Bt=Math.round(n.ab*(Be[xt+0]*$e-Ge)),Zt=Math.round(n.ab*(Be[xt+1]*$e-it));dt.push([Bt,Zt])}})(Te,Y,K,ce,Ae);else for(let Be of Te)an(Be,Y,K,ce,Ae);return{id:Ce,type:me,geometry:Ae,tags:ze}}function an(Ve,Y,K,ce,Ce){let me=-Pt,Te=n.ab+Pt,ze;for(let Ae=0;Ae<Ve.length-2;Ae+=2){let Be=Math.round(n.ab*(Ve[Ae+0]*Y-K)),$e=Math.round(n.ab*(Ve[Ae+1]*Y-ce)),Ge=Math.round(n.ab*(Ve[Ae+2]*Y-K)),it=Math.round(n.ab*(Ve[Ae+3]*Y-ce)),dt=Ge-Be,xt=it-$e;Be<me&&Ge<me||(Be<me?($e+=Math.round(xt*((me-Be)/dt)),Be=me):Ge<me&&(it=$e+Math.round(xt*((me-Be)/dt)),Ge=me),$e<me&&it<me||($e<me?(Be+=Math.round(dt*((me-$e)/xt)),$e=me):it<me&&(Ge=Be+Math.round(dt*((me-$e)/xt)),it=me),Be>=Te&&Ge>=Te||(Be>=Te?($e+=Math.round(xt*((Te-Be)/dt)),Be=Te):Ge>=Te&&(it=$e+Math.round(xt*((Te-Be)/dt)),Ge=Te),$e>=Te&&it>=Te||($e>=Te?(Be+=Math.round(dt*((Te-$e)/xt)),$e=Te):it>=Te&&(Ge=Be+Math.round(dt*((Te-$e)/xt)),it=Te),ze&&Be===ze[ze.length-1][0]&&$e===ze[ze.length-1][1]||(ze=[[Be,$e]],Ce.push(ze)),ze.push([Ge,it])))))}}var wr,ds,ll,nn={exports:{}},xa=function(){if(ll)return nn.exports;ll=1;var Ve=n.d_(),Y=function(){if(ds)return wr;ds=1;var $e=n.dY(),Ge=n.dZ().VectorTileFeature;function it(xt,Bt){this.options=Bt||{},this.features=xt,this.length=xt.length}function dt(xt,Bt){this.id=typeof xt.id=="number"?xt.id:void 0,this.type=xt.type,this.rawGeometry=xt.type===1?[xt.geometry]:xt.geometry,this.properties=xt.tags,this.extent=Bt||4096}return wr=it,it.prototype.feature=function(xt){return new dt(this.features[xt],this.options.extent)},dt.prototype.loadGeometry=function(){var xt=this.rawGeometry;this.geometry=[];for(var Bt=0;Bt<xt.length;Bt++){for(var Zt=xt[Bt],Xt=[],Vt=0;Vt<Zt.length;Vt++)Xt.push(new $e(Zt[Vt][0],Zt[Vt][1]));this.geometry.push(Xt)}return this.geometry},dt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var xt=this.geometry,Bt=1/0,Zt=-1/0,Xt=1/0,Vt=-1/0,zn=0;zn<xt.length;zn++)for(var Sn=xt[zn],ln=0;ln<Sn.length;ln++){var Zn=Sn[ln];Bt=Math.min(Bt,Zn.x),Zt=Math.max(Zt,Zn.x),Xt=Math.min(Xt,Zn.y),Vt=Math.max(Vt,Zn.y)}return[Bt,Xt,Zt,Vt]},dt.prototype.toGeoJSON=Ge.prototype.toGeoJSON,wr}();function K($e){var Ge=new Ve;return function(it,dt){for(var xt in it.layers)dt.writeMessage(3,ce,it.layers[xt])}($e,Ge),Ge.finish()}function ce($e,Ge){var it;Ge.writeVarintField(15,$e.version||1),Ge.writeStringField(1,$e.name||""),Ge.writeVarintField(5,$e.extent||4096);var dt={keys:[],values:[],keycache:{},valuecache:{}};for(it=0;it<$e.length;it++)dt.feature=$e.feature(it),Ge.writeMessage(2,Ce,dt);var xt=dt.keys;for(it=0;it<xt.length;it++)Ge.writeStringField(3,xt[it]);var Bt=dt.values;for(it=0;it<Bt.length;it++)Ge.writeMessage(4,Be,Bt[it])}function Ce($e,Ge){var it=$e.feature;it.id!==void 0&&Ge.writeVarintField(1,it.id),Ge.writeMessage(2,me,$e),Ge.writeVarintField(3,it.type),Ge.writeMessage(4,Ae,it)}function me($e,Ge){var it=$e.feature,dt=$e.keys,xt=$e.values,Bt=$e.keycache,Zt=$e.valuecache;for(var Xt in it.properties){var Vt=it.properties[Xt],zn=Bt[Xt];if(Vt!==null){zn===void 0&&(dt.push(Xt),Bt[Xt]=zn=dt.length-1),Ge.writeVarint(zn);var Sn=typeof Vt;Sn!=="string"&&Sn!=="boolean"&&Sn!=="number"&&(Vt=JSON.stringify(Vt));var ln=Sn+":"+Vt,Zn=Zt[ln];Zn===void 0&&(xt.push(Vt),Zt[ln]=Zn=xt.length-1),Ge.writeVarint(Zn)}}}function Te($e,Ge){return(Ge<<3)+(7&$e)}function ze($e){return $e<<1^$e>>31}function Ae($e,Ge){for(var it=$e.loadGeometry(),dt=$e.type,xt=0,Bt=0,Zt=it.length,Xt=0;Xt<Zt;Xt++){var Vt=it[Xt],zn=1;dt===1&&(zn=Vt.length),Ge.writeVarint(Te(1,zn));for(var Sn=dt===3?Vt.length-1:Vt.length,ln=0;ln<Sn;ln++){ln===1&&dt!==1&&Ge.writeVarint(Te(2,Sn-1));var Zn=Vt[ln].x-xt,ci=Vt[ln].y-Bt;Ge.writeVarint(ze(Zn)),Ge.writeVarint(ze(ci)),xt+=Zn,Bt+=ci}dt===3&&Ge.writeVarint(Te(7,1))}}function Be($e,Ge){var it=typeof $e;it==="string"?Ge.writeStringField(1,$e):it==="boolean"?Ge.writeBooleanField(7,$e):it==="number"&&($e%1!=0?Ge.writeDoubleField(3,$e):$e<0?Ge.writeSVarintField(6,$e):Ge.writeVarintField(5,$e))}return nn.exports=K,nn.exports.fromVectorTileJs=K,nn.exports.fromGeojsonVt=function($e,Ge){Ge=Ge||{};var it={};for(var dt in $e)it[dt]=new Y($e[dt].features,Ge),it[dt].name=dt,it[dt].version=Ge.version,it[dt].extent=Ge.extent;return K({layers:it})},nn.exports.GeoJSONWrapper=Y,nn.exports}(),Nc=n.d$(xa);let cl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},en=Math.fround||(zc=new Float32Array(1),Ve=>(zc[0]=+Ve,zc[0]));var zc;let wo=3,ao=5,ul=6;class Bc{constructor(Y){this.options=Object.assign(Object.create(cl),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){let{log:K,minZoom:ce,maxZoom:Ce}=this.options;K&&console.time("total time");let me=`prepare ${Y.length} points`;K&&console.time(me),this.points=Y;let Te=[];for(let Ae=0;Ae<Y.length;Ae++){let Be=Y[Ae];if(!Be.geometry)continue;let[$e,Ge]=Be.geometry.coordinates,it=en(hs($e)),dt=en($s(Ge));Te.push(it,dt,1/0,Ae,-1,1),this.options.reduce&&Te.push(0)}let ze=this.trees[Ce+1]=this._createTree(Te);K&&console.timeEnd(me);for(let Ae=Ce;Ae>=ce;Ae--){let Be=+Date.now();ze=this.trees[Ae]=this._createTree(this._cluster(ze,Ae)),K&&console.log("z%d: %d clusters in %dms",Ae,ze.numItems,+Date.now()-Be)}return K&&console.timeEnd("total time"),this}getClusters(Y,K){let ce=((Y[0]+180)%360+360)%360-180,Ce=Math.max(-90,Math.min(90,Y[1])),me=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,Te=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ce=-180,me=180;else if(ce>me){let Ge=this.getClusters([ce,Ce,180,Te],K),it=this.getClusters([-180,Ce,me,Te],K);return Ge.concat(it)}let ze=this.trees[this._limitZoom(K)],Ae=ze.range(hs(ce),$s(Te),hs(me),$s(Ce)),Be=ze.data,$e=[];for(let Ge of Ae){let it=this.stride*Ge;$e.push(Be[it+ao]>1?ba(Be,it,this.clusterProps):this.points[Be[it+wo]])}return $e}getChildren(Y){let K=this._getOriginId(Y),ce=this._getOriginZoom(Y),Ce="No cluster with the specified id.",me=this.trees[ce];if(!me)throw new Error(Ce);let Te=me.data;if(K*this.stride>=Te.length)throw new Error(Ce);let ze=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Ae=me.within(Te[K*this.stride],Te[K*this.stride+1],ze),Be=[];for(let $e of Ae){let Ge=$e*this.stride;Te[Ge+4]===Y&&Be.push(Te[Ge+ao]>1?ba(Te,Ge,this.clusterProps):this.points[Te[Ge+wo]])}if(Be.length===0)throw new Error(Ce);return Be}getLeaves(Y,K,ce){let Ce=[];return this._appendLeaves(Ce,Y,K=K||10,ce=ce||0,0),Ce}getTile(Y,K,ce){let Ce=this.trees[this._limitZoom(Y)],me=Math.pow(2,Y),{extent:Te,radius:ze}=this.options,Ae=ze/Te,Be=(ce-Ae)/me,$e=(ce+1+Ae)/me,Ge={features:[]};return this._addTileFeatures(Ce.range((K-Ae)/me,Be,(K+1+Ae)/me,$e),Ce.data,K,ce,me,Ge),K===0&&this._addTileFeatures(Ce.range(1-Ae/me,Be,1,$e),Ce.data,me,ce,me,Ge),K===me-1&&this._addTileFeatures(Ce.range(0,Be,Ae/me,$e),Ce.data,-1,ce,me,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(Y){let K=this._getOriginZoom(Y)-1;for(;K<=this.options.maxZoom;){let ce=this.getChildren(Y);if(K++,ce.length!==1)break;Y=ce[0].properties.cluster_id}return K}_appendLeaves(Y,K,ce,Ce,me){let Te=this.getChildren(K);for(let ze of Te){let Ae=ze.properties;if(Ae&&Ae.cluster?me+Ae.point_count<=Ce?me+=Ae.point_count:me=this._appendLeaves(Y,Ae.cluster_id,ce,Ce,me):me<Ce?me++:Y.push(ze),Y.length===ce)break}return me}_createTree(Y){let K=new n.bz(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<Y.length;ce+=this.stride)K.add(Y[ce],Y[ce+1]);return K.finish(),K.data=Y,K}_addTileFeatures(Y,K,ce,Ce,me,Te){for(let ze of Y){let Ae=ze*this.stride,Be=K[Ae+ao]>1,$e,Ge,it;if(Be)$e=Ee(K,Ae,this.clusterProps),Ge=K[Ae],it=K[Ae+1];else{let Bt=this.points[K[Ae+wo]];$e=Bt.properties;let[Zt,Xt]=Bt.geometry.coordinates;Ge=hs(Zt),it=$s(Xt)}let dt={type:1,geometry:[[Math.round(this.options.extent*(Ge*me-ce)),Math.round(this.options.extent*(it*me-Ce))]],tags:$e},xt;xt=Be||this.options.generateId?K[Ae+wo]:this.points[K[Ae+wo]].id,xt!==void 0&&(dt.id=xt),Te.features.push(dt)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,K){let{radius:ce,extent:Ce,reduce:me,minPoints:Te}=this.options,ze=ce/(Ce*Math.pow(2,K)),Ae=Y.data,Be=[],$e=this.stride;for(let Ge=0;Ge<Ae.length;Ge+=$e){if(Ae[Ge+2]<=K)continue;Ae[Ge+2]=K;let it=Ae[Ge],dt=Ae[Ge+1],xt=Y.within(Ae[Ge],Ae[Ge+1],ze),Bt=Ae[Ge+ao],Zt=Bt;for(let Xt of xt){let Vt=Xt*$e;Ae[Vt+2]>K&&(Zt+=Ae[Vt+ao])}if(Zt>Bt&&Zt>=Te){let Xt,Vt=it*Bt,zn=dt*Bt,Sn=-1,ln=(Ge/$e<<5)+(K+1)+this.points.length;for(let Zn of xt){let ci=Zn*$e;if(Ae[ci+2]<=K)continue;Ae[ci+2]=K;let Zi=Ae[ci+ao];Vt+=Ae[ci]*Zi,zn+=Ae[ci+1]*Zi,Ae[ci+4]=ln,me&&(Xt||(Xt=this._map(Ae,Ge,!0),Sn=this.clusterProps.length,this.clusterProps.push(Xt)),me(Xt,this._map(Ae,ci)))}Ae[Ge+4]=ln,Be.push(Vt/Zt,zn/Zt,1/0,ln,-1,Zt),me&&Be.push(Sn)}else{for(let Xt=0;Xt<$e;Xt++)Be.push(Ae[Ge+Xt]);if(Zt>1)for(let Xt of xt){let Vt=Xt*$e;if(!(Ae[Vt+2]<=K)){Ae[Vt+2]=K;for(let zn=0;zn<$e;zn++)Be.push(Ae[Vt+zn])}}}}return Be}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,K,ce){if(Y[K+ao]>1){let Te=this.clusterProps[Y[K+ul]];return ce?Object.assign({},Te):Te}let Ce=this.points[Y[K+wo]].properties,me=this.options.map(Ce);return ce&&me===Ce?Object.assign({},me):me}}function ba(Ve,Y,K){return{type:"Feature",id:Ve[Y+wo],properties:Ee(Ve,Y,K),geometry:{type:"Point",coordinates:[(ce=Ve[Y],360*(ce-.5)),Vc(Ve[Y+1])]}};var ce}function Ee(Ve,Y,K){let ce=Ve[Y+ao],Ce=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,me=Ve[Y+ul],Te=me===-1?{}:Object.assign({},K[me]);return Object.assign(Te,{cluster:!0,cluster_id:Ve[Y+wo],point_count:ce,point_count_abbreviated:Ce})}function hs(Ve){return Ve/360+.5}function $s(Ve){let Y=Math.sin(Ve*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function Vc(Ve){let Y=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function lt(Ve,Y,K,ce){let Ce=ce,me=Y+(K-Y>>1),Te,ze=K-Y,Ae=Ve[Y],Be=Ve[Y+1],$e=Ve[K],Ge=Ve[K+1];for(let it=Y+3;it<K;it+=3){let dt=wa(Ve[it],Ve[it+1],Ae,Be,$e,Ge);if(dt>Ce)Te=it,Ce=dt;else if(dt===Ce){let xt=Math.abs(it-me);xt<ze&&(Te=it,ze=xt)}}Ce>ce&&(Te-Y>3&&lt(Ve,Y,Te,ce),Ve[Te+2]=Ce,K-Te>3&&lt(Ve,Te,K,ce))}function wa(Ve,Y,K,ce,Ce,me){let Te=Ce-K,ze=me-ce;if(Te!==0||ze!==0){let Ae=((Ve-K)*Te+(Y-ce)*ze)/(Te*Te+ze*ze);Ae>1?(K=Ce,ce=me):Ae>0&&(K+=Te*Ae,ce+=ze*Ae)}return Te=Ve-K,ze=Y-ce,Te*Te+ze*ze}function er(Ve,Y,K,ce){let Ce={id:Ve??null,type:Y,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")fs(Ce,K);else if(Y==="Polygon")fs(Ce,K[0]);else if(Y==="MultiLineString")for(let me of K)fs(Ce,me);else if(Y==="MultiPolygon")for(let me of K)fs(Ce,me[0]);return Ce}function fs(Ve,Y){for(let K=0;K<Y.length;K+=3)Ve.minX=Math.min(Ve.minX,Y[K]),Ve.minY=Math.min(Ve.minY,Y[K+1]),Ve.maxX=Math.max(Ve.maxX,Y[K]),Ve.maxY=Math.max(Ve.maxY,Y[K+1])}function pn(Ve,Y,K,ce){if(!Y.geometry)return;let Ce=Y.geometry.coordinates;if(Ce&&Ce.length===0)return;let me=Y.geometry.type,Te=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),ze=[],Ae=Y.id;if(K.promoteId?Ae=Y.properties[K.promoteId]:K.generateId&&(Ae=ce||0),me==="Point")Ki(Ce,ze);else if(me==="MultiPoint")for(let Be of Ce)Ki(Be,ze);else if(me==="LineString")Co(Ce,ze,Te,!1);else if(me==="MultiLineString"){if(K.lineMetrics){for(let Be of Ce)ze=[],Co(Be,ze,Te,!1),Ve.push(er(Ae,"LineString",ze,Y.properties));return}Ca(Ce,ze,Te,!1)}else if(me==="Polygon")Ca(Ce,ze,Te,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(let Be of Y.geometry.geometries)pn(Ve,{id:Ae,geometry:Be,properties:Y.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Be of Ce){let $e=[];Ca(Be,$e,Te,!0),ze.push($e)}}Ve.push(er(Ae,me,ze,Y.properties))}function Ki(Ve,Y){Y.push(Gs(Ve[0]),dl(Ve[1]),0)}function Co(Ve,Y,K,ce){let Ce,me,Te=0;for(let Ae=0;Ae<Ve.length;Ae++){let Be=Gs(Ve[Ae][0]),$e=dl(Ve[Ae][1]);Y.push(Be,$e,0),Ae>0&&(Te+=ce?(Ce*$e-Be*me)/2:Math.sqrt(Math.pow(Be-Ce,2)+Math.pow($e-me,2))),Ce=Be,me=$e}let ze=Y.length-3;Y[2]=1,lt(Y,0,ze,K),Y[ze+2]=1,Y.size=Math.abs(Te),Y.start=0,Y.end=Y.size}function Ca(Ve,Y,K,ce){for(let Ce=0;Ce<Ve.length;Ce++){let me=[];Co(Ve[Ce],me,K,ce),Y.push(me)}}function Gs(Ve){return Ve/360+.5}function dl(Ve){let Y=Math.sin(Ve*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function Wt(Ve,Y,K,ce,Ce,me,Te,ze){if(ce/=Y,me>=(K/=Y)&&Te<ce)return Ve;if(Te<K||me>=ce)return null;let Ae=[];for(let Be of Ve){let $e=Be.geometry,Ge=Be.type,it=Ce===0?Be.minX:Be.minY,dt=Ce===0?Be.maxX:Be.maxY;if(it>=K&&dt<ce){Ae.push(Be);continue}if(dt<K||it>=ce)continue;let xt=[];if(Ge==="Point"||Ge==="MultiPoint")hl($e,xt,K,ce,Ce);else if(Ge==="LineString")ps($e,xt,K,ce,Ce,!1,ze.lineMetrics);else if(Ge==="MultiLineString")pr($e,xt,K,ce,Ce,!1);else if(Ge==="Polygon")pr($e,xt,K,ce,Ce,!0);else if(Ge==="MultiPolygon")for(let Bt of $e){let Zt=[];pr(Bt,Zt,K,ce,Ce,!0),Zt.length&&xt.push(Zt)}if(xt.length){if(ze.lineMetrics&&Ge==="LineString"){for(let Bt of xt)Ae.push(er(Be.id,Ge,Bt,Be.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(xt.length===1?(Ge="LineString",xt=xt[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=xt.length===3?"Point":"MultiPoint"),Ae.push(er(Be.id,Ge,xt,Be.tags))}}return Ae.length?Ae:null}function hl(Ve,Y,K,ce,Ce){for(let me=0;me<Ve.length;me+=3){let Te=Ve[me+Ce];Te>=K&&Te<=ce&&Ur(Y,Ve[me],Ve[me+1],Ve[me+2])}}function ps(Ve,Y,K,ce,Ce,me,Te){let ze=Ea(Ve),Ae=Ce===0?jc:Uc,Be,$e,Ge=Ve.start;for(let Zt=0;Zt<Ve.length-3;Zt+=3){let Xt=Ve[Zt],Vt=Ve[Zt+1],zn=Ve[Zt+2],Sn=Ve[Zt+3],ln=Ve[Zt+4],Zn=Ce===0?Xt:Vt,ci=Ce===0?Sn:ln,Zi=!1;Te&&(Be=Math.sqrt(Math.pow(Xt-Sn,2)+Math.pow(Vt-ln,2))),Zn<K?ci>K&&($e=Ae(ze,Xt,Vt,Sn,ln,K),Te&&(ze.start=Ge+Be*$e)):Zn>ce?ci<ce&&($e=Ae(ze,Xt,Vt,Sn,ln,ce),Te&&(ze.start=Ge+Be*$e)):Ur(ze,Xt,Vt,zn),ci<K&&Zn>=K&&($e=Ae(ze,Xt,Vt,Sn,ln,K),Zi=!0),ci>ce&&Zn<=ce&&($e=Ae(ze,Xt,Vt,Sn,ln,ce),Zi=!0),!me&&Zi&&(Te&&(ze.end=Ge+Be*$e),Y.push(ze),ze=Ea(Ve)),Te&&(Ge+=Be)}let it=Ve.length-3,dt=Ve[it],xt=Ve[it+1],Bt=Ce===0?dt:xt;Bt>=K&&Bt<=ce&&Ur(ze,dt,xt,Ve[it+2]),it=ze.length-3,me&&it>=3&&(ze[it]!==ze[0]||ze[it+1]!==ze[1])&&Ur(ze,ze[0],ze[1],ze[2]),ze.length&&Y.push(ze)}function Ea(Ve){let Y=[];return Y.size=Ve.size,Y.start=Ve.start,Y.end=Ve.end,Y}function pr(Ve,Y,K,ce,Ce,me){for(let Te of Ve)ps(Te,Y,K,ce,Ce,me,!1)}function Ur(Ve,Y,K,ce){Ve.push(Y,K,ce)}function jc(Ve,Y,K,ce,Ce,me){let Te=(me-Y)/(ce-Y);return Ur(Ve,me,K+(Ce-K)*Te,1),Te}function Uc(Ve,Y,K,ce,Ce,me){let Te=(me-K)/(Ce-K);return Ur(Ve,Y+(ce-Y)*Te,me,1),Te}function fl(Ve,Y){let K=[];for(let ce=0;ce<Ve.length;ce++){let Ce=Ve[ce],me=Ce.type,Te;if(me==="Point"||me==="MultiPoint"||me==="LineString")Te=ms(Ce.geometry,Y);else if(me==="MultiLineString"||me==="Polygon"){Te=[];for(let ze of Ce.geometry)Te.push(ms(ze,Y))}else if(me==="MultiPolygon"){Te=[];for(let ze of Ce.geometry){let Ae=[];for(let Be of ze)Ae.push(ms(Be,Y));Te.push(Ae)}}K.push(er(Ce.id,me,Te,Ce.tags))}return K}function ms(Ve,Y){let K=[];K.size=Ve.size,Ve.start!==void 0&&(K.start=Ve.start,K.end=Ve.end);for(let ce=0;ce<Ve.length;ce+=3)K.push(Ve[ce]+Y,Ve[ce+1],Ve[ce+2]);return K}function Ma(Ve,Y){if(Ve.transformed)return Ve;let K=1<<Ve.z,ce=Ve.x,Ce=Ve.y;for(let me of Ve.features){let Te=me.geometry,ze=me.type;if(me.geometry=[],ze===1)for(let Ae=0;Ae<Te.length;Ae+=2)me.geometry.push(pl(Te[Ae],Te[Ae+1],Y,K,ce,Ce));else for(let Ae=0;Ae<Te.length;Ae++){let Be=[];for(let $e=0;$e<Te[Ae].length;$e+=2)Be.push(pl(Te[Ae][$e],Te[Ae][$e+1],Y,K,ce,Ce));me.geometry.push(Be)}}return Ve.transformed=!0,Ve}function pl(Ve,Y,K,ce,Ce,me){return[Math.round(K*(Ve*ce-Ce)),Math.round(K*(Y*ce-me))]}function lo(Ve,Y,K,ce,Ce){let me=Y===Ce.maxZoom?0:Ce.tolerance/((1<<Y)*Ce.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:Ve.length,source:null,x:K,y:ce,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ze of Ve)$c(Te,ze,me,Ce);return Te}function $c(Ve,Y,K,ce){let Ce=Y.geometry,me=Y.type,Te=[];if(Ve.minX=Math.min(Ve.minX,Y.minX),Ve.minY=Math.min(Ve.minY,Y.minY),Ve.maxX=Math.max(Ve.maxX,Y.maxX),Ve.maxY=Math.max(Ve.maxY,Y.maxY),me==="Point"||me==="MultiPoint")for(let ze=0;ze<Ce.length;ze+=3)Te.push(Ce[ze],Ce[ze+1]),Ve.numPoints++,Ve.numSimplified++;else if(me==="LineString")xn(Te,Ce,Ve,K,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(let ze=0;ze<Ce.length;ze++)xn(Te,Ce[ze],Ve,K,me==="Polygon",ze===0);else if(me==="MultiPolygon")for(let ze=0;ze<Ce.length;ze++){let Ae=Ce[ze];for(let Be=0;Be<Ae.length;Be++)xn(Te,Ae[Be],Ve,K,!0,Be===0)}if(Te.length){let ze=Y.tags||null;if(me==="LineString"&&ce.lineMetrics){ze={};for(let Be in Y.tags)ze[Be]=Y.tags[Be];ze.mapbox_clip_start=Ce.start/Ce.size,ze.mapbox_clip_end=Ce.end/Ce.size}let Ae={geometry:Te,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:ze};Y.id!==null&&(Ae.id=Y.id),Ve.features.push(Ae)}}function xn(Ve,Y,K,ce,Ce,me){let Te=ce*ce;if(ce>0&&Y.size<(Ce?Te:ce))return void(K.numPoints+=Y.length/3);let ze=[];for(let Ae=0;Ae<Y.length;Ae+=3)(ce===0||Y[Ae+2]>Te)&&(K.numSimplified++,ze.push(Y[Ae],Y[Ae+1])),K.numPoints++;Ce&&function(Ae,Be){let $e=0;for(let Ge=0,it=Ae.length,dt=it-2;Ge<it;dt=Ge,Ge+=2)$e+=(Ae[Ge]-Ae[dt])*(Ae[Ge+1]+Ae[dt+1]);if($e>0===Be)for(let Ge=0,it=Ae.length;Ge<it/2;Ge+=2){let dt=Ae[Ge],xt=Ae[Ge+1];Ae[Ge]=Ae[it-2-Ge],Ae[Ge+1]=Ae[it-1-Ge],Ae[it-2-Ge]=dt,Ae[it-1-Ge]=xt}}(ze,me),Ve.push(ze)}let Vo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ld{constructor(Y,K){let ce=(K=this.options=function(me,Te){for(let ze in Te)me[ze]=Te[ze];return me}(Object.create(Vo),K)).debug;if(ce&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=function(me,Te){let ze=[];if(me.type==="FeatureCollection")for(let Ae=0;Ae<me.features.length;Ae++)pn(ze,me.features[Ae],Te,Ae);else pn(ze,me.type==="Feature"?me:{geometry:me},Te);return ze}(Y,K);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=function(me,Te){let ze=Te.buffer/Te.extent,Ae=me,Be=Wt(me,1,-1-ze,ze,0,-1,2,Te),$e=Wt(me,1,1-ze,2+ze,0,-1,2,Te);return(Be||$e)&&(Ae=Wt(me,1,-ze,1+ze,0,-1,2,Te)||[],Be&&(Ae=fl(Be,1).concat(Ae)),$e&&(Ae=Ae.concat(fl($e,-1)))),Ae}(Ce,K),Ce.length&&this.splitTile(Ce,0,0,0),ce&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,K,ce,Ce,me,Te,ze){let Ae=[Y,K,ce,Ce],Be=this.options,$e=Be.debug;for(;Ae.length;){Ce=Ae.pop(),ce=Ae.pop(),K=Ae.pop(),Y=Ae.pop();let Ge=1<<K,it=$r(K,ce,Ce),dt=this.tiles[it];if(!dt&&($e>1&&console.time("creation"),dt=this.tiles[it]=lo(Y,K,ce,Ce,Be),this.tileCoords.push({z:K,x:ce,y:Ce}),$e)){$e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ce,Ce,dt.numFeatures,dt.numPoints,dt.numSimplified),console.timeEnd("creation"));let Zi=`z${K}`;this.stats[Zi]=(this.stats[Zi]||0)+1,this.total++}if(dt.source=Y,me==null){if(K===Be.indexMaxZoom||dt.numPoints<=Be.indexMaxPoints)continue}else{if(K===Be.maxZoom||K===me)continue;if(me!=null){let Zi=me-K;if(ce!==Te>>Zi||Ce!==ze>>Zi)continue}}if(dt.source=null,Y.length===0)continue;$e>1&&console.time("clipping");let xt=.5*Be.buffer/Be.extent,Bt=.5-xt,Zt=.5+xt,Xt=1+xt,Vt=null,zn=null,Sn=null,ln=null,Zn=Wt(Y,Ge,ce-xt,ce+Zt,0,dt.minX,dt.maxX,Be),ci=Wt(Y,Ge,ce+Bt,ce+Xt,0,dt.minX,dt.maxX,Be);Y=null,Zn&&(Vt=Wt(Zn,Ge,Ce-xt,Ce+Zt,1,dt.minY,dt.maxY,Be),zn=Wt(Zn,Ge,Ce+Bt,Ce+Xt,1,dt.minY,dt.maxY,Be),Zn=null),ci&&(Sn=Wt(ci,Ge,Ce-xt,Ce+Zt,1,dt.minY,dt.maxY,Be),ln=Wt(ci,Ge,Ce+Bt,Ce+Xt,1,dt.minY,dt.maxY,Be),ci=null),$e>1&&console.timeEnd("clipping"),Ae.push(Vt||[],K+1,2*ce,2*Ce),Ae.push(zn||[],K+1,2*ce,2*Ce+1),Ae.push(Sn||[],K+1,2*ce+1,2*Ce),Ae.push(ln||[],K+1,2*ce+1,2*Ce+1)}}getTile(Y,K,ce){Y=+Y,K=+K,ce=+ce;let Ce=this.options,{extent:me,debug:Te}=Ce;if(Y<0||Y>24)return null;let ze=1<<Y,Ae=$r(Y,K=K+ze&ze-1,ce);if(this.tiles[Ae])return Ma(this.tiles[Ae],me);Te>1&&console.log("drilling down to z%d-%d-%d",Y,K,ce);let Be,$e=Y,Ge=K,it=ce;for(;!Be&&$e>0;)$e--,Ge>>=1,it>>=1,Be=this.tiles[$r($e,Ge,it)];return Be&&Be.source?(Te>1&&(console.log("found parent tile z%d-%d-%d",$e,Ge,it),console.time("drilling down")),this.splitTile(Be.source,$e,Ge,it,Y,K,ce),Te>1&&console.timeEnd("drilling down"),this.tiles[Ae]?Ma(this.tiles[Ae],me):null):null}}function $r(Ve,Y,K){return 32*((1<<Ve)*K+Y)+Ve}function Sa(Ve,Y){let K=Ve.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);let ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return void Y(null,null);let Ce=new Ln(ce.features),me=Nc(Ce);me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),Y(null,{vectorTile:Ce,rawData:me.buffer})}class Gc extends wt{constructor(Y,K,ce,Ce,me,Te){super(Y,K,ce,Ce,Sa,Te),me&&(this.loadGeoJSON=me),this._dynamicIndex=new xi}loadData(Y,K){let ce=Y&&Y.request,Ce=ce&&ce.collectResourceTiming;this.loadGeoJSON(Y,(me,Te)=>{if(me||!Te)return K(me);if(typeof Te!="object")return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){let Ae=n.M(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ae.result==="error")throw new Error(Ae.value.map(Be=>`${Be.key}: ${Be.message}`).join(", "));Te.features=Te.features.filter(Be=>Ae.value.evaluate({zoom:0},Be))}Y.dynamic?(Te.type==="Feature"&&(Te={type:"FeatureCollection",features:[Te]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Te.features,this.loaded),Y.cluster&&(Te.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new Bc(function({superclusterOptions:Ae,clusterProperties:Be}){if(!Be||!Ae)return Ae;let $e={},Ge={},it={accumulated:null,zoom:0},dt={properties:null},xt=Object.keys(Be);for(let Bt of xt){let[Zt,Xt]=Be[Bt],Vt=n.M(Xt),zn=n.M(typeof Zt=="string"?[Zt,["accumulated"],["get",Bt]]:Zt);$e[Bt]=Vt.value,Ge[Bt]=zn.value}return Ae.map=Bt=>{dt.properties=Bt;let Zt={};for(let Xt of xt)Zt[Xt]=$e[Xt].evaluate(it,dt);return Zt},Ae.reduce=(Bt,Zt)=>{dt.properties=Zt;for(let Xt of xt)it.accumulated=Bt[Xt],Bt[Xt]=Ge[Xt].evaluate(it,dt)},Ae}(Y)).load(Te.features):Y.dynamic?this._dynamicIndex:function(Ae,Be){return new ld(Ae,Be)}(Te,Y.geojsonVtOptions)}catch(Ae){return K(Ae)}let ze={};if(Ce){let Ae=R(ce);Ae&&(ze.resourceTiming={},ze.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Ae)))}K(null,ze)}})}reloadTile(Y,K){let ce=this.loaded;return ce&&ce[Y.uid]?Y.partial?K(null,void 0):super.reloadTile(Y,K):this.loadTile(Y,K)}loadGeoJSON(Y,K){if(Y.request)n.n(Y.request,K);else{if(typeof Y.data!="string")return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(Y.data))}catch{return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(ce){K(ce)}}getClusterChildren(Y,K){try{K(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(ce){K(ce)}}getClusterLeaves(Y,K){try{K(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(ce){K(ce)}}}class Hc{constructor(Y,K){this.tileID=new n.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=K}parse(Y,K,ce,Ce){this.status="parsing";let me=new n.aA(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Te=[],ze=K.familiesBySource[ce.source],Ae=new n.dR(me,ce.promoteId);return Ae.bucketLayerIDs=[],Ae.is3DTile=!0,n.e0(Y).then(Be=>{if(!Be)return Ce(new Error("Could not parse tile"));let $e=n.e1(Be,1/n.c9(ce.tileID.canonical)),Ge=Be.json.extensionsUsed&&Be.json.extensionsUsed.includes("MAPBOX_mesh_features")||Be.json.asset.extras&&Be.json.asset.extras.MAPBOX_mesh_features,it=Be.json.extensionsUsed&&Be.json.extensionsUsed.includes("EXT_meshopt_compression"),dt=new n.a3(this.zoom,{brightness:this.brightness});for(let xt in ze)for(let Bt of ze[xt]){let Zt=Bt[0];Ae.bucketLayerIDs.push(Bt.map(Vt=>n.av(Vt.id,Vt.scope))),Zt.recalculate(dt,[]);let Xt=new n.e2(Bt,$e,me,Ge,it,this.brightness,Ae);Ge||(Xt.needsUpload=!0),Te.push(Xt),Xt.evaluate(Zt)}this.status="done",Ce(null,{buckets:Te,featureIndex:Ae,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Be=>Ce(new Error(Be.message)))}}class ml{constructor(Y,K,ce,Ce,me,Te){this.actor=Y,this.layerIndex=K,this.availableImages=ce,this.brightness=Te,this.loading={},this.loaded={}}loadTile(Y,K){let ce=Y.uid,Ce=this.loading[ce]=new Hc(Y,this.brightness);n.bd(Y.request,(me,Te)=>{let ze=!this.loading[ce];return delete this.loading[ce],ze||me?(Ce.status="done",ze||(this.loaded[ce]=Ce),K(me)):Te&&Te.byteLength!==0?void Ce.parse(Te,this.layerIndex,Y,(Ae,Be)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[ce]=Ce,Ae||!Be?K(Ae):K(null,Be)}):(Ce.status="done",this.loaded[ce]=Ce,K())})}reloadTile(Y,K){let ce=this.loaded,Ce=Y.uid;if(ce&&ce[Ce]){let me=ce[Ce];me.projection=Y.projection,me.brightness=Y.brightness;let Te=(ze,Ae)=>{me.reloadCallback&&(delete me.reloadCallback,this.loadTile(Y,K)),K(ze,Ae)};me.status==="parsing"?me.reloadCallback=Te:me.status==="done"&&this.loadTile(Y,K)}}abortTile(Y,K){let ce=Y.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(Y,K){let ce=this.loaded,Ce=Y.uid;ce&&ce[Ce]&&delete ce[Ce],K()}}class qc{constructor(Y){this.self=Y,this.actor=new n.e3(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.bM({name:"mercator"}),this.workerSourceTypes={vector:wt,geojson:Gc,"batched-model":ml},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(n.e4.isParsed())throw new Error("RTL text plugin already registered.");n.e4.applyArabicShaping=K.applyArabicShaping,n.e4.processBidirectionalText=K.processBidirectionalText,n.e4.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(Y,K,ce){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],delete this.rasterArrayWorkerSource,ce()}checkIfReady(Y,K,ce){ce()}setReferrer(Y,K){this.referrer=K}spriteLoaded(Y,{scope:K,isLoaded:ce}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][K]=ce,this.workerSources[Y]&&this.workerSources[Y][K])for(let Ce in this.workerSources[Y][K]){let me=this.workerSources[Y][K][Ce];for(let Te in me){let ze=me[Te];ze instanceof wt&&(ze.isSpriteLoaded=ce,ze.fire(new n.x("isSpriteLoaded")))}}}setImages(Y,{scope:K,images:ce},Ce){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][K]=ce,this.workerSources[Y]&&this.workerSources[Y][K]){for(let me in this.workerSources[Y][K]){let Te=this.workerSources[Y][K][me];for(let ze in Te)Te[ze].availableImages=ce}Ce()}else Ce()}setProjection(Y,K){this.projections[Y]=n.bM(K)}setBrightness(Y,K,ce){this.brightness=K,ce()}setLayers(Y,K,ce){this.getLayerIndex(Y,K.scope).replace(K.layers,K.options),ce()}updateLayers(Y,K,ce){this.getLayerIndex(Y,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(Y,K,ce){K.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,K.type,K.source,K.scope).loadTile(K,ce)}loadDEMTile(Y,K,ce){this.getDEMWorkerSource(Y,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(Y,K,ce){this.getRasterArrayWorkerSource().decodeRasterArray(K,ce)}reloadTile(Y,K,ce){K.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(Y,K,ce){this.getWorkerSource(Y,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(Y,K,ce){this.getWorkerSource(Y,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(Y,K,ce){if(!(this.workerSources[Y]&&this.workerSources[Y][K.scope]&&this.workerSources[Y][K.scope][K.type]&&this.workerSources[Y][K.scope][K.type][K.source]))return;let Ce=this.workerSources[Y][K.scope][K.type][K.source];delete this.workerSources[Y][K.scope][K.type][K.source],Ce.removeSource!==void 0?Ce.removeSource(K,ce):ce()}loadWorkerSource(Y,K,ce){try{this.self.importScripts(K.url),ce()}catch(Ce){ce(Ce.toString())}}syncRTLPluginState(Y,K,ce){try{n.e4.setState(K);let Ce=n.e4.getPluginURL();if(n.e4.isLoaded()&&!n.e4.isParsed()&&Ce!=null){this.self.importScripts(Ce);let me=n.e4.isParsed();ce(me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ce}`),me)}}catch(Ce){ce(Ce.toString())}}setDracoUrl(Y,K){this.dracoUrl=K}getAvailableImages(Y,K){this.availableImages[Y]||(this.availableImages[Y]={});let ce=this.availableImages[Y][K];return ce||(ce=[]),ce}getLayerIndex(Y,K){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let ce=this.layerIndexes[Y][K];return ce||(ce=this.layerIndexes[Y][K]=new se,ce.scope=K),ce}getWorkerSource(Y,K,ce,Ce){return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][Ce]||(this.workerSources[Y][Ce]={}),this.workerSources[Y][Ce][K]||(this.workerSources[Y][Ce][K]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.workerSources[Y][Ce][K][ce]||(this.workerSources[Y][Ce][K][ce]=new this.workerSourceTypes[K]({send:(me,Te,ze,Ae,Be,$e)=>{this.actor.send(me,Te,ze,Y,Be,$e)},scheduler:this.actor.scheduler},this.getLayerIndex(Y,Ce),this.getAvailableImages(Y,Ce),this.isSpriteLoaded[Y][Ce],void 0,this.brightness)),this.workerSources[Y][Ce][K][ce]}getDEMWorkerSource(Y,K,ce){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ce]||(this.demWorkerSources[Y][ce]={}),this.demWorkerSources[Y][ce][K]||(this.demWorkerSources[Y][ce][K]=new mt),this.demWorkerSources[Y][ce][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ht),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Y,K){n.e5(K)}getWorkerPerformanceMetrics(Y,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new qc(self)),qc}),f(["./shared"],function(n){var R="3.8.0";let $={create:"create",load:"load",fullLoad:"fullLoad"},G={mark(d){performance.mark(d)},measure(d,t,o){performance.measure(d,t,o)}};function se(d){let t=d.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var Me,ke={},tt=function(){if(Me)return ke;function d(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,I=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(I);try{b=new Worker(A),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(A),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var I=b.getImageData(0,0,1,1);return I&&I.width===y.width}()?(o[g=h&&h.failIfMajorPerformanceCaveat]===void 0&&(o[g]=function(y){var b,I=function(A){var O=document.createElement("canvas"),P=Object.create(d.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=A,O.getContext("webgl2",P)}(y);if(!I)return!1;try{b=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!b||I.isContextLost())&&(I.shaderSource(b,"void main() {}"),I.compileShader(b),I.getShaderParameter(b,I.COMPILE_STATUS)===!0)}(g)),o[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}Me=1,ke.supported=d,ke.notSupportedReason=t;var o={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ke}();function Ye(d,t,o){let h=document.createElement(d);return t!=null&&(h.className=t),o&&o.appendChild(h),h}function wt(d,t,o){let h=document.createElementNS("http://www.w3.org/2000/svg",d);for(let g of Object.keys(t))h.setAttributeNS(null,g,String(t[g]));return o&&o.appendChild(h),h}let mt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ht=mt&&mt.userSelect!==void 0?"userSelect":"WebkitUserSelect",_n;function Ut(){mt&&Ht&&(_n=mt[Ht],mt[Ht]="none")}function Ln(){mt&&Ht&&(mt[Ht]=_n)}function mi(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",mi,!0)}function Pt(){window.addEventListener("click",mi,!0),window.setTimeout(()=>{window.removeEventListener("click",mi,!0)},0)}function xi(d,t){let o=d.getBoundingClientRect();return $t(d,o,t)}function Qi(d,t){let o=d.getBoundingClientRect(),h=[];for(let g=0;g<t.length;g++)h.push($t(d,o,t[g]));return h}function zt(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function $t(d,t,o){let h=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new n.P((o.clientX-t.left)*h,(o.clientY-t.top)*h)}let va="01",Us="NO_ACCESS_TOKEN";class ad{constructor(t,o,h){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){let t=function(){let o="";for(let h=0;h<10;h++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",va,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!n.f(t))return t;let h=wr(t);return h.params.push(`sdk=js-${R}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!n.f(t))return t;let h=wr(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||o)}normalizeModelURL(t,o){if(!n.f(t))return t;let h=wr(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||o)}normalizeSourceURL(t,o,h,g){if(!n.f(t))return t;let y=wr(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),h&&y.params.push(`language=${h}`),g&&y.params.push(`worldview=${g}`),this._makeAPIURL(y,this._customAccessToken||o)}normalizeSpriteURL(t,o,h,g){let y=wr(t);return n.f(t)?(y.path=`/styles/v1${y.path}/sprite${o}${h}`,this._makeAPIURL(y,this._customAccessToken||g)):(y.path+=`${o}${h}`,ds(y))}normalizeTileURL(t,o,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.f(t))return t;let g=wr(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||h&&g.authority!=="raster"&&h===512?"@2x":""}${n.m.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${n.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${n.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${n.e.TILE_URL_VERSION}${g.path}`);let y=this._customAccessToken||function(b){for(let I of b){let A=I.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(g.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,y)}canonicalizeTileURL(t,o){let h=wr(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let g="mapbox://";h.path.match(/^\/raster\/v1\//)?g+=`raster/${h.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${h.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${h.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let y=h.params;return o&&(y=y.filter(b=>!b.match(/^access_token=/))),y.length&&(g+=`?${y.join("&")}`),g}canonicalizeTileset(t,o){let h=!!o&&n.f(o),g=[];for(let y of t.tiles||[])n.h(y)?g.push(this.canonicalizeTileURL(y,h)):g.push(y);return g}_makeAPIURL(t,o){let h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=wr(n.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){let y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return ds(t);if(o=o||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${o||""}`),ds(t)}}let an=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function wr(d){let t=d.match(an);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ds(d){let t=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${t}`}let ll="mapbox.eventData";function nn(d){if(!d)return null;let t=d.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.j(t[1]))}catch{return null}}class xa{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let o=nn(n.e.ACCESS_TOKEN),h="";return h=o&&o.u?n.k(o.u):n.e.ACCESS_TOKEN||"",t?`${ll}.${t}:${h}`:`${ll}:${h}`}fetchEventData(){let t=n.s("localStorage"),o=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{let g=localStorage.getItem(o);g&&(this.eventData=JSON.parse(g));let y=localStorage.getItem(h);y&&(this.anonId=y)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){let t=n.s("localStorage"),o=this.getStorageKey(),h=this.getStorageKey("uuid"),g=this.anonId;if(t&&g)try{localStorage.setItem(h,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,h,g){if(!n.e.EVENTS_URL)return;let y=wr(n.e.EVENTS_URL);y.params.push(`access_token=${g||n.e.ACCESS_TOKEN||""}`);let b={event:this.type,created:new Date(t).toISOString()},I=o?n.l(b,o):b,A={url:ds(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=n.p(A,O=>{this.pendingRequest=null,h(O),this.saveEventData(),this.processRequests(g)})}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}let Nc=new class extends xa{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(o=>n.f(o)||n.h(o))&&this.queueRequest(Date.now(),t)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=nn(n.e.ACCESS_TOKEN),o=t?t.u:n.e.ACCESS_TOKEN,h=o!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),h=!0);let g=this.queue.shift();if(this.eventData.lastSuccess){let y=new Date(this.eventData.lastSuccess),b=new Date(g),I=(g-this.eventData.lastSuccess)/864e5;h=h||I>=1||I<-1||y.getDate()!==b.getDate()}else h=!0;h?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:va,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=g,this.eventData.tokenU=o)},d):this.processRequests()}},cl=Nc.postTurnstileEvent.bind(Nc),en=new class extends xa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,t,o,h){this.skuToken=t,this.errorCb=h,n.e.EVENTS_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},o):this.errorCb(new Error(Us)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:va,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d))}remove(){this.errorCb=null}},zc=en.postMapLoadEvent.bind(en),wo=new class extends xa{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let t=this.mapInstanceIdMap.get(d);return t||(t=n.u(),this.mapInstanceIdMap.set(d,t)),t}getEventId(d){let t=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,t+1),t}postStyleLoadEvent(d,t){let{map:o,style:h,importedStyles:g}=t;if(!n.e.EVENTS_URL||!d&&!n.e.ACCESS_TOKEN)return;let y=this.getMapInstanceId(o),b={mapInstanceId:y,eventId:this.getEventId(y),style:h};g.length&&(b.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:b},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},d)}},ao=wo.postStyleLoadEvent.bind(wo),ul=new class extends xa{constructor(){super("gljs.performance")}postPerformanceEvent(d,t){n.e.EVENTS_URL&&(d||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:o}=this.queue.shift(),h=function(g){let y=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),I=function(j){let W={};if(j){for(let q in j)if(q!=="other")for(let X of j[q]){let Z=`${q}ResolveRangeMin`,Q=`${q}ResolveRangeMax`,ie=`${q}RequestCount`,re=`${q}RequestCachedCount`;W[Z]=Math.min(W[Z]||1/0,X.startTime),W[Q]=Math.max(W[Q]||-1/0,X.responseEnd);let ae=de=>{W[de]===void 0&&(W[de]=0),++W[de]};X.transferSize!==void 0&&X.transferSize===0&&ae(re),ae(ie)}}return W}(function(j,W){let q={};if(j)for(let X of j){let Z=W(X);q[Z]===void 0&&(q[Z]=[]),q[Z].push(X)}return q}(y,se)),A=window.devicePixelRatio,O=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=O?O.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},z=(j,W,q)=>{q!=null&&j.push({name:W,value:q.toString()})};for(let j in I)z(k.counters,j,I[j]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(z(k.counters,"interactionRangeMin",g.interactionRange[0]),z(k.counters,"interactionRangeMax",g.interactionRange[1])),b)for(let j of Object.keys($)){let W=$[j],q=b.find(X=>X.name===W);q&&z(k.counters,W,q.startTime)}return z(k.counters,"visibilityHidden",g.visibilityHidden),z(k.attributes,"style",function(j){if(j)for(let W of j){let q=W.name.split("?")[0];if(n.i(q)){let X=q.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(y)),z(k.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),z(k.attributes,"fogEnabled",g.fogEnabled?"true":"false"),z(k.attributes,"projection",g.projection),z(k.attributes,"zoom",g.zoom),z(k.metadata,"devicePixelRatio",A),z(k.metadata,"connectionEffectiveType",P),z(k.metadata,"navigatorUserAgent",navigator.userAgent),z(k.metadata,"screenWidth",window.screen.width),z(k.metadata,"screenHeight",window.screen.height),z(k.metadata,"windowWidth",window.innerWidth),z(k.metadata,"windowHeight",window.innerHeight),z(k.metadata,"mapWidth",g.width/A),z(k.metadata,"mapHeight",g.height/A),z(k.metadata,"webglRenderer",g.renderer),z(k.metadata,"webglVendor",g.vendor),z(k.metadata,"sdkVersion",R),z(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(o);for(let g of h.metadata);for(let g of h.counters);for(let g of h.attributes);this.postEvent(t,h,()=>{},d)}},Bc=ul.postPerformanceEvent.bind(ul),ba=new class extends xa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,t,o,h){if(!n.e.API_URL||!n.e.SESSION_PATH)return;let g=wr(n.e.API_URL+n.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${h||n.e.ACCESS_TOKEN||""}`);let y={url:ds(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(y,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(h)})}getSessionAPI(d,t,o,h){this.skuToken=t,this.errorCb=h,n.e.SESSION_PATH&&n.e.API_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},o):this.errorCb(new Error(Us)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d)}remove(){this.errorCb=null}},Ee=ba.getSessionAPI.bind(ba),hs=new Set;function $s(d,t){t?hs.add(d):hs.delete(d)}class Vc{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){let o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(let o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function lt(d){let{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class wa extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new n.r({width:1,height:1})}isLoaded(){for(let t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,o){if(this.loaded[o]!==t&&(this.loaded[o]=t,t)){for(let{ids:h,callback:g}of this.requestors)this._notify(h,o,g);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images[o][t]}addImage(t,o,h){this._validate(t,h)&&(this.images[o][t]=h)}_validate(t,o){let h=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,o){if(!t)return!0;let h=0;for(let g of t){if(g[0]<h||g[1]<g[0]||o<g[1])return!1;h=g[1]}return!0}_validateContent(t,o){return!(t&&(t.length!==4||t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,o,h){h.version=this.images[o][t].version+1,this.images[o][t]=h,this.updatedImages[o][t]=!0}removeImage(t,o){let h=this.images[o][t];delete this.images[o][t],delete this.patterns[o][t],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,o,h){let g=!0,y=!!this.loaded[o];if(!y)for(let b of t)this.images[o][b]||(g=!1);y||g?this._notify(t,o,h):this.requestors.push({ids:t,scope:o,callback:h})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,o,h){let g={};for(let y of t){this.images[o][y]||this.fire(new n.x("styleimagemissing",{id:y}));let b=this.images[o][y];b?g[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:n.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,g)}getPixelSize(t){let{width:o,height:h}=this.atlasImage[t];return{width:o,height:h}}getPattern(t,o,h){let g=this.patterns[o][t],y=this.getImage(t,o);if(!y)return null;if(g&&g.position.version===y.version)return g.position;if(g)g.position.version=y.version;else{let b={w:y.data.width+2*n.y,h:y.data.height+2*n.y,x:0,y:0},I=new n.I(b,y,n.y);this.patterns[o][t]={bin:b,position:I}}return this._updatePatternAtlas(o,h),this.patterns[o][t].position}bind(t,o){let h=t.gl,g=this.atlasTexture[o];g?this.dirty&&(g.update(this.atlasImage[o]),this.dirty=!1):(g=new n.T(t,this.atlasImage[o],h.RGBA8),this.atlasTexture[o]=g),g.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){let h=[];for(let I in this.patterns[t])h.push(this.patterns[t][I].bin);let{w:g,h:y}=n.z(h),b=this.atlasImage[t];b.resize({width:g||1,height:y||1});for(let I in this.patterns[t]){let{bin:A,position:O}=this.patterns[t][I],P=O.padding,k=A.x+P,z=A.y+P,j=this.images[t][I].data,W=j.width,q=j.height;P=P>1?P-1:P,n.r.copy(j,b,{x:0,y:0},{x:k,y:z},{width:W,height:q},o),n.r.copy(j,b,{x:0,y:q-P},{x:k,y:z-P},{width:W,height:P},o),n.r.copy(j,b,{x:0,y:0},{x:k,y:z+q},{width:W,height:P},o),n.r.copy(j,b,{x:W-P,y:0},{x:k-P,y:z},{width:P,height:q},o),n.r.copy(j,b,{x:0,y:0},{x:k+W,y:z},{width:P,height:q},o),n.r.copy(j,b,{x:W-P,y:q-P},{x:k-P,y:z-P},{width:P,height:P},o),n.r.copy(j,b,{x:0,y:q-P},{x:k+W,y:z-P},{width:P,height:P},o),n.r.copy(j,b,{x:0,y:0},{x:k+W,y:z+q},{width:P,height:P},o),n.r.copy(j,b,{x:W-P,y:0},{x:k-P,y:z+q},{width:P,height:P},o)}this.dirty=!0}beginFrame(){for(let t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,o){for(let h of t){if(this.callbackDispatchedThisFrame[o][h])continue;this.callbackDispatchedThisFrame[o][h]=!0;let g=this.images[o][h];lt(g)&&this.updateImage(h,o,g)}}}function er(d){let t=d.key,o=d.value,h=d.valueSpec||{},g=d.objectElementValidators||{},y=d.style,b=d.styleSpec,I=[],A=n.B(o);if(A!=="object")return[new n.V(t,o,`object expected, ${A} found`)];for(let O in o){let P=O.split(".")[0],k;g[P]?k=g[P]:h[P]?k=xn:g["*"]?k=g["*"]:h["*"]&&(k=xn),k?I=I.concat(k({key:(t&&`${t}.`)+O,value:o[O],valueSpec:h[P]||h["*"],style:y,styleSpec:b,object:o,objectKey:O},o)):I.push(new n.A(t,o[O],`unknown property "${O}"`))}for(let O in h)g[O]||h[O].required&&h[O].default===void 0&&o[O]===void 0&&I.push(new n.V(t,o,`missing required property "${O}"`));return I}function fs(d){let t=d.value,o=d.valueSpec,h=d.style,g=d.styleSpec,y=d.key,b=d.arrayElementValidator||xn;if(n.B(t)!=="array")return[new n.V(y,t,`array expected, ${n.B(t)} found`)];if(o.length&&t.length!==o.length)return[new n.V(y,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new n.V(y,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let I={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};g.$version<7&&(I.function=o.function),n.B(o.value)==="object"&&(I=o.value);let A=[];for(let O=0;O<t.length;O++)A=A.concat(b({array:t,arrayIndex:O,value:t[O],valueSpec:I,style:h,styleSpec:g,key:`${y}[${O}]`},!0));return A}function pn(d){let t=d.key,o=d.value,h=d.valueSpec,g=n.B(o);if(g==="number"&&o!=o&&(g="NaN"),g!=="number")return[new n.V(t,o,`number expected, ${g} found`)];if("minimum"in h){let y=h.minimum;if(n.B(h.minimum)==="array"&&(y=h.minimum[d.arrayIndex]),o<y)return[new n.V(t,o,`${o} is less than the minimum value ${y}`)]}if("maximum"in h){let y=h.maximum;if(n.B(h.maximum)==="array"&&(y=h.maximum[d.arrayIndex]),o>y)return[new n.V(t,o,`${o} is greater than the maximum value ${y}`)]}return[]}function Ki(d){let t=d.valueSpec,o=n.D(d.value.type),h,g,y,b={},I=o!=="categorical"&&d.value.property===void 0,A=!I,O=n.B(d.value.stops)==="array"&&n.B(d.value.stops[0])==="array"&&n.B(d.value.stops[0][0])==="object",P=er({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(j){if(o==="identity")return[new n.V(j.key,j.value,'identity function may not have a "stops" property')];let W=[],q=j.value;return W=W.concat(fs({key:j.key,value:q,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:k})),n.B(q)==="array"&&q.length===0&&W.push(new n.V(j.key,q,"array must have at least one stop")),W},default:function(j){return xn({key:j.key,value:j.value,valueSpec:t,style:j.style,styleSpec:j.styleSpec})}}});return o==="identity"&&I&&P.push(new n.V(d.key,d.value,'missing required property "property"')),o==="identity"||d.value.stops||P.push(new n.V(d.key,d.value,'missing required property "stops"')),o==="exponential"&&d.valueSpec.expression&&!n.F(d.valueSpec)&&P.push(new n.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(A&&!n.G(d.valueSpec)?P.push(new n.V(d.key,d.value,"property functions not supported")):I&&!n.H(d.valueSpec)&&P.push(new n.V(d.key,d.value,"zoom functions not supported"))),o!=="categorical"&&!O||d.value.property!==void 0||P.push(new n.V(d.key,d.value,'"property" property is required')),P;function k(j){let W=[],q=j.value,X=j.key;if(n.B(q)!=="array")return[new n.V(X,q,`array expected, ${n.B(q)} found`)];if(q.length!==2)return[new n.V(X,q,`array length 2 expected, length ${q.length} found`)];if(O){if(n.B(q[0])!=="object")return[new n.V(X,q,`object expected, ${n.B(q[0])} found`)];if(q[0].zoom===void 0)return[new n.V(X,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new n.V(X,q,"object stop key must have value")];let Z=n.D(q[0].zoom);if(typeof Z!="number")return[new n.V(X,q[0].zoom,"stop zoom values must be numbers")];if(y&&y>Z)return[new n.V(X,q[0].zoom,"stop zoom values must appear in ascending order")];Z!==y&&(y=Z,g=void 0,b={}),W=W.concat(er({key:`${X}[0]`,value:q[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:pn,value:z}}))}else W=W.concat(z({key:`${X}[0]`,value:q[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},q));return n.J(n.K(q[1]))?W.concat([new n.V(`${X}[1]`,q[1],"expressions are not allowed in function stops.")]):W.concat(xn({key:`${X}[1]`,value:q[1],valueSpec:t,style:j.style,styleSpec:j.styleSpec}))}function z(j,W){let q=n.B(j.value),X=n.D(j.value),Z=j.value!==null?j.value:W;if(h){if(q!==h)return[new n.V(j.key,Z,`${q} stop domain type must match previous stop domain type ${h}`)]}else h=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new n.V(j.key,Z,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&o!=="categorical"){let Q=`number expected, ${q} found`;return n.G(t)&&o===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(j.key,Z,Q)]}return o!=="categorical"||q!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?o!=="categorical"&&q==="number"&&typeof X=="number"&&typeof g=="number"&&g!==void 0&&X<g?[new n.V(j.key,Z,"stop domain values must appear in ascending order")]:(g=X,o==="categorical"&&X in b?[new n.V(j.key,Z,"stop domain values must be unique")]:(b[X]=!0,[])):[new n.V(j.key,Z,`integer expected, found ${String(X)}`)]}}function Co(d){let t=(d.expressionContext==="property"?n.L:n.M)(n.K(d.value),d.valueSpec);if(t.result==="error")return t.value.map(h=>new n.V(`${d.key}${h.key}`,d.value,h.message));let o=t.value.expression||t.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!o.outputDefined())return[new n.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!n.N(o))return[new n.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Ca(o,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!n.O(o,["zoom","feature-state"]))return[new n.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!n.Q(o))return[new n.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ca(d,t){let o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let g of t.valueSpec.expression.parameters)o.delete(g);if(o.size===0)return[];let h=[];return d instanceof n.S&&o.has(d.name)?[new n.V(t.key,t.value,`["${d.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(d.eachChild(g=>{h.push(...Ca(g,t))}),h)}function Gs(d){let t=d.key,o=d.value,h=d.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(n.D(o))===-1&&g.push(new n.V(t,o,`expected one of [${h.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(h.values).indexOf(n.D(o))===-1&&g.push(new n.V(t,o,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function dl(d){return n.W(n.K(d.value))?Co(n.C({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):Wt(d)}function Wt(d){let t=d.value,o=d.key;if(n.B(t)!=="array")return[new n.V(o,t,`array expected, ${n.B(t)} found`)];let h=d.styleSpec,g,y=[];if(t.length<1)return[new n.V(o,t,"filter array must have at least 1 element")];switch(y=y.concat(Gs({key:`${o}[0]`,value:t[0],valueSpec:h.filter_operator,style:d.style,styleSpec:d.styleSpec})),n.D(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.D(t[1])==="$type"&&y.push(new n.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new n.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=n.B(t[1]),g!=="string"&&y.push(new n.V(`${o}[1]`,t[1],`string expected, ${g} found`)));for(let b=2;b<t.length;b++)g=n.B(t[b]),n.D(t[1])==="$type"?y=y.concat(Gs({key:`${o}[${b}]`,value:t[b],valueSpec:h.geometry_type,style:d.style,styleSpec:d.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new n.V(`${o}[${b}]`,t[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)y=y.concat(Wt({key:`${o}[${b}]`,value:t[b],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":g=n.B(t[1]),t.length!==2?y.push(new n.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new n.V(`${o}[1]`,t[1],`string expected, ${g} found`))}return y}function hl(d,t){let o=d.key,h=d.style,g=d.layer,y=d.styleSpec,b=d.value,I=d.objectKey,A=y[`${t}_${d.layerType}`];if(!A)return[];let O=I.match(/^(.*)-transition$/);if(t==="paint"&&O&&A[O[1]]&&A[O[1]].transition)return xn({key:o,value:b,valueSpec:y.transition,style:h,styleSpec:y});let P=d.valueSpec||A[I];if(!P)return[new n.A(o,b,`unknown property "${I}"`)];let k;if(n.B(b)==="string"&&n.G(P)&&!P.tokens&&(k=/^{([^}]+)}$/.exec(b))){let j=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new n.V(o,b,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}let z=[];if(d.layerType==="symbol")I!=="text-field"||!h||h.glyphs||h.imports||z.push(new n.V(o,b,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&n.X(n.K(b))&&n.D(b.type)==="identity"&&z.push(new n.V(o,b,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&n.G(P)&&(n.Y(P)||n.H(P))){let j=n.L(n.K(b),P),W=j.value.expression||j.value._styleExpression.expression;W&&!n.O(W,["measure-light"])&&(I==="model-emissive-strength"&&n.Q(W)&&n.N(W)||z.push(new n.V(o,b,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(xn({key:d.key,value:b,valueSpec:P,style:h,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:I}))}function ps(d){return hl(d,"paint")}function Ea(d){return hl(d,"layout")}function pr(d){let t=[],o=d.value,h=d.key,g=d.style,y=d.styleSpec;o.type||o.ref||t.push(new n.V(h,o,'either "type" or "ref" is required'));let b=n.D(o.type),I=n.D(o.ref);if(o.id){let A=n.D(o.id);for(let O=0;O<d.arrayIndex;O++){let P=g.layers[O];n.D(P.id)===A&&t.push(new n.V(h,o.id,`duplicate layer id "${o.id}", previously used at line ${P.id.__line__}`))}}if("ref"in o){let A;["type","source","source-layer","filter","layout"].forEach(O=>{O in o&&t.push(new n.V(h,o[O],`"${O}" is prohibited for ref layers`))}),g.layers.forEach(O=>{n.D(O.id)===I&&(A=O)}),A?A.ref?t.push(new n.V(h,o.ref,"ref cannot reference another ref layer")):b=n.D(A.type):typeof I=="string"&&t.push(new n.V(h,o.ref,`ref layer "${I}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(o.source){let A=g.sources&&g.sources[o.source],O=A&&n.D(A.type);A?O==="vector"&&b==="raster"?t.push(new n.V(h,o.source,`layer "${o.id}" requires a raster source`)):O==="raster"&&b!=="raster"?t.push(new n.V(h,o.source,`layer "${o.id}" requires a vector source`)):O!=="vector"||o["source-layer"]?O==="raster-dem"&&b!=="hillshade"?t.push(new n.V(h,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||O==="geojson"&&A.lineMetrics?b==="raster-particle"&&O!=="raster-array"&&t.push(new n.V(h,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new n.V(h,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new n.V(h,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(h,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new n.V(h,o.source,`source "${o.source}" not found`))}else t.push(new n.V(h,o,'missing required property "source"'));return t=t.concat(er({key:h,value:o,valueSpec:y.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>xn({key:`${h}.type`,value:o.type,valueSpec:y.layer.type,style:d.style,styleSpec:d.styleSpec,object:o,objectKey:"type"}),filter:A=>dl(n.C({layerType:b},A)),layout:A=>er({layer:o,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":O=>Ea(n.C({layerType:b},O))}}),paint:A=>er({layer:o,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":O=>ps(n.C({layerType:b,layer:o},O))}})}})),t}function Ur(d){let t=d.value,o=d.key,h=n.B(t);return h!=="string"?[new n.V(o,t,`string expected, ${h} found`)]:[]}let jc={promoteId:function({key:d,value:t}){if(n.B(t)==="string")return Ur({key:d,value:t});{let o=[];for(let h in t)o.push(...Ur({key:`${d}.${h}`,value:t[h]}));return o}}};function Uc(d){let t=d.value,o=d.key,h=d.styleSpec,g=d.style;if(!t.type)return[new n.V(o,t,'"type" is required')];let y=n.D(t.type),b=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(t.url||t.tiles||b.push(new n.A(o,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(er({key:o,value:t,valueSpec:h[`source_${y.replace("-","_")}`],style:d.style,styleSpec:h,objectElementValidators:jc})),b;case"geojson":if(b=er({key:o,value:t,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:jc}),t.cluster)for(let I in t.clusterProperties){let[A,O]=t.clusterProperties[I],P=typeof A=="string"?[A,["accumulated"],["get",I]]:A;b.push(...Co({key:`${o}.${I}.map`,value:O,expressionContext:"cluster-map"})),b.push(...Co({key:`${o}.${I}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return b;case"video":return er({key:o,value:t,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return er({key:o,value:t,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new n.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gs({key:`${o}.type`,value:t.type,valueSpec:{values:fl(h)},style:g,styleSpec:h})}}function fl(d){return d.source.reduce((t,o)=>{let h=d[o];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function ms(d){let t=d.value,o=d.styleSpec,h=o.light,g=d.style,y=[],b=n.B(t);if(t===void 0)return y;if(b!=="object")return y=y.concat([new n.V("light",t,`object expected, ${b} found`)]),y;for(let I in t){let A=I.match(/^(.*)-transition$/);y=y.concat(A&&h[A[1]]&&h[A[1]].transition?xn({key:I,value:t[I],valueSpec:o.transition,style:g,styleSpec:o}):h[I]?xn({key:I,value:t[I],valueSpec:h[I],style:g,styleSpec:o}):[new n.V(I,t[I],`unknown property "${I}"`)])}return y}function Ma(d){let t=d.value,o=[];if(!t)return o;let h=n.B(t);if(h!=="object")return o=o.concat([new n.V("light-3d",t,`object expected, ${h} found`)]),o;let g=d.styleSpec,y=g["light-3d"],b=d.key,I=d.style,A=d.style.lights;for(let k of["type","id"])if(!(k in t))return o=o.concat([new n.V("light-3d",t,`missing property ${k} on light`)]),o;if(t.type&&A)for(let k=0;k<d.arrayIndex;k++){let z=n.D(t.type),j=A[k];n.D(j.type)===z&&o.push(new n.V(b,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}let O=`properties_light_${t.type}`;if(!(O in g))return o=o.concat([new n.V("light-3d",t,`Invalid light type ${t.type}`)]),o;let P=g[O];for(let k in t)if(k==="properties"){let z=t[k],j=n.B(z);if(j!=="object")return o=o.concat([new n.V("properties",z,`object expected, ${j} found`)]),o;for(let W in z)o=o.concat(P[W]?xn({key:W,value:z[W],valueSpec:P[W],style:I,styleSpec:g}):[new n.A(d.key,z[W],`unknown property "${W}"`)])}else{let z=k.match(/^(.*)-transition$/);o=o.concat(z&&y[z[1]]&&y[z[1]].transition?xn({key:k,value:t[k],valueSpec:g.transition,style:I,styleSpec:g}):y[k]?xn({key:k,value:t[k],valueSpec:y[k],style:I,styleSpec:g}):[new n.A(k,t[k],`unknown property "${k}"`)])}return o}function pl(d){let t=d.value,o=d.key,h=d.style,g=d.styleSpec,y=g.terrain,b=[],I=n.B(t);if(t===void 0||I==="null")return b;if(I!=="object")return b=b.concat([new n.V("terrain",t,`object expected, ${I} found`)]),b;for(let A in t){let O=A.match(/^(.*)-transition$/);b=b.concat(O&&y[O[1]]&&y[O[1]].transition?xn({key:A,value:t[A],valueSpec:g.transition,style:h,styleSpec:g}):y[A]?xn({key:A,value:t[A],valueSpec:y[A],style:h,styleSpec:g}):[new n.A(A,t[A],`unknown property "${A}"`)])}if(t.source){let A=h.sources&&h.sources[t.source],O=A&&n.D(A.type);A?O!=="raster-dem"&&b.push(new n.V(o,t.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):b.push(new n.V(o,t.source,`source "${t.source}" not found`))}else b.push(new n.V(o,t,'terrain is missing required property "source"'));return b}function lo(d){let t=d.value,o=d.style,h=d.styleSpec,g=h.fog,y=[],b=n.B(t);if(t===void 0)return y;if(b!=="object")return y=y.concat([new n.V("fog",t,`object expected, ${b} found`)]),y;for(let I in t){let A=I.match(/^(.*)-transition$/);y=y.concat(A&&g[A[1]]&&g[A[1]].transition?xn({key:I,value:t[I],valueSpec:h.transition,style:o,styleSpec:h}):g[I]?xn({key:I,value:t[I],valueSpec:g[I],style:o,styleSpec:h}):[new n.A(I,t[I],`unknown property "${I}"`)])}return y}let $c={"*":()=>[],array:fs,boolean:function(d){let t=d.value,o=d.key,h=n.B(t);return h!=="boolean"?[new n.V(o,t,`boolean expected, ${h} found`)]:[]},number:pn,color:function(d){let t=d.key,o=d.value,h=n.B(o);return h!=="string"?[new n.V(t,o,`color expected, ${h} found`)]:n.U.parseCSSColor(o)===null?[new n.V(t,o,`color expected, "${o}" found`)]:[]},enum:Gs,filter:dl,function:Ki,layer:pr,object:er,source:Uc,model:n.Z,light:ms,"light-3d":Ma,terrain:pl,fog:lo,string:Ur,formatted:function(d){return Ur(d).length===0?[]:Co(d)},resolvedImage:function(d){return Ur(d).length===0?[]:Co(d)},projection:function(d){let t=d.value,o=d.styleSpec,h=o.projection,g=d.style,y=[],b=n.B(t);if(b==="object")for(let I in t)y=y.concat(xn({key:I,value:t[I],valueSpec:h[I],style:g,styleSpec:o}));else b!=="string"&&(y=y.concat([new n.V("projection",t,`object or string expected, ${b} found`)]));return y},import:function(d){let{value:t,styleSpec:o}=d,b=t,{data:h}=b,g=Ey(b,["data"]);Object.defineProperty(g,"__line__",{value:t.__line__,enumerable:!1});let y=er(n.C({},d,{value:g,valueSpec:o.import}));return n.D(g.id)===""&&y.push(new n.V(`${d.key}.id`,g,"import id can't be an empty string")),h&&(y=y.concat(ld(h,o,{key:`${d.key}.data`}))),y}};function xn(d,t=!1){let o=d.value,h=d.valueSpec,g=d.styleSpec;if(h.expression&&n.X(n.D(o)))return Ki(d);if(h.expression&&n.J(n.K(o)))return Co(d);if(h.type&&$c[h.type]){let y=$c[h.type](d);return t===!0&&y.length>0&&n.B(d.value)==="array"?Co(d):y}return er(n.C({},d,{valueSpec:h.type?g[h.type]:h}))}function Vo(d){let t=d.value,o=d.key,h=Ur(d);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new n.V(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new n.V(o,t,'"glyphs" url must include a "{range}" token'))),h}function ld(d,t=n._,o={}){return xn({key:o.key||"",value:d,valueSpec:t.$root,styleSpec:t,style:d,objectElementValidators:{glyphs:Vo,"*":()=>[]}})}function $r(d,t=n._){return me(ld(d,t))}let Sa=d=>me(Uc(d)),Gc=d=>me(ms(d)),Hc=d=>me(Ma(d)),ml=d=>me(pl(d)),qc=d=>me(lo(d)),Ve=d=>me(pr(d)),Y=d=>me(dl(d)),K=d=>me(ps(d)),ce=d=>me(Ea(d)),Ce=d=>me(n.Z(d));function me(d){return d.slice().sort((t,o)=>t.line&&o.line?t.line-o.line:0)}function Te(d,t){let o=!1;if(t&&t.length)for(let h of t)h instanceof n.A?n.w(h.message):(d.fire(new n.t(new Error(h.message))),o=!0);return o}let ze;class Ae extends n.E{constructor(t,o="flat"){super(),this._transitionable=new n.$(ze||(ze=new n.a0({anchor:new n.a1(n._.light.anchor),position:new n.a2(n._.light.position),color:new n.a1(n._.light.color),intensity:new n.a1(n._.light.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,h={}){this._validate(Gc,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,h){return(!h||h.validate!==!1)&&Te(this,t.call($r,n.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}let Be=class extends n.E{constructor(d,t,o,h){super(),this.scope=o,this._transitionable=new n.$(new n.a0({source:new n.a1(n._.terrain.source),exaggeration:new n.a1(n._.terrain.exaggeration)}),o,h),this._transitionable.setTransitionOrValue(d,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(d,t){this._transitionable.setTransitionOrValue(d,t)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new n.a3(d)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let d=this._transitionable._values.exaggeration;if(!d)return null;let t=d.value.expression;if(!t)return null;let o=-1,h=-1,g=1;for(let y of t.zoomStops)g=t.evaluate(new n.a3(y)),g>.01?(o=y,h=-1):h=y;return g<.01&&o>0&&h>o?[o,h]:null}isZoomDependent(){let d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof n.a4}},$e=45,Ge=65,it=.05;function dt(d,t,o,h){let g=n.a7($e,Ge,o),[y,b]=xt(d,h),I=1-Math.min(1,Math.exp((t-y)/(b-y)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*g*d.alpha}function xt(d,t){let o=.5/Math.tan(.5*t);return[d.range[0]+o,d.range[1]+o]}function Bt(d,t,o,h,g){let y=n.a6.vec3.transformMat4([],[t,o,h],g.mercatorFogMatrix);return dt(d,n.a6.vec3.length(y),g.pitch,g._fov)}function Zt(d,t,o,h,g,y,b){let I=[[o,h,0],[g,h,0],[g,y,0],[o,y,0]],A=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(let P of I){let k=n.a6.vec3.transformMat4([],P,t),z=n.a6.vec3.length(k);A=Math.min(A,z),O=Math.max(O,z)}return[dt(d,A,b.pitch,b._fov),dt(d,O,b.pitch,b._fov)]}class Xt extends n.E{constructor(t,o,h,g){super();let y=new n.a0({range:new n.a1(n._.fog.range),color:new n.a1(n._.fog.color),"high-color":new n.a1(n._.fog["high-color"]),"space-color":new n.a1(n._.fog["space-color"]),"horizon-blend":new n.a1(n._.fog["horizon-blend"]),"star-intensity":new n.a1(n._.fog["star-intensity"]),"vertical-range":new n.a1(n._.fog["vertical-range"])});this._transitionable=new n.$(y,h,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new n.a8(y),this.scope=h}get state(){let t=this._transform,o=t.projection.name==="globe",h=n.a9(t.zoom),g=this.properties.get("range"),y=[.5,3];return{range:o?[n.aa(y[0],g[0],h),n.aa(y[1],g[1],h)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,h={}){if(this._validate(qc,t,h))return;let g=n.l({},t);for(let y of Object.keys(n._.fog))g[y]===void 0&&(g[y]=n._.fog[y].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.a7($e,Ge,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?function(h,g,y){let b=n.a5.fromLngLat(g),I=y.elevation?y.elevation.getAtPointOrZero(b):0;return Bt(h,b.x,b.y,I,y)}(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Zt(this.state,o,0,0,n.ab,n.ab,this._transform)}getOpacityForBounds(t,o,h,g,y){return this._transform.projection.supportsFog?Zt(this.state,t,o,h,g,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?xt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let o=[4,5,6,7];for(let h of o){let g=t.points[h],y;if(g[2]>=0)y=g;else{let b=t.points[h-4];y=n.ac(b,g,b[2]/(b[2]-g[2]))}if(Bt(this.state,y[0],y[1],0,this._transform)>=it)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,h){return(!h||h.validate!==!1)&&Te(this,t.call($r,n.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}class Vt extends n.E{constructor(t,o,h,g){super(),this.scope=h,this._options=t,this.properties=new n.a8(o),this._transitionable=new n.$(o,h,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let zn,Sn;class ln{constructor(t,o,h,g){this.screenBounds=t,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(t,o){let h,g;if(t instanceof n.P||typeof t[0]=="number"){let y=n.P.convert(t);h=[y],g=o.isPointAboveHorizon(y)}else{let y=n.P.convert(t[0]),b=n.P.convert(t[1]);h=[y,b],g=n.ae(y,b).every(I=>o.isPointAboveHorizon(I))}return new ln(h,o.getCameraPoint(),g,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let o=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],g=n.ae(o,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<h.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?g[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(g[3]=this.cameraPoint)),n.af(g,t)}bufferedCameraGeometryGlobe(t){let o=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],g=n.ae(o,h,t),y=this.cameraPoint.clone();switch(3*((y.y>o.y)+(y.y>h.y))+((y.x>o.x)+(y.x>h.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(t,o,h,g=0){let y=t.queryPadding/o._pixelsPerMercatorPixel+1,b=h?this._bufferedCameraMercator(y,o):this._bufferedScreenMercator(y,o),I=t.tileID.wrap+(b.unwrapped?g:0),A=b.polygon.map(X=>n.ag(t.tileTransform,X,I));if(!n.ah(A,0,0,n.ab,n.ab))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);let O=this.screenGeometryMercator.polygon.map(X=>n.ai(t.tileTransform,X,I)),P=O.map(X=>new n.P(X[0],X[1])),k=o.getFreeCameraOptions().position||new n.a5(0,0,0),z=n.ai(t.tileTransform,k,I),j=O.map(X=>{let Z=n.a6.vec3.sub(X,X,z);return n.a6.vec3.normalize(Z,Z),new n.aj(z,Z)}),W=n.ak(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:j,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(q=n.al(A),q.min.x=n.ap(q.min.x,0,n.ab),q.min.y=n.ap(q.min.y,0,n.ab),q.max.x=n.ap(q.max.x,0,n.ab),q.max.y=n.ap(q.max.y,0,n.ab),q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:W};var q}_bufferedScreenMercator(t,o){let h=Zi(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[h]=g,g}}_bufferedCameraMercator(t,o){let h=Zi(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[h]=g,g}}_projectAndResample(t,o){let h=function(y,b){let I=n.a6.mat4.multiply([],b.pixelMatrix,b.globeMatrix),A=[0,-n.aq,0,1],O=[0,n.aq,0,1],P=[0,0,0,1];n.a6.vec4.transformMat4(A,A,I),n.a6.vec4.transformMat4(O,O,I),n.a6.vec4.transformMat4(P,P,I);let k=new n.P(A[0]/A[3],A[1]/A[3]),z=new n.P(O[0]/O[3],O[1]/O[3]),j=n.an(y,k)&&A[3]<P[3],W=n.an(y,z)&&O[3]<P[3];if(!j&&!W)return null;let q=function(le,he,_e){for(let we=1;we<le.length;we++){let ve=ci(he.pointCoordinate3D(le[we-1]).x),ye=ci(he.pointCoordinate3D(le[we]).x);if(_e<0){if(ve<ye)return{idx:we,t:-ve/(ye-1-ve)}}else if(ye<ve)return{idx:we,t:(1-ve)/(ye+1-ve)}}return null}(y,b,j?-1:1);if(!q)return null;let{idx:X,t:Z}=q,Q=X>1?Zn(y.slice(0,X),b):[],ie=X<y.length?Zn(y.slice(X),b):[];Q=Q.map(le=>new n.P(ci(le.x),le.y)),ie=ie.map(le=>new n.P(ci(le.x),le.y));let re=[...Q];re.length===0&&re.push(ie[ie.length-1]);let ae=n.aa(re[re.length-1].y,(ie.length===0?Q[0]:ie[0]).y,Z),de;return de=j?[new n.P(0,ae),new n.P(0,0),new n.P(1,0),new n.P(1,ae)]:[new n.P(1,ae),new n.P(1,1),new n.P(0,1),new n.P(0,ae)],re.push(...de),ie.length===0?re.push(Q[0]):re.push(...ie),{polygon:re.map(le=>new n.a5(le.x,le.y)),unwrapped:!1}}(t,o);if(h)return h;let g=function(y,b){let I=!1,A=-1/0,O=0;for(let k=0;k<y.length-1;k++)y[k].x>A&&(A=y[k].x,O=k);for(let k=0;k<y.length-1;k++){let z=(O+k)%(y.length-1),j=y[z],W=y[z+1];Math.abs(j.x-W.x)>.5&&(j.x<W.x?(j.x+=1,z===0&&(y[y.length-1].x+=1)):(W.x+=1,z+1===y.length-1&&(y[0].x+=1)),I=!0)}let P=n.am(b.center.lng);return I&&P<Math.abs(P-1)&&y.forEach(k=>{k.x-=1}),{polygon:y,unwrapped:I}}(Zn(t,o).map(y=>new n.P(ci(y.x),y.y)),o);return{polygon:g.polygon.map(y=>new n.a5(y.x,y.y)),unwrapped:g.unwrapped}}}function Zn(d,t){return n.ao(d,o=>{let h=t.pointCoordinate3D(o);o.x=h.x,o.y=h.y},1/256)}function ci(d){return d<0?1+d%1:d%1}function Zi(d){return 100*d|0}function tr(d,t,o,h,g){let y=function(I,A){if(I)return g(I);if(A){if(d.url&&A.tiles&&d.tiles&&delete d.tiles,A.variants){if(!Array.isArray(A.variants))return g(new Error("variants must be an array"));for(let P of A.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return g(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){A=n.l(A,P);break}}}let O=n.ar(n.l({},A,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);O.tiles=t.canonicalizeTileset(O,d.url),g(null,O)}},b=function(I,A,O){if(!I)return null;if(!A&&!O)return I;O=O||I.worldview_default;let P=Object.values(I.language||{});if(P.length===0)return null;let k=Object.values(I.worldview||{});if(k.length===0)return null;let z=P.every(W=>W===A),j=k.every(W=>W===O);return z&&j?I:A in(I.language_options||{})||O in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(d.data,o,h);return b?n.q.frame(()=>y(null,b)):d.url?n.n(t.transformRequest(t.normalizeSourceURL(d.url,null,o,h),n.R.Source),y):n.q.frame(()=>{let O=d,{data:I}=O,A=Ey(O,["data"]);y(null,A)})}class Bi{constructor(t,o,h){this.bounds=n.as.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let o=Math.pow(2,t.z),h=Math.floor(n.am(this.bounds.getWest())*o),g=Math.floor(n.at(this.bounds.getNorth())*o),y=Math.ceil(n.am(this.bounds.getEast())*o),b=Math.ceil(n.at(this.bounds.getSouth())*o);return t.x>=h&&t.x<y&&t.y>=g&&t.y<b}}class nr extends n.E{constructor(t,o,h,g){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ar(o,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new n.au}load(t){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=tr(this._options,this.map._requestManager,o,h,(g,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new n.t(g));else if(y){if(n.l(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let b of y.vector_layers)this.vectorLayerIds.push(b.id),y.worldview&&y.worldview[b.source]&&this.localizableLayerIds.add(b.id)}y.bounds&&(this.tileBounds=new Bi(y.bounds,this.minzoom,this.maxzoom)),cl(y.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(t,o){let h=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(h),y=this.map._requestManager.transformRequest(g,n.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,I=b?{image:b.image.clone()}:null,A={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(h)&&(A.worldview=this.map.getWorldview()||this.worldviewDefault,A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",A,O.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,O.bind(this),void 0,!0);else{let P=n.aw.call({deduped:this._deduped},A,(k,z)=>{k||!z?O.call(this,k):(A.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,O.bind(this),void 0,!0))},!0);t.request={cancel:P}}function O(P,k){return delete t.request,t.aborted?o(null):P&&P.status!==404?o(P):(k&&k.resourceTiming&&(t.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&t.setExpiryData(k),t.loadVectorData(k,this.map.painter),n.ax(this.dispatcher),o(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Hs extends n.E{constructor(t,o,h,g){super(),this.id=t,this.dispatcher=h,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},o),n.l(this,n.ar(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._tileJSONRequest=tr(this._options,this.map._requestManager,null,null,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new n.t(o)):h&&(n.l(this,h),h.raster_layers&&(this.rasterLayers=h.raster_layers,this.rasterLayerIds=this.rasterLayers.map(g=>g.id)),h.bounds&&(this.tileBounds=new Bi(h.bounds,this.minzoom,this.maxzoom)),cl(h.tiles),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(o)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){let h=n.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=n.o(this.map._requestManager.transformRequest(g,n.R.Tile),(y,b,I,A)=>(delete t.request,t.aborted?(t.state="unloaded",o(null)):y?(t.state="errored",o(y)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:A}),t.setTexture(b,this.map.painter),t.state="loaded",n.ax(this.dispatcher),void o(null)):o(null)))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class jo extends Hs{constructor(t,o,h,g){super(t,o,h,g),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},o)}triggerRepaint(t){let o=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);o&&o.enabled&&h&&o._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){let h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(h,n.R.Tile);t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(y,b,I,A)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(y)return y.code===20?void 0:(t.state="errored",o(y));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:A}),t.state="empty",o(null)})}unloadTile(t,o){let h=t.texture;h&&h instanceof n.T?(t.destroy(!0),this.map.painter.saveTileTexture(h)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,o,h){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(o,h,(g,y)=>{if(g)return t.state="errored",this.fire(new n.t(g)),void this.triggerRepaint(t);y&&(t.setTexture(y,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;let o=this.rasterLayers.find(({id:y})=>y===t),h=o&&o.fields,g=h&&h.bands&&h.bands;return g?g[0]:0}getTextureDescriptor(t,o,h){if(!t)return;let g=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let y=null;o instanceof n.aB?y=o.paint.get("raster-array-band"):o instanceof n.aC&&(y=o.paint.get("raster-particle-array-band"));let b=y||this.getInitialBand(g);if(b!=null)if(t.textureDescriptor){if(!t.updateNeeded(g,b)||h)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,g,b)}}let cd={vector:nr,raster:Hs,"raster-dem":class extends Hs{constructor(d,t,o,h){super(d,t,o,h),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){let o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(g,y){g&&(d.state="errored",t(g)),y&&(d.dem=y,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=n.o(this.map._requestManager.transformRequest(o,n.R.Tile),function(g,y,b,I){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(g)d.state="errored",t(g);else if(y){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:b,expires:I});let A=ImageBitmap&&y instanceof ImageBitmap&&n.ay(),O=1-(y.width-n.az(y.width))/2;O<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let P=A?y:n.q.getImageData(y,O),k={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:O};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",k,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){let t=d.canonical,o=Math.pow(2,t.z),h=(t.x-1+o)%o,g=t.x===0?d.wrap-1:d.wrap,y=(t.x+1+o)%o,b=t.x+1===o?d.wrap+1:d.wrap,I={};return I[new n.aA(d.overscaledZ,g,t.z,h,t.y).key]={backfilled:!1},I[new n.aA(d.overscaledZ,b,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(I[new n.aA(d.overscaledZ,g,t.z,h,t.y-1).key]={backfilled:!1},I[new n.aA(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new n.aA(d.overscaledZ,b,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<o&&(I[new n.aA(d.overscaledZ,g,t.z,h,t.y+1).key]={backfilled:!1},I[new n.aA(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new n.aA(d.overscaledZ,b,t.z,y,t.y+1).key]={backfilled:!1}),I}},"raster-array":jo,geojson:class extends n.E{constructor(d,t,o,h){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(h),this._data=t.data,this._options=n.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let g=n.ab/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:n.ab,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.ab,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new n.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new n.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let t=new Map;for(let o of this._data.features)t.set(o.id,o);for(let o of d.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterLeaves(d,t,o,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:t,offset:o},h),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.x("dataloading",{dataType:"source"})),this._loaded=!1;let t=n.l({append:d},this.workerOptions);t.scope=this.scope;let o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(n.q.resolveURL(o),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new n.t(h));else{let y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new n.x("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,t){let o=d.actor?"reloadTile":"loadTile";d.actor=this.actor;let h=this.map.style?this.map.style.getLut(this.scope):null,g=h?{image:h.image.clone()}:null,y=this._partialReload,b={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:y};d.request=this.actor.send(o,b,(I,A)=>y&&!A?(d.state="loaded",t(null)):(delete d.request,d.destroy(),d.aborted?t(null):I?t(I):(d.loadVectorData(A,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,t){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aD{constructor(d,t,o,h){super(d,t,o,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aE(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new n.t(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new n.t(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,t=d.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(d,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aD,model:class extends n.E{constructor(d,t,o,h){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){let d=[];for(let t in this._options.models){let o=this._options.models[t],h=n.aG(this.map._requestManager.transformRequest(o.uri,n.R.Model).url).then(g=>{if(!g)return;let y=n.aH(g),b=new n.aI(t,o.position,o.orientation,y);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(g=>{this.fire(new n.t(new Error(`Could not load model ${t} from ${o.uri}: ${g.message}`)))});d.push(h)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new n.t(new Error(`Could not load models: ${t.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,t){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(d,t,o,h){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=tr(this._options,this.map._requestManager,t,o,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new n.t(h))):g&&(n.l(this,g),g.bounds&&(this.tileBounds=new Bi(g.bounds,this.minzoom,this.maxzoom)),cl(g.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),d&&d(h)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,t){let o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(o,n.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=t;else{if(d.buckets){let y=Object.values(d.buckets);for(let b of y)b.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",h,g.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",h,g.bind(this),void 0,!0);function g(y,b){return d.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&b&&d.setExpiryData(b),d.loadModelData(b,this.map.painter),d.state="loaded",void t(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aD{constructor(d,t,o,h){super(d,t,o,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new n.t(new n.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.t(new n.V(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.t(new n.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.t(new n.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.t(new n.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof n.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends n.E{constructor(d,t,o,h){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bi(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ar(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:t,y:o,z:h}=d.canonical;return this._implementation.hasTile({x:t,y:o,z:h})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,t){let{x:o,y:h,z:g}=d.tileID.canonical,y=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:o,y:h,z:g},{signal:y.signal})).then(function(b){return delete d.request,d.aborted?(d.state="unloaded",t(null)):b===void 0?(d.state="errored",t(null)):b===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",t(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(b)?(this.loadTileData(d,b),d.state="loaded",void t(null)):(d.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(b=>{b.code!==20&&(d.state="errored",t(b))}),d.request.cancel=()=>y.abort()}loadTileData(d,t){d.setTexture(t,this.map.painter)}unloadTile(d,t){if(d.texture&&d.texture instanceof n.T?(d.destroy(!0),d.texture&&d.texture instanceof n.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){let{x:o,y:h,z:g}=d.tileID.canonical;this._implementation.unloadTile({x:o,y:h,z:g})}t&&t()}abortTile(d,t){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){let d=n.av(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}}},ud=function(d,t,o,h){let g=new cd[t.type](d,t,o,h);if(g.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${g.id}`);return n.aJ(["load","abort","unload","serialize","prepare"],g),g};function dd(d,t){let o=n.a6.mat4.identity([]);return n.a6.mat4.scale(o,o,[.5*d.width,.5*-d.height,1]),n.a6.mat4.translate(o,o,[1,-1,0]),n.a6.mat4.multiply(o,o,d.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(o)}function Af(d,t,o,h,g,y,b,I,A=!1){let O=d.tilesIn(o,I,A);O.sort(gl);let P=[];for(let z of O)P.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,d._state,z,h,g,y,b,dd(d.transform,z.tile.tileID),A)});let k=function(z){let j={},W={};for(let q of z){let X=q.queryResults,Z=q.wrappedTileID,Q=W[Z]=W[Z]||{};for(let ie in X){let re=X[ie],ae=Q[ie]=Q[ie]||{},de=j[ie]=j[ie]||[];for(let le of re)ae[le.featureIndex]||(ae[le.featureIndex]=!0,de.push(le))}}return j}(P);for(let z in k)k[z].forEach(j=>{let W=j.feature,q=W.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(n.aK(z)||(W.source=q.source,q["source-layer"]&&(W.sourceLayer=q["source-layer"])),W.state=W.id!==void 0?d.getFeatureState(q["source-layer"],W.id):{})});return k}function Pf(d,t){let o=d.getRenderableIds().map(y=>d.getTileByID(y)),h=[],g={};for(let y=0;y<o.length;y++){let b=o[y],I=b.tileID.canonical.key;g[I]||(g[I]=!0,b.querySourceFeatures(h,t))}return h}function gl(d,t){let o=d.tileID,h=t.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function _l(d,t){let o={};if(!t)return o;for(let h of d){let g=h.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(g.length!==0){h.layers=g,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(y=>g.filter(b=>b.id===y)[0]));for(let y of g)o[y.fqid]=h}}return o}let co=32,Eo=33,Mo=new Uint16Array(8184);for(let d=0;d<2046;d++){let t=d+2,o=0,h=0,g=0,y=0,b=0,I=0;for(1&t?g=y=b=co:o=h=I=co;(t>>=1)>1;){let O=o+g>>1,P=h+y>>1;1&t?(g=o,y=h,o=b,h=I):(o=g,h=y,g=b,y=I),b=O,I=P}let A=4*d;Mo[A+0]=o,Mo[A+1]=h,Mo[A+2]=g,Mo[A+3]=y}let Dr=new Uint16Array(2178),Uo=new Uint8Array(1089),Wc=new Uint16Array(1089);function Rf(d){return d===0?-.03125:d===32?.03125:0}let Of={type:2,extent:n.ab,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ab+1,0),new n.P(n.ab+1,n.ab+1),new n.P(0,n.ab+1),new n.P(0,0)]]};class $o{constructor(t,o,h,g,y){this.tileID=t,this.uid=n.aQ(),this.uses=0,this.tileSize=o,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(t){let o=t+this.timeAdded;o<n.q.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=_l(t.buckets,o.style),this.hasSymbolBuckets=!1;for(let g in this.buckets){let y=this.buckets[g];if(y instanceof n.aS){if(this.hasSymbolBuckets=!0,!h)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let g in this.buckets){let y=this.buckets[g];if(y instanceof n.aS&&y.hasRTLText){this.hasRTLText=!0,n.aT();break}}this.queryPadding=0;for(let g in this.buckets){let y=this.buckets[g],b=o.style.getOwnLayer(g);if(!b)continue;let I=b.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.aR}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Mt(Mt({},this.buckets),_l(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(let g in this.buckets){let y=this.buckets[g];y.uploadPending()&&y.upload(t)}let o=t.gl,h=this.imageAtlas;if(h&&!h.uploaded){let g=!!Object.keys(h.patternPositions).length;this.imageAtlasTexture=new n.T(t,h.image,o.RGBA8,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let g=o.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this._lastUpdatedBrightness=g,this.updateBuckets(o)))}queryRenderedFeatures(t,o,h,g,y,b,I,A,O){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:A,transform:I,filter:g,layers:y,availableImages:b,tileTransform:this.tileTransform},t,o):{}}querySourceFeatures(t,o){let h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;let g=h.loadVTLayers(),y=o?o.sourceLayer:"",b=g._geojsonTileLayer||g[y];if(!b)return;let I=n.aU(o&&o.filter),{z:A,x:O,y:P}=this.tileID.canonical,k={z:A,x:O,y:P};for(let z=0;z<b.length;z++){let j=b.feature(z);if(I.needGeometry){let X=n.aV(j,!0);if(!I.filter(new n.a3(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!I.filter(new n.a3(this.tileID.overscaledZ),j))continue;let W=h.getId(j,y),q=new n.aW(j,A,O,P,W);q.tile=k,t.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let o=this.expirationTime;if(t.cacheControl){let h=n.aX(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let h=Date.now(),g=!1;if(this.expirationTime>h)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{let y=this.expirationTime-o;y?this.expirationTime=h+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t){if(!this.latestFeatureIndex)return;let o=this.latestFeatureIndex.loadVTLayers(),h=t.style.listImages(),g=t.style.getBrightness();for(let y in this.buckets){if(!t.style.hasLayer(y))continue;let b=this.buckets[y],I=b.layers[0],A=I.sourceLayer||"_geojsonTileLayer",O=o[A],P=t.style.getSourceCache(I.source,I.scope),k={};P&&(k=P._state.getState(A,void 0)),b.update(k,O,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},g),(b instanceof n.aY||b instanceof n.aZ)&&t._terrain&&t._terrain.enabled&&P&&b.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(P.id,this.tileID);let z=t&&t.style&&t.style.getOwnLayer(y);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.q.now()+t}setTexture(t,o){let h=o.context,g=h.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(h,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,o){let h={};for(let g of o)h[g]=!0;this.dependencies[t]=h}hasDependency(t,o){for(let h of t){let g=this.dependencies[h];if(g){for(let y of o)if(g[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;let h=n.a_(Of,this.tileID.canonical,this.tileTransform)[0],g=new n.a$,y=new n.b0;for(let b=0;b<h.length;b++){let{x:I,y:A}=h[b];g.emplaceBack(I,A),y.emplaceBack(b)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(g,n.b1.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,g.length,y.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;let h=n.a_(Of,this.tileID.canonical,this.tileTransform)[0],g,y;if(this.isRaster){let b=function(I,A){let O=n.aL(I,A),P=Math.pow(2,I.z);for(let X=0;X<Eo;X++)for(let Z=0;Z<Eo;Z++){let Q=n.aM((I.x+(Z+Rf(Z))/co)/P),ie=n.aN((I.y+(X+Rf(X))/co)/P),re=A.project(Q,ie),ae=X*Eo+Z;Dr[2*ae+0]=Math.round((re.x*O.scale-O.x)*n.ab),Dr[2*ae+1]=Math.round((re.y*O.scale-O.y)*n.ab)}Uo.fill(0),Wc.fill(0);for(let X=2045;X>=0;X--){let Z=4*X,Q=Mo[Z+0],ie=Mo[Z+1],re=Mo[Z+2],ae=Mo[Z+3],de=Q+re>>1,le=ie+ae>>1,he=de+le-ie,_e=le+Q-de,we=ie*Eo+Q,ve=ae*Eo+re,ye=le*Eo+de,Fe=Math.hypot((Dr[2*we+0]+Dr[2*ve+0])/2-Dr[2*ye+0],(Dr[2*we+1]+Dr[2*ve+1])/2-Dr[2*ye+1])>=16;Uo[ye]=Uo[ye]||(Fe?1:0),X<1022&&(Uo[ye]=Uo[ye]||Uo[(ie+_e>>1)*Eo+(Q+he>>1)]||Uo[(ae+_e>>1)*Eo+(re+he>>1)])}let k=new n.aO,z=new n.aP,j=0;function W(X,Z){let Q=Z*Eo+X;return Wc[Q]===0&&(k.emplaceBack(Dr[2*Q+0],Dr[2*Q+1],X*n.ab/co,Z*n.ab/co),Wc[Q]=++j),Wc[Q]-1}function q(X,Z,Q,ie,re,ae){let de=X+Q>>1,le=Z+ie>>1;if(Math.abs(X-re)+Math.abs(Z-ae)>1&&Uo[le*Eo+de])q(re,ae,X,Z,de,le),q(Q,ie,re,ae,de,le);else{let he=W(X,Z),_e=W(Q,ie),we=W(re,ae);z.emplaceBack(he,_e,we)}}return q(0,0,co,co,co,0),q(co,co,0,0,0,co),{vertices:k,indices:z}}(this.tileID.canonical,o);g=b.vertices,y=b.indices}else{g=new n.aO,y=new n.aP;for(let{x:I,y:A}of h)g.emplaceBack(I,A,0,0);let b=n.b3(g.int16,void 0,4);for(let I=0;I<b.length;I+=3)y.emplaceBack(b[I],b[I+1],b[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,n.b4.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=n.b2.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugBuffers(t,o){let h=o.projection;if(!h||h.name!=="globe"||o.freezeTileCoverage)return;let g=this.tileID.canonical,y=n.b5(g,o),b=n.b6(y),I=n.a9(o.zoom),A;I>0&&(A=n.a6.mat4.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,o,b,A,I),this._makeGlobeTileDebugTextBuffer(t,g,o,b,A,I)}_globePoint(t,o,h,g,y,b,I){let A=n.b7(t,o,h);if(b){let O=1<<h.z,P=n.am(g.center.lng),k=n.at(g.center.lat),z=(h.x+.5)/O-P,j=0;z>.5?j=-1:z<-.5&&(j=1);let W=(t/n.ab+h.x)/O+j,q=(o/n.ab+h.y)/O;W=(W-P)*g._pixelsPerMercatorPixel+P,q=(q-k)*g._pixelsPerMercatorPixel+k;let X=[W*g.worldSize,q*g.worldSize,0];n.a6.vec3.transformMat4(X,X,b),A=n.b8(A,X,I)}return n.a6.vec3.transformMat4(A,A,y)}_makeGlobeTileDebugBorderBuffer(t,o,h,g,y,b){let I=new n.a$,A=new n.b0,O=new n.b9,P=(z,j,W,q,X)=>{let Z=(W-z)/(X-1),Q=(q-j)/(X-1),ie=I.length;for(let re=0;re<X;re++){let ae=z+re*Z,de=j+re*Q;I.emplaceBack(ae,de);let le=this._globePoint(ae,de,o,h,g,y,b);O.emplaceBack(le[0],le[1],le[2]),A.emplaceBack(ie+re)}},k=n.ab;P(0,0,k,0,16),P(k,0,k,k,16),P(k,k,0,k,16),P(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(I,n.b1.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(O,n.ba.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,I.length,A.length)}_makeGlobeTileDebugTextBuffer(t,o,h,g,y,b){let I=n.ab/4,A=new n.a$,O=new n.aP,P=new n.b9,k=25;O.reserve(32),A.reserve(k),P.reserve(k);let z=(j,W)=>k*j+W;for(let j=0;j<k;j++){let W=j*I;for(let q=0;q<k;q++){let X=q*I;A.emplaceBack(X,W);let Z=this._globePoint(X,W,o,h,g,y,b);P.emplaceBack(Z[0],Z[1],Z[2])}}for(let j=0;j<4;j++)for(let W=0;W<4;W++){let q=z(j,W),X=z(j,W+1),Z=z(j+1,W),Q=z(j+1,W+1);O.emplaceBack(q,X,Z),O.emplaceBack(Z,X,Q)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(O),this._tileDebugTextBuffer=t.createVertexBuffer(A,n.b1.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(P,n.ba.members),this._tileDebugTextSegments=n.b2.simpleSegment(0,0,k,32)}destroy(t=!1){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bb.setPbf(n.bc);class hd extends $o{constructor(t,o,h,g,y){super(t,o,h,g,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,o){let h=o.context,g=h.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t,{premultiply:!1}):this.texture=new n.T(h,t,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,o){let h=this._mrt=new n.bb(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bd(g,(y,b,I,A)=>{if(y)o(y);else try{let O=h.getHeaderLength(b);if(O>t)return void(this.request=this.fetchHeader(O,o));h.parseHeader(b),this._isHeaderLoaded=!0;let P=0;for(let k of Object.values(h.layers))P=Math.max(P,k.dataIndex[k.dataIndex.length-1].last_byte);b.byteLength>=P&&(this.entireBuffer=b),o(null,this.entireBuffer||b,I,A)}catch(O){o(O)}}),this.request}fetchBand(t,o,h){let g=this._mrt;if(!this._isHeaderLoaded||!g)return void h(new Error("Tile header is not ready"));let y=this.actor;if(!y)return void h(new Error("Can't fetch tile band without an actor"));let b,I=(k,z)=>{b.complete(k,z),k?h(k):(this.updateTextureDescriptor(t,o),h(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(k,z)=>{if(k)return h(k);let j=y.send("decodeRasterArray",{buffer:z,task:b},I,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),b.cancel()})},O=g.getLayer(t);if(!O)return void h(new Error(`Unknown sourceLayer "${t}"`));if(O.hasDataForBand(o))return this.updateTextureDescriptor(t,o),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);let P=O.getDataRange([o]);if(b=g.createDecodingTask(P),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(P.firstByte,P.lastByte+1));else{let k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${P.firstByte}-${P.lastByte}`}}),z=n.bd(k,A);this._fetchQueue.push(()=>{z.cancel(),b.cancel()})}else h(null)}updateNeeded(t,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,o){if(!this._mrt)return;let h=this._mrt.getLayer(t);if(!h||!h.hasBand(o)||!h.hasDataForBand(o))return;let{bytes:g,tileSize:y,buffer:b,offset:I,scale:A}=h.getBandView(o),O=y+2*b,P={data:g,width:O,height:O},k=this.texture;k&&k instanceof n.T&&k.update(P,{premultiply:!1}),this.textureDescriptor={layer:t,band:o,img:P,buffer:b,offset:I,tileSize:y,format:h.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class Og{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(let t in this.data)for(let o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,h){let g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);let y={value:o,timeout:void 0};if(h!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},h)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){let b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){let o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;let h=t.wrapped().key,g=o===void 0?0:this.data[h].indexOf(o),y=this.data[h][g];return this.data[h].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(y.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){let o=[];for(let h in this.data)for(let g of this.data[h])t(g.value)||o.push(g);for(let h of o)this.remove(h.value.tileID,h)}}class cx{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,h){let g=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},n.l(this.stateChanges[t][g],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(let y in this.state[t])y!==g&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(let y in this.state[t][g])h[y]||(this.deletedStates[t][g][y]=null)}else for(let y in h)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][y]===null&&delete this.deletedStates[t][g][y]}removeFeatureState(t,o,h){if(this.deletedStates[t]===null)return;let g=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&o!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][h]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(h in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][h]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,o){let h=this.state[t]||{},g=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(o!==void 0){let I=String(o),A=n.l({},h[I],g[I]);if(y){let O=y[o];if(O===null)return{};for(let P in O)delete A[P]}return A}let b=n.l({},h,g);if(y)for(let I in y)delete b[I];return b}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){let h={};for(let g in this.stateChanges){this.state[g]=this.state[g]||{};let y={};for(let b in this.stateChanges[g])this.state[g][b]||(this.state[g][b]={}),n.l(this.state[g][b],this.stateChanges[g][b]),y[b]=this.state[g][b];h[g]=y}for(let g in this.deletedStates){this.state[g]=this.state[g]||{};let y={};if(this.deletedStates[g]===null)for(let b in this.state[g])y[b]={},this.state[g][b]={};else for(let b in this.deletedStates[g]){if(this.deletedStates[g][b]===null)this.state[g][b]={};else if(this.state[g][b])for(let I of Object.keys(this.deletedStates[g][b]))delete this.state[g][b][I];y[b]=this.state[g][b]}h[g]=h[g]||{},n.l(h[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(let g in t)t[g].refreshFeatureState(o)}}class Ar extends n.E{constructor(t,o,h){super(),this.id=t,this._onlySymbols=h,o.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new Og(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new cx,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let h=this._tiles[o];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.be(this._tiles).map(t=>t.tileID).sort(qs).map(t=>t.key)}getRenderableIds(t,o){let h=[];for(let g in this._tiles)this._isIdRenderable(+g,t,o)&&h.push(this._tiles[g]);return t?h.sort((g,y)=>{let b=g.tileID,I=y.tileID,A=new n.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),O=new n.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-I.overscaledZ||O.y-A.y||O.x-A.x}).map(g=>g.tileID.key):h.map(g=>g.tileID).sort(qs).map(g=>g.key)}hasRenderableParent(t){let o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){let h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=o),this._loadTile(h,this._tileLoaded.bind(this,h,t,o)))}_tileLoaded(t,o,h,g){if(g)if(t.state="errored",g.status!==404)this._source.fire(new n.t(g,{tile:t}));else{if(this._source.fire(new n.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=n.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new n.x("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let o=this.getRenderableIds();for(let g=0;g<o.length;g++){let y=o[g];if(t.neighboringTiles&&t.neighboringTiles[y]){let b=this.getTileByID(y);h(t,b),h(b,t)}}function h(g,y){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let b=y.tileID.canonical.x-g.tileID.canonical.x,I=y.tileID.canonical.y-g.tileID.canonical.y,A=Math.pow(2,g.tileID.canonical.z),O=y.tileID.key;b===0&&I===0||Math.abs(I)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,b,I),g.neighboringTiles&&g.neighboringTiles[O]&&(g.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,h,g){for(let y in this._tiles){let b=this._tiles[y];if(g[y]||!b.hasData()||b.tileID.overscaledZ<=o||b.tileID.overscaledZ>h)continue;let I=b.tileID;for(;b&&b.tileID.overscaledZ>o+1;){let O=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[O.key],b&&b.hasData()&&(I=O)}let A=I;for(;A.overscaledZ>o;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){g[I.key]=I;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){let h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=t.overscaledZ-1;h>=o;h--){let g=t.scaledTo(h),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(t){let o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;let h=Math.ceil(t.width/o)+1,g=Math.ceil(t.height/o)+1,y=Math.floor(h*g*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(I)}handleWrapJump(t){let o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){let h={};for(let g in this._tiles){let y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),h[y.tileID.key]=y}this._tiles=h;for(let g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(let g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,o,h,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let y=this._source.type==="batched-model",b,I=this._source.maxzoom,A=this.map&&this.map.painter?this.map.painter._terrain:null;if(A&&A.sourceCache===this&&A.attenuationRange()){let k=A.attenuationRange()[0],z=Math.floor(k)-Math.log2(A.getDemUpscale());I>z&&(I=z)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new n.aA(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(this.tileCoverLift!==0){let k=t.clone();k.tileCoverLift=this.tileCoverLift,b=k.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new n.aA(1,0,1,0,0)),b.push(new n.aA(1,0,1,1,0)),b.push(new n.aA(1,0,1,0,1)),b.push(new n.aA(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.hasTile){let k=this._source.hasTile.bind(this._source);b=b.filter(z=>k(z))}}else b=[];if(b.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Zc(this._source.type)){let k=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),z=Math.min(k,this._source.maxzoom);if(y){let j=t.extendTileCover(b,z);for(let W of j)b.push(W)}else{let j=t.extendTileCover(b,z,g);for(let W of j)this._shadowCasterTiles[W.key]=!0,b.push(W)}}let O=this._updateRetainedTiles(b);if(Zc(this._source.type)&&b.length!==0){let k={},z={},j=Object.keys(O);for(let q of j){let X=O[q],Z=this._tiles[q];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=n.q.now())continue;let Q=this.findLoadedParent(X,Math.max(X.overscaledZ-Ar.maxOverzooming,this._source.minzoom));Q&&(this._addTile(Q.tileID),k[Q.tileID.key]=Q.tileID),z[q]=X}let W=b[b.length-1].overscaledZ;for(let q in this._tiles){let X=this._tiles[q];if(O[q]||!X.hasData())continue;let Z=X.tileID;for(;Z.overscaledZ>W;){Z=Z.scaledTo(Z.overscaledZ-1);let Q=this._tiles[Z.key];if(Q&&Q.hasData()&&z[Z.key]){O[q]=X.tileID;break}}}for(let q in k)O[q]||(this._coveredTiles[q]=!0,O[q]=k[q])}for(let k in O)this._tiles[k].clearFadeHold();let P=n.bf(this._tiles,O);for(let k of P){let z=this._tiles[k];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let o={};if(t.length===0)return o;let h={},g=t.reduce((O,P)=>Math.min(O,P.overscaledZ),1/0),y=t[0].overscaledZ,b=Math.max(y-Ar.maxOverzooming,this._source.minzoom),I=Math.max(y+Ar.maxUnderzooming,this._source.minzoom),A={};for(let O of t){let P=this._addTile(O);o[O.key]=O,P.hasData()||g<this._source.maxzoom&&(A[O.key]=O)}this._retainLoadedChildren(A,g,I,o);for(let O of t){let P=this._tiles[O.key];if(P.hasData())continue;if(O.canonical.z>=this._source.maxzoom){let z=O.children(this._source.maxzoom)[0],j=this.getTile(z);if(j&&j.hasData()){o[z.key]=z;continue}}else{let z=O.children(this._source.maxzoom);if(o[z[0].key]&&o[z[1].key]&&o[z[2].key]&&o[z[3].key])continue}let k=P.wasRequested();for(let z=O.overscaledZ-1;z>=b;--z){let j=O.scaledTo(z);if(h[j.key]||(h[j.key]=!0,P=this.getTile(j),!P&&k&&(P=this._addTile(j)),P&&(o[j.key]=j,k=P.wasRequested(),P.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let o=[],h,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){h=this._loadedParentTiles[g.key];break}o.push(g.key);let y=g.scaledTo(g.overscaledZ-1);if(h=this._getLoadedTile(y),h)break;g=y}for(let y of o)this._loadedParentTiles[y]=h}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));let h=!!o;if(!h){let g=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new hd(t,y,this.transform.tileZoom,g,this._isRaster):new $o(t,y,this.transform.tileZoom,g,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o?(o.uses++,this._tiles[t.key]=o,h||this._source.fire(new n.x("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let h=o.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){let o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,h){let g=[],y=this.transform;if(!y)return g;let b=y.projection.name==="globe",I=n.am(y.center.lng);for(let A in this._tiles){let O=this._tiles[A];if(h&&O.clearQueryDebugViz(),O.holdingForFade())continue;let P;if(b){let k=O.tileID.canonical;if(k.z===0){let z=[Math.abs(n.ap(I,...yl(k,-1))-I),Math.abs(n.ap(I,...yl(k,1))-I)];P=[0,2*z.indexOf(Math.min(...z))-1]}else{let z=[Math.abs(n.ap(I,...yl(k,-1))-I),Math.abs(n.ap(I,...yl(k,0))-I),Math.abs(n.ap(I,...yl(k,1))-I)];P=[z.indexOf(Math.min(...z))-1]}}else P=[0];for(let k of P){let z=t.containsTile(O,y,o,k);z&&g.push(z)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){let h=this.getRenderableIds(t,o).map(y=>this._tiles[y].tileID),g=this.transform.projection.name==="globe";for(let y of h)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=g?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return h}sortCoordinatesByDistance(t){let o=t.slice(),h=this.transform._camera.position,g=this.transform._camera.forward(),y={};for(let b of o){let I=1/(1<<b.canonical.z);y[b.key]=((b.canonical.x+.5)*I+b.wrap-h[0])*g[0]+((b.canonical.y+.5)*I-h[1])*g[1]-h[2]*g[2]}return o.sort((b,I)=>y[b.key]-y[I.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Zc(this._source.type))for(let t in this._tiles){let o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(t,o,h){this._state.updateState(t=t||"_geojsonTileLayer",o,h)}removeFeatureState(t,o,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,h)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,h){let g=this._tiles[t];g&&g.setDependencies(o,h)}reloadTilesForDependencies(t,o){for(let h in this._tiles)this._tiles[h].hasDependency(t,o)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,o))}_preloadTiles(t,o){if(!this._sourceLoaded){let A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,o))};return void this._source.on("data",A)}let h=new Map,g=Array.isArray(t)?t:[t],y=this.map.painter.terrain,b=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(let A of g){let O=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let P of O)h.set(P.key,P);this.usedForTerrain&&A.updateElevation(!1)}let I=Array.from(h.values());n.bg(I,(A,O)=>{let P=new $o(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,k=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),O(k,P)})},o)}}function qs(d,t){let o=Math.abs(2*d.wrap)-+(d.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||h-o||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function Zc(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function yl(d,t){let o=1<<d.z;return[d.x/o+t,(d.x+1)/o+t]}Ar.maxOverzooming=10,Ar.maxUnderzooming=3;class Lf{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let t=!1,o=!1;for(let h in this.style._mergedLayers){let g=this.style._mergedLayers[h];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:t,visibilityChanged:o});else if(g.type==="model"){let y=this.style.getLayerSource(g);y&&y.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(let o of this.layers){let h=o.layer,g=!1;h.type==="fill-extrusion"?g=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(g=!h.isHidden(t)&&h.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!g&&o.visible,o.visible=g}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(let g of this.layers){let y=g.layer,b=this.style.getLayerSourceCache(y),I=1;y.type==="fill-extrusion"&&(I=g.visible?y.paint.get("fill-extrusion-vertical-scale"):0);let A=b?b.getTile(o):null;if(!A&&b&&o.canonical.z>b.getSource().minzoom){let O=o.scaledTo(Math.min(b.getSource().maxzoom,o.overscaledZ-1));for(;O.overscaledZ>=b.getSource().minzoom&&(A=b.getTile(O),!A&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(y):null,tileID:A?A.tileID:o,verticalScale:I})}t.hasAnyZOffset=!1;let h=!1;for(let g=0;g<t.symbolInstances.length;g++){let y=t.symbolInstances.get(g),b=y.zOffset,I=this._getHeightAtTileOffset(o,y.tileAnchorX,y.tileAnchorY);y.zOffset=I!==Number.NEGATIVE_INFINITY?I:b,h||b===y.zOffset||(h=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,h,g){let y=o,b=h;if(t.canonical.z!==g.canonical.z){let I=g.canonical,A=1/(1<<t.canonical.z-I.z);y=(o+t.canonical.x*n.ab)*A-I.x*n.ab|0,b=(h+t.canonical.y*n.ab)*A-I.y*n.ab|0}return{tileX:y,tileY:b}}_getHeightAtTileOffset(t,o,h){let g,y;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;let{bucket:I,tileID:A,verticalScale:O}=this.currentBuildingBuckets[b];if(!I)continue;let{tileX:P,tileY:k}=this._mapCoordToOverlappingTile(t,o,h,A),z=I.getHeightAtTileCoord(P,k);z&&z.height!==void 0&&(z.hidden?g=z.height:y=Math.max(z.height*O,y||0))}if(y!==void 0)return y;for(let b=0;b<this.layers.length;++b){let I=this.layers[b];if(I.layer.type!=="model"||!I.visible)continue;let{bucket:A,tileID:O}=this.currentBuildingBuckets[b];if(!A)continue;let{tileX:P,tileY:k}=this._mapCoordToOverlappingTile(t,o,h,O),z=A.getHeightAtTileCoord(P,k);if(z&&!z.hidden)return z.height===void 0&&g!==void 0?Math.min(z.maxHeight,g)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function vl(d,t){let o={};for(let h in d)h!=="ref"&&(o[h]=d[h]);return n.bh.forEach(h=>{h in t&&(o[h]=t[h])}),o}function Ff(d){d=d.slice();let t=Object.create(null);for(let o=0;o<d.length;o++)t[d[o].id]=d[o];for(let o=0;o<d.length;o++)"ref"in d[o]&&(d[o]=vl(d[o],t[d[o].ref]));return d}let Tn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function kf(d,t,o){o.push({command:Tn.addSource,args:[d,t[d]]})}function Un(d,t,o){t.push({command:Tn.removeSource,args:[d]}),o[d]=!0}function ux(d,t,o,h){Un(d,o,h),kf(d,t,o)}function kt(d,t,o){let h;for(h in d[o])if(d[o].hasOwnProperty(h)&&h!=="data"&&!n.bi(d[o][h],t[o][h]))return!1;for(h in t[o])if(t[o].hasOwnProperty(h)&&h!=="data"&&!n.bi(d[o][h],t[o][h]))return!1;return!0}function Xc(d,t,o,h,g,y){let b;for(b in t=t||{},d=d||{})d.hasOwnProperty(b)&&(n.bi(d[b],t[b])||o.push({command:y,args:[h,b,t[b],g]}));for(b in t)t.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(n.bi(d[b],t[b])||o.push({command:y,args:[h,b,t[b],g]}))}function Ta(d){return d.id}function xl(d,t){return d[t.id]=t,d}class So{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.ap(t,0,1);let o=1,h=this._distances[o],g=t*this.paddedLength+this.padding;for(;h<g&&o<this._distances.length;)h=this._distances[++o];let y=o-1,b=this._distances[y],I=h-b,A=I>0?(g-b)/I:0;return this.points[y].mult(1-A).add(this.points[o].mult(A))}}class fd{constructor(t,o,h){let g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(o/h);for(let b=0;b<this.xCellCount*this.yCellCount;b++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,h,g,y){this._forEachCell(o,h,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(t,o,h,g){this._forEachCell(o-g,h-g,o+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(h),this.circles.push(g)}_insertBoxCell(t,o,h,g,y,b){this.boxCells[y].push(b)}_insertCircleCell(t,o,h,g,y,b){this.circleCells[y].push(b)}_query(t,o,h,g,y,b){if(h<0||t>this.width||g<0||o>this.height)return!y&&[];let I=[];if(t<=0&&o<=0&&this.width<=h&&this.height<=g){if(y)return!0;for(let A=0;A<this.boxKeys.length;A++)I.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let O=this.circles[3*A],P=this.circles[3*A+1],k=this.circles[3*A+2];I.push({key:this.circleKeys[A],x1:O-k,y1:P-k,x2:O+k,y2:P+k})}return b?I.filter(b):I}return this._forEachCell(t,o,h,g,this._queryCell,I,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?I.length>0:I}_queryCircle(t,o,h,g,y){let b=t-h,I=t+h,A=o-h,O=o+h;if(I<0||b>this.width||O<0||A>this.height)return!g&&[];let P=[];return this._forEachCell(b,A,I,O,this._queryCellCircle,P,{hitTest:g,circle:{x:t,y:o,radius:h},seenUids:{box:{},circle:{}}},y),g?P.length>0:P}query(t,o,h,g,y){return this._query(t,o,h,g,!1,y)}hitTest(t,o,h,g,y){return this._query(t,o,h,g,!0,y)}hitTestCircle(t,o,h,g){return this._queryCircle(t,o,h,!0,g)}_queryCell(t,o,h,g,y,b,I,A){let O=I.seenUids,P=this.boxCells[y];if(P!==null){let z=this.bboxes;for(let j of P)if(!O.box[j]){O.box[j]=!0;let W=4*j;if(t<=z[W+2]&&o<=z[W+3]&&h>=z[W+0]&&g>=z[W+1]&&(!A||A(this.boxKeys[j]))){if(I.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[j],x1:z[W],y1:z[W+1],x2:z[W+2],y2:z[W+3]})}}}let k=this.circleCells[y];if(k!==null){let z=this.circles;for(let j of k)if(!O.circle[j]){O.circle[j]=!0;let W=3*j;if(this._circleAndRectCollide(z[W],z[W+1],z[W+2],t,o,h,g)&&(!A||A(this.circleKeys[j]))){if(I.hitTest)return b.push(!0),!0;{let q=z[W],X=z[W+1],Z=z[W+2];b.push({key:this.circleKeys[j],x1:q-Z,y1:X-Z,x2:q+Z,y2:X+Z})}}}}}_queryCellCircle(t,o,h,g,y,b,I,A){let O=I.circle,P=I.seenUids,k=this.boxCells[y];if(k!==null){let j=this.bboxes;for(let W of k)if(!P.box[W]){P.box[W]=!0;let q=4*W;if(this._circleAndRectCollide(O.x,O.y,O.radius,j[q+0],j[q+1],j[q+2],j[q+3])&&(!A||A(this.boxKeys[W])))return b.push(!0),!0}}let z=this.circleCells[y];if(z!==null){let j=this.circles;for(let W of z)if(!P.circle[W]){P.circle[W]=!0;let q=3*W;if(this._circlesCollide(j[q],j[q+1],j[q+2],O.x,O.y,O.radius)&&(!A||A(this.circleKeys[W])))return b.push(!0),!0}}}_forEachCell(t,o,h,g,y,b,I,A){let O=this._convertToXCellCoord(t),P=this._convertToYCellCoord(o),k=this._convertToXCellCoord(h),z=this._convertToYCellCoord(g);for(let j=O;j<=k;j++)for(let W=P;W<=z;W++)if(y.call(this,t,o,h,g,this.xCellCount*W+j,b,I,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,h,g,y,b){let I=g-t,A=y-o,O=h+b;return O*O>I*I+A*A}_circleAndRectCollide(t,o,h,g,y,b,I){let A=(b-g)/2,O=Math.abs(t-(g+A));if(O>A+h)return!1;let P=(I-y)/2,k=Math.abs(o-(y+P));if(k>P+h)return!1;if(O<=A||k<=P)return!0;let z=O-A,j=k-P;return z*z+j*j<=h*h}}let To={unknown:0,flipRequired:1,flipNotRequired:2},vt=Math.tan(85*Math.PI/180);function bn(d,t,o,h,g,y,b){let I=n.a6.mat4.create();if(o)if(y.name==="globe"){let A=n.bj(g,t);n.a6.mat4.multiply(I,I,A)}else{let A=n.a6.mat2.invert([],b);I[0]=A[0],I[1]=A[1],I[4]=A[2],I[5]=A[3],h||n.a6.mat4.rotateZ(I,I,g.angle)}else n.a6.mat4.multiply(I,g.labelPlaneMatrix,d);return I}function wn(d,t,o,h,g,y,b){let I=bn(d,t,o,h,g,y,b);return y.name==="globe"&&o||(I[2]=I[6]=I[10]=I[14]=0),I}function Pr(d,t,o,h,g,y,b){if(o){if(y.name==="globe"){let I=bn(d,t,o,h,g,y,b);return n.a6.mat4.invert(I,I),n.a6.mat4.multiply(I,d,I),I}{let I=n.a6.mat4.clone(d),A=n.a6.mat4.identity([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],n.a6.mat4.multiply(I,I,A),h||n.a6.mat4.rotateZ(I,I,-g.angle),I}}return g.glCoordMatrix}function mr(d,t,o,h){let g=[d,t,o,1];o?n.a6.vec4.transformMat4(g,g,h):md(g,g,h);let y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function En(d,t){return Math.min(.5+d/t*.5,1.5)}function pd(d,t){let o=d[0]/d[3],h=d[1]/d[3];return o>=-t[0]&&o<=t[0]&&h>=-t[1]&&h<=t[1]}function bl(d,t,o,h,g,y,b,I,A,O){let P=o.transform,k=h?d.textSizeData:d.iconSizeData,z=n.bk(k,o.transform.zoom),j=P.projection.name==="globe",W=[256/o.width*2+1,256/o.height*2+1],q=h?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;q.clear();let X=null;j&&(X=h?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);let Z=d.lineVertexArray,Q=h?d.text.placedSymbolArray:d.icon.placedSymbolArray,ie=o.transform.width/o.transform.height,re,ae=!1;for(let de=0;de<Q.length;de++){let le=Q.get(de),{numGlyphs:he,writingMode:_e}=le;if(_e!==n.bl.vertical||ae||re===n.bl.horizontal||(ae=!0),re=_e,(le.hidden||_e===n.bl.vertical)&&!ae){Go(he,q);continue}ae=!1;let we=new n.P(le.tileAnchorX,le.tileAnchorY),{x:ve,y:ye,z:Fe}=P.projection.projectTilePoint(we.x,we.y,O.canonical);if(A){let[We,ut,bt]=A(we);ve+=We,ye+=ut,Fe+=bt}let Ue=[ve,ye,Fe,1];if(n.a6.vec4.transformMat4(Ue,Ue,t),!pd(Ue,W)){Go(he,q);continue}let Je=Ue[3],nt=En(o.transform.getCameraToCenterDistance(P.projection),Je),st=n.bm(k,z,le),Ie=b?st/nt:st*nt,Ze=mr(ve,ye,Fe,g);if(Ze[3]<=0){Go(he,q);continue}let Ne={},Xe=b?null:A,Ke=Ii(le,Ie,!1,I,t,g,y,d.glyphOffsetArray,Z,q,X,Ze,we,Ne,ie,Xe,P.projection,O,b);ae=Ke.useVertical,Xe&&Ke.needsFlipping&&(Ne={}),(Ke.notEnoughRoom||ae||Ke.needsFlipping&&Ii(le,Ie,!0,I,t,g,y,d.glyphOffsetArray,Z,q,X,Ze,we,Ne,ie,Xe,P.projection,O,b).notEnoughRoom)&&Go(he,q)}h?(d.text.dynamicLayoutVertexBuffer.updateData(q),X&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(X)):(d.icon.dynamicLayoutVertexBuffer.updateData(q),X&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(X))}function wl(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q){let{lineStartIndex:X,glyphStartIndex:Z,segment:Q}=I,ie=Z+I.numGlyphs,re=X+I.lineLength,ae=t.getoffsetX(Z),de=t.getoffsetX(ie-1),le=El(d*ae,o,h,g,y,b,Q,X,re,A,O,P,k,z,!0,j,W,q);if(!le)return null;let he=El(d*de,o,h,g,y,b,Q,X,re,A,O,P,k,z,!0,j,W,q);return he?{first:le,last:he}:null}function Cr(d,t,o,h){return d===n.bl.horizontal&&Math.abs(h)>Math.abs(o)?{useVertical:!0}:d===n.bl.vertical?h>0?{needsFlipping:!0}:null:t!==To.unknown&&function(g,y){return g===0||Math.abs(y/g)>vt}(o,h)?t===To.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Ii(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X,Z,Q){let ie=t/24,re=d.lineOffsetX*ie,ae=d.lineOffsetY*ie,{lineStartIndex:de,glyphStartIndex:le,numGlyphs:he,segment:_e,writingMode:we,flipState:ve}=d,ye=de+d.lineLength,Fe=Ue=>{if(P){let[Ie,Ze,Ne]=Ue.up,Xe=O.length;n.bn(P,Xe+0,Ie,Ze,Ne),n.bn(P,Xe+1,Ie,Ze,Ne),n.bn(P,Xe+2,Ie,Ze,Ne),n.bn(P,Xe+3,Ie,Ze,Ne)}let[Je,nt,st]=Ue.point;n.bo(O,Je,nt,st,Ue.angle)};if(he>1){let Ue=wl(ie,I,re,ae,o,k,z,d,A,y,j,q,!1,X,Z,Q);if(!Ue)return{notEnoughRoom:!0};if(h&&!o){let[Je,nt,st]=Ue.first.point,[Ie,Ze,Ne]=Ue.last.point;[Je,nt]=mr(Je,nt,st,b),[Ie,Ze]=mr(Ie,Ze,Ne,b);let Xe=Cr(we,ve,(Ie-Je)*W,Ze-nt);if(d.flipState=Xe&&Xe.needsFlipping?To.flipRequired:To.flipNotRequired,Xe)return Xe}Fe(Ue.first);for(let Je=le+1;Je<le+he-1;Je++){let nt=El(ie*I.getoffsetX(Je),re,ae,o,k,z,_e,de,ye,A,y,j,q,!1,!1,X,Z,Q);if(!nt)return O.length-=4*(Je-le),{notEnoughRoom:!0};Fe(nt)}Fe(Ue.last)}else{if(h&&!o){let Je=mr(z.x,z.y,0,g),nt=de+_e+1,st=new n.P(A.getx(nt),A.gety(nt)),Ie=mr(st.x,st.y,0,g),Ze=Ie[3]>0?Ie:Cl(z,st,Je,1,g,void 0,X,Z.canonical),Ne=Cr(we,ve,(Ze[0]-Je[0])*W,Ze[1]-Je[1]);if(d.flipState=Ne&&Ne.needsFlipping?To.flipRequired:To.flipNotRequired,Ne)return Ne}let Ue=El(ie*I.getoffsetX(le),re,ae,o,k,z,_e,de,ye,A,y,j,q,!1,!1,X,Z,Q);if(!Ue)return{notEnoughRoom:!0};Fe(Ue)}return{}}function Lg(d,t,o,h,g){let{x:y,y:b,z:I}=h.projectTilePoint(d.x,d.y,t);if(!g)return mr(y,b,I,o);let[A,O,P]=g(d);return mr(y+A,b+O,I+P,o)}function Cl(d,t,o,h,g,y,b,I){let A=Lg(d.sub(t)._unit()._add(d),I,g,b,y);return n.a6.vec3.sub(A,o,A),n.a6.vec3.normalize(A,A),n.a6.vec3.scaleAndAdd(A,o,A,h)}function El(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X,Z){let Q=h?d-t:d+t,ie=Q>0?1:-1,re=0;h&&(ie*=-1,re=Math.PI),ie<0&&(re+=Math.PI);let ae=I+b+(ie>0?0:1)|0,de=g,le=g,he=0,_e=0,we=Math.abs(Q),ve=[],ye=[],Fe=y,Ue=Fe,Je=()=>Cl(Ue,Fe,le,we-he+1,P,z,q,X.canonical);for(;he+_e<=we;){if(ae+=ie,ae<I||ae>=A)return null;if(le=de,Ue=Fe,ve.push(le),j&&ye.push(Ue),Fe=new n.P(O.getx(ae),O.gety(ae)),de=k[ae],!de){let ut=Lg(Fe,X.canonical,P,q,z);de=ut[3]>0?k[ae]=ut:Je()}he+=_e,_e=n.a6.vec3.distance(le,de)}W&&z&&(k[ae]&&(de=Je(),_e=n.a6.vec3.distance(le,de)),k[ae]=de);let nt=(we-he)/_e,st=Fe.sub(Ue)._mult(nt)._add(Ue),Ie=n.a6.vec3.sub([],de,le),Ze=n.a6.vec3.scaleAndAdd([],le,Ie,nt),Ne=[0,0,1],Xe=Ie[0],Ke=Ie[1];if(Z&&(Ne=q.upVector(X.canonical,st.x,st.y),Ne[0]!==0||Ne[1]!==0||Ne[2]!==1)){let ut=[Ne[2],0,-Ne[0]],bt=n.a6.vec3.cross([],Ne,ut);n.a6.vec3.normalize(ut,ut),n.a6.vec3.normalize(bt,bt),Xe=n.a6.vec3.dot(Ie,ut),Ke=n.a6.vec3.dot(Ie,bt)}if(o){let ut=n.a6.vec3.cross([],Ne,Ie);n.a6.vec3.normalize(ut,ut),n.a6.vec3.scaleAndAdd(Ze,Ze,ut,o*ie)}let We=re+Math.atan2(Ke,Xe);return ve.push(Ze),j&&ye.push(st),{point:Ze,angle:We,path:ve,tilePath:ye,up:Ne}}function Go(d,t){let o=t.length,h=o+4*d;t.resize(h),t.float32.fill(-1/0,4*o,4*h)}function md(d,t,o){let h=t[0],g=t[1];return d[0]=o[0]*h+o[4]*g+o[12],d[1]=o[1]*h+o[5]*g+o[13],d[3]=o[3]*h+o[7]*g+o[15],d}let Gr=100;class gr{constructor(t,o,h=new fd(t.width+200,t.height+200,25),g=new fd(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Gr,this.screenBottomBoundary=t.height+Gr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,h,g,y,b,I,A){let O=h.projectedAnchorX,P=h.projectedAnchorY,k=h.projectedAnchorZ,z=h.elevation,j=h.tileID,W=t.getProjection();if(z&&j){let[de,le,he]=W.upVector(j.canonical,h.tileAnchorX,h.tileAnchorY),_e=W.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=de*z*_e,P+=le*z*_e,k+=he*z*_e}let q=this.projectAndGetPerspectiveRatio(I,O,P,k,h.tileID,W.name==="globe"||!!z||this.transform.pitch>0,W),X=b*q.perspectiveRatio,Z=(h.x1*o+g.x-h.padding)*X+q.point.x,Q=(h.y1*o+g.y-h.padding)*X+q.point.y,ie=(h.x2*o+g.x+h.padding)*X+q.point.x,re=(h.y2*o+g.y+h.padding)*X+q.point.y,ae=q.perspectiveRatio<=.55||q.occluded;return!this.isInsideGrid(Z,Q,ie,re)||!y&&this.grid.hitTest(Z,Q,ie,re,A)||ae?{box:[],offscreen:!1,occluded:q.occluded}:{box:[Z,Q,ie,re],offscreen:this.isOffscreen(Z,Q,ie,re),occluded:!1}}placeCollisionCircles(t,o,h,g,y,b,I,A,O,P,k,z,j,W,q){let X=[],Z=this.transform.elevation,Q=t.getProjection(),ie=Z?Z.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,Q):null,re=new n.P(h.tileAnchorX,h.tileAnchorY),{x:ae,y:de,z:le}=Q.projectTilePoint(re.x,re.y,q.canonical);if(ie){let[st,Ie,Ze]=ie(re);ae+=st,de+=Ie,le+=Ze}let he=Q.name==="globe",_e=this.projectAndGetPerspectiveRatio(I,ae,de,le,q,he||!!Z||this.transform.pitch>0,Q),{perspectiveRatio:we}=_e,ve=(k?b/we:b*we)/n.br,ye=mr(ae,de,le,A),Fe=_e.signedDistanceFromCamera>0?wl(ve,y,h.lineOffsetX*ve,h.lineOffsetY*ve,!1,ye,re,h,g,A,{},Z&&!k?ie:null,k&&!!Z,Q,q,k):null,Ue=!1,Je=!1,nt=!0;if(Fe&&!_e.occluded){let st=.5*j*we+W,Ie=new n.P(-100,-100),Ze=new n.P(this.screenRightBoundary,this.screenBottomBoundary),Ne=new So,{first:Xe,last:Ke}=Fe,We=Xe.path.length,ut=[];for(let _t=We-1;_t>=1;_t--)ut.push(Xe.path[_t]);for(let _t=1;_t<Ke.path.length;_t++)ut.push(Ke.path[_t]);let bt=2.5*st;O&&(ut=ut.map(([_t,At,ht],Lt)=>(ie&&!he&&(ht=ie(Lt<We-1?Xe.tilePath[We-1-Lt]:Ke.tilePath[Lt-We+2])[2]),mr(_t,At,ht,O))),ut.some(_t=>_t[3]<=0)&&(ut=[]));let It=[];if(ut.length>0){let _t=1/0,At=-1/0,ht=1/0,Lt=-1/0;for(let Kt of ut)_t=Math.min(_t,Kt[0]),ht=Math.min(ht,Kt[1]),At=Math.max(At,Kt[0]),Lt=Math.max(Lt,Kt[1]);At>=Ie.x&&_t<=Ze.x&&Lt>=Ie.y&&ht<=Ze.y&&(It=[ut.map(Kt=>new n.P(Kt[0],Kt[1]))],(_t<Ie.x||At>Ze.x||ht<Ie.y||Lt>Ze.y)&&(It=n.bp(It,Ie.x,Ie.y,Ze.x,Ze.y)))}for(let _t of It){Ne.reset(_t,.25*st);let At=0;At=Ne.length<=.5*st?1:Math.ceil(Ne.paddedLength/bt)+1;for(let ht=0;ht<At;ht++){let Lt=ht/Math.max(At-1,1),Kt=Ne.lerp(Lt),mn=Kt.x+Gr,Kn=Kt.y+Gr;X.push(mn,Kn,st,0);let Mn=mn-st,ri=Kn-st,An=mn+st,Qn=Kn+st;if(nt=nt&&this.isOffscreen(Mn,ri,An,Qn),Je=Je||this.isInsideGrid(Mn,ri,An,Qn),!o&&this.grid.hitTestCircle(mn,Kn,st,z)&&(Ue=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ue,occluded:!1}}}}return{circles:!P&&Ue||!Je?[]:X,offscreen:nt,collisionDetected:Ue,occluded:_e.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let o=[],h=1/0,g=1/0,y=-1/0,b=-1/0;for(let P of t){let k=new n.P(P.x+Gr,P.y+Gr);h=Math.min(h,k.x),g=Math.min(g,k.y),y=Math.max(y,k.x),b=Math.max(b,k.y),o.push(k)}let I=this.grid.query(h,g,y,b).concat(this.ignoredGrid.query(h,g,y,b)),A={},O={};for(let P of I){let k=P.key;if(A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]={}),A[k.bucketInstanceId][k.featureIndex])continue;let z=[new n.P(P.x1,P.y1),new n.P(P.x2,P.y1),new n.P(P.x2,P.y2),new n.P(P.x1,P.y2)];n.bq(o,z)&&(A[k.bucketInstanceId][k.featureIndex]=!0,O[k.bucketInstanceId]===void 0&&(O[k.bucketInstanceId]=[]),O[k.bucketInstanceId].push(k.featureIndex))}return O}insertCollisionBox(t,o,h,g,y){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,h,g,y){let b=o?this.ignoredGrid:this.grid,I={bucketInstanceId:h,featureIndex:g,collisionGroupID:y};for(let A=0;A<t.length;A+=4)b.insertCircle(I,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,o,h,g,y,b,I){let A=[o,h,g,1],O=!1;g||this.transform.pitch>0?(n.a6.vec4.transformMat4(A,A,t),this.fogState&&y&&I.name!=="globe"&&(O=function(z,j,W,q,X,Z){let Q=Z.calculateFogTileMatrix(X),ie=[j,W,q];return n.a6.vec3.transformMat4(ie,ie,Q),dt(z,n.a6.vec3.length(ie),Z.pitch,Z._fov)}(this.fogState,o,h,g,y.toUnwrapped(),this.transform)>.9)):md(A,A,t);let P=A[3];return{point:new n.P((A[0]/P+1)/2*this.transform.width+Gr,(-A[1]/P+1)/2*this.transform.height+Gr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/P*.5,1.5),signedDistanceFromCamera:P,occluded:b&&A[2]>P||O}}isOffscreen(t,o,h,g){return h<Gr||t>=this.screenRightBoundary||g<Gr||o>this.screenBottomBoundary}isInsideGrid(t,o,h,g){return h>=0&&t<this.gridRightBoundary&&g>=0&&o<this.gridBottomBoundary}getViewportMatrix(){let t=n.a6.mat4.identity([]);return n.a6.mat4.translate(t,t,[-100,-100,0]),t}}function Er(d,t,o){let h=t.createTileMatrix(d,d.worldSize,o.toUnwrapped());return n.a6.mat4.multiply(new Float32Array(16),d.projMatrix,h)}function Fg(d,t,o){if(t.projection.name===o.projection.name)return d.projMatrix;let h=o.clone();return h.setProjection(t.projection),Er(h,t.getProjection(),d)}function Ws(d,t,o){return t.name===o.projection.name?d.projMatrix:Er(o,t,d)}class Oi{constructor(t,o,h,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):g&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Mr{constructor(t,o,h,g,y,b=!1){this.text=new Oi(t?t.text:null,o,h,y),this.icon=new Oi(t?t.icon:null,o,g,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Io{constructor(t,o,h,g=!1){this.text=t,this.icon=o,this.skipFade=h,this.clipped=g}}class Xi{constructor(){this.invProjMatrix=n.a6.mat4.create(),this.viewportMatrix=n.a6.mat4.create(),this.circles=[]}}class Nf{constructor(t,o,h,g,y){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=y}}class Do{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[t]}}function Ml(d,t,o,h,g){let{horizontalAlign:y,verticalAlign:b}=n.by(d),I=-(y-.5)*t,A=-(b-.5)*o,O=n.bx(d,h);return new n.P(I+O[0]*g,A+O[1]*g)}function Ia(d,t,o,h,g){let y=new n.P(d,t);return o&&y._rotate(h?g:-g),y}class Da{constructor(t,o,h,g,y,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new gr(this.transform,y),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Do(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,h,g,y=1){let b=h.getBucket(o),I=h.latestFeatureIndex;if(!b||!I||o.fqid!==b.layerIds[0])return;let A=b.layers[0].layout,O=b.layers[0].paint,P=h.collisionBoxArray,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),z=h.tileSize/n.ab,j=h.tileID.toUnwrapped();this.transform.setProjection(b.projection);let W=(q=h.tileID,X=b.getProjection(),Z=this.transform,X.name===this.projection?Z.calculateProjMatrix(q.toUnwrapped()):Er(Z,X,q));var q,X,Z;let Q=A.get("text-pitch-alignment")==="map",ie=A.get("text-rotation-alignment")==="map";o.compileFilter(o.options);let re=o.dynamicFilter(),ae=o.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(h),le=wn(W,h.tileID.canonical,Q,ie,this.transform,b.getProjection(),de),he=null;if(Q){let Je=Pr(W,h.tileID.canonical,Q,ie,this.transform,b.getProjection(),de);he=n.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Je)}let _e=null;re&&h.latestFeatureIndex&&(_e={unwrappedTileID:j,dynamicFilter:re,dynamicFilterNeedsFeature:ae}),this.retainedQueryData[b.bucketInstanceId]=new Nf(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,h.tileID);let we=b.layers[0].layout.get("text-size-scale-range"),ve=n.ap(y,we[0],we[1]),ye=b.layers[0].layout.get("icon-size-scale-range"),Fe=n.ap(y,ye[0],ye[1]),Ue={bucket:b,layout:A,paint:O,posMatrix:W,textLabelPlaneMatrix:le,labelToScreenMatrix:he,clippingData:_e,scale:k,textPixelRatio:z,holdingForFade:h.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:n.bk(b.textSizeData,this.transform.zoom,ve),partiallyEvaluatedIconSize:n.bk(b.iconSizeData,this.transform.zoom,Fe),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(g)for(let Je of b.sortKeyRanges){let{sortKey:nt,symbolInstanceStart:st,symbolInstanceEnd:Ie}=Je;t.push({sortKey:nt,symbolInstanceStart:st,symbolInstanceEnd:Ie,parameters:Ue})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ue})}attemptAnchorPlacement(t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X,Z,Q){let{textOffset0:ie,textOffset1:re,crossTileID:ae}=z,de=[ie,re],le=Ml(t,h,g,de,y),he=this.collisionIndex.placeCollisionBox(W,y,o,Ia(le.x,le.y,b,I,this.transform.angle),k,A,O,P.predicate);if(X){let _e=W.getSymbolInstanceIconSize(Q,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(W,_e,X,Ia(le.x,le.y,b,I,this.transform.angle),k,A,O,P.predicate).box.length===0)return}if(he.box.length>0){let _e;return this.prevPlacement&&this.prevPlacement.variableOffsets[ae]&&this.prevPlacement.placements[ae]&&this.prevPlacement.placements[ae].text&&(_e=this.prevPlacement.variableOffsets[ae].anchor),this.variableOffsets[ae]={textOffset:de,width:h,height:g,anchor:t,textScale:y,prevAnchor:_e},this.markUsedJustification(W,t,z,q),W.allowVerticalPlacement&&(this.markUsedOrientation(W,q,z),this.placedOrientations[ae]=q),{shift:le,placedGlyphBoxes:he}}}placeLayerBucketPart(t,o,h,g,y=1){let{bucket:b,layout:I,paint:A,posMatrix:O,textLabelPlaneMatrix:P,labelToScreenMatrix:k,clippingData:z,textPixelRatio:j,holdingForFade:W,collisionBoxArray:q,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Z,collisionGroup:Q,latestFeatureIndex:ie}=t.parameters,re=I.get("text-optional"),ae=I.get("icon-optional"),de=I.get("text-allow-overlap"),le=I.get("icon-allow-overlap"),he=I.get("text-rotation-alignment")==="map",_e=I.get("text-pitch-alignment")==="map",we=I.get("symbol-z-elevate"),ve=A.get("symbol-z-offset"),ye=I.get("symbol-elevation-reference")==="sea",Fe=I.get("text-size-scale-range"),Ue=I.get("icon-size-scale-range"),Je=n.ap(y,Fe[0],Fe[1]),nt=n.ap(y,Ue[0],Ue[1]);this.transform.setProjection(b.projection);let st=de&&(le||!b.hasIconData()||ae),Ie=le&&(de||!b.hasTextData()||re),Ze=!ve.isConstant();!b.collisionArrays&&q&&b.deserializeCollisionBoxes(q),h&&g&&b.updateCollisionDebugBuffers(this.transform.zoom,q,Je,nt);let Ne=(Xe,Ke,We)=>{let{crossTileID:ut,numVerticalGlyphVertices:bt}=Xe,It=null;if(z&&z.dynamicFilterNeedsFeature||Ze){let Cn=this.retainedQueryData[b.bucketInstanceId];It=ie.loadFeature({featureIndex:Xe.featureIndex,bucketIndex:Cn.bucketIndex,sourceLayerIndex:Cn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},It,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new n.P(Xe.tileAnchorX,Xe.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[ut]=new Io(!1,!1,!1,!0),void o.add(ut);let _t=ve.evaluate(It,{});if(o.has(ut))return;if(W)return void(this.placements[ut]=new Io(!1,!1,!1));let At=!1,ht=!1,Lt=!0,Kt=!1,mn=!1,Kn=null,Mn={box:null,offscreen:null,occluded:null},ri={box:null,offscreen:null,occluded:null},An=null,Qn=null,un=null,Xn=0,Gn=0,Fn=0;We.textFeatureIndex?Xn=We.textFeatureIndex:Xe.useRuntimeCollisionCircles&&(Xn=Xe.featureIndex),We.verticalTextFeatureIndex&&(Gn=We.verticalTextFeatureIndex);let ui=Cn=>{Cn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;let gn=this.transform.elevation;Cn.elevation=ye?_t:_t+(gn?gn.getAtTileOffset(Cn.tileID,Cn.tileAnchorX,Cn.tileAnchorY):0),Cn.elevation+=Xe.zOffset},Vi=We.textBox;if(Vi){ui(Vi);let Cn=Pn=>{let ni=n.bl.horizontal;if(b.allowVerticalPlacement&&!Pn&&this.prevPlacement){let Si=this.prevPlacement.placedOrientations[ut];Si&&(this.placedOrientations[ut]=Si,ni=Si,this.markUsedOrientation(b,ni,Xe))}return ni},gn=(Pn,ni)=>{if(b.allowVerticalPlacement&&bt>0&&We.verticalTextBox){for(let Si of b.writingModes)if(Si===n.bl.vertical?(Mn=ni(),ri=Mn):Mn=Pn(),Mn&&Mn.box&&Mn.box.length)break}else Mn=Pn()};if(I.get("text-variable-anchor")){let Pn=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ut]){let di=this.prevPlacement.variableOffsets[ut];Pn.indexOf(di.anchor)>0&&(Pn=Pn.filter(Yi=>Yi!==di.anchor),Pn.unshift(di.anchor))}let ni=(di,Yi,Zo)=>{let Or=b.getSymbolInstanceTextSize(X,Xe,this.transform.zoom,Ke),Lr=(di.x2-di.x1)*Or+2*di.padding,ho=(di.y2-di.y1)*Or+2*di.padding,Ro=Xe.hasIconTextFit&&!le?Yi:null;Ro&&ui(Ro);let Fr={box:[],offscreen:!1,occluded:!1},Ts=de?2*Pn.length:Pn.length;for(let fo=0;fo<Ts;++fo){let Bn=this.attemptAnchorPlacement(Pn[fo%Pn.length],di,Lr,ho,Or,he,_e,j,O,Q,fo>=Pn.length,Xe,Ke,b,Zo,Ro,X,Z);if(Bn&&(Fr=Bn.placedGlyphBoxes,Fr&&Fr.box&&Fr.box.length)){At=!0,Kn=Bn.shift;break}}return Fr};gn(()=>ni(Vi,We.iconBox,n.bl.horizontal),()=>{let di=We.verticalTextBox;return di&&ui(di),b.allowVerticalPlacement&&!(Mn&&Mn.box&&Mn.box.length)&&bt>0&&di?ni(di,We.verticalIconBox,n.bl.vertical):{box:null,offscreen:null,occluded:null}}),Mn&&(At=Mn.box,Lt=Mn.offscreen,Kt=Mn.occluded);let Si=Cn(!(!Mn||!Mn.box));if(!At&&this.prevPlacement){let di=this.prevPlacement.variableOffsets[ut];di&&(this.variableOffsets[ut]=di,this.markUsedJustification(b,di.anchor,Xe,Si))}}else{let Pn=(ni,Si)=>{let di=b.getSymbolInstanceTextSize(X,Xe,this.transform.zoom,Ke,y),Yi=this.collisionIndex.placeCollisionBox(b,di,ni,new n.P(0,0),de,j,O,Q.predicate);return Yi&&Yi.box&&Yi.box.length&&(this.markUsedOrientation(b,Si,Xe),this.placedOrientations[ut]=Si),Yi};gn(()=>Pn(Vi,n.bl.horizontal),()=>{let ni=We.verticalTextBox;return b.allowVerticalPlacement&&bt>0&&ni?(ui(ni),Pn(ni,n.bl.vertical)):{box:null,offscreen:null,occluded:null}}),Cn(!!(Mn&&Mn.box&&Mn.box.length))}}if(An=Mn,At=An&&An.box&&An.box.length>0,Lt=An&&An.offscreen,Kt=An&&An.occluded,Xe.useRuntimeCollisionCircles){let Cn=b.text.placedSymbolArray.get(Xe.centerJustifiedTextSymbolIndex>=0?Xe.centerJustifiedTextSymbolIndex:Xe.verticalPlacedTextSymbolIndex),gn=n.bm(b.textSizeData,X,Cn),Pn=I.get("text-padding");Qn=this.collisionIndex.placeCollisionCircles(b,de,Cn,b.lineVertexArray,b.glyphOffsetArray,gn,O,P,k,h,_e,Q.predicate,Xe.collisionCircleDiameter*gn/n.br,Pn,this.retainedQueryData[b.bucketInstanceId].tileID),At=de||Qn.circles.length>0&&!Qn.collisionDetected,Lt=Lt&&Qn.offscreen,Kt=Qn.occluded}if(We.iconFeatureIndex&&(Fn=We.iconFeatureIndex),We.iconBox){let Cn=gn=>{ui(gn);let Pn=Xe.hasIconTextFit&&Kn?Ia(Kn.x,Kn.y,he,_e,this.transform.angle):new n.P(0,0),ni=b.getSymbolInstanceIconSize(Z,this.transform.zoom,Xe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,ni,gn,Pn,le,j,O,Q.predicate)};ri&&ri.box&&ri.box.length&&We.verticalIconBox?(un=Cn(We.verticalIconBox),ht=un.box.length>0):(un=Cn(We.iconBox),ht=un.box.length>0),Lt=Lt&&un.offscreen,mn=un.occluded}let Jr=re||Xe.numHorizontalGlyphVertices===0&&bt===0,uo=ae||Xe.numIconVertices===0;if(Jr||uo?uo?Jr||(ht=ht&&At):At=ht&&At:ht=At=ht&&At,At&&An&&An.box&&this.collisionIndex.insertCollisionBox(An.box,I.get("text-ignore-placement"),b.bucketInstanceId,ri&&ri.box&&Gn?Gn:Xn,Q.ID),ht&&un&&this.collisionIndex.insertCollisionBox(un.box,I.get("icon-ignore-placement"),b.bucketInstanceId,Fn,Q.ID),Qn&&(At&&this.collisionIndex.insertCollisionCircles(Qn.circles,I.get("text-ignore-placement"),b.bucketInstanceId,Xn,Q.ID),h)){let Cn=b.bucketInstanceId,gn=this.collisionCircleArrays[Cn];gn===void 0&&(gn=this.collisionCircleArrays[Cn]=new Xi);for(let Pn=0;Pn<Qn.circles.length;Pn+=4)gn.circles.push(Qn.circles[Pn+0]),gn.circles.push(Qn.circles[Pn+1]),gn.circles.push(Qn.circles[Pn+2]),gn.circles.push(Qn.collisionDetected?1:0)}let Gi=b.projection.name!=="globe";st=st&&(Gi||!Kt),Ie=Ie&&(Gi||!mn),this.placements[ut]=new Io(At||st,ht||Ie,Lt||b.justReloaded),o.add(ut)};if(we&&this.buildingIndex&&(this.buildingIndex.updateZOffset(b,this.retainedQueryData[b.bucketInstanceId].tileID),b.updateZOffset()),b.sortFeaturesByY){let Xe=b.getSortedSymbolIndexes(this.transform.angle);for(let Ke=Xe.length-1;Ke>=0;--Ke){let We=Xe[Ke];Ne(b.symbolInstances.get(We),We,b.collisionArrays[We])}b.hasAnyZOffset&&n.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){let Xe=b.getSortedIndexesByZOffset();for(let Ke=0;Ke<Xe.length;++Ke){let We=Xe[Ke];Ne(b.symbolInstances.get(We),We,b.collisionArrays[We])}}else for(let Xe=t.symbolInstanceStart;Xe<t.symbolInstanceEnd;Xe++)Ne(b.symbolInstances.get(Xe),Xe,b.collisionArrays[Xe]);if(h&&b.bucketInstanceId in this.collisionCircleArrays){let Xe=this.collisionCircleArrays[b.bucketInstanceId];n.a6.mat4.invert(Xe.invProjMatrix,O),Xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,o,h,g){let{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:A,crossTileID:O}=h,P=n.bw(o),k=g===n.bl.vertical?A:P==="left"?y:P==="center"?b:P==="right"?I:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=k>=0&&y!==k?0:O),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=k>=0&&b!==k?0:O),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=k>=0&&I!==k?0:O),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:O)}markUsedOrientation(t,o,h){let g=o===n.bl.horizontal||o===n.bl.horizontalOnly?o:0,y=o===n.bl.vertical?o:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:O}=h,P=t.text.placedSymbolArray;b>=0&&(P.get(b).placedOrientation=g),I>=0&&(P.get(I).placedOrientation=g),A>=0&&(P.get(A).placedOrientation=g),O>=0&&(P.get(O).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let o=this.prevPlacement,h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;let g=o?o.symbolFadeChange(t):1,y=o?o.opacities:{},b=o?o.variableOffsets:{},I=o?o.placedOrientations:{};for(let A in this.placements){let O=this.placements[A],P=y[A];P?(this.opacities[A]=new Mr(P,g,O.text,O.icon,null,O.clipped),h=h||O.text!==P.text.placed||O.icon!==P.icon.placed):(this.opacities[A]=new Mr(null,g,O.text,O.icon,O.skipFade,O.clipped),h=h||O.text||O.icon)}for(let A in y){let O=y[A];if(!this.opacities[A]){let P=new Mr(O,g,!1,!1);P.isHidden()||(this.opacities[A]=P,h=h||O.text.placed||O.icon.placed)}}for(let A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(let A in I)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=I[A]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,h,g){let y=new Set;for(let b of o){let I=b.getBucket(t);I&&b.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,y,b,b.collisionBoxArray,h,g,b.tileID,t.scope),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,b.tileID),I.updateZOffset()))}}updateBucketOpacities(t,o,h,g,y,b,I,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let O=t.layers[0].layout,P=t.layers[0].paint,k=!!t.layers[0].dynamicFilter(),z=new Mr(null,0,!1,!1,!0),j=O.get("text-allow-overlap"),W=O.get("icon-allow-overlap"),q=O.get("text-variable-anchor"),X=O.get("text-rotation-alignment")==="map",Z=O.get("text-pitch-alignment")==="map",Q=P.get("symbol-z-offset"),ie=O.get("symbol-elevation-reference")==="sea",re=!Q.isConstant(),ae=new Mr(null,0,j&&(W||!t.hasIconData()||O.get("icon-optional")),W&&(j||!t.hasTextData()||O.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);let de=(he,_e,we)=>{for(let ve=0;ve<_e/4;ve++)he.opacityVertexArray.emplaceBack(we)},le=0;b&&t.updateReplacement(I,b);for(let he=0;he<t.symbolInstances.length;he++){let _e=t.symbolInstances.get(he),{numHorizontalGlyphVertices:we,numVerticalGlyphVertices:ve,crossTileID:ye,numIconVertices:Fe,tileAnchorX:Ue,tileAnchorY:Je}=_e,nt=null,st=this.retainedQueryData[t.bucketInstanceId];re&&_e&&st&&(nt=h.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:st.bucketIndex,sourceLayerIndex:st.sourceLayerIndex,layoutVertexArrayOffset:0}));let Ie=Q.evaluate(nt,{}),Ze=o.has(ye),Ne=this.opacities[ye];Ze?Ne=z:Ne||(Ne=ae,this.opacities[ye]=Ne),o.add(ye);let Xe=we>0||ve>0,Ke=Fe>0,We=this.placedOrientations[ye],ut=We===n.bl.vertical,bt=We===n.bl.horizontal||We===n.bl.horizontalOnly;!Xe&&!Ke||Ne.isHidden()||le++;let It=!1;if((Xe||Ke)&&b)for(let _t of t.activeReplacements){if(n.bs(_t,y,n.bt.Symbol,A)||_t.min.x>Ue||Ue>_t.max.x||_t.min.y>Je||Je>_t.max.y)continue;let At=n.bu(Ue,Je,I.canonical,_t.footprintTileId.canonical);if(It=n.bv(At,_t.footprint),It)break}if(Xe){let _t=It?Tl:Sl(Ne.text);de(t.text,we,ut?Tl:_t),de(t.text,ve,bt?Tl:_t);let At=Ne.text.isHidden(),{leftJustifiedTextSymbolIndex:ht,centerJustifiedTextSymbolIndex:Lt,rightJustifiedTextSymbolIndex:Kt,verticalPlacedTextSymbolIndex:mn}=_e,Kn=t.text.placedSymbolArray,Mn=At||ut?1:0;ht>=0&&(Kn.get(ht).hidden=Mn),Lt>=0&&(Kn.get(Lt).hidden=Mn),Kt>=0&&(Kn.get(Kt).hidden=Mn),mn>=0&&(Kn.get(mn).hidden=At||bt?1:0);let ri=this.variableOffsets[ye];ri&&this.markUsedJustification(t,ri.anchor,_e,We);let An=this.placedOrientations[ye];An&&(this.markUsedJustification(t,"left",_e,An),this.markUsedOrientation(t,An,_e))}if(Ke){let _t=It?Tl:Sl(Ne.icon),{placedIconSymbolIndex:At,verticalPlacedIconSymbolIndex:ht}=_e,Lt=t.icon.placedSymbolArray,Kt=Ne.icon.isHidden()?1:0;At>=0&&(de(t.icon,Fe,ut?Tl:_t),Lt.get(At).hidden=Kt),ht>=0&&(de(t.icon,_e.numVerticalIconVertices,bt?Tl:_t),Lt.get(ht).hidden=Kt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let _t=t.collisionArrays[he];if(_t){let At=new n.P(0,0),ht=!0;if(_t.textBox||_t.verticalTextBox){if(q){let Kt=this.variableOffsets[ye];Kt?(At=Ml(Kt.anchor,Kt.width,Kt.height,Kt.textOffset,Kt.textScale),X&&At._rotate(Z?this.transform.angle:-this.transform.angle)):ht=!1}k&&(ht=!Ne.clipped),_t.textBox&&gd(t.textCollisionBox.collisionVertexArray,Ne.text.placed,!ht||ut,Ie,ie,At.x,At.y),_t.verticalTextBox&&gd(t.textCollisionBox.collisionVertexArray,Ne.text.placed,!ht||bt,Ie,ie,At.x,At.y)}let Lt=ht&&!!(!bt&&_t.verticalIconBox);_t.iconBox&&gd(t.iconCollisionBox.collisionVertexArray,Ne.icon.placed,Lt,Ie,ie,_e.hasIconTextFit?At.x:0,_e.hasIconTextFit?At.y:0),_t.verticalIconBox&&gd(t.iconCollisionBox.collisionVertexArray,Ne.icon.placed,!Lt,Ie,ie,_e.hasIconTextFit?At.x:0,_e.hasIconTextFit?At.y:0)}}}if(t.fullyClipped=le===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let he=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=he.invProjMatrix,t.placementViewportMatrix=he.viewportMatrix,t.collisionCircleArray=he.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){let h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function gd(d,t,o,h,g,y,b){d.emplaceBack(t?1:0,o?1:0,y||0,b||0,h,g?1:0),d.emplaceBack(t?1:0,o?1:0,y||0,b||0,h,g?1:0),d.emplaceBack(t?1:0,o?1:0,y||0,b||0,h,g?1:0),d.emplaceBack(t?1:0,o?1:0,y||0,b||0,h,g?1:0)}let gs=Math.pow(2,25),dx=Math.pow(2,24),kg=Math.pow(2,17),Rr=Math.pow(2,16),hx=Math.pow(2,9),_d=Math.pow(2,8),Ng=Math.pow(2,1);function Sl(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let t=d.placed?1:0,o=Math.floor(127*d.opacity);return o*gs+t*dx+o*kg+t*Rr+o*hx+t*_d+o*Ng+t}let Tl=0;class fx{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,h,g,y,b){let I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(I,g,t[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,O)=>A.sortKey-O.sortKey));this._currentPartIndex<I.length;){let A=I[this._currentPartIndex];if(o.placeLayerBucketPart(A,this._seenCrossTileIDs,h,A.symbolInstanceStart===0,b),this._currentPartIndex++,y())return!0}return!1}}class Yc{constructor(t,o,h,g,y,b,I,A,O){this.placement=new Da(t,y,b,I,A,O),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,o,h,g,y){let b=n.q.now(),I=()=>{let A=n.q.now()-b;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){let A=o[t[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=O)&&(!A.maxzoom||A.maxzoom>O)){let P=A,k=P.layout.get("symbol-z-elevate"),z=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=P.layout.get("symbol-z-order"),W=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&z),q=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),X=W&&q,Z=this._inProgressLayer=this._inProgressLayer||new fx(P),Q=n.av(A.source,A.scope);if(Z.continuePlacement(k||X?g[Q]:h[Q],this.placement,this._showCollisionBoxes,A,I,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let Aa=512/n.ab/2;class px{constructor(t,o,h){this.tileID=t,this.bucketInstanceId=h,this.index=new n.bz(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let g=t.canonical.x*n.ab,y=t.canonical.y*n.ab;for(let b=0;b<o.length;b++){let{key:I,crossTileID:A,tileAnchorX:O,tileAnchorY:P}=o.get(b),k=Math.floor((g+O)*Aa),z=Math.floor((y+P)*Aa);this.index.add(k,z),this.keys.push(I),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,o,h){let g=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),y=Aa/Math.pow(2,o.canonical.z-this.tileID.canonical.z),b=o.canonical.x*n.ab,I=o.canonical.y*n.ab;for(let A=0;A<t.length;A++){let O=t.get(A);if(O.crossTileID)continue;let{key:P,tileAnchorX:k,tileAnchorY:z}=O,j=Math.floor((b+k)*y),W=Math.floor((I+z)*y),q=this.index.range(j-g,W-g,j+g,W+g);for(let X of q){let Z=this.crossTileIDs[X];if(this.keys[X]===P&&!h.has(Z)){h.add(Z),O.crossTileID=Z;break}}}}}class Il{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zg{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let o=Math.round((t-this.lng)/360);if(o!==0)for(let h in this.indexes){let g=this.indexes[h],y={};for(let b in g){let I=g[b];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+o),y[I.tileID.key]=I}this.indexes[h]=y}this.lng=t}addBucket(t,o,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let g=this.usedCrossTileIDs[t.overscaledZ];for(let y in this.indexes){let b=this.indexes[y];if(Number(y)>t.overscaledZ)for(let I in b){let A=b[I];A.tileID.isChildOf(t)&&A.findMatches(o.symbolInstances,t,g)}else{let I=b[t.scaledTo(Number(y)).key];I&&I.findMatches(o.symbolInstances,t,g)}}for(let y=0;y<o.symbolInstances.length;y++){let b=o.symbolInstances.get(y);b.crossTileID||(b.crossTileID=h.generate(),g.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new px(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(let h of o.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let o=!1;for(let h in this.indexes){let g=this.indexes[h];for(let y in g)t[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[y]),delete g[y],o=!0)}return o}}class yd{constructor(){this.layerIndexes={},this.crossTileIDs=new Il,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,h,g){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new zg);let b=!1,I={};g.name!=="globe"&&y.handleWrapJump(h);for(let A of o){let O=A.getBucket(t);O&&t.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,O,this.crossTileIDs)&&(b=!0),I[O.bucketInstanceId]=!0)}return y.removeStaleBuckets(I)&&(b=!0),b}pruneUnusedLayers(t){let o={};t.forEach(h=>{o[h]=!0});for(let h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}let Hr=771;class fn{constructor(t,o,h,g){this.blendFunction=t,this.blendColor=o,this.mask=h,this.blendEquation=g}}fn.Replace=[1,0,1,0],fn.disabled=new fn(fn.Replace,n.bA.transparent,[!1,!1,!1,!1]),fn.unblended=new fn(fn.Replace,n.bA.transparent,[!0,!0,!0,!0]),fn.alphaBlended=new fn([1,Hr,1,Hr],n.bA.transparent,[!0,!0,!0,!0]),fn.alphaBlendedNonPremultiplied=new fn([770,Hr,770,Hr],n.bA.transparent,[!0,!0,!0,!0]),fn.multiply=new fn([774,0,774,0],n.bA.transparent,[!0,!0,!0,!0]);class Rt{constructor(t,o,h){this.func=t,this.mask=o,this.range=h}}Rt.ReadOnly=!1,Rt.ReadWrite=!0,Rt.disabled=new Rt(519,Rt.ReadOnly,[0,1]);let zf=7680;class Yt{constructor(t,o,h,g,y,b){this.test=t,this.ref=o,this.mask=h,this.fail=g,this.depthFail=y,this.pass=b}}Yt.disabled=new Yt({func:519,mask:0},0,0,zf,zf,zf);let Bf=1029,Jc=2305;class jt{constructor(t,o,h){this.enable=t,this.mode=o,this.frontFace=h}}function Vf(d,t){let o=n.bD(d,3);n.a6.mat4.fromQuat(d,t),n.bF(d,3,o)}function vd(d,t){let o=n.a6.quat.identity([]);return n.a6.quat.rotateZ(o,o,-t),n.a6.quat.rotateX(o,o,-d),o}function jf(d,t){let o=[d[0],d[1],0],h=[t[0],t[1],0];if(n.a6.vec3.length(o)>=1e-15){let b=n.a6.vec3.normalize([],o);n.a6.vec3.scale(h,b,n.a6.vec3.dot(h,b)),t[0]=h[0],t[1]=h[1]}let g=n.a6.vec3.cross([],t,d);if(n.a6.vec3.len(g)<1e-15)return null;let y=Math.atan2(-g[1],g[0]);return vd(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),y)}jt.disabled=new jt(!1,Bf,Jc),jt.backCCW=new jt(!0,Bf,Jc),jt.backCW=new jt(!0,Bf,2304),jt.frontCW=new jt(!0,1028,2304),jt.frontCCW=new jt(!0,1028,Jc);class Zs{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){let o=t instanceof n.a5?t:new n.a5(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=n.bB(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;let h=this.position,g=this._elevation?this._elevation.getAtPointOrZero(n.a5.fromLngLat(t)):0,y=n.a5.fromLngLat(t,g),b=[y.x-h.x,y.y-h.y,y.z-h.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=jf(b,o)}setPitchBearing(t,o){this.orientation=vd(n.bC(t),n.bC(-o))}}class Pa{constructor(t,o){this._transform=n.a6.mat4.identity([]),this.orientation=o,this.position=t}get mercatorPosition(){let t=this.position;return new n.a5(t[0],t[1],t[2])}get position(){let t=n.bD(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&n.bF(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.a6.quat.identity([]),t&&Vf(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=vd(t,o),Vf(this._transform,this._orientation)}forward(){let t=n.bD(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=n.bD(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=n.bD(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){let h=new Float64Array(16);return n.a6.mat4.invert(h,this.getWorldToCamera(t,o)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,h){let g=this.position;n.a6.vec3.scale(g,g,-t);let y=new Float64Array(16);return n.a6.mat4.fromScaling(y,[h,h,h]),n.a6.mat4.translate(y,y,g),y[10]*=o,y}getWorldToCamera(t,o){let h=new Float64Array(16),g=new Float64Array(4),y=this.position;return n.a6.quat.conjugate(g,this._orientation),n.a6.vec3.scale(y,y,-t),n.a6.mat4.fromQuat(h,g),n.a6.mat4.translate(h,h,y),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=o,h[9]*=o,h[10]*=o,h[11]*=o,h}getCameraToClipPerspective(t,o,h,g){let y=new Float64Array(16);return n.a6.mat4.perspective(y,t,o,h,g),y}getCameraToClipOrthographic(t,o,h,g,y,b){let I=new Float64Array(16);return n.a6.mat4.ortho(I,t,o,h,g,y,b),I}getDistanceToElevation(t,o=!1){let h=t===0?0:n.bE(t,o?n.aN(this.position[1]):this.position[1]),g=this.forward();return(h-this.position[2])/g[2]}clone(){return new Pa([...this.position],[...this.orientation])}}let ar={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class xd{constructor(t=0,o=0,h=0,g=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=h,this.right=g}interpolate(t,o,h){return o.top!=null&&t.top!=null&&(this.top=n.aa(t.top,o.top,h)),o.bottom!=null&&t.bottom!=null&&(this.bottom=n.aa(t.bottom,o.bottom,h)),o.left!=null&&t.left!=null&&(this.left=n.aa(t.left,o.left,h)),o.right!=null&&t.right!=null&&(this.right=n.aa(t.right,o.right,h)),this}getCenter(t,o){let h=n.ap((this.left+t-this.right)/2,0,t),g=n.ap((this.top+o-this.bottom)/2,0,o);return new n.P(h,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new xd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Dl=(d,t,o)=>(1-o)*d+o*t,Al=d=>d*d*d*d*d;class bd{constructor(t,o,h,g,y,b,I){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=g??60,this.setProjection(b),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new n.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Pa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let t=new bd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){let h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.ar(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let o=this.projection?this.getProjection():void 0;this.projection=n.bM(this.projectionOptions);let h=this.getProjection(),g=!n.bi(o,h);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bM({name:"mercator"});let o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bB(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=n.a6.mat2.create(),n.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let o=n.ap(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.bC(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let h=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop(),g=0,y=0;for(let b=0;b<o.length;b++){let I=new n.P(o[b][0]*this.width,h+o[b][1]*(this.height-h)),A=t.pointCoordinate(I);if(!A)continue;let O=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);g+=A[3]*O,y+=O}return y===0?NaN:g/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*o,g=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(g-h,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),h;h=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];let g=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,h));return n.ap(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!n.a6.quat.exactEquals(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){let h=[t.position.x,t.position.y,t.position.z];n.a6.vec3.exactEquals(h,this._camera.position)||(this._setCameraPosition(h),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,o=new Zs;return o.position=new n.a5(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!n.a6.quat.length(t))return!1;n.a6.quat.normalize(t,t);let o=n.a6.vec3.transformQuat([],[0,0,-1],t),h=n.a6.vec3.transformQuat([],[0,-1,0],t);if(h[2]<0)return!1;let g=jf(o,h);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){let o=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=n.ap(t[2],g/h,g/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,h){this._unmodified=!1,this._edgeInsets.interpolate(t,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){let o=[new n.bN(0,t)];if(this.renderWorldCopies){let h=this.pointCoordinate(new n.P(0,0)),g=this.pointCoordinate(new n.P(this.width,0)),y=this.pointCoordinate(new n.P(this.width,this.height)),b=this.pointCoordinate(new n.P(0,this.height)),I=Math.floor(Math.min(h.x,g.x,y.x,b.x)),A=Math.floor(Math.max(h.x,g.x,y.x,b.x)),O=1;for(let P=I-O;P<=A+O;P++)P!==0&&o.push(new n.bN(P,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,h){let g=[],y=h!==void 0,b=!y;if(b&&this.zoom<o||y&&h[0]===0&&h[1]===0)return g;let I=new Set,A=(P,k,z,j,W)=>{let q=n.c2(k,P,z,j,W);I.has(q)||(g.push(new n.aA(P,k,z,j,W)),I.add(q))};for(let P=0;P<t.length;P++){let k=t[P];if(b&&k.canonical.z!==o)continue;let z=k.canonical,j=k.overscaledZ,W=k.wrap,q=1<<z.z,X=z.x+1<q,Z=z.x>0,Q=z.y+1<q,ie=z.y>0,re=k.wrap-(Z?0:1),ae=k.wrap+(X?0:1),de=Z?z.x-1:q-1,le=X?z.x+1:0;if(y)h[0]<0?(A(j,ae,z.z,le,z.y),h[1]<0&&Q&&(A(j,W,z.z,z.x,z.y+1),A(j,ae,z.z,le,z.y+1)),h[1]>0&&ie&&(A(j,W,z.z,z.x,z.y-1),A(j,ae,z.z,le,z.y-1))):h[0]>0?(A(j,re,z.z,de,z.y),h[1]<0&&Q&&(A(j,W,z.z,z.x,z.y+1),A(j,re,z.z,de,z.y+1)),h[1]>0&&ie&&(A(j,W,z.z,z.x,z.y-1),A(j,re,z.z,de,z.y-1))):h[1]<0&&Q?A(j,W,z.z,z.x,z.y+1):ie&&A(j,W,z.z,z.x,z.y-1);else{let he=k.visibleQuadrants;1&he&&(A(j,re,z.z,de,z.y),ie&&(A(j,W,z.z,z.x,z.y-1),A(j,re,z.z,de,z.y-1))),2&he&&(A(j,ae,z.z,le,z.y),ie&&(A(j,W,z.z,z.x,z.y-1),A(j,ae,z.z,le,z.y-1))),4&he&&(A(j,re,z.z,de,z.y),Q&&(A(j,W,z.z,z.x,z.y+1),A(j,re,z.z,de,z.y+1))),8&he&&(A(j,ae,z.z,le,z.y),Q&&(A(j,W,z.z,z.x,z.y+1),A(j,ae,z.z,le,z.y+1)))}}let O=[];for(let P of g)g.some(k=>P.isChildOf(k))||O.push(P);if(g=O.filter(P=>!t.some(k=>!!(P.overscaledZ<o&&k.isChildOf(P))||P.equals(k)||P.isChildOf(k))),b){let P=1<<o,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[P*k.x,P*k.y],j=4,W=j*j;g=g.filter(q=>{let X=q.canonical.x+.5-z[0],Z=q.canonical.y+.5-z[1];return X*X+Z*Z<W})}return g}coveringTiles(t){let o=this.coveringZoomLevel(t),h=o,g=this.elevation&&this.elevation.exaggeration(),y=g&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);let I=this.locationCoordinate(this.center),A=this.center.lat,O=1<<o,P=[O*I.x,O*I.y,0],k=this.projection.name==="globe",z=!k,j=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,z),W=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=O*n.bE(1,this.center.lat),X=this._camera.position[2]/n.bE(1,this.center.lat),Z=[O*W.x,O*W.y,X*(z?1:q)],Q=k||g,ie=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),re=this.isLODDisabled(!0)?o:0,ae;if(this._elevation&&t.isTerrainDEM)ae=1e4*this._elevation.exaggeration();else if(this._elevation){let Ie=this._elevation.getMinMaxForVisibleTiles();ae=Ie?Ie.max:this._centerAltitude}else ae=this._centerAltitude;let de=t.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,le=this.projection.isReprojectedInTileSpace?n.bP(this):1,he=Ie=>{let Ne=new n.a5(Ie.x+25e-6,Ie.y,Ie.z),Xe=new n.a5(Ie.x,Ie.y+25e-6,Ie.z),Ke=Ie.toLngLat(),We=Ne.toLngLat(),ut=Xe.toLngLat(),bt=this.locationCoordinate(Ke),It=this.locationCoordinate(We),_t=this.locationCoordinate(ut),At=Math.hypot(It.x-bt.x,It.y-bt.y),ht=Math.hypot(_t.x-bt.x,_t.y-bt.y);return Math.sqrt(At*ht)*le/25e-6},_e=Ie=>{let Ze=ae,Ne=de;return{aabb:n.bS(this,O,0,0,0,Ie,Ne,Ze,this.projection),zoom:0,x:0,y:0,minZ:Ne,maxZ:Ze,wrap:Ie,fullyVisible:!1}},we=[],ve=[],ye=o,Fe=t.reparseOverscaled?h:o,Ue=(X-this._centerAltitude)*q,Je=Ie=>{if(!this._elevation||!Ie.tileID||!b)return;let Ze=this._elevation.getMinMaxForTile(Ie.tileID),Ne=Ie.aabb;Ze?(Ne.min[2]=Ze.min,Ne.max[2]=Ze.max,Ne.center[2]=(Ne.min[2]+Ne.max[2])/2):(Ie.shouldSplit=st(Ie),Ie.shouldSplit||(Ne.min[2]=Ne.max[2]=Ne.center[2]=this._centerAltitude))},nt=(Ie,Ze)=>{if(.707*Ze<Ie)return 1;let Ne=Ze/Ie;return Ne/(1.4144271570014144+(Math.pow(1.1,Ne-1.4144271570014144+1)-1)/(1.1-1)-1)},st=Ie=>{if(Ie.zoom<re)return!0;if(Ie.zoom===ye)return!1;if(Ie.shouldSplit!=null)return Ie.shouldSplit;let Ze=Ie.aabb.distanceX(Z),Ne=Ie.aabb.distanceY(Z),Xe=Ue,Ke=1;if(k){Xe=Ie.aabb.distanceZ(Z);let ht=Math.pow(2,Ie.zoom),Lt=n.aN((Ie.y+1)/ht),Kt=n.aN(Ie.y/ht),mn=Math.min(Math.max(A,Lt),Kt),Kn=n.c6(mn)/n.c6(A);if(Ke=mn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Kn/this._mercatorScaleRatio),this.zoom<=n.c3&&Ie.zoom===ye-1&&Kn>=.9)return!0}else if(y&&(Xe=Ie.aabb.distanceZ(Z)*q),this.projection.isReprojectedInTileSpace&&h<=5){let ht=Math.pow(2,Ie.zoom),Lt=he(new n.a5((Ie.x+.5)/ht,(Ie.y+.5)/ht));Ke=Lt>.85?1:Lt}if(!b){let ht=Math.sqrt(Ze*Ze+Ne*Ne+Xe*Xe),Lt=(1<<ye-Ie.zoom)*ie*Ke;return Lt*=nt(Math.max(Xe,Ue),ht),ht<Lt}let We=Number.MAX_VALUE,ut=0,bt=Ie.aabb.getCorners(),It=[];for(let ht of bt){n.a6.vec3.sub(It,ht,Z),k||(y?It[2]*=q:It[2]=Ue);let Lt=n.a6.vec3.dot(It,this._camera.forward());Lt<We&&(We=Lt,ut=Math.abs(It[2]))}let _t=(1<<ye-Ie.zoom)*ie*Ke;if(_t*=nt(Math.max(ut,Ue),We),We<_t)return!0;let At=Ie.aabb.closestPoint(P);return At[0]===P[0]&&At[1]===P[1]};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)we.push(_e(-Ie)),we.push(_e(Ie));for(we.push(_e(0));we.length>0;){let Ie=we.pop(),Ze=Ie.x,Ne=Ie.y,Xe=Ie.fullyVisible,Ke=()=>this.projection.name==="globe"&&(Ie.y===0||Ie.y===(1<<Ie.zoom)-1);if(!Xe){let We=Q?Ie.aabb.intersects(j):Ie.aabb.intersectsFlat(j);if(We===0&&Ke()){let ut=new n.bQ(Ie.zoom,Ze,Ne);We=n.bR(this,O,ut,!0).intersects(j)}if(We===0)continue;Xe=We===2}if(Ie.zoom!==ye&&st(Ie))for(let We=0;We<4;We++){let ut=(Ze<<1)+We%2,bt=(Ne<<1)+(We>>1),It={aabb:b?Ie.aabb.quadrant(We):n.bS(this,O,Ie.zoom+1,ut,bt,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:ut,y:bt,wrap:Ie.wrap,fullyVisible:Xe,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};y&&!k&&(It.tileID=new n.aA(Ie.zoom+1===ye?Fe:Ie.zoom+1,Ie.wrap,Ie.zoom+1,ut,bt),Je(It)),we.push(It)}else{let We=Ie.zoom===ye?Fe:Ie.zoom;if(t.minzoom&&t.minzoom>We)continue;let ut=0;if(!Xe){let At=Q?Ie.aabb.intersectsPrecise(j):Ie.aabb.intersectsPreciseFlat(j);if(At===0&&Ke()){let ht=new n.bQ(Ie.zoom,Ze,Ne);At=n.bR(this,O,ht,!0).intersectsPrecise(j)}if(At===0)continue;if(t.calculateQuadrantVisibility)if(j.containsPoint(Ie.aabb.center))ut=15;else for(let ht=0;ht<4;ht++)Ie.aabb.quadrant(ht).intersects(j)!==0&&(ut|=1<<ht)}let bt=P[0]-(.5+Ze+(Ie.wrap<<Ie.zoom))*(1<<o-Ie.zoom),It=P[1]-.5-Ne,_t=Ie.tileID?Ie.tileID:new n.aA(We,Ie.wrap,Ie.zoom,Ze,Ne);t.calculateQuadrantVisibility&&(_t.visibleQuadrants=ut),ve.push({tileID:_t,distanceSq:bt*bt+It*It})}}if(this.fogCullDistSq){let Ie=this.fogCullDistSq,Ze=this.horizonLineFromTop();ve=ve.filter(Ne=>{let Xe=[0,0,0,1],Ke=[n.ab,n.ab,0,1],We=this.calculateFogTileMatrix(Ne.tileID.toUnwrapped());n.a6.vec4.transformMat4(Xe,Xe,We),n.a6.vec4.transformMat4(Ke,Ke,We);let ut=n.a6.vec4.min([],Xe,Ke),bt=n.a6.vec4.max([],Xe,Ke),It=n.bT(ut,bt);if(It===0)return!0;let _t=!1,At=this._elevation;if(At&&It>Ie&&Ze!==0){let ht=this.calculateProjMatrix(Ne.tileID.toUnwrapped()),Lt;t.isTerrainDEM||(Lt=At.getMinMaxForTile(Ne.tileID)),Lt||(Lt={min:de,max:ae});let Kt=n.c4(this.rotation),mn=[Kt[0]*n.ab,Kt[1]*n.ab,Lt.max];n.a6.vec3.transformMat4(mn,mn,ht),_t=(1-mn[1])*this.height*.5<Ze}return It<Ie||_t})}return ve.sort((Ie,Ze)=>Ie.distanceSq-Ze.distanceSq).map(Ie=>Ie.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let o=n.ap(t.lat,-n.bU,n.bU),h=this.projection.project(t.lng,o);return new n.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let h,g,y=this.centerPoint;if(this.projection.name==="globe"){let I=this.worldSize;h=(o.x-y.x)/I,g=(o.y-y.y)/I}else{let I=this.pointCoordinate(o),A=this.pointCoordinate(y);h=I.x-A.x,g=I.y-A.y}let b=this.locationCoordinate(t);this.setLocation(new n.a5(b.x-h,b.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,o){let h=o?n.bE(o,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new n.a5(g.x,g.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){let h=o??this._centerAltitude,g=[t.x,t.y,0,1],y=[t.x,t.y,1,1];n.a6.vec4.transformMat4(g,g,this.pixelMatrixInverse),n.a6.vec4.transformMat4(y,y,this.pixelMatrixInverse);let b=y[3];n.a6.vec4.scale(g,g,1/g[3]),n.a6.vec4.scale(y,y,1/b);let I=g[2],A=y[2];return{p0:g,p1:y,t:I===A?0:(h-I)/(A-I)}}screenPointToMercatorRay(t){let o=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return n.a6.vec4.transformMat4(o,o,this.pixelMatrixInverse),n.a6.vec4.transformMat4(h,h,this.pixelMatrixInverse),n.a6.vec4.scale(o,o,1/o[3]),n.a6.vec4.scale(h,h,1/h[3]),o[2]=n.bE(o[2],this._center.lat)*this.worldSize,h[2]=n.bE(h[2],this._center.lat)*this.worldSize,n.a6.vec4.scale(o,o,1/this.worldSize),n.a6.vec4.scale(h,h,1/this.worldSize),new n.aj([o[0],o[1],o[2]],n.a6.vec3.normalize([],n.a6.vec3.sub([],h,o)))}rayIntersectionCoordinate(t){let{p0:o,p1:h,t:g}=t,y=n.bE(o[2],this._center.lat),b=n.bE(h[2],this._center.lat);return new n.a5(n.aa(o[0],h[0],g)/this.worldSize,n.aa(o[1],h[1],g)/this.worldSize,n.aa(y,b,g))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let o=this.projection.pointCoordinate3D(this,t.x,t.y);if(o)return new n.a5(o[0],o[1],o[2]);let h=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t);let y=.02*g,b=t.clone();for(let I=0;I<10&&g-h>y;I++){b.y=n.aa(h,g,.66);let A=this.projection.pointCoordinate3D(this,b.x,b.y);A?(g=b.y,o=A):h=b.y}return o?new n.a5(o[0],o[1],o[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.bV)return!this.isPointAboveHorizon(t);let o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){let h=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return n.a6.vec4.transformMat4(g,g,this.pixelMatrix),g[3]>0?new n.P(g[0]/g[3],g[1]/g[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:o}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new n.P(o,t)),b=this.pointLocation3D(new n.P(g,t)),I=this.pointLocation3D(new n.P(g,h)),A=this.pointLocation3D(new n.P(o,h)),O=Math.min(y.lng,b.lng,I.lng,A.lng),P=Math.max(y.lng,b.lng,I.lng,A.lng),k=Math.min(y.lat,b.lat,I.lat,A.lat),z=Math.max(y.lat,b.lat,I.lat,A.lat),j=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,q=(X,Z,Q,ie,re)=>{let ae=(X+Q)/2,de=(Z+ie)/2,le=new n.P(ae,de),{lng:he,lat:_e}=this.pointLocation3D(le),we=Math.max(0,O-he,k-_e,he-P,_e-z);O=Math.min(O,he),P=Math.max(P,he),k=Math.min(k,_e),z=Math.max(z,_e),(re<W||we>j)&&(q(X,Z,ae,de,re+1),q(ae,de,Q,ie,re+1))};if(q(o,t,g,t,1),q(g,t,g,h,1),q(g,h,o,h,1),q(o,h,o,t,1),this.projection.name==="globe"){let[X,Z]=n.bW(this);X?(z=90,P=180,O=-180):Z&&(k=-90,P=180,O=-180)}return new n.as(new n.bL(O,k),new n.bL(P,z))}_getBoundsRectangular(t,o){let{top:h,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,I=new n.P(g,h),A=new n.P(b,h),O=new n.P(b,y),P=new n.P(g,y),k=this.pointCoordinate(I,t),z=this.pointCoordinate(A,t),j=this.pointCoordinate(O,o),W=this.pointCoordinate(P,o),q=(X,Z)=>(Z.y-X.y)/(Z.x-X.x);return k.y>1&&z.y>=0?k=new n.a5((1-W.y)/q(W,k)+W.x,1):k.y<0&&z.y<=1&&(k=new n.a5(-W.y/q(W,k)+W.x,0)),z.y>1&&k.y>=0?z=new n.a5((1-j.y)/q(j,z)+j.x,1):z.y<0&&k.y<=1&&(z=new n.a5(-j.y/q(j,z)+j.x,0)),new n.as().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let o=t.visibleDemTiles.reduce((h,g)=>{if(g.dem){let y=g.dem.tree;h.min=Math.min(h.min,y.minimums[0]),h.max=Math.max(h.max,y.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.bU,this.maxLat=n.bU,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.am(this.minLng)*this.tileSize,this.worldMaxX=n.am(this.maxLng)*this.tileSize,this.worldMinY=n.at(this.maxLat)*this.tileSize,this.worldMaxY=n.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){let o=t.key,h=this._distanceTileDataCache;if(h[o])return h[o];let g=t.canonical,y=1/this.height,b=this.cameraWorldSize,I=b/this.zoomScale(g.z),A=(g.x+Math.pow(2,g.z)*t.wrap)*I,O=g.y*I,P=this.point;P.x*=b/this.worldSize,P.y*=b/this.worldSize;let k=this.angle,z=Math.sin(-k),j=-Math.cos(-k);return h[o]={bearing:[z,j],center:[(P.x-A)*y,(P.y-O)*y],scale:I/n.ab*y},h[o]}calculateFogTileMatrix(t){let o=t.key,h=this._fogTileMatrixCache;if(h[o])return h[o];let g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.a6.mat4.multiply(g,this.worldToFogMatrix,g),h[o]=new Float32Array(g),h[o]}calculateProjMatrix(t,o=!1,h=!1){let g=t.key,y;if(y=h?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,y[g])return y[g];let b=this.calculatePosMatrix(t,this.worldSize),I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,n.a6.mat4.multiply(b,I,b),y[g]=new Float32Array(b),y[g]}calculatePixelsToTileUnitsMatrix(t){let o=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[o])return h[o];let g=n.bX(t,this);return h[o]=g,h[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,o=n.a6.mat4.fromScaling([],[t,t,t]);return n.a6.mat4.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let o=n.bE(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(o),g=this._camera.forward(),y=n.bE(1,this._center.lat);h[2]/=y,g[2]/=y,n.a6.vec3.normalize(g,g);let b=t.raycast(h,g,t.exaggeration());if(b){let I=n.a6.vec3.scaleAndAdd([],h,g,b),A=new n.a5(I[0],I[1],n.bE(I[2],n.aN(I[1]))),O=(A.z+n.a6.vec3.length([A.x-h[0],A.y-h[1],A.z-h[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let o=this._elevation,h=n.bE(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),y=o.getAtPointOrZero(new n.a5(...g)),b=this.pixelsPerMeter/this.worldSize*y,I=this._minimumHeightOverTerrain(),A=g[2]-b;if(A<=I)if(A<0||t){let O=this.locationCoordinate(this._center,this._centerAltitude),P=[g[0],g[1],O.z-g[2]],k=n.a6.vec3.length(P);P[2]-=(I-A)/this._pixelsPerMercatorPixel;let z=n.a6.vec3.length(P);if(z===0)return;n.a6.vec3.scale(P,P,k/z*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],O.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let z=this.center;return z.lat=n.ap(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(z.lng=n.ap(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}let o=this._unmodified,{x:h,y:g}=this.point,y=0,b=h,I=g,A=this.width/2,O=this.height/2,P=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(g-O<P&&(I=P+O),g+O>k&&(I=k-O),k-P<this.height&&(y=Math.max(y,this.height/(k-P)),I=(k+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let z=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,W=this.worldSize/2-(z+j)/2;b=(h+W+this.worldSize)%this.worldSize-W,b-A<z&&(b=z+A),b+A>j&&(b=j-A),j-z<this.width&&(y=Math.max(y,this.width/(j-z)),b=(j+z)/2)}b===h&&I===g||(this.center=this.unproject(new n.P(b,I))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,o=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bE(1,this.center.lat)/n.bE(1,n.c5));let g=n.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let y=this.projection.zAxisUnit==="meters"?h:1,b=this._camera.getWorldToCamera(this.worldSize,y),I,A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=_e*this.aspect,ve=-we,ye=-_e;we-=t.x,ve-=t.x,_e+=t.y,ye+=t.y,I=this._camera.getCameraToClipOrthographic(ve,we,ye,_e,this._nearZ,this._farZ),((Fe,Ue,Je,nt)=>{for(let st=0;st<16;st++)Fe[st]=Dl(Ue[st],Je[st],nt)})(I,I,A,Al(this.pitch>=15?1:this.pitch/15))}else I=A;let O=n.a6.mat4.mul([],A,b),P=n.a6.mat4.mul([],I,b);if(this.projection.isReprojectedInTileSpace){let _e=this.locationCoordinate(this.center),we=n.a6.mat4.identity([]);n.a6.mat4.translate(we,we,[_e.x*this.worldSize,_e.y*this.worldSize,0]),n.a6.mat4.multiply(we,we,n.bZ(this)),n.a6.mat4.translate(we,we,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),n.a6.mat4.multiply(P,P,we),n.a6.mat4.multiply(O,O,we),this.inverseAdjustmentMatrix=n.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.a6.mat4.scale([],P,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=P,this.invProjMatrix=n.a6.mat4.invert(new Float64Array(16),this.projMatrix),o){let _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-t.x/this.width,_e[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.a6.mat4.mul([],_e,b)}else this.expandedFarZProjMatrix=this.projMatrix;let k=n.a6.mat4.invert([],I);this.frustumCorners=n.b$.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);let z=new Float32Array(16);n.a6.mat4.identity(z),n.a6.mat4.scale(z,z,[1,-1,1]),n.a6.mat4.rotateX(z,z,this._pitch),n.a6.mat4.rotateZ(z,z,this.angle);let j=n.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.a6.mat4.clone(j);let W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-t.x/this.width,j[9]=2*(t.y+W)/this.height,this.skyboxMatrix=n.a6.mat4.multiply(z,j,z);let q=this.point,X=q.x,Z=q.y,Q=this.width%2/2,ie=this.height%2/2,re=Math.cos(this.angle),ae=Math.sin(this.angle),de=X-Math.round(X)+re*Q+ae*ie,le=Z-Math.round(Z)+re*ie+ae*Q,he=new Float64Array(P);if(n.a6.mat4.translate(he,he,[de>.5?de-1:de,le>.5?le-1:le,0]),this.alignedProjMatrix=he,P=n.a6.mat4.create(),n.a6.mat4.scale(P,P,[this.width/2,-this.height/2,1]),n.a6.mat4.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=n.a6.mat4.create(),n.a6.mat4.scale(P,P,[1,-1,1]),n.a6.mat4.translate(P,P,[-1,-1,0]),n.a6.mat4.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=n.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},P=n.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.c0(this);let _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.a6.vec3.transformMat4(_e,_e,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,h=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,o];n.a6.vec3.scale(y,y,g),n.a6.vec3.scale(h,h,-1),n.a6.vec3.multiply(h,h,y);let b=n.a6.mat4.create();n.a6.mat4.translate(b,b,h),n.a6.mat4.scale(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,g)}_computeCameraPosition(t){let o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-h[0]*y,g.y/this.worldSize-h[1]*y,t/this.worldSize*this._centerAltitude-h[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],g=t[2],y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((o-h)/g,1)),this._camera.position=n.a6.vec3.scaleAndAdd([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,o=this._camera.forward(),{pitch:h,bearing:g}=this._camera.getPitchBearing(),y=n.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.bC(this._maxPitch)),I=Math.max((t[2]-y)/Math.cos(h),b),A=this._zoomFromMercatorZ(I);n.a6.vec3.scaleAndAdd(t,t,o,I),this._pitch=n.ap(h,n.bC(this.minPitch),n.bC(this.maxPitch)),this.angle=n.bB(g,-Math.PI,Math.PI),this._setZoom(n.ap(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.a5(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,h=n.bV,g=0,y=1/0;for(;h-o>1e-6&&h>o;){let b=o+.5*(h-o),I=this.tileSize*Math.pow(2,b),A=this.getCameraToCenterDistance(this.projection,b,I),O=this.scaleZoom(A/(t*this.tileSize)),P=Math.abs(b-O);P<y&&(y=P,g=b),b<O?o=b:h=b}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){let h=Math.min(t.x,o.x),g=Math.max(t.x,o.x),y=Math.min(t.y,o.y),b=Math.max(t.y,o.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let I=[new n.P(h,y),new n.P(g,b),new n.P(h,b),new n.P(g,y)],A=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(let P of I){let k=this.pointRayIntersection(P);if(k.t<0)return!0;let z=this.rayIntersectionCoordinate(k);if(z.x<A||z.y<0||z.x>O||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,o){let h=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,t)),g=this._zoomFromMercatorZ(h)+o;return h-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){let t=function([o,h,g],y){let b=[o,h,g,1];n.a6.vec4.transformMat4(b,b,y);let I=b[3]=Math.max(b[3],1e-6);return b[0]/=I,b[1]/=I,b[2]/=I,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,h=this.worldSize){let g=n.bY(t,o,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,h,g),b=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(b=Dl(1,b,Al(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.a6.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}let _s=(d,t)=>{if(t>0&&d.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let o=d.transform,h=Math.max(Math.abs(o._zoom-(d.minCutoffZoom-1)),1),g=o.isLODDisabled(!1)?n.a7(60,45,o.pitch):n.a7(30,15,o.pitch),y=o._farZ-o._nearZ,b=t*o.height,I=((1-(A=g))*o.cameraToCenterDistance+A*(o._farZ+b))*h;var A;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(I-o._nearZ)/y,(I-b-o._nearZ)/y]}}},Ci={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Uf{constructor(t,o){this.aabb=t,this.lastCascade=o}}class ct{add(t,o){let h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],o.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],o.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],o.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],o.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],o.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],o.max[2])):this.receivers[t.key]=new Uf(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,h){let g=n.ca.fromPoints(t.points),y=0;for(let b in this.receivers){let I=this.receivers[b];if(!I||!g.intersectsAabb(I.aabb))continue;I.aabb.min=g.closestPoint(I.aabb.min),I.aabb.max=g.closestPoint(I.aabb.max);let A=I.aabb.getCorners();for(let O=0;O<h.length;O++){let P=!0;for(let k of A){let z=[k[0]*o,k[1]*o,k[2]];if(n.a6.vec3.transformMat4(z,z,h[O].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){P=!1;break}}if(I.lastCascade=O,y=Math.max(y,O),P)break}}return y+1}}class Bg{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ct,this._depthMode=new Rt(t.context.gl.LEQUAL,Rt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Ci,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Ci,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Ci,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){let h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;let g=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||g<=0||(this._shadowLayerCount=h.style.order.reduce((W,q)=>{let X=h.style._mergedLayers[q];return W+(X.hasShadowPass()&&!X.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let y=h.context,b=Ci.shadowMapResolution,I=Ci.shadowMapResolution;if(this._cascades.length===0||Ci.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let W=0;W<Ci.cascadeCount;++W){let q=h._shadowMapDebug,X=y.gl,Z=y.createFramebuffer(b,I,q,"texture"),Q=new n.T(y,{width:b,height:I,data:null},X.DEPTH_COMPONENT16);if(Z.depthAttachment.set(Q.texture),q){let ie=new n.T(y,{width:b,height:I,data:null},X.RGBA8);Z.colorAttachment.set(ie.texture)}this._cascades.push({framebuffer:Z,texture:Q,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bO,scale:0})}}this.shadowDirection=wd(o);let A=0;if(t.elevation){let W=t.elevation,q=[1e4,-1e4];W.visibleDemTiles.filter(X=>X.dem).forEach(X=>{let Z=X.dem.tree;q[0]=Math.min(q[0],Z.minimums[0]),q[1]=Math.max(q[1],Z.maximums[0])}),q[0]!==1e4&&(A=(q[1]-q[0])*W.exaggeration())}let O=1.5*t.cameraToCenterDistance,P=3*O,k=new Float64Array(16);for(let W=0;W<this._cascades.length;++W){let q=this._cascades[W],X=t.height/50,Z=1;Ci.cascadeCount===1?Z=P:W===0?Z=O:(X=O,Z=P);let[Q,ie]=Ed(t,this.shadowDirection,X,Z,Ci.shadowMapResolution,A);q.scale=t.scale,q.matrix=Q,q.boundingSphereRadius=ie,n.a6.mat4.invert(k,q.matrix),q.frustum=n.bO.fromInvProjectionMatrix(k,1,0,!0),q.far=Z}let z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ci.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ci.shadowMapResolution,this._uniformValues.u_shadowmap_0=ar.ShadowMap0,this._uniformValues.u_shadowmap_1=ar.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let j=h.transform.elevation;for(let W of this._groundShadowTiles){let q={min:0,max:0};if(j){let X=j.getMinMaxForTile(W);X&&(q=X)}this.addShadowReceiver(W.toUnwrapped(),q.min,q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;let h=this.painter,g=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),g.viewport.set([0,0,Ci.shadowMapResolution,Ci.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){h.currentShadowCascade=y,g.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),g.clear({color:n.bA.white,depth:1});for(let b of t.order){let I=t._mergedLayers[b];if(!I.hasShadowPass()||I.isHidden(h.transform.zoom))continue;let A=t.getLayerSourceCache(I),O=A?o[A.id]:void 0;(I.type==="model"||O&&O.length)&&h.renderLayer(h,A,I,O)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let t=this.painter,o=t.style,h=t.context,g=o.directionalLight,y=o.ambientLight;if(!g||!y)return;let b=[],I=_s(t,t.longestCutoffRange);I.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&b.push("NORMAL_OFFSET");let A=Cd(o,g,y),O=new Rt(h.gl.LEQUAL,Rt.ReadOnly,t.depthRangeFor3D);for(let P of this._groundShadowTiles){let k=P.toUnwrapped(),z=t.isTileAffectedByFog(P),j=t.getOrCreateProgram("groundShadow",{defines:b,overrideFog:z});this.setupShadows(k,j),t.uploadCommonUniforms(h,j,k,null,I);let W={u_matrix:t.transform.calculateProjMatrix(k),u_ground_shadow_factor:A};j.draw(t,h.gl.TRIANGLES,O,Yt.disabled,fn.multiply,jt.disabled,W,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?fn.unblended:fn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let o=this.painter.transform,h=o.calculatePosMatrix(t,o.worldSize);return n.a6.mat4.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return n.a6.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,o,h,g=0){if(!this.enabled)return;let y=this.painter.transform,b=this.painter.context,I=b.gl,A=this._uniformValues,O=new Float64Array(16),P=y.calculatePosMatrix(t,y.worldSize);for(let k=0;k<this._cascades.length;k++)n.a6.mat4.multiply(O,this._cascades[k].matrix,P),A[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),b.activeTexture.set(I.TEXTURE0+ar.ShadowMap0+k),this._cascades[k].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){let k=n.c9(t.canonical),z=2/y.tileSize*n.ab/Ci.shadowMapResolution,j=z*this._cascades[0].boundingSphereRadius,W=z*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(h==="vector-tile"?1:3)/Math.pow(2,g-t.canonical.z-(1-y.zoom+Math.floor(y.zoom)));A.u_shadow_normal_offset=[k,j*q,W*q],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(b,A)}setupShadowsFromMatrix(t,o,h=!1){if(!this.enabled)return;let g=this.painter.context,y=g.gl,b=this._uniformValues,I=new Float64Array(16);for(let A=0;A<Ci.cascadeCount;A++)n.a6.mat4.multiply(I,this._cascades[A].matrix,t),b[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),g.activeTexture.set(y.TEXTURE0+ar.ShadowMap0+A),this._cascades[A].texture.bind(y.NEAREST,y.CLAMP_TO_EDGE);if(this.useNormalOffset=h,h){let A=Ci.normalOffset;b.u_shadow_normal_offset=[1,A,A],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(g,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,h,g){if(g[2]>=0)return{};let y=function(A,O,P){let k=P/(1<<A.canonical.z);return new n.ca([A.canonical.x*k+A.wrap*P,A.canonical.y*k+A.wrap*P,0],[(A.canonical.x+1)*k+A.wrap*P,(A.canonical.y+1)*k+A.wrap*P,O])}(t,o,h).getCorners(),b=o/-g[2];g[0]<0?(n.a6.vec3.add(y[0],y[0],[g[0]*b,0,0]),n.a6.vec3.add(y[3],y[3],[g[0]*b,0,0])):g[0]>0&&(n.a6.vec3.add(y[1],y[1],[g[0]*b,0,0]),n.a6.vec3.add(y[2],y[2],[g[0]*b,0,0])),g[1]<0?(n.a6.vec3.add(y[0],y[0],[0,g[1]*b,0]),n.a6.vec3.add(y[1],y[1],[0,g[1]*b,0])):g[1]>0&&(n.a6.vec3.add(y[2],y[2],[0,g[1]*b,0]),n.a6.vec3.add(y[3],y[3],[0,g[1]*b,0]));let I={};return I.vertices=y,I.planes=[Pl(y[1],y[0],y[4]),Pl(y[2],y[1],y[5]),Pl(y[3],y[2],y[6]),Pl(y[0],y[3],y[7])],I}addShadowReceiver(t,o,h){this._receivers.add(t,n.ca.fromTileIdAndHeight(t,o,h))}getMaxCascadeForTile(t){let o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function Pl(d,t,o){let h=n.a6.vec3.sub([],o,t),g=n.a6.vec3.sub([],d,t),y=n.a6.vec3.cross([],h,g),b=n.a6.vec3.length(y);return b===0?[0,0,1,0]:(n.a6.vec3.scale(y,y,1/b),[y[0],y[1],y[2],-n.a6.vec3.dot(y,t)])}function wd(d){let t=d.properties.get("direction"),o=n.c8(t.x,t.y,t.z);o[2]=n.ap(o[2],0,75);let h=n.cb([o[0],o[1],o[2]]);return n.a6.vec3.fromValues(h.x,h.y,h.z)}function Cd(d,t,o){let h=t.properties.get("color"),g=t.properties.get("intensity"),y=t.properties.get("direction"),b=[y.x,y.y,y.z],I=o.properties.get("color"),A=o.properties.get("intensity"),O=Math.max(n.a6.vec3.dot([0,0,1],b),0),P=[0,0,0];n.a6.vec3.scale(P,I.toRenderColor(d.getLut(t.scope)).toArray01Linear().slice(0,3),A);let k=[0,0,0];return n.a6.vec3.scale(k,h.toRenderColor(d.getLut(o.scope)).toArray01Linear().slice(0,3),O*g),n.cc([P[0]>0?P[0]/(P[0]+k[0]):0,P[1]>0?P[1]/(P[1]+k[1]):0,P[2]>0?P[2]/(P[2]+k[2]):0])}function Ed(d,t,o,h,g,y){let b=d.zoom,I=d.scale,A=d.worldSize,O=1/A,P=d.aspect,k=Math.sqrt(1+P*P)*Math.tan(.5*d.fovX),z=k*k,j=h-o,W=h+o,q,X;z>j/W?(q=h,X=h*k):(q=.5*W*(1+z),X=.5*Math.sqrt(j*j+2*(h*h+o*o)*z+W*W*z*z));let Z=d.projection.pixelsPerMeter(d.center.lat,A),Q=d._camera.getCameraToWorldMercator(),ie=[0,0,-q*O];n.a6.vec3.transformMat4(ie,ie,Q);let re=X*O,ae=d._edgeInsets;if(!(ae.left===0&&ae.top===0&&ae.right===0&&ae.bottom===0||ae.left===ae.right&&ae.top===ae.bottom)){let Xe=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?Z:1),Ke=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,o,h);Ke[8]=2*-d.centerOffset.x/d.width,Ke[9]=2*d.centerOffset.y/d.height;let We=new Float64Array(16);n.a6.mat4.mul(We,Ke,Xe);let ut=new Float64Array(16);n.a6.mat4.invert(ut,We);let bt=n.bO.fromInvProjectionMatrix(ut,A,b,!0);for(let It of bt.points){let _t=((de=It)[0]/=I,de[1]/=I,de[2]=n.bE(de[2],d._center.lat),de);re=Math.max(re,n.a6.vec3.len(n.a6.vec3.subtract([],ie,_t)))}}var de;re*=g/(g-1);let le=Math.acos(t[2]),he=Math.atan2(-t[0],-t[1]),_e=new Pa;_e.position=ie,_e.setPitchBearing(le,he);let we=_e.getWorldToCamera(A,Z),ve=re*A,ye=Math.min(d._mercatorZfromZoom(17)*A*-2,-2*ve),Fe=_e.getCameraToClipOrthographic(-ve,ve,-ve,ve,ye,(ve+y*Z)/t[2]),Ue=new Float64Array(16);n.a6.mat4.multiply(Ue,Fe,we);let Je=n.a6.vec3.fromValues(Math.floor(1e6*ie[0])/1e6*A,Math.floor(1e6*ie[1])/1e6*A,0),nt=.5*g,st=[0,0,0];n.a6.vec3.transformMat4(st,Je,Ue),n.a6.vec3.scale(st,st,nt);let Ie=[Math.floor(st[0]),Math.floor(st[1]),Math.floor(st[2])],Ze=[0,0,0];n.a6.vec3.sub(Ze,st,Ie),n.a6.vec3.scale(Ze,Ze,-1/nt);let Ne=new Float64Array(16);return n.a6.mat4.identity(Ne),n.a6.mat4.translate(Ne,Ne,Ze),n.a6.mat4.multiply(Ue,Ne,Ue),[Ue,ve]}class ys extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,o){return n.aG(this.requestManager.transformRequest(o,n.R.Model).url).then(h=>{if(!h)return;let g=n.aH(h),y=new n.aI(t,void 0,void 0,g);return y.computeBoundsAndApplyParent(),y}).catch(h=>{if(h&&h.status===404)return null;this.fire(new n.t(new Error(`Could not load model ${t} from ${o}: ${h.message}`)))})}load(t,o){this.models[o]||(this.models[o]={});let h=Object.keys(t);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+h.length;let g=[];for(let y of h)g.push(this.loadModel(y,t[y]));Promise.allSettled(g).then(y=>{for(let b=0;b<y.length;b++){let{status:I,value:A}=y[b];I==="fulfilled"&&A&&(this.models[o][h[b]]={model:A,numReferences:1})}this.numModelsLoading[o]-=h.length,this.fire(new n.x("data",{dataType:"style"}))}).catch(y=>{this.fire(new n.t(new Error(`Could not load models: ${y.message}`)))})}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o){return!!this.getModel(t,o)}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}addModel(t,o,h){this.models[h]||(this.models[h]={}),this.hasModel(t,h)&&this.models[h][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(o)},h)}addModels(t,o){this.models[o]||(this.models[o]={});let h={};for(let g in t)this.models[o][g]={},h[g]=this.requestManager.normalizeModelURL(t[g]);this.load(h,o)}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={});let h={};for(let g of t)this.hasModel(g,o)?this.models[o][g].numReferences++:h[g]=this.requestManager.normalizeModelURL(g);this.load(h,o)}removeModel(t,o){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0)){let h=this.models[o][t].model;delete this.models[o][t],h.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(let h in this.models[o])this.models[o][h].model&&this.models[o][h].model.upload(t.context)}}let $f=new n.a0({data:new n.a1(n._.colorTheme.data)}),qr=(d,t)=>Te(d,t&&t.filter(o=>o.identifier!=="source.canvas")),Md=n.ar(Tn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Rl=n.ar(Tn,["setCenter","setZoom","setBearing","setPitch"]),Vg={version:8,layers:[],sources:{}},jg={duration:300,delay:0};class Wr extends n.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=n.l({},jg),this._buildingIndex=new Lf(this),this.crossTileSymbolIndex=new yd,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Vc,this.dispatcher=o.dispatcher?o.dispatcher:new n.ce(n.cf(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new wa,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new n.cg(t._requestManager,o.localFontFamily?n.ch.all:o.localIdeographFontFamily?n.ch.ideographs:n.ch.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new ys(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",n.ci());let h=this;this._rtlTextPluginCallback=Wr.registerForPluginStateChange(g=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,b)=>{if(n.cj(y),b&&b.every(I=>I))for(let I in h._sourceCaches){let A=h._sourceCaches[I],O=A.getSource().type;O!=="vector"&&O!=="geojson"||A.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;let y=this.getOwnSource(g.sourceId);if(y&&y.vectorLayerIds)for(let b in this._layers){let I=this._layers[b];I.source===y.id&&this._validateLayer(I)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.f(t))return t;let o=n.ck(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${n.cl(JSON.stringify(t))}`}_diffStyle(t,o,h){this.globalId=this._getGlobalId(t);let g=(y,b)=>{try{b(null,this.setState(y,h))}catch(I){b(I,!1)}};if(typeof t=="string"){let y=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(y,n.R.Style);n.n(b,(I,A)=>{I?this.fire(new n.t(I)):A&&g(A,o)})}else typeof t=="object"&&g(t,o)}loadURL(t,o={}){this.fire(new n.x("dataloading",{dataType:"style"}));let h=typeof o.validate=="boolean"?o.validate:!n.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);let g=this.importsCache.get(t);if(g)return this._load(g,h);let y=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.n(y,(b,I)=>{if(this._request=null,b)this.fire(new n.t(b));else if(I)return this.importsCache.set(t,I),this._load(I,h)})}loadJSON(t,o={}){this.fire(new n.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.q.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new n.x("dataloading",{dataType:"style"})),this._load(Vg,!1)}_loadImports(t,o,h){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let g=[];for(let y of t){let b=this._createFragmentStyle(y),I=new Promise(P=>{b.once("style.import.load",P),b.once("error",P)}).then(()=>this.mergeAll());if(g.push(I),this.resolvedImports.has(y.url)){b.loadEmpty();continue}let A=y.data||this.importsCache.get(y.url);A?(b.loadJSON(A,{validate:o}),this._isInternalStyle(A)&&(b.globalId=null)):y.url?b.loadURL(y.url,{validate:o}):b.loadEmpty();let O={style:b,id:y.id,config:y.config};if(h){let P=this.fragments.findIndex(({id:k})=>k===h);this.fragments=this.fragments.slice(0,P).concat(O).concat(this.fragments.slice(P))}else this.fragments.push(O)}return Promise.allSettled(g)}getImportGlobalIds(t=this,o=new Set){for(let h of t.fragments)h.style.globalId&&o.add(h.style.globalId),this.getImportGlobalIds(h.style,o);return[...o.values()]}_createFragmentStyle(t){let o=this.scope?n.av(t.id,this.scope):t.id,h,g=this._initialConfig&&this._initialConfig[o];(t.config||g)&&(h=n.l({},t.config,g));let y=new Wr(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){let h=t.schema;if(this._isInternalStyle(t)){let b=n.l({},Vg,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(b,o)}if(this.updateConfig(this._config,h),o&&qr(this,$r(t)))return;this._loaded=!0,this.stylesheet=n.cm(t);let g=()=>{for(let O in t.sources)this.addSource(O,t.sources[O],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);let b=Ff(this.stylesheet.layers);if(this._order=b.map(O=>O.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let O=this.stylesheet.lights[0];this.light=new Ae(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ae(this.stylesheet.light)),this._layers={};for(let O of b){let P=n.cq(O,this.scope,this._styleColorTheme.lut,this.options);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;let k=this.getOwnLayerSourceCache(P),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&P.canCastShadows()&&z&&(k.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.x("data",{dataType:"style"}));let A=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then(()=>{this._reloadImports(),this.fire(new n.x(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.x(A?"style.load":"style.import.load")))},y=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=y,y){let b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{g()}).catch(I=>{n.w(`Couldn't load color theme from the stylesheet: ${I}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,o,h,g,y,b,I,A,O={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(P=>{if(P.stylesheet){if(P.light!=null&&(t=P.light),P.stylesheet.lights)for(let k of P.stylesheet.lights)k.type==="ambient"&&P.ambientLight!=null&&(o=P.ambientLight),k.type==="directional"&&P.directionalLight!=null&&(h=P.directionalLight);g=this._prioritizeTerrain(g,P.terrain,P.stylesheet.terrain),P.stylesheet.fog&&P.fog!=null&&(y=P.fog),P.stylesheet.camera!=null&&(A=P.stylesheet.camera),P.stylesheet.projection!=null&&(b=P.stylesheet.projection),P.stylesheet.transition!=null&&(I=P.stylesheet.transition),O[P.scope]=P._styleColorTheme}}),this.light=t,this.ambientLight=o,this.directionalLight=h,this.fog=y,this._styleColorThemeForScope=O,g===null?delete this.terrain:this.terrain=g,this.camera=A||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=n.l({},jg,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){let o=h=>{for(let g of h.fragments)o(g.style);t(h)};o(this)}_prioritizeTerrain(t,o,h){let g=t&&t.drapeRenderMode===0;return h===null?o&&o.drapeRenderMode===0?o:g?t:null:o!=null&&(!t||g||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){let t={},o={},h={};this.forEachFragmentStyle(g=>{for(let y in g._sourceCaches){let b=n.av(y,g.scope);t[b]=g._sourceCaches[y]}for(let y in g._otherSourceCaches){let b=n.av(y,g.scope);o[b]=g._otherSourceCaches[y]}for(let y in g._symbolSourceCaches){let b=n.av(y,g.scope);h[b]=g._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=h}mergeLayers(){let t={},o=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(y=>{for(let I of y._order){let A=y._layers[I];if(A.type==="slot"){let O=n.cn(I);if(t[O])continue;t[O]=[]}A.slot&&t[A.slot]?t[A.slot].push(A):o.push(A)}let{featuresets:b}=y.stylesheet||{};if(b)for(let I in b){let{selectors:A}=b[I];for(let O of A){let P=y._layers[O.layer],k=this._mergedLayerSelectors.get(P.fqid)||[],z;if(O.properties)for(let j in O.properties){let W=n.M(O.properties[j]);W.result==="success"&&(z=z||{},z[j]=W.value)}k.push({featuresetId:I,featureNamespace:O.featureNamespace,properties:z}),this._mergedLayerSelectors.set(P.fqid,k)}}}),this._mergedOrder=[];let g=(y=[])=>{for(let b of y)if(b.type==="slot"){let I=n.cn(b.id);t[I]&&g(t[I]),this._mergedSlots.push(I)}else{let I=n.av(b.id,b.scope);this._mergedOrder.push(I),h[I]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};g(o),this._mergedOrder.sort((y,b)=>{let I=h[y],A=h[b];return I.hasInitialOcclusionOpacityProperties?A.is3D()?1:0:I.is3D()&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=n.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(o,h,g){let y=n.l({},h);for(let I of Object.keys(n._.colorTheme))y[I]===void 0&&(y[I]=n._.colorTheme[I].default);let b=new n.$($f,o,new Map(g));return b.setTransitionOrValue(y,g),b.untransitioned().possiblyEvaluate(new n.a3(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,g)=>{let y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let b=t;b.startsWith(y)||(b=y+b);let I="mapbox-reserved-lut",A=new Image;A.src=b,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void h();this._styleColorTheme.lutLoading=!1;let{width:O,height:P,data:k}=n.q.getImageData(A);if(P>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(O!==P*P)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new n.r({width:O,height:P},k),pixelRatio:1,sdf:!1,version:0});let z=this.imageManager.getImage(I,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:t},h()):g(new Error("Missing LUT image."))}})}getLut(t){let o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(o,h,g){let y,b,I,A=n.q.devicePixelRatio>1?"@2x":"",O=n.n(h.transformRequest(h.normalizeSpriteURL(o,A,".json"),n.R.SpriteJSON),(z,j)=>{O=null,I||(I=z,y=j,k())}),P=n.o(h.transformRequest(h.normalizeSpriteURL(o,A,".png"),n.R.SpriteImage),(z,j)=>{P=null,I||(I=z,b=j,k())});function k(){if(I)g(I);else if(y&&b){let z=n.q.getImageData(b),j={};for(let W in y){let{width:q,height:X,x:Z,y:Q,sdf:ie,pixelRatio:re,stretchX:ae,stretchY:de,content:le}=y[W],he=new n.r({width:q,height:X});n.r.copy(z,he,{x:Z,y:Q},{x:0,y:0},{width:q,height:X},null),j[W]={data:he,pixelRatio:re,sdf:ie,stretchX:ae,stretchY:de,content:le}}g(null,j)}}return{cancel(){O&&(O.cancel(),O=null),P&&(P.cancel(),P=null)}}}(t,this.map._requestManager,(o,h)=>{if(this._spriteRequest=null,o)this.fire(new n.t(o));else if(h)for(let g in h)this.imageManager.addImage(g,this.scope,h[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.x("data",{dataType:"style"}))})}_validateLayer(t){let o=this.getOwnSource(t.source);if(!o)return;let h=t.sourceLayer;h&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(h)===-1)&&this.fire(new n.t(new Error(`Source layer "${h}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,o)=>{let h=this.fragments[o];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){let t={};for(let o in this._sourceCaches){let h=this._sourceCaches[o].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){let o=[];for(let h of t){let g=this._layers[h];g&&g.type!=="custom"&&o.push(g.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let o=this.getOwnLayer(t);if(o)return o;this.fire(new n.t(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){let o=this.getOwnSource(t);if(o)return o;this.fire(new n.t(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){let h=this.map.painter;if(h)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){let y=t.getProgramIds();if(y)for(let b of y){let I=t.getDefaultProgramParams(b,o.zoom,this._styleColorTheme.lut);I&&(h.style=this,this.fog&&(h._fogVisible=!0,I.overrideFog=!0,h.getOrCreateProgram(b,I)),h._fogVisible=!1,I.overrideFog=!1,h.getOrCreateProgram(b,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,h.getOrCreateProgram(b,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));let h=this._changes.isDirty(),g=!1;if(this._changes.isDirty()){let b=this._changes.getLayerUpdatesByScope();for(let I in b){let{updatedIds:A,removedIds:O}=b[I];(A||O)&&(this._updateWorkerLayers(I,A,O),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}let y={};for(let b in this._mergedSourceCaches){let I=this._mergedSourceCaches[b];y[b]=I.used,I.used=!1,I.tileCoverLift=0}for(let b of this._mergedOrder){let I=this._mergedLayers[b];if(I.recalculate(t,this._availableImages),!I.isHidden(t.zoom)){let A=this.getLayerSourceCache(I);A&&(A.used=!0,A.tileCoverLift=Math.max(A.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,t)}):this.precompilePrograms(I,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(let b in y){let I=this._mergedSourceCaches[b];y[b]!==I.used&&I.getSource().fire(new n.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new n.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=this._changes.getUpdatedImages();if(t.length){for(let o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,o,h){let g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:o?g._serializeLayers(o):[],scope:t,removedIds:h||[],options:g.options})}setState(t,o){if(this._checkLoaded(),qr(this,$r(t)))return!1;(t=n.cm(t)).layers=Ff(t.layers);let h=function(b,I){if(!b)return[{command:Tn.setStyle,args:[I]}];let A=[];try{if(!n.bi(b.version,I.version))return[{command:Tn.setStyle,args:[I]}];if(n.bi(b.center,I.center)||A.push({command:Tn.setCenter,args:[I.center]}),n.bi(b.zoom,I.zoom)||A.push({command:Tn.setZoom,args:[I.zoom]}),n.bi(b.bearing,I.bearing)||A.push({command:Tn.setBearing,args:[I.bearing]}),n.bi(b.pitch,I.pitch)||A.push({command:Tn.setPitch,args:[I.pitch]}),n.bi(b.sprite,I.sprite)||A.push({command:Tn.setSprite,args:[I.sprite]}),n.bi(b.glyphs,I.glyphs)||A.push({command:Tn.setGlyphs,args:[I.glyphs]}),n.bi(b.imports,I.imports)||function(j=[],W=[],q){W=W||[];let X=(j=j||[]).map(Ta),Z=W.map(Ta),Q=j.reduce(xl,{}),ie=W.reduce(xl,{}),re=X.slice(),ae,de,le,he;for(ae=0,de=0;ae<X.length;ae++)le=X[ae],ie.hasOwnProperty(le)?de++:(q.push({command:Tn.removeImport,args:[le]}),re.splice(re.indexOf(le,de),1));for(ae=0,de=0;ae<Z.length;ae++)le=Z[Z.length-1-ae],re[re.length-1-ae]!==le&&(Q.hasOwnProperty(le)?(q.push({command:Tn.removeImport,args:[le]}),re.splice(re.lastIndexOf(le,re.length-de),1)):de++,he=re[re.length-ae],q.push({command:Tn.addImport,args:[ie[le],he]}),re.splice(re.length-ae,0,le));for(let _e of W){let we=Q[_e.id];we&&!n.bi(we,_e)&&q.push({command:Tn.updateImport,args:[_e.id,_e]})}}(b.imports,I.imports,A),n.bi(b.transition,I.transition)||A.push({command:Tn.setTransition,args:[I.transition]}),n.bi(b.light,I.light)||A.push({command:Tn.setLight,args:[I.light]}),n.bi(b.fog,I.fog)||A.push({command:Tn.setFog,args:[I.fog]}),n.bi(b.projection,I.projection)||A.push({command:Tn.setProjection,args:[I.projection]}),n.bi(b.lights,I.lights)||A.push({command:Tn.setLights,args:[I.lights]}),n.bi(b.camera,I.camera)||A.push({command:Tn.setCamera,args:[I.camera]}),!n.bi(b["color-theme"],I["color-theme"]))return[{command:Tn.setStyle,args:[I]}];let O={},P=[];(function(j,W,q,X){let Z;for(Z in W=W||{},j=j||{})j.hasOwnProperty(Z)&&(W.hasOwnProperty(Z)||Un(Z,q,X));for(Z in W){if(!W.hasOwnProperty(Z))continue;let Q=W[Z];j.hasOwnProperty(Z)?n.bi(j[Z],Q)||(j[Z].type==="geojson"&&Q.type==="geojson"&&kt(j,W,Z)?q.push({command:Tn.setGeoJSONSourceData,args:[Z,Q.data]}):ux(Z,W,q,X)):kf(Z,W,q)}})(b.sources,I.sources,P,O);let k=[];b.layers&&b.layers.forEach(j=>{j.source&&O[j.source]?A.push({command:Tn.removeLayer,args:[j.id]}):k.push(j)});let z=b.terrain;z&&O[z.source]&&(A.push({command:Tn.setTerrain,args:[void 0]}),z=void 0),A=A.concat(P),n.bi(z,I.terrain)||A.push({command:Tn.setTerrain,args:[I.terrain]}),function(j,W,q){W=W||[];let X=(j=j||[]).map(Ta),Z=W.map(Ta),Q=j.reduce(xl,{}),ie=W.reduce(xl,{}),re=X.slice(),ae=Object.create(null),de,le,he,_e,we,ve,ye;for(de=0,le=0;de<X.length;de++)he=X[de],ie.hasOwnProperty(he)?le++:(q.push({command:Tn.removeLayer,args:[he]}),re.splice(re.indexOf(he,le),1));for(de=0,le=0;de<Z.length;de++)he=Z[Z.length-1-de],re[re.length-1-de]!==he&&(Q.hasOwnProperty(he)?(q.push({command:Tn.removeLayer,args:[he]}),re.splice(re.lastIndexOf(he,re.length-le),1)):le++,ve=re[re.length-de],q.push({command:Tn.addLayer,args:[ie[he],ve]}),re.splice(re.length-de,0,he),ae[he]=!0);for(de=0;de<Z.length;de++)if(he=Z[de],_e=Q[he],we=ie[he],!ae[he]&&!n.bi(_e,we))if(n.bi(_e.source,we.source)&&n.bi(_e["source-layer"],we["source-layer"])&&n.bi(_e.type,we.type)){for(ye in Xc(_e.layout,we.layout,q,he,null,Tn.setLayoutProperty),Xc(_e.paint,we.paint,q,he,null,Tn.setPaintProperty),n.bi(_e.slot,we.slot)||q.push({command:Tn.setSlot,args:[he,we.slot]}),n.bi(_e.filter,we.filter)||q.push({command:Tn.setFilter,args:[he,we.filter]}),n.bi(_e.minzoom,we.minzoom)&&n.bi(_e.maxzoom,we.maxzoom)||q.push({command:Tn.setLayerZoomRange,args:[he,we.minzoom,we.maxzoom]}),_e)_e.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?Xc(_e[ye],we[ye],q,he,ye.slice(6),Tn.setPaintProperty):n.bi(_e[ye],we[ye])||q.push({command:Tn.setLayerProperty,args:[he,ye,we[ye]]}));for(ye in we)we.hasOwnProperty(ye)&&!_e.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?Xc(_e[ye],we[ye],q,he,ye.slice(6),Tn.setPaintProperty):n.bi(_e[ye],we[ye])||q.push({command:Tn.setLayerProperty,args:[he,ye,we[ye]]}))}else q.push({command:Tn.removeLayer,args:[he]}),ve=re[re.lastIndexOf(he)+1],q.push({command:Tn.addLayer,args:[we,ve]})}(k,I.layers,A)}catch(O){console.warn("Unable to compute style diff:",O),A=[{command:Tn.setStyle,args:[I]}]}return A}(this.serialize(),t).filter(b=>!(b.command in Rl));if(h.length===0)return!1;let g=h.filter(b=>!(b.command in Md));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);let y=[];return h.forEach(b=>{y.push(this[b.command].apply(this,b.args))}),o&&Promise.all(y).then(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,o){return this.getImage(t)?this.fire(new n.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,o),this._afterImageUpdated(t),this)}updateImage(t,o){this.imageManager.updateImage(t,this.scope,o)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new n.t(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,o,h={}){return this._checkLoaded(),this._validate(Ce,`models.${t}`,o,null,h)||(this.modelManager.addModel(t,o,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new n.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Sa,`sources.${t}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);let g=ud(t,o,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));let y=b=>{let I=(b?"symbol:":"other:")+g.id,A=n.av(I,this.scope),O=this._sourceCaches[I]=new Ar(A,g,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=O,O.onAdd(this.map)};y(!1),o.type!=="vector"&&o.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(let g in this._layers)if(this._layers[g].source===t)return this.fire(new n.t(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.t(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));let h=this.getOwnSourceCaches(t);for(let g of h){let y=n.cn(g.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(g.id),g.fire(new n.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){let o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){let t=[];for(let o in this._otherSourceCaches){let h=this.getOwnSourceCache(o);h&&t.push(h.getSource())}return t}areTilesLoaded(){let t=this._mergedSourceCaches;for(let o in t){let h=t[o]._tiles;for(let g in h){let y=h[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let o=this._getTransitionParameters();for(let g of t){if(this._validate(Hc,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){let y=this.ambientLight;y.set(g),y.updateTransitions(o)}else this.ambientLight=new Vt(g,zn||(zn=new n.a0({color:new n.a1(n._.properties_light_ambient.color),intensity:new n.a1(n._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let y=this.directionalLight;y.set(g),y.updateTransitions(o)}else this.directionalLight=new Vt(g,Sn||(Sn=new n.a0({direction:new n.ad(n._.properties_light_directional.direction),color:new n.a1(n._.properties_light_directional.color),intensity:new n.a1(n._.properties_light_directional.intensity),"cast-shadows":new n.a1(n._.properties_light_directional["cast-shadows"]),"shadow-intensity":new n.a1(n._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let h=new n.a3(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;let h=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),g=t.properties.get("color").toRenderColor(null).toArray01(),y=t.properties.get("intensity"),b=t.properties.get("direction"),I=1-n.c8(b.x,b.y,b.z)[2]/90,A=h(g)*y*I,O=o.properties.get("color").toRenderColor(null).toArray01(),P=o.properties.get("intensity"),k=h(O)*P;return Number(((A+k)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(n.aK(t)){let o=n.co(t),h=this.fragments.find(({id:y})=>y===o);if(!h)throw new Error(`Style import '${t}' not found`);let g=n.cn(t);return h.style.getFragmentStyle(g)}{let o=this.fragments.find(({id:h})=>h===t);if(!o)throw new Error(`Style import '${t}' not found`);return o.style}}getFeaturesetDescriptors(t){let o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];let h=[];for(let g in o.stylesheet.featuresets)h.push({featuresetId:g,importId:o.scope?o.scope:void 0});return h}getFeaturesetLayers(t,o){let h=this.getFragmentStyle(o),g=h.stylesheet.featuresets;if(!g||!g[t])return this.fire(new n.t(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];let y=[];for(let b of g[t].selectors){let I=h.getOwnLayer(b.layer);I&&y.push(I)}return y}getConfigProperty(t,o){let h=this.getFragmentStyle(t);if(!h)return null;let g=n.av(o,h.scope),y=h.options.get(g),b=y?y.value||y.default:null;return b?b.serialize():null}setConfigProperty(t,o,h){let g=this.getFragmentStyle(t);if(!g)return;let y=g.stylesheet.schema;if(!y||!y[o])return;let b=n.M(h);if(b.result!=="success")return void qr(this,b.value);let I=b.value.expression,A=n.av(o,g.scope),O=g.options.get(A);if(!O)return;let P,{minValue:k,maxValue:z,stepValue:j,type:W,values:q}=y[o],X=n.M(y[o].default);X.result==="success"&&(P=X.value.expression),P?(this.options.set(A,ei(Mt({},O),{value:I,default:P,minValue:k,maxValue:z,stepValue:j,type:W,values:q})),this.updateConfigDependencies(o)):this.fire(new n.t(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){let o=this.getFragmentStyle(t);if(!o)return null;let h=o.stylesheet.schema;if(!h)return null;let g={};for(let y in h){let b=n.av(y,o.scope),I=o.options.get(b),A=I?I.value||I.default:null;g[y]=A?A.serialize():null}return g}setConfig(t,o){let h=this.getFragmentStyle(t);h&&(h.updateConfig(o,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){let o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){let h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=o,h.updateConfig(h._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(let h in o){let g,y,b=n.M(o[h].default);if(b.result==="success"&&(g=b.value.expression),t&&t[h]!==void 0){let z=n.M(t[h]);z.result==="success"&&(y=z.value.expression)}let{minValue:I,maxValue:A,stepValue:O,type:P,values:k}=o[h];if(g){let z=n.av(h,this.scope);this.options.set(z,{default:g,value:y,minValue:I,maxValue:A,stepValue:O,type:P,values:k})}else this.fire(new n.t(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new n.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(let o of this._configDependentLayers){let h=this.getLayer(o);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(o=>{if(o._styleColorTheme.colorTheme){let h=o._evaluateColorThemeData(o._styleColorTheme.colorTheme);(!o._styleColorTheme.lut&&h!==""||o._styleColorTheme.lut&&h!==o._styleColorTheme.lut.data)&&o.setColorTheme(o._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(t,o,h={}){this._checkLoaded();let g=t.id;if(this._layers[g])return void this.fire(new n.t(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(t.type==="custom"){if(qr(this,n.cp(t)))return;y=n.cq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=n.cm(t),t=n.l(t,{source:g})),this._validate(Ve,`layers.${g}`,t,{arrayIndex:-1},h))return;y=n.cq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let b=this._order.length;if(o){let P=this._order.indexOf(o);if(P===-1)return void this.fire(new n.t(new Error(`Layer with id "${o}" does not exist on this map.`)));y.slot===this._layers[o].slot?b=P:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,g),this._layerOrderChanged=!0,this._layers[g]=y;let I=this.getOwnLayerSourceCache(y),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&y.canCastShadows()&&A&&(I.castsShadows=!0);let O=this._changes.getRemovedLayer(y);if(O&&y.source&&I&&y.type!=="custom"){this._changes.discardLayerRemoval(y);let P=n.av(y.source,y.scope);O.type!==y.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),I.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();let h=this._checkLayer(t);if(!h||t===o)return;let g=this._order.indexOf(t);this._order.splice(g,1);let y=this._order.length;if(o){let b=this._order.indexOf(o);if(b===-1)return void this.fire(new n.t(new Error(`Layer with id "${o}" does not exist on this map.`)));h.slot===this._layers[o].slot?y=b:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);let h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);let g=this.getOwnLayerSourceCache(o);if(g&&g.castsShadows){let y=!1;for(let b in this._layers)if(this._layers[b].source===o.source&&this._layers[b].canCastShadows()){y=!0;break}g.castsShadows=y}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,h){this._checkLoaded();let g=this._checkLayer(t);g&&(g.minzoom===o&&g.maxzoom===h||(o!=null&&(g.minzoom=o),h!=null&&(g.maxzoom=h),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();let h=this._checkLayer(t);h&&h.slot!==o&&(h.slot=o,this._updateLayer(h))}setFilter(t,o,h={}){this._checkLoaded();let g=this._checkLayer(t);if(g&&!n.bi(g.filter,o))return o==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Y,`layers.${g.id}.filter`,o,{layerType:g.type},h)||(g.filter=n.cm(o),this._updateLayer(g)))}getFilter(t){let o=this._checkLayer(t);if(o)return n.cm(o.filter)}setLayoutProperty(t,o,h,g={}){this._checkLoaded();let y=this._checkLayer(t);if(y&&!n.bi(y.getLayoutProperty(o),h)){if(h!=null&&(!g||g.validate!==!1)&&qr(y,ce.call($r,{key:`layers.${t}.layout.${o}`,layerType:y.type,objectKey:o,value:h,styleSpec:n._,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(o,h),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,o){let h=this._checkLayer(t);if(h)return h.getLayoutProperty(o)}setPaintProperty(t,o,h,g={}){this._checkLoaded();let y=this._checkLayer(t);if(!y||n.bi(y.getPaintProperty(o),h)||h!=null&&(!g||g.validate!==!1)&&qr(y,K.call($r,{key:`layers.${t}.paint.${o}`,layerType:y.type,objectKey:o,value:h,styleSpec:n._})))return;let b=y.setPaintProperty(o,h);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),b&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,o){let h=this._checkLayer(t);if(h)return h.getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();let h=t.featureset;if(h){if("featuresetId"in h){let O=this.getFragmentStyle(h.importId),P=O.getFeaturesetLayers(h.featuresetId);for(let{source:k,sourceLayer:z}of P)O.setFeatureState({id:t.id,source:k,sourceLayer:z},o)}else if("layerId"in h){let O=this.getLayer(h.layerId);this.setFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},o)}return}let g=t.source,y=t.sourceLayer,b=this._checkSource(g);if(!b)return;let I=b.type;if(I==="geojson"&&y)return void this.fire(new n.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!y)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided.")));let A=this.getOwnSourceCaches(g);for(let O of A)O.setFeatureState(y,t.id,o)}removeFeatureState(t,o){this._checkLoaded();let h=t.featureset;if(h){if("featuresetId"in h){let O=this.getFragmentStyle(h.importId),P=O.getFeaturesetLayers(h.featuresetId);for(let{source:k,sourceLayer:z}of P)O.removeFeatureState({id:t.id,source:k,sourceLayer:z},o)}else if("layerId"in h){let O=this.getLayer(h.layerId);this.removeFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},o)}return}let g=t.source,y=this._checkSource(g);if(!y)return;let b=y.type,I=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!I)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.t(new Error("A feature id is required to remove its specific state property.")));let A=this.getOwnSourceCaches(g);for(let O of A)O.removeFeatureState(I,t.id,o)}getFeatureState(t){this._checkLoaded();let o=t.featureset;if(o){let b;if("featuresetId"in o){let I=this.getFragmentStyle(o.importId),A=I.getFeaturesetLayers(o.featuresetId);for(let{source:O,sourceLayer:P}of A){let k=I.getFeatureState({id:t.id,source:O,sourceLayer:P});if(k&&!b)b=k;else if(!n.bi(b,k))return void this.fire(new n.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t){let I=this.getLayer(o.layerId);b=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return b}let h=t.source,g=t.sourceLayer,y=this._checkSource(h);if(y){if(y.type!=="vector"||g)return t.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,t.id);this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=n.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(let o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);let o=this.getLayerSourceCache(t),h=n.av(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[h]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let o=I=>this._mergedLayers[I].is3D(),h=this.order,g={},y=[];for(let I=h.length-1;I>=0;I--){let A=h[I];if(o(A)){g[A]=I;for(let O of t){let P=O[A];if(P)for(let k of P)y.push(k)}}}y.sort((I,A)=>A.intersectionZ-I.intersectionZ);let b=[];for(let I=h.length-1;I>=0;I--){let A=h[I];if(o(A))for(let O=y.length-1;O>=0;O--){let P=y[O].feature;if(P.layer&&g[P.layer.id]<I)break;b.push(P),y.pop()}else for(let O of t){let P=O[A];if(P)for(let k of P)b.push(k.feature)}}return b}queryRenderedFeatures(t,o,h){o&&!Array.isArray(o)&&o.filter&&this._validate(Y,"queryRenderedFeatures.filter",o.filter,null,o);let g,y=!1,b=new Set;if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.t(new Error("parameters.layers must be an Array."))),[];g=[];for(let P of o.layers){let k=this._mergedLayers[P];if(!k)return this.fire(new n.t(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];k.is3D()&&(y=!0),b.add(k.source),g.push(P)}}else y=this.has3DLayers();let I=this._queryRenderedFeatures(t,h,{layerIds:g,filter:o.filter,has3DLayers:y,includedSources:b}),A=this._flattenAndSortRenderedFeatures(I),O=[];for(let P of A)n.co(P.layer.id)===this.scope&&O.push(P);return O}queryRenderedFeaturesForInteractions(t,o,h){let g=[];for(let{featureset:A,filter:O,radius:P}of o){let k=!1,z=[],j=new Set;if("featuresetId"in A){let q=this.getFeaturesetLayers(A.featuresetId,A.importId);if(q.length===0)continue;for(let X of q)X.is3D()&&(k=!0),j.add(X.source),z.push(X.fqid)}else if("layerId"in A){let q=this._mergedLayers[A.layerId];if(!q)return this.fire(new n.t(new Error(`The layer '${A.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];q.is3D()&&(k=!0),j.add(q.source),z.push(A.layerId)}let W=t;if(P)if(t instanceof n.P||typeof t[0]=="number"){let q=n.P.convert(t);W=[[q.x-P,q.y-P],[q.x+P,q.y+P]]}else{let q=n.P.convert(t[0]),X=n.P.convert(t[1]);W=[[q.x-P,q.y-P],[X.x+P,X.y+P]]}g=g.concat(this._queryRenderedFeatures(W,h,{layerIds:z,filter:O,has3DLayers:k,includedSources:j}))}let y=this._flattenAndSortRenderedFeatures(g),b=(A,O,P)=>{let k=A.clone();if(delete k.layer,k.featureset=O,P&&P.featureNamespace&&(k.namespace=P.featureNamespace),P&&P.properties){let z={},j=this.map.transform.zoom;for(let W of Object.keys(P.properties)){let q=P.properties[W].evaluate({zoom:j},A._vectorTileFeature,A.state,A.tile,this._availableImages);q!=null&&(z[W]=q)}k.properties=z}return k},I=[];for(let A of y){let O=A.layer.id,P=n.cn(O),k=n.co(O);for(let{featureset:z}of o){if("layerId"in z&&z.layerId!==O)continue;if("layerId"in z&&z.layerId===O){let W=b(A,z);I.push(W);continue}if("featuresetId"in z&&(z.importId!==k||!this.getFeaturesetLayers(z.featuresetId,z.importId).map(W=>W.id).includes(P)))continue;let j=this._mergedLayerSelectors.get(O)||[];for(let W of j){let q=b(A,z,W);I.push(q)}}}return I}_queryRenderedFeatures(t,o,h){let{layerIds:g,filter:y,has3DLayers:b,includedSources:I}=h,A=[],O=ln.createFromScreenPoints(t,o);for(let P in this._mergedSourceCaches){if(!this._mergedSourceCaches[P].getSource())continue;let k=this._mergedSourceCaches[P].getSource().id;g&&!I.has(k)||A.push(Af(this._mergedSourceCaches[P],this._mergedLayers,O,y,g||[],this._availableImages,o,b,!!this.map._showQueryGeometry))}return this.placement&&A.push(function(P,k,z,j,W,q,X,Z){let Q={},ie=X.queryRenderedSymbols(z),re=[];for(let ae of Object.keys(ie).map(Number))re.push(Z[ae]);re.sort(gl);for(let ae of re){let de=ae.featureIndex.lookupSymbolFeatures(ie[ae.bucketInstanceId],ae.bucketIndex,ae.sourceLayerIndex,j,W,q,P);for(let le in de){let he=Q[le]=Q[le]||[],_e=de[le];_e.sort((we,ve)=>{let ye=ae.featureSortOrder;if(ye){let Fe=ye.indexOf(we.featureIndex);return ye.indexOf(ve.featureIndex)-Fe}return ve.featureIndex-we.featureIndex});for(let we of _e)he.push(we)}}for(let ae in Q)Q[ae].forEach(de=>{let le=de.feature,he=P[ae],_e=k(he);if(!_e)return;let we=_e.getFeatureState(le.layer["source-layer"],le.id);le.state=we,n.aK(he.id)||(le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]))});return Q}(this._mergedLayers,this.getLayerSourceCache.bind(this),O.screenGeometry,y,g||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),A}querySourceFeatures(t,o){let h=o&&o.filter;h&&this._validate(Y,"querySourceFeatures.filter",h,null,o);let g=[],y=this.getOwnSourceCaches(t);for(let b of y)g=g.concat(Pf(b,o));return g}addSourceType(t,o,h){return Wr.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(Wr.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,h={}){this._checkLoaded();let g=this.light.getLight(),y=!1;for(let I in t)if(!n.bi(t[I],g[I])){y=!0;break}if(!y)return;let b=this._getTransitionParameters();this.light.setLight(t,o,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t,g=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){let I="terrain-dem-src";this.addSource(I,h.source),h=n.cm(h),h=n.l(h,{source:I})}let y=n.l({},h),b={};if(this.terrain&&g){y.source=this.terrain.get().source;let I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(b.style=I.serialize())}if(this._validate(ml,"terrain",y,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&o!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,o),this.fire(new n.x("data",{dataType:"style"}))}else{let y=this.terrain,b=y.get();for(let I of Object.keys(n._.terrain))!h.hasOwnProperty(I)&&n._.terrain[I].default&&(h[I]=n._.terrain[I].default);for(let I in t)if(!n.bi(t[I],b[I])){y.set(t,this.options),this.stylesheet.terrain=t;let A=this._getTransitionParameters({duration:0});y.updateTransitions(A),this.fire(new n.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let o=this.fog=new Xt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();let h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let o=this.fog;if(!n.bi(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();let h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(t){this._checkLoaded();let o=()=>{for(let g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(let g in this._sourceCaches)this._sourceCaches[g].clearTiles()};if(this._styleColorTheme.colorTheme=t,!t)return this._styleColorTheme.lut=null,void o();let h=this._evaluateColorThemeData(t);this._loadColorTheme(h).then(()=>{this.fire(new n.x("colorthemeset")),o()}).catch(g=>{n.w(`Couldn't set color theme: ${g}`)})}_getTransitionParameters(t){return{now:n.q.now(),transition:n.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],o=[];for(let h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):o.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){let h=this.terrain=new Be(t,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_force3DLayerUpdate(){for(let t in this._layers){let o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,h,g,y={}){if(y&&y.validate===!1)return!1;let b=n.l({},this.serialize());return qr(this,t.call($r,n.l({key:o,style:b,value:h,styleSpec:n._},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){let o=this.getSourceCaches(t);for(let h of o)h.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){let o=this.getSourceCaches(t);for(let h of o)h.resume(),h.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}updateSources(t){let o;this.directionalLight&&(o=wd(this.directionalLight));for(let h in this._mergedSourceCaches)this._mergedSourceCaches[h].update(t,void 0,void 0,o)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,h,g,y,b,I=!1){let A=!1,O=!1,P={},k={};for(let z of this._mergedOrder){let j=this._mergedLayers[z];if(j.type!=="symbol")continue;let W=n.av(j.source,j.scope),q=P[W];if(!q){let Z=this.getLayerSourceCache(j);if(!Z)continue;let Q=Z.getRenderableIds(!0).map(ie=>Z.getTileByID(ie));k[W]=Q.slice(),q=P[W]=Q.sort((ie,re)=>re.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(re.tileID)?-1:1))}let X=this.crossTileSymbolIndex.addLayer(j,q,o.center.lng,o.projection);A=A||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new n.x("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),o.zoom))&&(this.pauseablePlacement=new Yc(o,this._mergedOrder,I,h,g,y,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,k,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),O=!0),A&&this.pauseablePlacement.placement.setStale()),O||A){this._buildingIndex.onNewFrame(o.zoom);for(let z=0;z<this._mergedOrder.length;z++){let j=this._mergedLayers[this._mergedOrder[z]];if(j.type!=="symbol")continue;let W=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,P[n.av(j.source,j.scope)],z,W?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();let h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new n.t(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return h.push(t),this._loadImports([t],!0);let g=h.findIndex(({id:y})=>y===o);return g===-1&&this.fire(new n.t(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,g).concat(t).concat(h.slice(g)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==h[g].url&&this.setImportUrl(t,o.url),n.bi(o.config,h[g].config)||this.setImportConfig(t,o.config),n.bi(o.data,h[g].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;let y=this.getImportIndex(o);if(y===-1)return this;let b=h[g],I=this.fragments[g];return h=h.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=h.slice(0,y).concat(b).concat(h.slice(y)),this.fragments=this.fragments.slice(0,y).concat(I).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();let h=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;h[g].url=o;let y=this.fragments[g];return y.style=this._createFragmentStyle(h[g]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();let h=this.getImportIndex(t),g=this.stylesheet.imports||[];return h===-1?this:o?(this.fragments[h].style.setState(o),this._reloadImports(),this):(delete g[h].data,this.setImportUrl(t,g[h].url))}setImportConfig(t,o){this._checkLoaded();let h=this.getImportIndex(t),g=this.stylesheet.imports||[];if(h===-1)return this;o?g[h].config=o:delete g[h].config;let y=this.fragments[h],b=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=o,y.style.updateConfig(o,b),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let o=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(o.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){let o=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return o===-1&&this.fire(new n.t(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let o in this._mergedOtherSourceCaches){let h=this._mergedOtherSourceCaches[o];h&&t.push(h.getSource())}return t}getSource(t,o){let h=this.getSourceCache(t,o);return h&&h.getSource()}getLayerSource(t){let o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){let h=n.av(t,o);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){let o=n.av(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);let o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let o in t){let h=t[o];h==="reload"?this.reloadSource(o):h==="clear"&&this.clearSource(o)}}updateLayers(t){let o=this._changes.getUpdatedPaintProperties();for(let h of o){let g=this.getLayer(h);g&&g.updateTransitions(t)}}getImages(t,o,h){this.imageManager.getImages(o.icons,o.scope,h),this._updateTilesForChangedImages();let g=y=>{y&&y.setDependencies(o.tileID.key,o.type,o.icons)};g(this._otherSourceCaches[o.source]),g(this._symbolSourceCaches[o.source])}getGlyphs(t,o,h){this.glyphManager.getGlyphs(o.stacks,o.scope,h)}getResource(t,o,h){return n.ct(o,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){let o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new n.t(new Error(`There is no source with ID '${t}'`))),!1):o.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;let h=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(h||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Wr.getSourceType=function(d){return cd[d]},Wr.setSourceType=function(d,t){cd[d]=t},Wr.registerForPluginStateChange=n.cd;var Ug=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Gf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Hf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Sd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",$g=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Gg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Hg=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,qg=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,qf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Wg=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Kc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Td=[];Ys(Ug,Td),Ys(Hf,Td),Ys(Gf,Td);let Qc={"_prelude_fog.vertex.glsl":Gg,"_prelude_terrain.vertex.glsl":$g,"_prelude_shadow.vertex.glsl":Wg,"_prelude_fog.fragment.glsl":Hg,"_prelude_shadow.fragment.glsl":Kc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":qg,"_prelude_raster_particle.glsl":qf},Ol={};yn("",$g),yn(Hg,Gg),yn(Kc,Wg),yn(qg,""),yn(qf,"");let eu=yn(Gf,Hf),Id=Ug;var Xs={background:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:yn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:yn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:yn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:yn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:yn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:yn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:yn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:yn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:yn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:yn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:yn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:yn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:yn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:yn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Sd),skyboxGradient:yn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Sd),skyboxCapture:yn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:yn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:yn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:yn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:yn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:yn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:yn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),occlusion:yn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ys(d,t){let o=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of o)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let g=h.split(" ");for(let y of g)t.includes(y)||t.push(y)}}function yn(d,t){let o=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(O=>{let P=O.split(" ");return P[P.length-1]}),g=[...new Set(g)]);let y={},b=[],I=[];if(d=d.replace(o,(O,P)=>(I.push(P),"")),(t=t.replace(o,(O,P)=>(b.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...Td];Ys(d,A),Ys(t,A);for(let O of[...b,...I])Qc[O]||console.error(`Undefined include: ${O}`),Ol[O]||(Ol[O]=[],Ys(Qc[O],Ol[O])),A=[...A,...Ol[O]];return{fragmentSource:d=d.replace(h,(O,P,k,z,j)=>(y[j]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${k} ${z} ${j};
#else
uniform ${k} ${z} u_${j};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${k} ${z} ${j} = u_${j};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${k} ${z} ${j};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(O,P,k,z,j)=>{let W=z==="float"?"vec2":z,q=j.match(/color/)?"color":W;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${k} ${z} a_${j};
#endif
`:y[j]?P==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${k} ${W} a_${j};
out ${k} ${z} ${j};
#else
uniform ${k} ${z} u_${j};
#endif
`:P==="initialize"?q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${k} ${z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${q}(a_${j}, u_${j}_t);
#else
    ${k} ${z} ${j} = u_${j};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${k} ${z} a_${j};
    out ${k} ${z} ${j};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${k} ${W} a_${j};
#else
uniform ${k} ${z} u_${j};
#endif
`:P==="define-instanced"?q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${k} ${z} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${W} a_${j};
#else
uniform ${k} ${z} u_${j};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${k} ${z} ${j} = a_${j};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${k} ${z} ${j} = a_${j};
#else
    ${k} ${z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${k} ${z} ${j} = unpack_mix_${q}(a_${j}, u_${j}_t);
#else
    ${k} ${z} ${j} = u_${j};
#endif
`}),staticAttributes:g,usedDefines:A,vertexIncludes:b,fragmentIncludes:I}}class Ll{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,h,g,y,b,I,A){this.context=t;let O=this.boundPaintVertexBuffers.length!==g.length;for(let k=0;!O&&k<g.length;k++)this.boundPaintVertexBuffers[k]!==g[k]&&(O=!0);let P=this.boundDynamicVertexBuffers.length!==I.length;for(let k=0;!P&&k<I.length;k++)this.boundDynamicVertexBuffers[k]!==I[k]&&(P=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||O||P||this.boundIndexBuffer!==y||this.boundVertexOffset!==b)this.freshBind(o,h,g,y,b,I,A);else{t.bindVertexArrayOES.set(this.vao);for(let k of I)k&&(k.bind(),A&&k.instanceCount&&k.setVertexAttribDivisor(t.gl,o,A));y&&y.dynamicDraw&&y.bind()}}freshBind(t,o,h,g,y,b,I){let A=t.numAttributes,O=this.context,P=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=b,o.enableAttributes(P,t),o.bind(),o.setVertexAttribPointers(P,t,y);for(let k of h)k.enableAttributes(P,t),k.bind(),k.setVertexAttribPointers(P,t,y);for(let k of b)k&&(k.enableAttributes(P,t),k.bind(),k.setVertexAttribPointers(P,t,y),I&&k.instanceCount&&k.setVertexAttribDivisor(P,t,I));g&&g.bind(),O.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function tu(d,t){let o=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new n.a5(0,h/o).toLngLat().lat,new n.a5(0,(h+1)/o).toLngLat().lat]}function Dd(d,t,o,h,g,y,b){let I=d.context,A=I.gl,O=o.hillshadeFBO;if(!O)return;d.prepareDrawTile();let P=d.isTileAffectedByFog(t),k=d.getOrCreateProgram("hillshade",{overrideFog:P});I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.colorAttachment.get());let z=((X,Z,Q,ie)=>{let re=Q.paint.get("hillshade-shadow-color"),ae=Q.paint.get("hillshade-highlight-color"),de=Q.paint.get("hillshade-accent-color"),le=Q.paint.get("hillshade-emissive-strength"),he=n.bC(Q.paint.get("hillshade-illumination-direction"));if(Q.paint.get("hillshade-illumination-anchor")==="viewport")he-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){let we=X.style.directionalLight.properties.get("direction"),ve=n.c8(we.x,we.y,we.z);he=n.bC(ve[1])}let _e=!X.options.moving;return{u_matrix:ie||X.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),_e),u_image:0,u_latrange:tu(0,Z.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),he],u_shadow:re.toRenderColor(Q.lut),u_highlight:ae.toRenderColor(Q.lut),u_emissive_strength:le,u_accent:de.toRenderColor(Q.lut)}})(d,o,h,d.terrain?t.projMatrix:null);d.uploadCommonUniforms(I,k,t.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:W,tileBoundsSegments:q}=d.getTileBoundsBuffers(o);k.draw(d,A.TRIANGLES,g,y,b,jt.disabled,z,h.id,j,W,q)}function nu(d,t,o){if(!t.needsDEMTextureUpload)return;let h=d.context,g=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(o.stride);let y=o.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new n.T(h,y,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Fl(d,t,o){let h=d.context,g=h.gl;if(!t.dem)return;let y=t.dem;if(h.activeTexture.set(g.TEXTURE1),nu(d,t,y),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);let b=y.dim;h.activeTexture.set(g.TEXTURE0);let I=t.hillshadeFBO;if(!I){let z=new n.T(h,{width:b,height:b,data:null},g.RGBA8);z.bind(g.LINEAR,g.CLAMP_TO_EDGE),I=t.hillshadeFBO=h.createFramebuffer(b,b,!0,"renderbuffer"),I.colorAttachment.set(z.texture)}h.bindFramebuffer.set(I.framebuffer),h.viewport.set([0,0,b,b]);let{tileBoundsBuffer:A,tileBoundsIndexBuffer:O,tileBoundsSegments:P}=d.getMercatorTileBoundsBuffers(),k=[];d.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(d,g.TRIANGLES,Rt.disabled,Yt.disabled,fn.unblended,jt.disabled,((z,j)=>{let W=j.stride,q=n.a6.mat4.create();return n.a6.mat4.ortho(q,0,n.ab,-n.ab,0,0,1),n.a6.mat4.translate(q,q,[0,-n.ab,0]),{u_matrix:q,u_image:1,u_dimension:[W,W],u_zoom:z.overscaledZ}})(t.tileID,y),o.id,A,O,P),t.needsHillshadePrepare=!1}class ti{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wf extends ti{getDefault(){return n.bA.transparent}set(t){let o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Zg extends ti{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Zf extends ti{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ad extends ti{getDefault(){return[!0,!0,!0,!0]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class iu extends ti{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Xg extends ti{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Yg extends ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Jg extends ti{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class kl extends ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Kg extends ti{getDefault(){return[0,1]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class mx extends ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class gx extends ti{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class _x extends ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Xf extends ti{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Yf extends ti{getDefault(){return n.bA.transparent}set(t){let o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Jf extends ti{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Kf extends ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class Qg extends ti{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class e_ extends ti{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let yx=class extends ti{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class ru extends ti{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ou extends ti{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class t_ extends ti{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Zr extends ti{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Qf extends ti{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Pd extends ti{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rd extends ti{getDefault(){return null}set(t){let o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ep extends ti{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class tp extends ti{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Od extends ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class np extends ti{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class su extends ti{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Ld extends su{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ip extends su{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class n_ extends su{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Nl extends ip{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let vx=(d,t,o)=>({u_matrix:d,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),i_=(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:o,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_frustum_tl:b,u_frustum_tr:I,u_frustum_br:A,u_frustum_bl:O,u_globe_pos:P,u_globe_radius:k,u_viewport:z,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:W});function r_(d,t){return d!=null&&t!=null&&!(!d.hasData()||!t.hasData())&&d.demTexture!=null&&t.demTexture!=null&&d.tileID.key!==t.tileID.key}let zl=new class{constructor(){this.operations={}}newMorphing(d,t,o,h,g){if(d in this.operations){let y=this.operations[d];y.to.tileID.key!==o.tileID.key&&(y.queued=o)}else this.operations[d]={startTime:h,phase:0,duration:g,from:t,to:o,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(let t in this.operations){let o=this.operations[t];for(o.phase=(d-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},o_={0:null,1:"TERRAIN_VERTEX_MORPHING"};function s_(d,t,o){if(t===0)return 0;let h=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-d)*Math.max(t,1)*h}function rp(d,t){let o=1<<d.z;return!t&&(d.x===0||d.x===o-1)||d.y===0||d.y===o-1}let au=d=>({u_matrix:d});function Fd(d,t,o,h,g){if(g>0){let y=n.q.now(),b=(y-d.timeAdded)/g,I=t?(y-t.timeAdded)/g:-1,A=o.getSource(),O=h.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),P=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(d.tileID.overscaledZ-O),k=P&&d.refreshedUponExpiration?1:n.ap(P?b:1-I,0,1);return d.refreshedUponExpiration&&b>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class Bl extends Ar{constructor(t){let o={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new n.ce(n.cf(),null),g=ud("mock-dem",o,h,t.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class a_ extends Ar{constructor(t){let o=ud("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new n.ce(n.cf(),null),t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,h){if(t.freezeTileCoverage)return;this.transform=t;let g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){let I=new $o(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom);I.state="loaded",this._tiles[b.key]=I}return y},{});for(let y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){let o=this.proxyCachedFBO[t];if(o!==void 0){let h=Object.values(o);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class op extends n.aA{constructor(t,o,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=h}}class sp extends n.cE{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[h,g,y]=function(A){let O=new n.a$,P=new n.aP,k=131;O.reserve(17161),P.reserve(33800);let z=n.ab/128,j=n.ab+z/2,W=j+z;for(let X=-z;X<W;X+=z)for(let Z=-z;Z<W;Z+=z){let Q=Z<0||Z>j||X<0||X>j?24575:0,ie=n.ap(Math.round(Z),0,n.ab),re=n.ap(Math.round(X),0,n.ab);O.emplaceBack(ie+Q,re)}let q=(X,Z)=>{let Q=Z*k+X;P.emplaceBack(Q+1,Q,Q+k),P.emplaceBack(Q+k,Q+k+1,Q+1)};for(let X=1;X<129;X++)for(let Z=1;Z<129;Z++)q(Z,X);return[0,129].forEach(X=>{for(let Z=0;Z<130;Z++)q(Z,X),q(X,Z)}),[O,P,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(h,n.b1.members),this.gridIndexBuffer=b.createIndexBuffer(g),this.gridSegments=n.b2.simpleSegment(0,0,h.length,g.length),this.gridNoSkirtSegments=n.b2.simpleSegment(0,0,h.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new a_(o.map),this.orthoMatrix=n.a6.mat4.create(),n.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ab,0,n.ab,0,1);let I=b.gl;this._overlapStencilMode=new Yt({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Bl(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,o,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let g=t.terrain.properties,y=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();let I=t.terrain&&t.terrain.scope,A=g.get("source"),O=y?this._mockSourceCache:t.getSourceCache(A,I);if(!O)return void n.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=O,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(o):g.get("exaggeration"),!o.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;let P=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let k=this.getScaledDemTileSize();this.sourceCache.update(o,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),o.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);let o=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;let g=o!=null?h-o:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;let y=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(y);let I=y-this._previousZoom,A=this._previousUpdateTimestamp,O=y;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(y-O)>.5&&(I=.5*(y-O+I)),I*g<0&&(O+=I)),this._evaluationZoom=O;let P=b.getExaggeration(O),k=P===b.getExaggeration(Math.max(0,O-.1));if(k&&Math.abs(P-this._exaggeration)<.01)return P;let z=Math.min(.1,.00375*(this._updateTimestamp-A));return(k||P<.1||Math.abs(I)<1e-4)&&(z=Math.min(.2,4*z)),n.aa(this._exaggeration,P,z)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let o=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(n.a5.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let g=this.proxyCoords=o.getIds().map(A=>{let O=o.getTileByID(A).tileID;return O.projMatrix=h.calculateProjMatrix(O.toUnwrapped()),O});(function(A,O){let P=O.transform.pointCoordinate(O.transform.getCameraPoint()),k=new n.P(P.x,P.y);A.sort((z,j)=>{if(j.overscaledZ-z.overscaledZ)return j.overscaledZ-z.overscaledZ;let W=new n.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),q=new n.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),X=k.mult(1<<z.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(W)-X.distSqr(q)})})(g,this.painter);let y=this.proxyToSource||{};this.proxyToSource={},g.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};let b=this._style._mergedSourceCaches;for(let A in b){let O=b[A];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[A],y),O.usedForTerrain))continue;let P=t[A];O.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[o.id]=g.map(A=>new op(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;let I={};this._visibleDemTiles=[];for(let A of this.proxyCoords){let O=this.terrainTileForTile[A.key];if(!O)continue;let P=O.tileID.key;P in I||(this._visibleDemTiles.push(O),I[P]=P)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;let h=this._findTileCoveringTileID(o,this.sourceCache);h&&(this.terrainTileForTile[o.key]=h)})}_prepareDEMTextures(){let t=this.painter.context,o=t.gl;for(let h in this.terrainTileForTile){let g=this.terrainTileForTile[h],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),nu(this.painter,g,y))}}_prepareDemTileUniforms(t,o,h,g){if(!o||o.demTexture==null)return!1;let y=t.tileID.canonical,b=Math.pow(2,o.tileID.canonical.z-y.z),I=g||"";return h[`u_dem_tl${I}`]=[y.x*b%1,y.y*b%1],h[`u_dem_scale${I}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0,o=this._visibleDemTiles.reduce((h,g)=>{if(!g.dem)return h;let y=g.dem.tree.minimums[0];return y>0&&t++,h+y},0);return t?o/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);let h=this._getLoadedAreaMinimum(),g=new n.cF({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(g,{premultiply:!1}):y=this._emptyDEMTexture=new n.T(t,g,o.R32F,{premultiply:!1}),y}setupElevationDraw(t,o,h){let g=this.painter.context,y=g.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let I=null,A=null,O=1;if(h&&h.morphing&&this._useVertexMorphing){let j=h.morphing.srcDemTile,W=h.morphing.dstDemTile;O=h.morphing.phase,j&&W&&(this._prepareDemTileUniforms(t,j,b,"_prev")&&(A=j),this._prepareDemTileUniforms(t,W,b)&&(I=W))}let P=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST,k=null;var z;if(this.enabled?A&&I?(k=I.demTexture,g.activeTexture.set(y.TEXTURE4),A.demTexture.bind(P(A),y.CLAMP_TO_EDGE),b.u_dem_lerp=O):(I=this.terrainTileForTile[t.tileID.key],k=this._prepareDemTileUniforms(t,I,b)?I.demTexture:this.emptyDEMTexture):k=this.emptyDEMTexture,g.activeTexture.set(y.TEXTURE2),k&&(b.u_dem_size=(z=k).size[0]===1?1:z.size[0]-2,k.bind(P(I),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,o,b),h&&h.useMeterToDem&&I){let j=(1<<I.tileID.canonical.z)*n.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=j}if(h&&h.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),o.setTerrainUniformValues(g,b),this.painter.transform.projection.name==="globe"){let j=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);o.setGlobeUniformValues(g,j)}}globeUniformValues(t,o,h){let g=t.projection;return{u_tile_tl_up:g.upVector(o,0,0),u_tile_tr_up:g.upVector(o,n.ab,0),u_tile_br_up:g.upVector(o,n.ab,n.ab),u_tile_bl_up:g.upVector(o,0,n.ab),u_tile_up_scale:h?n.cG(1):g.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let o=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,y,b,I,A){if(g.transform.projection.name==="globe")(function(O,P,k,z,j){let W=O.context,q=W.gl,X,Z,Q=O.transform,ie=n.cx(O,W,Q),re=(Fe,Ue)=>{if(Z===Ue)return;let Je=[o_[Ue],"PROJECTION_GLOBE_VIEW"];ie&&Je.push("CUSTOM_ANTIALIASING");let nt=O.isTileAffectedByFog(Fe);X=O.getOrCreateProgram("globeRaster",{defines:Je,overrideFog:nt}),Z=Ue},ae=O.colorModeForRenderPass(),de=new Rt(q.LEQUAL,Rt.ReadWrite,O.depthRangeFor3D);zl.update(j);let le=n.cy(Q),he=[n.am(Q.center.lng),n.at(Q.center.lat)],_e=O.globeSharedBuffers,we=[Q.width*n.q.devicePixelRatio,Q.height*n.q.devicePixelRatio],ve=Float32Array.from(Q.globeMatrix),ye={useDenormalizedUpVectorScale:!0};{let Fe=O.transform,Ue=s_(Fe.zoom,P.exaggeration(),P.sourceCache._source.tileSize);Z=-1;let Je=q.TRIANGLES;for(let nt of z){let st=k.getTile(nt),Ie=Yt.disabled,Ze=P.prevTerrainTileForTile[nt.key],Ne=P.terrainTileForTile[nt.key];r_(Ze,Ne)&&zl.newMorphing(nt.key,Ze,Ne,j,250),W.activeTexture.set(q.TEXTURE0),st.texture&&st.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let Xe=zl.getMorphValuesForProxy(nt.key),Ke=Xe?1:0;Xe&&n.C(ye,{morphing:{srcDemTile:Xe.from,dstDemTile:Xe.to,phase:n.cw(Xe.phase)}});let We=n.cz(nt.canonical),ut=n.cA(We.getCenter().lat),bt=n.cB(nt.canonical,We,ut,Fe.worldSize/Fe._pixelsPerMercatorPixel),It=n.b6(n.cC(nt.canonical)),_t=i_(Fe.expandedFarZProjMatrix,ve,le,It,n.a9(Fe.zoom),he,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,we,Ue,Fe._farZ,bt);if(re(nt,Ke),X&&(P.setupElevationDraw(st,X,ye),O.uploadCommonUniforms(W,X,nt.toUnwrapped()),_e)){let[At,ht,Lt]=_e.getGridBuffers(ut,Ue!==0);X.draw(O,Je,de,Ie,ae,jt.backCCW,_t,"globe_raster",At,ht,Lt)}}}if(_e&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){let Fe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ie&&Fe.push("CUSTOM_ANTIALIASING"),X=O.getOrCreateProgram("globeRaster",{defines:Fe});for(let Ue of z){let{x:Je,y:nt,z:st}=Ue.canonical,Ie=nt===0,Ze=nt===(1<<st)-1,[Ne,Xe,Ke,We]=_e.getPoleBuffers(st,!1);if(We&&(Ie||Ze)){let ut=k.getTile(Ue);W.activeTexture.set(q.TEXTURE0),ut.texture&&ut.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let bt=n.cD(st,Je,Q),It=n.b6(n.cC(Ue.canonical)),_t=(At,ht)=>At.draw(O,q.TRIANGLES,de,Yt.disabled,ae,jt.disabled,i_(Q.expandedFarZProjMatrix,bt,bt,It,0,he,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,we,0,Q._farZ),"globe_pole_raster",ht,Ke,We);P.setupElevationDraw(ut,X,ye),O.uploadCommonUniforms(W,X,Ue.toUnwrapped()),Ie&&O.renderDefaultNorthPole&&_t(X,Ne),Ze&&O.renderDefaultSouthPole&&(bt=n.a6.mat4.scale(n.a6.mat4.create(),bt,[1,-1,1]),_t(X,Xe))}}}})(g,y,b,I,A);else{let O=g.context,P=O.gl,k,z,j=g.shadowRenderer,W=_s(g,g.longestCutoffRange),q=ae=>{if(z===ae)return;let de=[];de.push(o_[ae]),W.shouldRenderCutoff&&de.push("RENDER_CUTOFF"),j&&(de.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&de.push("NORMAL_OFFSET")),k=g.getOrCreateProgram("terrainRaster",{defines:de}),z=ae},X=g.colorModeForRenderPass(),Z=new Rt(P.LEQUAL,Rt.ReadWrite,g.depthRangeFor3D);zl.update(A);let Q=g.transform,ie=s_(Q.zoom,y.exaggeration(),y.sourceCache._source.tileSize),re=[0,0,0];if(j){let ae=g.style.directionalLight,de=g.style.ambientLight;ae&&de&&(re=Cd(g.style,ae,de))}{z=-1;let ae=P.TRIANGLES,[de,le]=[y.gridIndexBuffer,y.gridSegments];for(let he of I){let _e=b.getTile(he),we=Yt.disabled,ve=y.prevTerrainTileForTile[he.key],ye=y.terrainTileForTile[he.key];r_(ve,ye)&&zl.newMorphing(he.key,ve,ye,A,250),O.activeTexture.set(P.TEXTURE0),_e.texture&&_e.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let Fe=zl.getMorphValuesForProxy(he.key),Ue=Fe?1:0,Je;Fe&&(Je={morphing:{srcDemTile:Fe.from,dstDemTile:Fe.to,phase:n.cw(Fe.phase)}});let nt=vx(he.projMatrix,rp(he.canonical,Q.renderWorldCopies)?ie/10:ie,re);if(q(Ue),!k)continue;y.setupElevationDraw(_e,k,Je);let st=he.toUnwrapped();j&&j.setupShadows(st,k),g.uploadCommonUniforms(O,k,st,null,W),k.draw(g,ae,Z,we,X,jt.backCCW,nt,"terrain_raster",y.gridBuffer,de,le)}}}}(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let o=this.painter,h=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],b=this._drapedRenderBatches.shift(),I=o.style.order,A=[],O=0;for(let P of y){let k=g.getTileByID(P.proxyTileKey),z=g.proxyCachedFBO[P.key]?g.proxyCachedFBO[P.key][t]:void 0,j=z!==void 0?g.renderCache[z]:this.pool[O++],W=z!==void 0;if(k.texture=j.tex,W&&!j.dirty){A.push(k.tileID);continue}let q;h.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(h.clear({color:n.bA.transparent,stencil:0}),j.dirty=!1);for(let X=b.start;X<=b.end;++X){let Z=o.style._mergedLayers[I[X]];if(Z.isHidden(o.transform.zoom))continue;let Q=o.style.getLayerSourceCache(Z),ie=Q?this.proxyToSource[P.key][Q.id]:[P];if(!ie)continue;let re=ie;h.viewport.set([0,0,j.fb.width,j.fb.height]),q!==(Q?Q.id:null)&&(this._setupStencil(j,ie,Z,Q),q=Q?Q.id:null),o.renderLayer(o,Q,Z,re)}if(this._drapedRenderBatches.length===0)for(let X of this._pendingGroundEffectLayers){let Z=o.style._mergedLayers[I[X]];if(Z.isHidden(o.transform.zoom))continue;let Q=o.style.getLayerSourceCache(Z),ie=Q?this.proxyToSource[P.key][Q.id]:[P];if(!ie)continue;let re=ie;h.viewport.set([0,0,j.fb.width,j.fb.height]),q!==(Q?Q.id:null)&&(this._setupStencil(j,ie,Z,Q),q=Q?Q.id:null),o.renderLayer(o,Q,Z,re)}this.renderedToTile?(j.dirty=!0,A.push(k.tileID)):W||--O,O===5&&(O=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,o.width,o.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){let o=t.order.length,h=-1,g=o;for(let y=0;y<o;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?h=Math.max(h,y):g=Math.min(g,y);return g>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,h){if(!this._visibleDemTiles)return null;let g=this._visibleDemTiles.filter(y=>y.dem).map(y=>{let b=y.tileID,I=1<<b.overscaledZ,{x:A,y:O}=b.canonical,P=A/I,k=(A+1)/I,z=O/I,j=(O+1)/I;return{minx:P,miny:z,maxx:k,maxy:j,t:y.dem.tree.raycastRoot(P,z,k,j,t,o,h),tile:y}});g.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(let y of g){if(y.t==null)return null;let b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,o,h);if(b!=null)return b}return null}_createFBO(){let t=this.painter.context,o=t.gl,h=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);let g=new n.T(t,{width:h[0],height:h[1],data:null},o.RGBA8);g.bind(o.LINEAR,o.CLAMP_TO_EDGE);let y=t.createFramebuffer(h[0],h[1],!0,null);return y.colorAttachment.set(g.texture),y.depthAttachment=new Nl(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let o=this._style._mergedLayers[t],h=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!h&&o.shouldRedrape():!h&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(let h of this._style.getSources())if(h instanceof nr){t=!0;break}if(!t)return;let o={};for(let h=0;h<this._style.order.length;++h){let g=this._style._mergedLayers[this._style.order[h]],y=this._style.getLayerSourceCache(g);if(y&&!o[y.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof n.a4){o[y.id]=!0;for(let b of this.proxyCoords){let I=this.proxyToSource[b.key][y.id];if(I)for(let A of I)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof Hs){t=!0;break}if(!t)return;let o={};for(let h=0;h<this._style.order.length;++h){let g=this._style._mergedLayers[this._style.order[h]],y=this._style.getLayerSourceCache(g);if(!y||o[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;let b=g.paint.get("raster-fade-duration");for(let I of this.proxyCoords){let A=this.proxyToSource[I.key][y.id];if(A)for(let O of A){let P=Fd(y.getTile(O),y.findLoadedParent(O,0),y,this.painter.transform,b);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,O)}}}}_setupDrapedRenderBatches(){let t=this._style.order,o=t.length;if(o===0)return;let h=[];this._pendingGroundEffectLayers=[];let g,y=0,b=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<o;)b=this._style._mergedLayers[t[y]];for(;y<o;++y){let I=this._style._mergedLayers[t[y]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?g===void 0&&(g=y):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),g!==void 0&&(h.push({start:g,end:y-1}),g=void 0)))}if(g!==void 0&&h.push({start:g,end:y-1}),h.length!==0){let I=h[h.length-1];this._pendingGroundEffectLayers.every(A=>A>I.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){let o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){let b=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let I=0;I<b.length;++I){let A=Object.values(b[I]);o.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();let h=this.proxyCoords,g=this._tilesDirty;for(let b=h.length-1;b>=0;b--){let I=h[b];if(o.getTileByID(I.key),o.proxyCachedFBO[I.key]!==void 0){let A=t[I.key],O=this.proxyToSource[I.key],P=0;for(let k in O){let z=O[k],j=A[k];if(!j||j.length!==z.length||z.some((W,q)=>W!==j[q]||g[k]&&g[k].hasOwnProperty(W.key))){P=-1;break}++P}for(let k in o.proxyCachedFBO[I.key])o.renderCache[o.proxyCachedFBO[I.key][k]].dirty=P<0||P!==Object.values(A).length}}let y=[...this._drapedRenderBatches];y.sort((b,I)=>I.end-I.start-(b.end-b.start));for(let b of y)for(let I of h){if(o.proxyCachedFBO[I.key])continue;let A=o.renderCachePool.pop();A===void 0&&o.renderCache.length<50&&(A=o.renderCache.length,o.renderCache.push(this._createFBO())),A!==void 0&&(o.proxyCachedFBO[I.key]={},o.proxyCachedFBO[I.key][b.start]=A,o.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,h,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let y=this.painter.context,b=y.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let I;if(h.isTileClipped())I=o.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Yt.disabled}_renderTileClippingMasks(t,o){let h=this.painter,g=this.painter.context,y=g.gl;h._tileClippingMaskIDs={},g.setColorMode(fn.disabled),g.setDepthMode(Rt.disabled);let b=h.getOrCreateProgram("clippingMask");for(let I of t){let A=h._tileClippingMaskIDs[I.key]=--o;b.draw(h,y.TRIANGLES,Rt.disabled,new Yt({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),fn.disabled,jt.disabled,au(I.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){let o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;let h=[t.x,t.y,1,1];n.a6.vec4.transformMat4(h,h,o.pixelMatrixInverse),n.a6.vec4.scale(h,h,1/h[3]),h[0]/=o.worldSize,h[1]/=o.worldSize;let g=o._camera.position,y=n.bE(1,o.center.lat),b=[g[0],g[1],g[2]/y,0],I=n.a6.vec3.subtract([],h.slice(0,3),b);n.a6.vec3.normalize(I,I);let A=this.raycast(b,I,this._exaggeration);return A!==null&&A?(n.a6.vec3.scaleAndAdd(b,b,I,A),b[3]=b[2],b[2]*=y,b):null}_setupProxiedCoordsForOrtho(t,o,h){if(t.getSource()instanceof n.aD)return this._setupProxiedCoordsForImageSource(t,o,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let g=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let A=0;A<y.length;A++){let O=y[A],P=this._findTileCoveringTileID(O,t);if(P){let k=this._createProxiedId(O,P,h[O.key]&&h[O.key][t.id]);g.push(k),this.proxyToSource[O.key][t.id]=[k]}}let b=!1,I=new Set;for(let A=0;A<o.length;A++){let O=t.getTile(o[A]);if(!O||!O.hasData())continue;let P=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==O.tileID.canonical.z){let k=this.proxyToSource[P.tileID.key][t.id],z=this._createProxiedId(P.tileID,O,h[P.tileID.key]&&h[P.tileID.key][t.id]);k?k.splice(k.length-1,0,z):this.proxyToSource[P.tileID.key][t.id]=[z];let j=this.proxyToSource[P.tileID.key][t.id];I.has(j)||I.add(j),g.push(z),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(let A of I)A.sort((O,P)=>P.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(t,o,h){if(!t.getSource().loaded())return;let g=this.proxiedCoords[t.id]=[],y=this.proxyCoords,b=t.getSource(),I=b.tileID;if(!I)return;let A=new n.P(I.x,I.y)._div(1<<I.z),O=b.coordinates.map(n.a5.fromLngLat).reduce((k,z)=>(k.min.x=Math.min(k.min.x,z.x-A.x),k.min.y=Math.min(k.min.y,z.y-A.y),k.max.x=Math.max(k.max.x,z.x-A.x),k.max.y=Math.max(k.max.y,z.y-A.y),k),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(k,z)=>{let j=k.wrap+k.canonical.x/(1<<k.canonical.z),W=k.canonical.y/(1<<k.canonical.z),q=n.ab/(1<<k.canonical.z),X=z.wrap+z.canonical.x/(1<<z.canonical.z),Z=z.canonical.y/(1<<z.canonical.z);return j+q<X+O.min.x||j>X+O.max.x||W+q<Z+O.min.y||W>Z+O.max.y};for(let k=0;k<y.length;k++){let z=y[k];for(let j=0;j<o.length;j++){let W=t.getTile(o[j]);if(!W||!W.hasData()||P(z,W.tileID))continue;let q=this._createProxiedId(z,W,h[z.key]&&h[z.key][t.id]),X=this.proxyToSource[z.key][t.id];X?X.push(q):this.proxyToSource[z.key][t.id]=[q],g.push(q)}}}_createProxiedId(t,o,h){let g=this.orthoMatrix;if(h){let y=h.find(b=>b.key===o.tileID.key);if(y)return y}if(o.tileID.key!==t.key){let y=t.canonical.z-o.tileID.canonical.z,b,I,A;g=n.a6.mat4.create();let O=o.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(b=n.ab>>y,I=b*((o.tileID.canonical.x<<y)-t.canonical.x+O),A=b*((o.tileID.canonical.y<<y)-t.canonical.y)):(b=n.ab<<-y,I=n.ab*(o.tileID.canonical.x-(t.canonical.x+O<<-y)),A=n.ab*(o.tileID.canonical.y-(t.canonical.y<<-y))),n.a6.mat4.ortho(g,0,b,0,b,0,1),n.a6.mat4.translate(g,g,[I,A,0])}return new op(o.tileID,t.key,g)}_findTileCoveringTileID(t,o){let h=o.getTile(t);if(h&&h.hasData())return h;let g=this._findCoveringTileCache[o.id],y=g[t.key];if(h=y?o.getTileByID(y):null,h&&h.hasData()||y===null)return h;let b=h?h.tileID:t,I=b.overscaledZ,A=o.getSource().minzoom,O=[];if(!y){let k=o.getSource().maxzoom;if(t.canonical.z>=k){let z=t.canonical.z-k;o.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,o.transform.tileZoom),b=new n.aA(I,t.wrap,k,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(I=k,b=new n.aA(I,t.wrap,k,t.canonical.x>>z,t.canonical.y>>z))}b.key!==t.key&&(O.push(b.key),h=o.getTile(b))}let P=k=>{O.forEach(z=>{g[z]=k}),O.length=0};for(I-=1;I>=A&&(!h||!h.hasData());I--){h&&P(h.tileID.key);let k=b.calculateScaledKey(I);if(h=o.getTileByID(k),h&&h.hasData())break;let z=g[k];if(z===null)break;z===void 0?O.push(k):h=o.getTileByID(z)}return P(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[o.key]=!0}}function ap(d,t,o){let h=function(I,A,O){let P=n.a6.vec3.dot(A,I),k=n.a6.vec3.dot(O,[.2126,.7152,.0722]),z=(W,q,X)=>(1-X)*W+X*q,j=z(1-.3*Math.min(k,1),1,Math.min(P+1,1));return z(.92,1,Math.asin(n.ap(A[2],-1,1))/Math.PI+.5)*j}(d,[0,0,1],t),g=[0,0,0];n.a6.vec3.scale(g,o.slice(0,3),h);let y=[0,0,0];n.a6.vec3.scale(y,t.slice(0,3),d[2]);let b=[0,0,0];return n.a6.vec3.add(b,g,y),n.cc(b)}let Ra=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],l_=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class vs{static cacheKey(t,o,h,g){let y=`${o}${g?g.cacheKey:""}`;for(let b of h)t.usedDefines.includes(b)&&(y+=`/${b}`);return y}constructor(t,o,h,g,y,b){let I=t.gl;this.program=I.createProgram(),this.configuration=g,this.name=o,this.fixedDefines=[...b];let A=g?g.getBinderAttributes():[],O=(h.staticAttributes||[]).concat(A),P=g?g.defines():[];P=P.concat(b.map(X=>`#define ${X}`));let k=`#version 300 es
`,z=k+P.concat("precision mediump float;",Id,eu.fragmentSource).join(`
`);for(let X of h.fragmentIncludes)z+=`
${Qc[X]}`;z+=`
${h.fragmentSource}`;let j=k+P.concat("precision highp float;",Id,eu.vertexSource).join(`
`);for(let X of h.vertexIncludes)j+=`
${Qc[X]}`;j+=`
${h.vertexSource}`;let W=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(W,z),I.compileShader(W),I.attachShader(this.program,W);let q=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(q,j),I.compileShader(q),I.attachShader(this.program,q),this.attributes={},this.numAttributes=O.length;for(let X=0;X<this.numAttributes;X++)if(O[X]){let Z=O[X].startsWith("a_")?O[X]:`a_${O[X]}`;I.bindAttribLocation(this.program,X,Z),this.attributes[Z]=X}I.linkProgram(this.program),I.deleteShader(q),I.deleteShader(W),this.fixedUniforms=y(t),this.binderUniforms=g?g.getUniforms(t):[],(b.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new n.bK(X),u_dem_prev:new n.bK(X),u_dem_tl:new n.bH(X),u_dem_scale:new n.bJ(X),u_dem_tl_prev:new n.bH(X),u_dem_scale_prev:new n.bJ(X),u_dem_size:new n.bJ(X),u_dem_lerp:new n.bJ(X),u_exaggeration:new n.bJ(X),u_depth:new n.bK(X),u_depth_size_inv:new n.bH(X),u_depth_range_unpack:new n.bH(X),u_occluder_half_size:new n.bJ(X),u_occlusion_depth_offset:new n.bJ(X),u_meter_to_dem:new n.bJ(X),u_label_plane_matrix_inv:new n.bG(X)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new n.bI(X),u_tile_tr_up:new n.bI(X),u_tile_br_up:new n.bI(X),u_tile_bl_up:new n.bI(X),u_tile_up_scale:new n.bJ(X)}))(t)),b.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new n.bG(X),u_fog_range:new n.bH(X),u_fog_color:new n.c7(X),u_fog_horizon_blend:new n.bJ(X),u_fog_vertical_limit:new n.bH(X),u_fog_temporal_offset:new n.bJ(X),u_frustum_tl:new n.bI(X),u_frustum_tr:new n.bI(X),u_frustum_br:new n.bI(X),u_frustum_bl:new n.bI(X),u_globe_pos:new n.bI(X),u_globe_radius:new n.bJ(X),u_globe_transition:new n.bJ(X),u_is_globe:new n.bK(X),u_viewport:new n.bH(X)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new n.c7(X)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new n.bI(X),u_lighting_directional_dir:new n.bI(X),u_lighting_directional_color:new n.bI(X),u_ground_radiance:new n.bI(X)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new n.bG(X),u_light_matrix_1:new n.bG(X),u_fade_range:new n.bH(X),u_shadow_normal_offset:new n.bI(X),u_shadow_intensity:new n.bJ(X),u_shadow_texel_size:new n.bJ(X),u_shadow_map_resolution:new n.bJ(X),u_shadow_direction:new n.bI(X),u_shadow_bias:new n.bI(X),u_shadowmap_0:new n.bK(X),u_shadowmap_1:new n.bK(X)}))(t))}}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;let h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)h[g]&&h[g].set(this.program,g,o[g])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;let h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)h[g]&&h[g].set(this.program,g,o[g])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;let h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)h[g].set(this.program,g,o[g])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;let h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)h[g].set(this.program,g,o[g])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;let h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)h[g].set(this.program,g,o[g])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;let h=this.shadowUniforms;t.program.set(this.program);for(let g in o)h[g].set(this.program,g,o[g])}_drawDebugWireframe(t,o,h,g,y,b,I,A,O,P){let k=t.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;let z=t.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ra.includes(this.name))||!(!k.layers3D||!l_.includes(this.name))))return;let j=z.gl,W=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,z);if(!W)return;let q=[...this.fixedDefines];q.push("DEBUG_WIREFRAME");let X=t.getOrCreateProgram(this.name,{config:this.configuration,defines:q});z.program.set(X.program);let Z=(re,ae,de)=>{if(ae[re]&&de[re])for(let le in ae[re])de[re][le]&&de[re][le].set(de.program,le,ae[re][le].current)};O&&O.setUniforms(X.program,z,X.binderUniforms,I,{zoom:A}),Z("fixedUniforms",this,X),Z("terrainUniforms",this,X),Z("globeUniforms",this,X),Z("fogUniforms",this,X),Z("lightsUniforms",this,X),Z("shadowUniforms",this,X),W.bind(),z.setColorMode(new fn([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],n.bA.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Rt(o.func===j.LESS?j.LEQUAL:o.func,Rt.ReadOnly,o.range)),z.setStencilMode(Yt.disabled);let Q=3*b.primitiveLength*2,ie=3*b.primitiveOffset*2*2;P&&P>1?j.drawElementsInstanced(j.LINES,Q,j.UNSIGNED_SHORT,ie,P):j.drawElements(j.LINES,Q,j.UNSIGNED_SHORT,ie),y.bind(),z.program.set(this.program),z.setDepthMode(o),z.setStencilMode(h),z.setColorMode(g)}checkUniforms(t,o,h){if(this.fixedDefines.includes(o)){for(let g of Object.keys(h))if(!h[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${o} being defined`)}}draw(t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X){let Z=t.context,Q=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(h),Z.setStencilMode(g),Z.setColorMode(y),Z.setCullFace(b);for(let ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,I[ae]);W&&W.setUniforms(this.program,Z,this.binderUniforms,z,{zoom:j});let ie={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[o];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);let re=X&&X>0?1:void 0;for(let ae of k.get()){let de=ae.vaos||(ae.vaos={});(de[A]||(de[A]=new Ll)).bind(Z,this,O,W?W.getPaintVertexBuffers():[],P,ae.vertexOffset,q||[],re),X&&X>1?Q.drawElementsInstanced(o,ae.primitiveLength*ie,Q.UNSIGNED_SHORT,ae.primitiveOffset*ie*2,X):P?Q.drawElements(o,ae.primitiveLength*ie,Q.UNSIGNED_SHORT,ae.primitiveOffset*ie*2):Q.drawArrays(o,ae.vertexOffset,ae.vertexLength),o===Q.TRIANGLES&&P&&this._drawDebugWireframe(t,h,g,y,P,ae,z,j,W,X)}}}function kd(d,t){let o=Math.pow(2,t.tileID.overscaledZ),h=t.tileSize*Math.pow(2,d.transform.tileZoom)/o,g=h*(t.tileID.canonical.x+t.tileID.wrap*o),y=h*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ak(t,1,d.transform.tileZoom),u_pixel_coord_upper:[g>>16,y>>16],u_pixel_coord_lower:[65535&g,65535&y]}}let Oa={terrain:0,flat:1},c_=n.a6.mat4.create(),lp=(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X,Z)=>{let Q=t.style.light,ie=Q.properties.get("position"),re=[ie.x,ie.y,ie.z],ae=n.a6.mat3.create();Q.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(ae,-t.transform.angle),n.a6.vec3.transformMat3(re,re,ae));let de=Q.properties.get("color"),le=t.transform,he={u_matrix:d,u_lightpos:re,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+o,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:c_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Oa[O],u_base_type:Oa[P],u_ao:g,u_edge_radius:y,u_width_scale:b,u_flood_light_color:W,u_vertical_scale:q,u_flood_light_intensity:X,u_ground_shadow_factor:Z};return le.projection.name==="globe"&&(he.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],he.u_zoom_transition=k,he.u_inv_rot_matrix=j,he.u_merc_center=z,he.u_up_dir=le.projection.upVector(new n.bQ(0,0,0),z[0]*n.ab,z[1]*n.ab),he.u_height_lift=A),he},cp=(d,t,o,h,g,y)=>({u_matrix:d,u_edge_radius:t,u_width_scale:o,u_vertical_scale:h,u_height_type:Oa[g],u_base_type:Oa[y]}),up=(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X)=>{let Z=lp(d,t,o,h,g,y,b,I,O,P,k,z,j,W,q,X,1,[0,0,0]),Q={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return n.l(Z,kd(t,A),Q)},u_=(d,t)=>({u_matrix:d,u_emissive_strength:t}),dp=(d,t,o,h)=>n.l(u_(d,t),kd(o,h)),lu=(d,t,o)=>({u_matrix:d,u_world:o,u_emissive_strength:t}),xx=(d,t,o,h,g)=>n.l(dp(d,t,o,h),{u_world:g}),bx=(d,t,o,h)=>{let g=n.ab/o.tileSize;return{u_matrix:d,u_camera_to_center_distance:t.getCameraToCenterDistance(h),u_extrude_scale:[t.pixelsToGLUnits[0]/g,t.pixelsToGLUnits[1]/g]}},hp=(d,t,o=1)=>({u_matrix:d,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:o}),wx=n.a6.mat4.create(),fp=(d,t,o,h,g,y,b)=>{let I=d.transform,A=I.projection.name==="globe",O=A?n.cI(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:n.ak(o,1,y),P={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:b,u_inv_rot_matrix:wx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){P.u_inv_rot_matrix=h,P.u_merc_center=g,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=n.a9(I.zoom);let k=g[0]*n.ab,z=g[1]*n.ab;P.u_up_dir=I.projection.upVector(new n.bQ(0,0,0),k,z)}return P};function Nd(d,[t,o,h,g],[y,b]){if(y===b)return[0,0,0,0];let I=255*(d-1)/(d*(b-y));return[t*I,o*I,h*I,g*I]}function Vl(d,t,[o,h]){return o===h?0:.5/d+(t-o)*(d-1)/(d*(h-o))}let zd=(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X,Z,Q,ie,re)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:O,u_fade_t:P.mix,u_opacity:P.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:n.cJ(k.paint.get("raster-saturation")),u_contrast_factor:n.cK(k.paint.get("raster-contrast")),u_spin_weights:cu(k.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:j,u_zoom_transition:b,u_merc_center:I,u_cutoff_params:A,u_colorization_mix:Nd(n.cL,q,Z),u_colorization_offset:Vl(n.cL,X,Z),u_color_ramp:W,u_texture_offset:[ie/(Q+2*ie),Q/(Q+2*ie)],u_texture_res:[Q+2*ie,Q+2*ie],u_emissive_strength:re});function cu(d){d*=Math.PI/180;let t=Math.sin(d),o=Math.cos(d);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}let La=.05,Bd=(d,t,o,h,g,y,b,I,A,O,P,k)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:O,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:b,u_merc_center:I,u_cutoff_params:A}),Vd=(d,t,o,h,g,y,b,I,A,O)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:h,u_color_ramp:y,u_velocity_res:g,u_max_speed:b,u_uv_offset:I,u_data_scale:[255*A[0],255*A[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[La,La]}),pp=(d,t,o,h,g,y,b,I,A,O)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:h,u_max_speed:g,u_speed_factor:y,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*A[0],255*A[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[La,La]}),mp=n.a6.mat4.create(),d_=(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X,Z,Q,ie,re,ae)=>{let de=g.transform,le={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:de.getCameraToCenterDistance(Q),u_rotate_symbol:+o,u_aspect_ratio:de.width/de.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:I,u_is_text:+O,u_elevation_from_sea:A?1:0,u_pitch_with_map:+h,u_texsize:P,u_texsize_icon:k,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:mp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:mp,u_up_vector:[0,-1,0],u_color_adj_mat:ie,u_icon_transition:re||0,u_gamma_scale:h?g.transform.getCameraToCenterDistance(Q)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:+z,u_scale_factor:ae||1};return Q.name==="globe"&&(le.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],le.u_zoom_transition=W,le.u_inv_rot_matrix=X,le.u_merc_center=q,le.u_camera_forward=de._camera.forward(),le.u_ecef_origin=n.cM(de.globeMatrix,j.toUnwrapped()),le.u_tile_matrix=Float32Array.from(de.globeMatrix),le.u_up_vector=Z),le},Fa=(d,t,o,h)=>({u_matrix:d,u_emissive_strength:t,u_opacity:o,u_color:h}),uu=(d,t,o,h,g,y,b,I,A)=>n.l(function(O,P,k,z,j,W){let{width:q,height:X}=z.imageManager.getPixelSize(P),Z=Math.pow(2,W.tileID.overscaledZ),Q=W.tileSize*Math.pow(2,z.transform.tileZoom)/Z,ie=Q*(W.tileID.canonical.x+W.tileID.wrap*Z),re=Q*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[q,X],u_pattern_size:k.displaySize,u_pattern_units_to_pixels:j?[z.transform.width,-1*z.transform.height]:[1/n.ak(W,1,z.transform.tileZoom),1/n.ak(W,1,z.transform.tileZoom)],u_pixel_coord_upper:[ie>>16,re>>16],u_pixel_coord_lower:[65535&ie,65535&re]}}(0,y,b,h,I,A),{u_matrix:d,u_emissive_strength:t,u_opacity:o}),gt=new Float32Array(n.a6.mat4.identity([])),jd=(d,t,o,h,g,y,b,I,A,O,P,k,z,j=[0,0,0],W)=>{let q=g.style.light,X=q.properties.get("position"),Z=[-X.x,-X.y,X.z],Q=n.a6.mat3.create();q.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(Q,-g.transform.angle),n.a6.vec3.transformMat3(Z,Z,Q));let ie=P.alphaMode==="MASK",re=q.properties.get("color").toRenderColor(null),ae=z.paint.get("model-ambient-occlusion-intensity"),de=z.paint.get("model-color").constantOr(n.bA.white).toRenderColor(null),le=z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:h||gt,u_lightpos:Z,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_camera_pos:j,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+ie,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:A,u_roughnessFactor:O,u_baseColorTexture:ar.BaseColor,u_metallicRoughnessTexture:ar.MetallicRoughness,u_normalTexture:ar.Normal,u_occlusionTexture:ar.Occlusion,u_emissionTexture:ar.Emission,u_lutTexture:ar.LUT,u_color_mix:[de.r,de.g,de.b,le],u_aoIntensity:ae,u_emissive_strength:k,u_occlusionTextureTransform:W||[0,0,0,0]}},gp=(d,t=gt,o=gt)=>({u_matrix:d,u_instance:t,u_node_matrix:o}),ka={fillExtrusion:d=>({u_matrix:new n.bG(d),u_lightpos:new n.bI(d),u_lightintensity:new n.bJ(d),u_lightcolor:new n.bI(d),u_vertical_gradient:new n.bJ(d),u_opacity:new n.bJ(d),u_edge_radius:new n.bJ(d),u_width_scale:new n.bJ(d),u_ao:new n.bH(d),u_height_type:new n.bK(d),u_base_type:new n.bK(d),u_tile_id:new n.bI(d),u_zoom_transition:new n.bJ(d),u_inv_rot_matrix:new n.bG(d),u_merc_center:new n.bH(d),u_up_dir:new n.bI(d),u_height_lift:new n.bJ(d),u_flood_light_color:new n.bI(d),u_vertical_scale:new n.bJ(d),u_flood_light_intensity:new n.bJ(d),u_ground_shadow_factor:new n.bI(d)}),fillExtrusionDepth:d=>({u_matrix:new n.bG(d),u_edge_radius:new n.bJ(d),u_width_scale:new n.bJ(d),u_vertical_scale:new n.bJ(d),u_height_type:new n.bK(d),u_base_type:new n.bK(d)}),fillExtrusionPattern:d=>({u_matrix:new n.bG(d),u_lightpos:new n.bI(d),u_lightintensity:new n.bJ(d),u_lightcolor:new n.bI(d),u_vertical_gradient:new n.bJ(d),u_height_factor:new n.bJ(d),u_edge_radius:new n.bJ(d),u_width_scale:new n.bJ(d),u_ao:new n.bH(d),u_height_type:new n.bK(d),u_base_type:new n.bK(d),u_tile_id:new n.bI(d),u_zoom_transition:new n.bJ(d),u_inv_rot_matrix:new n.bG(d),u_merc_center:new n.bH(d),u_up_dir:new n.bI(d),u_height_lift:new n.bJ(d),u_image:new n.bK(d),u_texsize:new n.bH(d),u_pixel_coord_upper:new n.bH(d),u_pixel_coord_lower:new n.bH(d),u_tile_units_to_pixels:new n.bJ(d),u_opacity:new n.bJ(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new n.bG(d),u_opacity:new n.bJ(d),u_ao_pass:new n.bJ(d),u_meter_to_tile:new n.bJ(d),u_ao:new n.bH(d),u_flood_light_intensity:new n.bJ(d),u_flood_light_color:new n.bI(d),u_attenuation:new n.bJ(d),u_edge_radius:new n.bJ(d),u_fb:new n.bK(d),u_fb_size:new n.bJ(d),u_dynamic_offset:new n.bJ(d)}),fill:d=>({u_matrix:new n.bG(d),u_emissive_strength:new n.bJ(d)}),fillPattern:d=>({u_matrix:new n.bG(d),u_emissive_strength:new n.bJ(d),u_image:new n.bK(d),u_texsize:new n.bH(d),u_pixel_coord_upper:new n.bH(d),u_pixel_coord_lower:new n.bH(d),u_tile_units_to_pixels:new n.bJ(d)}),fillOutline:d=>({u_matrix:new n.bG(d),u_emissive_strength:new n.bJ(d),u_world:new n.bH(d)}),fillOutlinePattern:d=>({u_matrix:new n.bG(d),u_emissive_strength:new n.bJ(d),u_world:new n.bH(d),u_image:new n.bK(d),u_texsize:new n.bH(d),u_pixel_coord_upper:new n.bH(d),u_pixel_coord_lower:new n.bH(d),u_tile_units_to_pixels:new n.bJ(d)}),circle:n.cN,collisionBox:d=>({u_matrix:new n.bG(d),u_camera_to_center_distance:new n.bJ(d),u_extrude_scale:new n.bH(d)}),collisionCircle:d=>({u_matrix:new n.bG(d),u_inv_matrix:new n.bG(d),u_camera_to_center_distance:new n.bJ(d),u_viewport_size:new n.bH(d)}),debug:d=>({u_color:new n.cu(d),u_matrix:new n.bG(d),u_overlay:new n.bK(d),u_overlay_scale:new n.bJ(d)}),clippingMask:d=>({u_matrix:new n.bG(d)}),heatmap:d=>({u_extrude_scale:new n.bJ(d),u_intensity:new n.bJ(d),u_matrix:new n.bG(d),u_inv_rot_matrix:new n.bG(d),u_merc_center:new n.bH(d),u_tile_id:new n.bI(d),u_zoom_transition:new n.bJ(d),u_up_dir:new n.bI(d)}),heatmapTexture:d=>({u_image:new n.bK(d),u_color_ramp:new n.bK(d),u_opacity:new n.bJ(d)}),hillshade:d=>({u_matrix:new n.bG(d),u_image:new n.bK(d),u_latrange:new n.bH(d),u_light:new n.bH(d),u_shadow:new n.cu(d),u_highlight:new n.cu(d),u_emissive_strength:new n.bJ(d),u_accent:new n.cu(d)}),hillshadePrepare:d=>({u_matrix:new n.bG(d),u_image:new n.bK(d),u_dimension:new n.bH(d),u_zoom:new n.bJ(d)}),line:n.cO,linePattern:n.cP,raster:d=>({u_matrix:new n.bG(d),u_normalize_matrix:new n.bG(d),u_globe_matrix:new n.bG(d),u_merc_matrix:new n.bG(d),u_grid_matrix:new n.cv(d),u_tl_parent:new n.bH(d),u_scale_parent:new n.bJ(d),u_fade_t:new n.bJ(d),u_opacity:new n.bJ(d),u_image0:new n.bK(d),u_image1:new n.bK(d),u_brightness_low:new n.bJ(d),u_brightness_high:new n.bJ(d),u_saturation_factor:new n.bJ(d),u_contrast_factor:new n.bJ(d),u_spin_weights:new n.bI(d),u_perspective_transform:new n.bH(d),u_raster_elevation:new n.bJ(d),u_zoom_transition:new n.bJ(d),u_merc_center:new n.bH(d),u_cutoff_params:new n.c7(d),u_colorization_mix:new n.c7(d),u_colorization_offset:new n.bJ(d),u_color_ramp:new n.bK(d),u_texture_offset:new n.bH(d),u_texture_res:new n.bH(d),u_emissive_strength:new n.bJ(d)}),rasterParticle:d=>({u_matrix:new n.bG(d),u_normalize_matrix:new n.bG(d),u_globe_matrix:new n.bG(d),u_merc_matrix:new n.bG(d),u_grid_matrix:new n.cv(d),u_tl_parent:new n.bH(d),u_scale_parent:new n.bJ(d),u_fade_t:new n.bJ(d),u_opacity:new n.bJ(d),u_image0:new n.bK(d),u_image1:new n.bK(d),u_raster_elevation:new n.bJ(d),u_zoom_transition:new n.bJ(d),u_merc_center:new n.bH(d),u_cutoff_params:new n.c7(d)}),rasterParticleTexture:d=>({u_texture:new n.bK(d),u_opacity:new n.bJ(d)}),rasterParticleDraw:d=>({u_particle_texture:new n.bK(d),u_particle_texture_side_len:new n.bJ(d),u_tile_offset:new n.bH(d),u_velocity:new n.bK(d),u_color_ramp:new n.bK(d),u_velocity_res:new n.bH(d),u_max_speed:new n.bJ(d),u_uv_offset:new n.bH(d),u_data_scale:new n.bH(d),u_data_offset:new n.bJ(d),u_particle_pos_scale:new n.bJ(d),u_particle_pos_offset:new n.bH(d)}),rasterParticleUpdate:d=>({u_particle_texture:new n.bK(d),u_particle_texture_side_len:new n.bJ(d),u_velocity:new n.bK(d),u_velocity_res:new n.bH(d),u_max_speed:new n.bJ(d),u_speed_factor:new n.bJ(d),u_reset_rate:new n.bJ(d),u_rand_seed:new n.bJ(d),u_uv_offset:new n.bH(d),u_data_scale:new n.bH(d),u_data_offset:new n.bJ(d),u_particle_pos_scale:new n.bJ(d),u_particle_pos_offset:new n.bH(d)}),symbol:d=>({u_is_size_zoom_constant:new n.bK(d),u_is_size_feature_constant:new n.bK(d),u_size_t:new n.bJ(d),u_size:new n.bJ(d),u_camera_to_center_distance:new n.bJ(d),u_rotate_symbol:new n.bK(d),u_aspect_ratio:new n.bJ(d),u_fade_change:new n.bJ(d),u_matrix:new n.bG(d),u_label_plane_matrix:new n.bG(d),u_coord_matrix:new n.bG(d),u_is_text:new n.bK(d),u_elevation_from_sea:new n.bK(d),u_pitch_with_map:new n.bK(d),u_texsize:new n.bH(d),u_texsize_icon:new n.bH(d),u_texture:new n.bK(d),u_texture_icon:new n.bK(d),u_gamma_scale:new n.bJ(d),u_device_pixel_ratio:new n.bJ(d),u_tile_id:new n.bI(d),u_zoom_transition:new n.bJ(d),u_inv_rot_matrix:new n.bG(d),u_merc_center:new n.bH(d),u_camera_forward:new n.bI(d),u_tile_matrix:new n.bG(d),u_up_vector:new n.bI(d),u_ecef_origin:new n.bI(d),u_is_halo:new n.bK(d),u_icon_transition:new n.bJ(d),u_color_adj_mat:new n.bG(d),u_scale_factor:new n.bJ(d)}),background:d=>({u_matrix:new n.bG(d),u_emissive_strength:new n.bJ(d),u_opacity:new n.bJ(d),u_color:new n.cu(d)}),backgroundPattern:d=>({u_matrix:new n.bG(d),u_emissive_strength:new n.bJ(d),u_opacity:new n.bJ(d),u_image:new n.bK(d),u_pattern_tl:new n.bH(d),u_pattern_br:new n.bH(d),u_texsize:new n.bH(d),u_pattern_size:new n.bH(d),u_pixel_coord_upper:new n.bH(d),u_pixel_coord_lower:new n.bH(d),u_pattern_units_to_pixels:new n.bH(d)}),terrainRaster:d=>({u_matrix:new n.bG(d),u_image0:new n.bK(d),u_skirt_height:new n.bJ(d),u_ground_shadow_factor:new n.bI(d)}),skybox:d=>({u_matrix:new n.bG(d),u_sun_direction:new n.bI(d),u_cubemap:new n.bK(d),u_opacity:new n.bJ(d),u_temporal_offset:new n.bJ(d)}),skyboxGradient:d=>({u_matrix:new n.bG(d),u_color_ramp:new n.bK(d),u_center_direction:new n.bI(d),u_radius:new n.bJ(d),u_opacity:new n.bJ(d),u_temporal_offset:new n.bJ(d)}),skyboxCapture:d=>({u_matrix_3f:new n.cv(d),u_sun_direction:new n.bI(d),u_sun_intensity:new n.bJ(d),u_color_tint_r:new n.c7(d),u_color_tint_m:new n.c7(d),u_luminance:new n.bJ(d)}),globeRaster:d=>({u_proj_matrix:new n.bG(d),u_globe_matrix:new n.bG(d),u_normalize_matrix:new n.bG(d),u_merc_matrix:new n.bG(d),u_zoom_transition:new n.bJ(d),u_merc_center:new n.bH(d),u_image0:new n.bK(d),u_grid_matrix:new n.cv(d),u_skirt_height:new n.bJ(d),u_far_z_cutoff:new n.bJ(d),u_frustum_tl:new n.bI(d),u_frustum_tr:new n.bI(d),u_frustum_br:new n.bI(d),u_frustum_bl:new n.bI(d),u_globe_pos:new n.bI(d),u_globe_radius:new n.bJ(d),u_viewport:new n.bH(d)}),globeAtmosphere:d=>({u_frustum_tl:new n.bI(d),u_frustum_tr:new n.bI(d),u_frustum_br:new n.bI(d),u_frustum_bl:new n.bI(d),u_horizon:new n.bJ(d),u_transition:new n.bJ(d),u_fadeout_range:new n.bJ(d),u_color:new n.c7(d),u_high_color:new n.c7(d),u_space_color:new n.c7(d),u_temporal_offset:new n.bJ(d),u_horizon_angle:new n.bJ(d)}),model:d=>({u_matrix:new n.bG(d),u_lighting_matrix:new n.bG(d),u_normal_matrix:new n.bG(d),u_node_matrix:new n.bG(d),u_lightpos:new n.bI(d),u_lightintensity:new n.bJ(d),u_lightcolor:new n.bI(d),u_camera_pos:new n.bI(d),u_opacity:new n.bJ(d),u_baseColorFactor:new n.c7(d),u_emissiveFactor:new n.c7(d),u_metallicFactor:new n.bJ(d),u_roughnessFactor:new n.bJ(d),u_baseTextureIsAlpha:new n.bK(d),u_alphaMask:new n.bK(d),u_alphaCutoff:new n.bJ(d),u_baseColorTexture:new n.bK(d),u_metallicRoughnessTexture:new n.bK(d),u_normalTexture:new n.bK(d),u_occlusionTexture:new n.bK(d),u_emissionTexture:new n.bK(d),u_lutTexture:new n.bK(d),u_color_mix:new n.c7(d),u_aoIntensity:new n.bJ(d),u_emissive_strength:new n.bJ(d),u_occlusionTextureTransform:new n.c7(d)}),modelDepth:d=>({u_matrix:new n.bG(d),u_instance:new n.bG(d),u_node_matrix:new n.bG(d)}),groundShadow:d=>({u_matrix:new n.bG(d),u_ground_shadow_factor:new n.bI(d)}),stars:d=>({u_matrix:new n.bG(d),u_up:new n.bI(d),u_right:new n.bI(d),u_intensity_multiplier:new n.bJ(d)}),snowParticle:d=>({u_modelview:new n.bG(d),u_projection:new n.bG(d),u_time:new n.bJ(d),u_cam_pos:new n.bI(d),u_velocityConeAperture:new n.bJ(d),u_velocity:new n.bJ(d),u_horizontalOscillationRadius:new n.bJ(d),u_horizontalOscillationRate:new n.bJ(d),u_boxSize:new n.bJ(d),u_billboardSize:new n.bJ(d),u_simpleShapeParameters:new n.bH(d),u_screenSize:new n.bH(d),u_thinningCenterPos:new n.bH(d),u_thinningShape:new n.bI(d),u_thinningAffectedRatio:new n.bJ(d),u_thinningParticleOffset:new n.bJ(d),u_particleColor:new n.c7(d),u_direction:new n.bI(d)}),rainParticle:d=>({u_modelview:new n.bG(d),u_projection:new n.bG(d),u_time:new n.bJ(d),u_cam_pos:new n.bI(d),u_texScreen:new n.bK(d),u_velocityConeAperture:new n.bJ(d),u_velocity:new n.bJ(d),u_boxSize:new n.bJ(d),u_rainDropletSize:new n.bH(d),u_distortionStrength:new n.bJ(d),u_rainDirection:new n.bI(d),u_color:new n.c7(d),u_screenSize:new n.bH(d),u_thinningCenterPos:new n.bH(d),u_thinningShape:new n.bI(d),u_thinningAffectedRatio:new n.bJ(d),u_thinningParticleOffset:new n.bJ(d),u_shapeDirectionalPower:new n.bJ(d),u_mode:new n.bJ(d)}),occlusion:d=>({u_matrix:new n.bG(d),u_anchorPos:new n.bI(d),u_screenSizePx:new n.bH(d),u_occluderSizePx:new n.bH(d),u_color:new n.c7(d)})},Js=(()=>{class d{constructor(o,h,g,y){this.id=d.uniqueIdxCounter,d.uniqueIdxCounter++,this.context=o;let b=o.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=d.uniqueIdxCounter,d.uniqueIdxCounter++;let h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return d.uniqueIdxCounter=0,d})(),Et={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _p{constructor(t,o,h,g,y,b){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=g,this.instanceCount=b,this.context=t;let I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let h=0;h<this.attributes.length;h++){let g=o.attributes[this.attributes[h].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,o,h){for(let g=0;g<this.attributes.length;g++){let y=this.attributes[g],b=o.attributes[y.name];b!==void 0&&t.vertexAttribPointer(b,y.components,t[Et[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,o,h){for(let g=0;g<this.attributes.length;g++){let y=o.attributes[this.attributes[g].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class h_{constructor(t,o,h,g,y){this.context=t,this.width=o,this.height=h;let b=this.framebuffer=t.gl.createFramebuffer();g&&(this.colorAttachment=new Ld(t,b)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new ip(t,b):new n_(t,b))}destroy(){let t=this.context.gl;if(this.colorAttachment){let o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{let o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class Cx{constructor(t,o){this.gl=t,this.clearColor=new Wf(this),this.clearDepth=new Zg(this),this.clearStencil=new Zf(this),this.colorMask=new Ad(this),this.depthMask=new iu(this),this.stencilMask=new Xg(this),this.stencilFunc=new Yg(this),this.stencilOp=new Jg(this),this.stencilTest=new kl(this),this.depthRange=new Kg(this),this.depthTest=new mx(this),this.depthFunc=new gx(this),this.blend=new _x(this),this.blendFunc=new Xf(this),this.blendColor=new Yf(this),this.blendEquation=new Jf(this),this.cullFace=new Kf(this),this.cullFaceSide=new Qg(this),this.frontFace=new e_(this),this.program=new yx(this),this.activeTexture=new ru(this),this.viewport=new ou(this),this.bindFramebuffer=new t_(this),this.bindRenderbuffer=new Zr(this),this.bindTexture=new Qf(this),this.bindVertexBuffer=new Pd(this),this.bindElementBuffer=new Rd(this),this.bindVertexArrayOES=new ep(this),this.pixelStoreUnpack=new tp(this),this.pixelStoreUnpackPremultiplyAlpha=new Od(this),this.pixelStoreUnpackFlipY=new np(this),this.options=o?Mt({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,h){return new Js(this,t,o,h)}createVertexBuffer(t,o,h,g,y){return new _p(this,t,o,h,g,y)}createRenderbuffer(t,o,h){let g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,t,o,h),this.bindRenderbuffer.set(null),y}createFramebuffer(t,o,h,g){return new h_(this,t,o,h,g)}clear({color:t,depth:o,stencil:h,colorMask:g}){let y=this.gl,b=0;t&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(g||[!0,!0,!0,!0])),o!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),y.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bi(t.blendFunction,fn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let jl;function yp(d,t,o,h,g,y,b){let I=d.context,A=I.gl,O=d.transform,P=d.getOrCreateProgram("collisionBox"),k=[],z=0,j=0;for(let re=0;re<h.length;re++){let ae=h[re],de=t.getTile(ae),le=de.getBucket(o);if(!le)continue;let he=Fg(ae,le,O),_e=he;g[0]===0&&g[1]===0||(_e=d.translatePosMatrix(he,de,g,y));let we=b?le.textCollisionBox:le.iconCollisionBox,ve=le.collisionCircleArray;if(ve.length>0){let ye=n.a6.mat4.create(),Fe=_e;n.a6.mat4.mul(ye,le.placementInvProjMatrix,O.glCoordMatrix),n.a6.mat4.mul(ye,ye,le.placementViewportMatrix),k.push({circleArray:ve,circleOffset:j,transform:Fe,invTransform:ye,projection:le.getProjection()}),z+=ve.length/4,j=z}we&&(d.terrain&&d.terrain.setupElevationDraw(de,P),P.draw(d,A.LINES,Rt.disabled,Yt.disabled,d.colorModeForRenderPass(),jt.disabled,bx(_e,O,de,le.getProjection()),o.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,O.zoom,null,[we.collisionVertexBuffer,we.collisionVertexBufferExt]))}if(!b||!k.length)return;let W=d.getOrCreateProgram("collisionCircle"),q=new n.cQ;q.resize(4*z),q._trim();let X=0;for(let re of k)for(let ae=0;ae<re.circleArray.length/4;ae++){let de=4*ae,le=re.circleArray[de+0],he=re.circleArray[de+1],_e=re.circleArray[de+2],we=re.circleArray[de+3];q.emplace(X++,le,he,_e,we,0),q.emplace(X++,le,he,_e,we,1),q.emplace(X++,le,he,_e,we,2),q.emplace(X++,le,he,_e,we,3)}(!jl||jl.length<2*z)&&(jl=function(re){let ae=2*re,de=new n.aP;de.resize(ae),de._trim();for(let le=0;le<ae;le++){let he=6*le;de.uint16[he+0]=4*le+0,de.uint16[he+1]=4*le+1,de.uint16[he+2]=4*le+2,de.uint16[he+3]=4*le+2,de.uint16[he+4]=4*le+3,de.uint16[he+5]=4*le+0}return de}(z));let Z=I.createIndexBuffer(jl,!0),Q=I.createVertexBuffer(q,n.cR.members,!0);for(let re of k){let ae={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ie=O).getCameraToCenterDistance(re.projection),u_viewport_size:[ie.width,ie.height]};W.draw(d,A.TRIANGLES,Rt.disabled,Yt.disabled,d.colorModeForRenderPass(),jt.disabled,ae,o.id,Q,Z,n.b2.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,O.zoom)}var ie;Q.destroy(),Z.destroy()}let du=n.a6.mat4.create();function f_(d){let t=d._camera.getWorldToCamera(d.worldSize,1),o=n.a6.mat4.multiply([],t,d.globeMatrix);n.a6.mat4.invert(o,o);let h=[0,0,0],g=[0,1,0,0];return n.a6.vec4.transformMat4(g,g,o),h[0]=g[0],h[1]=g[1],h[2]=g[2],n.a6.vec3.normalize(h,h),h}function Ex({width:d,height:t,anchor:o,textOffset:h,textScale:g},y){let{horizontalAlign:b,verticalAlign:I}=n.by(o),A=-(b-.5)*d,O=-(I-.5)*t,P=n.bx(o,h);return new n.P((A/g+P[0])*y,(O/g+P[1])*y)}function vp(d,t,o,h,g,y,b,I,A,O,P){let k=d.text.placedSymbolArray,z=d.text.dynamicLayoutVertexArray,j=d.icon.dynamicLayoutVertexArray,W={},q=d.getProjection(),X=Ws(I,q,y),Z=y.elevation,Q=q.upVectorScale(I.canonical,y.center.lat,y.worldSize).metersToTile;z.clear();for(let ie=0;ie<k.length;ie++){let re=k.get(ie),{tileAnchorX:ae,tileAnchorY:de,numGlyphs:le}=re,he=re.hidden||!re.crossTileID||d.allowVerticalPlacement&&!re.placedOrientation?null:h[re.crossTileID];if(he){let _e=0,we=0,ve=0;if(Z){let Ne=Z?Z.getAtTileOffset(I,ae,de):0,[Xe,Ke,We]=q.upVector(I.canonical,ae,de);_e=Ne*Xe*Q,we=Ne*Ke*Q,ve=Ne*We*Q}let[ye,Fe,Ue,Je]=mr(re.projectedAnchorX+_e,re.projectedAnchorY+we,re.projectedAnchorZ+ve,o?X:b),nt=En(y.getCameraToCenterDistance(q),Je),st=g.evaluateSizeForFeature(d.textSizeData,O,re)*nt/n.br;o&&(st*=d.tilePixelRatio/A);let Ie=Ex(he,st);o?({x:ye,y:Fe,z:Ue}=q.projectTilePoint(ae+Ie.x,de+Ie.y,I.canonical),[ye,Fe,Ue]=mr(ye+_e,Fe+we,Ue+ve,b)):(t&&Ie._rotate(-y.angle),ye+=Ie.x,Fe+=Ie.y,Ue=0);let Ze=d.allowVerticalPlacement&&re.placedOrientation===n.bl.vertical?Math.PI/2:0;for(let Ne=0;Ne<le;Ne++)n.bo(z,ye,Fe,Ue,Ze);P&&re.associatedIconIndex>=0&&(W[re.associatedIconIndex]={x:ye,y:Fe,z:Ue,angle:Ze})}else Go(le,z)}if(P){j.clear();let ie=d.icon.placedSymbolArray;for(let re=0;re<ie.length;re++){let ae=ie.get(re),{numGlyphs:de}=ae,le=W[re];if(ae.hidden||!le)Go(de,j);else{let{x:he,y:_e,z:we,angle:ve}=le;for(let ye=0;ye<de;ye++)n.bo(j,he,_e,we,ve)}}d.icon.dynamicLayoutVertexBuffer.updateData(j)}d.text.dynamicLayoutVertexBuffer.updateData(z)}function hu(d,t,o,h,g,y,b={}){let I=o.paint.get("icon-translate"),A=o.paint.get("text-translate"),O=o.paint.get("icon-translate-anchor"),P=o.paint.get("text-translate-anchor"),k=o.layout.get("icon-rotation-alignment"),z=o.layout.get("text-rotation-alignment"),j=o.layout.get("icon-pitch-alignment"),W=o.layout.get("text-pitch-alignment"),q=o.layout.get("icon-keep-upright"),X=o.layout.get("text-keep-upright"),Z=o.paint.get("icon-color-saturation"),Q=o.paint.get("icon-color-contrast"),ie=o.paint.get("icon-color-brightness-min"),re=o.paint.get("icon-color-brightness-max"),ae=o.layout.get("symbol-elevation-reference")==="sea",de=d.context,le=de.gl,he=d.transform,_e=k==="map",we=z==="map",ve=j==="map",ye=W==="map",Fe=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ue=!1,Je=d.depthModeForSublayer(0,Rt.ReadOnly),nt=[n.am(he.center.lng),n.at(he.center.lat)],st=o.layout.get("text-variable-anchor"),Ie=he.projection.name==="globe",Ze=[],Ne=[0,-1,0];for(let Xe of h){let Ke=t.getTile(Xe),We=Ke.getBucket(o);if(!We||We.projection.name==="mercator"&&Ie||We.fullyClipped)continue;let ut=We.projection.name==="globe",bt=ut?n.a9(he.zoom):0,It=Ws(Xe,We.getProjection(),he),_t=he.calculatePixelsToTileUnitsMatrix(Ke),At=st&&We.hasTextData(),ht=We.hasIconTextFit()&&At&&We.hasIconData(),Lt=We.getProjection().createInversionMatrix(he,Xe.canonical),Kt=Gn=>{he.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||d.terrain)&&(Gn.push("DEPTH_D24"),Gn.push("DEPTH_OCCLUSION"))},mn=()=>{let Gn=_e&&o.layout.get("symbol-placement")!=="point",Fn=[];Kt(Fn);let ui=Gn||ht,Vi=o.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&ve&&Fn.push("PITCH_WITH_MAP_TERRAIN"),ut&&(Fn.push("PROJECTION_GLOBE_VIEW"),ui&&Fn.push("PROJECTED_POS_ON_VIEWPORT")),Vi>0&&Fn.push("ICON_TRANSITION"),We.icon.zOffsetVertexBuffer&&Fn.push("Z_OFFSET"),Z===0&&Q===0&&ie===0&&re===1||Fn.push("COLOR_ADJUSTMENT"),We.sdfIcons&&Fn.push("RENDER_SDF");let Jr=We.icon.programConfigurations.get(o.id),uo=d.getOrCreateProgram("symbol",{config:Jr,defines:Fn}),Gi=Ke.imageAtlasTexture?Ke.imageAtlasTexture.size:[0,0],Cn=We.iconSizeData,gn=n.bk(Cn,he.zoom),Pn=ve||he.pitch!==0,ni=bn(It,Ke.tileID.canonical,ve,_e,he,We.getProjection(),_t),Si=Pr(It,Ke.tileID.canonical,ve,_e,he,We.getProjection(),_t),di=d.translatePosMatrix(Si,Ke,I,O,!0),Yi=d.translatePosMatrix(It,Ke,I,O),Zo=ui?du:ni,Or=_e&&!ve&&!Gn,Lr=Ne;!Ie&&!he.mercatorFromTransition||_e||(Lr=f_(he));let ho=ut?Lr:Ne,Ro=o.getColorAdjustmentMatrix(Z,Q,ie,re),Fr=d_(Cn.kind,gn,Or,ve,d,Yi,Zo,di,ae,!1,Gi,[0,0],!0,Xe,bt,nt,Lt,ho,We.getProjection(),Ro,Vi),Ts=Ke.imageAtlasTexture?Ke.imageAtlasTexture:null,fo=o.layout.get("icon-size").constantOr(0)!==1||We.iconsNeedLinear,Bn=We.sdfIcons||d.options.rotating||d.options.zooming||fo||Pn?le.LINEAR:le.NEAREST,Ql=We.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Up=d.terrain&&ve&&Gn?n.a6.mat4.invert(n.a6.mat4.create(),ni):du;if(Gn&&We.icon){let ec=he.elevation,$p=ec?ec.getAtTileOffsetFunc(Xe,he.center.lat,he.worldSize,We.getProjection()):null,Mu=wn(It,Ke.tileID.canonical,ve,_e,he,We.getProjection(),_t);bl(We,It,d,!1,Mu,Si,ve,q,$p,Xe)}return{program:uo,buffers:We.icon,uniformValues:Fr,atlasTexture:Ts,atlasTextureIcon:null,atlasInterpolation:Bn,atlasInterpolationIcon:null,isSDF:We.sdfIcons,hasHalo:Ql,tile:Ke,labelPlaneMatrixInv:Up}},Kn=()=>{let Gn=we&&o.layout.get("symbol-placement")!=="point",Fn=[],ui=Gn||st||ht;d.terrainRenderModeElevated()&&ye&&Fn.push("PITCH_WITH_MAP_TERRAIN"),ut&&(Fn.push("PROJECTION_GLOBE_VIEW"),ui&&Fn.push("PROJECTED_POS_ON_VIEWPORT")),We.text.zOffsetVertexBuffer&&Fn.push("Z_OFFSET"),We.iconsInText&&Fn.push("RENDER_TEXT_AND_SYMBOL"),Fn.push("RENDER_SDF"),Kt(Fn);let Vi=We.text.programConfigurations.get(o.id),Jr=d.getOrCreateProgram("symbol",{config:Vi,defines:Fn}),uo,Gi=[0,0],Cn=null,gn=We.textSizeData;We.iconsInText&&(Gi=Ke.imageAtlasTexture?Ke.imageAtlasTexture.size:[0,0],Cn=Ke.imageAtlasTexture?Ke.imageAtlasTexture:null,uo=ye||he.pitch!==0||d.options.rotating||d.options.zooming||gn.kind==="composite"||gn.kind==="camera"?le.LINEAR:le.NEAREST);let Pn=Ke.glyphAtlasTexture?Ke.glyphAtlasTexture.size:[0,0],ni=o.layout.get("text-size-scale-range"),Si=n.ap(d.scaleFactor,ni[0],ni[1]),di=n.bk(gn,he.zoom,Si),Yi=bn(It,Ke.tileID.canonical,ye,we,he,We.getProjection(),_t),Zo=Pr(It,Ke.tileID.canonical,ye,we,he,We.getProjection(),_t),Or=d.translatePosMatrix(Zo,Ke,A,P,!0),Lr=d.translatePosMatrix(It,Ke,A,P),ho=ui?du:Yi,Ro=we&&!ye&&!Gn,Fr=Ne;!Ie&&!he.mercatorFromTransition||we||(Fr=f_(he));let Ts=d_(gn.kind,di,Ro,ye,d,Lr,ho,Or,ae,!0,Pn,Gi,!0,Xe,bt,nt,Lt,ut?Fr:Ne,We.getProjection(),null,null,Si),fo=Ke.glyphAtlasTexture?Ke.glyphAtlasTexture:null,Bn=le.LINEAR,Ql=o.paint.get("text-halo-width").constantOr(1)!==0,Up=d.terrain&&ye&&Gn?n.a6.mat4.invert(n.a6.mat4.create(),Yi):du;if(Gn&&We.text){let ec=he.elevation,$p=ec?ec.getAtTileOffsetFunc(Xe,he.center.lat,he.worldSize,We.getProjection()):null,Mu=wn(It,Ke.tileID.canonical,ye,we,he,We.getProjection(),_t);bl(We,It,d,!0,Mu,Zo,ye,X,$p,Xe)}return{program:Jr,buffers:We.text,uniformValues:Ts,atlasTexture:fo,atlasTextureIcon:Cn,atlasInterpolation:Bn,atlasInterpolationIcon:uo,isSDF:!0,hasHalo:Ql,tile:Ke,labelPlaneMatrixInv:Up}},Mn=We.icon.segments.get().length,ri=We.text.segments.get().length,An=Mn&&!b.onlyText?mn():null,Qn=ri&&!b.onlyIcons?Kn():null,un=o.paint.get("icon-opacity").constantOr(1),Xn=o.paint.get("text-opacity").constantOr(1);if(Fe&&We.canOverlap){Ue=!0;let Gn=un&&!b.onlyText?We.icon.segments.get():[],Fn=Xn&&!b.onlyIcons?We.text.segments.get():[];for(let ui of Gn)Ze.push({segments:new n.b2([ui]),sortKey:ui.sortKey,state:An});for(let ui of Fn)Ze.push({segments:new n.b2([ui]),sortKey:ui.sortKey,state:Qn})}else b.onlyText||Ze.push({segments:un?We.icon.segments:new n.b2([]),sortKey:0,state:An}),b.onlyIcons||Ze.push({segments:Xn?We.text.segments:new n.b2([]),sortKey:0,state:Qn})}Ue&&Ze.sort((Xe,Ke)=>Xe.sortKey-Ke.sortKey);for(let Xe of Ze){let Ke=Xe.state;if(Ke)if(d.terrain?d.terrain.setupElevationDraw(Ke.tile,Ke.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ke.labelPlaneMatrixInv}):d.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,Ke.program),de.activeTexture.set(le.TEXTURE0),Ke.atlasTexture&&Ke.atlasTexture.bind(Ke.atlasInterpolation,le.CLAMP_TO_EDGE,!0),Ke.atlasTextureIcon&&(de.activeTexture.set(le.TEXTURE1),Ke.atlasTextureIcon&&Ke.atlasTextureIcon.bind(Ke.atlasInterpolationIcon,le.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,Ke.program),Ke.hasHalo){let We=Ke.uniformValues;We.u_is_halo=1,fu(Ke.buffers,Xe.segments,o,d,Ke.program,Je,g,y,We,2),We.u_is_halo=0}else{if(Ke.isSDF){let We=Ke.uniformValues;Ke.hasHalo&&(We.u_is_halo=1,fu(Ke.buffers,Xe.segments,o,d,Ke.program,Je,g,y,We,1)),We.u_is_halo=0}fu(Ke.buffers,Xe.segments,o,d,Ke.program,Je,g,y,Ke.uniformValues,1)}}}function fu(d,t,o,h,g,y,b,I,A,O){let P=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];g.draw(h,h.context.gl.TRIANGLES,y,b,I,jt.disabled,A,o.id,d.layoutVertexBuffer,d.indexBuffer,t,o.paint,h.transform.zoom,d.programConfigurations.get(o.id),P,O)}function Ud(d,t,o,h,g,y,b){let I=d.context.gl,A=o.paint.get("fill-pattern"),O=o.is3D(),P=O?d.stencilModeFor3D():Yt.disabled,k=A&&A.constantOr(1),z,j,W,q,X;b?(j=k&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=I.LINES):(j=k?"fillPattern":"fill",z=I.TRIANGLES);for(let Z of h){let Q=t.getTile(Z);if(k&&!Q.patternsLoaded())continue;let ie=Q.getBucket(o);if(!ie)continue;d.prepareDrawTile();let re=ie.programConfigurations.get(o.id),ae=d.isTileAffectedByFog(Z),de=d.getOrCreateProgram(j,{config:re,overrideFog:ae});k&&(d.context.activeTexture.set(I.TEXTURE0),Q.imageAtlasTexture&&Q.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),re.updatePaintBuffers());let le=A.constantOr(null);if(le&&Q.imageAtlas){let we=Q.imageAtlas.patternPositions[le.toString()];we&&re.setConstantPatternPositions(we)}let he=d.translatePosMatrix(Z.projMatrix,Q,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),_e=o.paint.get("fill-emissive-strength");if(b){q=ie.indexBuffer2,X=ie.segments2;let we=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];W=j==="fillOutlinePattern"&&k?xx(he,_e,d,Q,we):lu(he,_e,we)}else q=ie.indexBuffer,X=ie.segments,W=k?dp(he,_e,d,Q):u_(he,_e);d.uploadCommonUniforms(d.context,de,Z.toUnwrapped()),de.draw(d,z,g,O?P:d.stencilModeForClipping(Z),y,jt.disabled,W,o.id,ie.layoutVertexBuffer,q,X,o.paint,d.transform.zoom,re,void 0)}}function lr(d,t,o,h,g,y,b,I){o.resetLayerRenderingStats(d);let A=d.context,O=A.gl,P=d.transform,k=o.paint.get("fill-extrusion-pattern"),z=k.constantOr(1),j=o.paint.get("fill-extrusion-opacity"),W=d.style.enable3dLights(),q=o.paint.get(W&&!z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],Z=o.layout.get("fill-extrusion-edge-radius"),Q=Z>0&&!o.paint.get("fill-extrusion-rounded-roof"),ie=Q?0:Z,re=P.projection.name==="globe"?n.c_():0,ae=P.projection.name==="globe",de=ae?n.a9(P.zoom):0,le=[n.am(P.center.lng),n.at(P.center.lat)],he=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(o.lut).toArray01().slice(0,3),_e=o.paint.get("fill-extrusion-flood-light-intensity"),we=o.paint.get("fill-extrusion-vertical-scale"),ve=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ye=o.paint.get("fill-extrusion-height-alignment"),Fe=o.paint.get("fill-extrusion-base-alignment"),Ue=_s(d,o.paint.get("fill-extrusion-cutoff-fade-range")),Je=[],nt;ae&&Je.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&Je.push("FAUX_AO"),Q&&Je.push("ZERO_ROOF_RADIUS"),I&&Je.push("HAS_CENTROID"),_e>0&&Je.push("FLOOD_LIGHT"),Ue.shouldRenderCutoff&&Je.push("RENDER_CUTOFF"),ve&&Je.push("RENDER_WALL_MODE");let st=d.renderPass==="shadow",Ie=d.shadowRenderer,Ze=st&&!!Ie;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let Ne=[0,0,0];if(Ie){let We=d.style.directionalLight,ut=d.style.ambientLight;We&&ut&&(Ne=Cd(d.style,We,ut)),st||(Je.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ie.useNormalOffset&&Je.push("NORMAL_OFFSET")),nt=Je.concat(["SHADOWS_SINGLE_CASCADE"])}let Xe=Ze?"fillExtrusionDepth":z?"fillExtrusionPattern":"fillExtrusion",Ke=o.getLayerRenderingStats();for(let We of h){let ut=t.getTile(We),bt=ut.getBucket(o);if(!bt||bt.projection.name!==P.projection.name)continue;let It=!1;Ie&&(It=Ie.getMaxCascadeForTile(We.toUnwrapped())===0);let _t=d.isTileAffectedByFog(We),At=bt.programConfigurations.get(o.id),ht=d.getOrCreateProgram(Xe,{config:At,defines:It?nt:Je,overrideFog:_t});if(d.terrain&&d.terrain.setupElevationDraw(ut,ht,{useMeterToDem:!0}),!bt.centroidVertexBuffer){let An=ht.attributes.a_centroid_pos;An!==void 0&&O.vertexAttrib2f(An,0,0)}!st&&Ie&&Ie.setupShadows(ut.tileID.toUnwrapped(),ht,"vector-tile",ut.tileID.overscaledZ),z&&(d.context.activeTexture.set(O.TEXTURE0),ut.imageAtlasTexture&&ut.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),At.updatePaintBuffers());let Lt=k.constantOr(null);if(Lt&&ut.imageAtlas){let An=ut.imageAtlas.patternPositions[Lt.toString()];An&&At.setConstantPatternPositions(An)}let Kt=o.paint.get("fill-extrusion-vertical-gradient"),mn=1/bt.tileToMeter,Kn;if(st&&Ie){if(m_(ut.tileID,bt,d))continue;let An=Ie.calculateShadowPassMatrixFromTile(ut.tileID.toUnwrapped());Kn=cp(An,ie,mn,we,ye,Fe)}else{let An=d.translatePosMatrix(We.expandedProjMatrix,ut,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Qn=P.projection.createInversionMatrix(P,We.canonical);Kn=z?up(An,d,Kt,j,X,ie,mn,We,ut,re,ye,Fe,de,le,Qn,he,we):lp(An,d,Kt,j,X,ie,mn,We,re,ye,Fe,de,le,Qn,he,we,_e,Ne)}d.uploadCommonUniforms(A,ht,We.toUnwrapped(),null,Ue);let Mn=bt.segments;if(P.projection.name==="mercator"&&!st&&(Mn=bt.getVisibleSegments(ut.tileID,d.terrain,d.transform.getFrustum(0)),!Mn.get().length))continue;if(Ke)if(st)for(let An of Mn.get())Ke.numRenderedVerticesInShadowPass+=An.primitiveLength;else for(let An of Mn.get())Ke.numRenderedVerticesInTransparentPass+=An.primitiveLength;let ri=[];(d.terrain||I)&&ri.push(bt.centroidVertexBuffer),ae&&ri.push(bt.layoutVertexExtBuffer),ve&&ri.push(bt.wallVertexBuffer),ht.draw(d,A.gl.TRIANGLES,g,y,b,jt.backCCW,Kn,o.id,bt.layoutVertexBuffer,bt.indexBuffer,Mn,o.paint,d.transform.zoom,At,ri)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function Xr(d,t,o,h,g,y,b,I,A,O,P,k,z,j,W,q,X,Z,Q){let ie=d.context,re=ie.gl,ae=d.transform,de=d.transform.zoom,le=[],he=_s(d,o.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(le.push("CLEAR_SUBPASS"),Q&&(le.push("CLEAR_FROM_TEXTURE"),ie.activeTexture.set(re.TEXTURE0),Q.bind(re.LINEAR,re.CLAMP_TO_EDGE))):O==="sdf"&&le.push("SDF_SUBPASS"),X&&le.push("HAS_CENTROID"),he.shouldRenderCutoff&&le.push("RENDER_CUTOFF");let _e=o.layout.get("fill-extrusion-edge-radius"),we=(ve,ye,Fe,Ue,Je)=>{let nt=ye.programConfigurations.get(o.id),st=d.isTileAffectedByFog(ve),Ie=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:nt,defines:le,overrideFog:st}),Ze=((Xe,Ke,We,ut,bt,It,_t,At,ht,Lt,Kt)=>({u_matrix:Ke,u_opacity:We,u_ao_pass:ut?1:0,u_meter_to_tile:bt,u_ao:It,u_flood_light_intensity:_t,u_flood_light_color:At,u_attenuation:ht,u_edge_radius:Lt,u_fb:0,u_fb_size:Kt,u_dynamic_offset:1}))(0,Ue,P,A,Je,[k,z*Je],j,W,q,de>=17?0:_e*Je,Q?Q.size[0]:0),Ne=[];X&&Ne.push(ye.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(ie,Ie,ve.toUnwrapped(),null,he),Ie.draw(d,ie.gl.TRIANGLES,g,y,b,I,Ze,o.id,ye.vertexBuffer,ye.indexBuffer,Fe,o.paint,de,nt,Ne)};for(let ve of h){let ye=t.getTile(ve),Fe=ye.getBucket(o);if(!Fe||Fe.projection.name!==ae.projection.name||!Fe.groundEffect||Fe.groundEffect&&!Fe.groundEffect.hasData())continue;let Ue=Fe.groundEffect,Je=1/Fe.tileToMeter;{let nt=d.translatePosMatrix(ve.projMatrix,ye,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),st=Ue.getDefaultSegment();we(ve,Ue,st,nt,Je)}if(Z)for(let nt=0;nt<4;nt++){let st=n.c$[nt](ve),Ie=t.getTile(st);if(!Ie)continue;let Ze=Ie.getBucket(o);if(!Ze||Ze.projection.name!==ae.projection.name||!Ze.groundEffect||Ze.groundEffect&&!Ze.groundEffect.hasData())continue;let Ne=Ze.groundEffect,Xe,Ke;nt===0?(Xe=[-n.ab,0,0],Ke=1):nt===1?(Xe=[n.ab,0,0],Ke=0):nt===2?(Xe=[0,-n.ab,0],Ke=3):(Xe=[0,n.ab,0],Ke=2);let We=Ne.regionSegments[Ke];if(!We)continue;let ut=new Float32Array(16);n.a6.mat4.translate(ut,ve.projMatrix,Xe),we(ve,Ne,We,d.translatePosMatrix(ut,ye,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Je)}}}function p_(d,t,o,h,g,y,b){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();let I=y?y.findDEMTileFor(o):null;if(!(I&&I.dem||b))return;let A=Z=>new n.P(Math.ceil((Z+n.d2)*n.d3),0),O=Z=>{let Q=t.getSource().minzoom,ie=ae=>{let de=t.getTileByID(ae);if(de&&de.hasData())return de.getBucket(g)},re=[0,-1,1];for(let ae of re){if(Z.overscaledZ+ae<Q)continue;let de=ie(Z.calculateScaledKey(Z.overscaledZ+ae));if(de)return de}},P=[0,0,0],k=(Z,Q)=>(P[0]=Math.min(Z.min.y,Q.min.y),P[1]=Math.max(Z.max.y,Q.max.y),P[2]=n.ab-Q.min.x>Z.max.x?Q.min.x-n.ab:Z.max.x,P),z=(Z,Q)=>(P[0]=Math.min(Z.min.x,Q.min.x),P[1]=Math.max(Z.max.x,Q.max.x),P[2]=n.ab-Q.min.y>Z.max.y?Q.min.y-n.ab:Z.max.y,P),j=[(Z,Q)=>k(Z,Q),(Z,Q)=>k(Q,Z),(Z,Q)=>z(Z,Q),(Z,Q)=>z(Q,Z)],W=(Z,Q,ie,re,ae,de,le)=>{if(!y)return 0;let he=[[de?ie:Z,de?Z:ie,0],[de?ie:Q,de?Q:ie,0]],_e=le<0?n.ab+le:le,we=[de?_e:(Z+Q)/2,de?(Z+Q)/2:_e,0];return ie===0&&le<0||ie!==0&&le>0?y.getForTilePoints(ae,[we],!0,re):he.push(we),y.getForTilePoints(o,he,!0,I),Math.max(he[0][2],he[1][2],we[2])/y.exaggeration()};for(let Z=0;Z<4;Z++){let Q=h.borderFeatureIndices[Z];if(Q.length===0)continue;let ie=n.c$[Z](o),re=O(ie);if(!(re&&re instanceof n.d0)||h.borderDoneWithNeighborZ[Z]===re.canonical.z)continue;re.centroidVertexArray.length===0&&re.createCentroidsBuffer();let ae=y?y.findDEMTileFor(ie):null;if(!(ae&&ae.dem||b))continue;let de=(Z<2?1:5)-Z,le=re.borderDoneWithNeighborZ[de]!==h.canonical.z,he=re.borderFeatureIndices[de],_e=0;if(h.canonical.z!==re.canonical.z){for(let we of Q)h.showCentroid(h.featuresOnBorder[we]);if(le)for(let we of he)re.showCentroid(re.featuresOnBorder[we]);h.borderDoneWithNeighborZ[Z]=re.canonical.z,re.borderDoneWithNeighborZ[de]=h.canonical.z}for(let we of Q){let ve=h.featuresOnBorder[we],ye=h.centroidData[ve.centroidDataIndex],Fe=ve.borders[Z],Ue;for(;_e<he.length;){Ue=re.featuresOnBorder[he[_e]];let Je=Ue.borders[de];if(Je[1]>Fe[0]+3||Je[0]>Fe[0]-3)break;re.showCentroid(Ue),_e++}if(Ue&&_e<he.length){let Je=_e,nt=0;for(;!(Ue.borders[de][0]>Fe[1]-3)&&(nt++,++_e!==he.length);)Ue=re.featuresOnBorder[he[_e]];Ue=re.featuresOnBorder[he[Je]];let st=!1;if(nt>=1){let Ne=Ue.borders[de];Math.abs(Fe[0]-Ne[0])<3&&Math.abs(Fe[1]-Ne[1])<3&&(nt=1,st=!0,_e=Je+1)}else if(nt===0){h.showCentroid(ve);continue}let Ie=re.centroidData[Ue.centroidDataIndex];b&&st&&(((q=ye).flags|(X=Ie).flags)&n.d1?(q.flags|=n.d1,X.flags|=n.d1):(q.flags&=~n.d1,X.flags&=~n.d1));let Ze=ve.intersectsCount()>1||Ue.intersectsCount()>1;if(nt>1)_e=Je,ye.centroidXY=Ie.centroidXY=new n.P(0,0);else if(ae&&ae.dem&&!Ze){let Ne=j[Z](ye,Ie),Xe=Z%2?n.ab-1:0,Ke=W(Ne[0],Math.min(n.ab-1,Ne[1]),Xe,ae,ie,Z<2,Ne[2]);ye.centroidXY=Ie.centroidXY=A(Ke)}else Ze?ye.centroidXY=Ie.centroidXY=new n.P(0,0):(ye.centroidXY=h.encodeBorderCentroid(ve),Ie.centroidXY=re.encodeBorderCentroid(Ue));h.writeCentroidToBuffer(ye),re.writeCentroidToBuffer(Ie)}else h.showCentroid(ve)}h.borderDoneWithNeighborZ[Z]=re.canonical.z,re.borderDoneWithNeighborZ[de]=h.canonical.z}var q,X;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(d)}let xp=[1,0,0],bp=[0,1,0],wp=[0,0,1];function m_(d,t,o){let h=o.transform,g=o.shadowRenderer;if(!g)return!0;let y=d.toUnwrapped(),b=h.tileSize*g._cascades[o.currentShadowCascade].scale,I=t.maxHeight;if(h.elevation){let q=h.elevation.getMinMaxForTile(d);q&&(I+=q.max)}let A=[...g.shadowDirection];A[2]=-A[2];let O=g.computeSimplifiedTileShadowVolume(y,I,b,A);if(!O)return!1;let P=[xp,bp,wp,A,[A[0],0,A[2]],[0,A[1],A[2]]],k=h.projection.name==="globe",z=h.scaleZoom(b),j=n.bO.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,z,!k),W=g.getCurrentCascadeFrustum();return j.intersectsPrecise(O.vertices,O.planes,P)===0||W.intersectsPrecise(O.vertices,O.planes,P)===0}function Yr(d){return[d[0]*n.d4,d[1]*n.d4,d[2]*n.d4,0]}function bi(d,t,o,h,g,y,b,I,A){let O=h.getSource(),P=o.globeSharedBuffers;if(!P)return;let k,z,j;if(t&&(k=h.getTile(t)),O instanceof n.aD?(z=O.texture,j=n.cD(0,0,o.transform)):k&&t&&(z=k.texture,j=n.cD(t.canonical.z,t.canonical.x,o.transform)),!z||!j)return;d||(j=n.a6.mat4.scale(n.a6.mat4.create(),j,[1,-1,1]));let W=o.context,q=W.gl,X=g.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR,Z=o.colorModeForDrapableLayerRenderPass(y),Q=b.defines;Q.push("GLOBE_POLES");let ie=new Rt(q.LEQUAL,Rt.ReadWrite,o.depthRangeFor3D),re=Float32Array.from(o.transform.expandedFarZProjMatrix),ae=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),W.activeTexture.set(q.TEXTURE0),z.bind(X,q.CLAMP_TO_EDGE),W.activeTexture.set(q.TEXTURE1),z.bind(X,q.CLAMP_TO_EDGE),z.useMipmap&&W.extTextureFilterAnisotropic&&o.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);let[de,le,he,_e]=t?P.getPoleBuffers(t.canonical.z,!1):P.getPoleBuffers(0,!0),we=g.paint.get("raster-elevation"),ve;d?(ve=de,o.renderDefaultNorthPole=we!==0):(ve=le,o.renderDefaultSouthPole=we!==0);let ye=Yr(b.mix),Fe=((Je,nt,st,Ie,Ze,Ne,Xe,Ke,We,ut,bt,It,_t)=>zd(Je,nt,st,new Float32Array(16),new Float32Array(9),[0,0],Ie,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ne,[0,0],Ke,2,ut,bt,It,1,0,_t))(re,ae,j,n.a9(o.transform.zoom),0,g,0,we,0,ye,b.offset,b.range,y),Ue=o.getOrCreateProgram("raster",{defines:Q});o.uploadCommonUniforms(W,Ue,null),Ue.draw(o,q.TRIANGLES,ie,A,Z,I,Fe,g.id,ve,he,_e)}function $d(d){let t=d._nearZ,o=d.projection.farthestPixelDistance(d),h=o-t,g=.2*d.height,y=t+g;return[t,o,(y-g-t)/h,(y-t)/h]}function Cp(d,t,o,h){if(d)return t instanceof jo&&d instanceof hd?t.getTextureDescriptor(d,o,!0):{texture:d.texture,mix:Yr(h.mix),offset:h.offset,buffer:0,tileSize:1}}var g_=n.d5([{name:"a_index",type:"Int16",components:1}]);class __{constructor(t,o,h,g){let y={width:h[0],height:h[1],data:null},b=t.gl;this.targetColorTexture=new n.T(t,y,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,y,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,g),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let h=this.context.gl,g=o.width*o.height;this.particleTexture0=new n.T(this.context,o,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,o,h.RGBA8,{premultiply:!1,useMipmap:!1});let y=new n.d6;y.reserve(g);for(let b=0;b<g;b++)y.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(y,g_.members,!0),this.particleSegment=n.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function y_(d,t,o){if(!d)return null;let h=t.getTextureDescriptor(d,o,!0);if(!h)return null;let{texture:g,mix:y,offset:b,tileSize:I,buffer:A,format:O}=h;if(!g||!O)return null;let P=!1;return O==="uint32"&&(P=!0,y[3]=0,y=Nd(n.d7,y,[0,o.paint.get("raster-particle-max-speed")]),b=Vl(n.d7,b,[0,o.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[A/(I+2*A),I/(I+2*A)],tileSize:I,scalarData:P,scale:y,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function Mx(d){let t=d._nearZ,o=d.projection.farthestPixelDistance(d),h=o-t,g=.2*d.height,y=t+g;return[t,o,(y-g-t)/h,(y-t)/h]}let Ul=new n.bA(1,0,0,1),$l=new n.bA(0,1,0,1),ot=new n.bA(0,0,1,1),Tt=new n.bA(1,0,1,1),Gl=new n.bA(0,1,1,1);function si(d,t,o,h,g,y,b){let I=d.context,A=d.transform,O=I.gl,P=A.projection.name==="globe",k=P?["PROJECTION_GLOBE_VIEW"]:[],z=n.a6.mat4.clone(o.projMatrix);if(P&&n.a9(A.zoom)>0){let ye=n.b5(o.canonical,A),Fe=n.d8(ye);z=n.a6.mat4.multiply(new Float32Array(16),A.globeMatrix,Fe),n.a6.mat4.multiply(z,A.projMatrix,z)}let j=n.a6.mat4.create();j[12]+=2*g/(n.q.devicePixelRatio*A.width),j[13]+=2*y/(n.q.devicePixelRatio*A.height),n.a6.mat4.multiply(z,j,z);let W=d.getOrCreateProgram("debug",{defines:k}),q=t.getTileByID(o.key);d.terrain&&d.terrain.setupElevationDraw(q,W);let X=Rt.disabled,Z=Yt.disabled,Q=d.colorModeForRenderPass(),ie="$debug";I.activeTexture.set(O.TEXTURE0),d.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),P?q._makeGlobeTileDebugBuffers(d.context,A):q._makeDebugTileBoundsBuffers(d.context,A.projection);let re=q._tileDebugBuffer||d.debugBuffer,ae=q._tileDebugIndexBuffer||d.debugIndexBuffer,de=q._tileDebugSegments||d.debugSegments;if(W.draw(d,O.LINE_STRIP,X,Z,Q,jt.disabled,hp(z,h),ie,re,ae,de,null,null,null,[q._globeTileDebugBorderBuffer]),b){let ye=q.latestRawTileData,Fe=Math.floor((ye&&ye.byteLength||0)/1024),Ue=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Ue+=` => ${o.overscaledZ}`),Ue+=` ${q.state}`,Ue+=` ${Fe}kb`,function(Je,nt){Je.initDebugOverlayCanvas();let st=Je.debugOverlayCanvas,Ie=Je.context.gl,Ze=Je.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,st.width,st.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(nt,5,5),Ze.strokeText(nt,5,5),Je.debugOverlayTexture.update(st),Je.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(d,Ue)}let le=t.getTile(o).tileSize,he=512/Math.min(le,512)*(o.overscaledZ/A.zoom)*.5,_e=q._tileDebugTextBuffer||d.debugBuffer,we=q._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,ve=q._tileDebugTextSegments||d.debugSegments;W.draw(d,O.TRIANGLES,X,Z,fn.alphaBlended,jt.disabled,hp(z,n.bA.transparent,he),ie,_e,we,ve,null,null,null,[q._globeTileDebugTextBuffer])}function Oe(d,t,o,h){Na(d,0,t+o/2,d.transform.width,o,h)}function Ep(d,t,o,h){Na(d,t-o/2,0,o,d.transform.height,h)}function Na(d,t,o,h,g,y){let b=d.context,I=b.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*n.q.devicePixelRatio,o*n.q.devicePixelRatio,h*n.q.devicePixelRatio,g*n.q.devicePixelRatio),b.clear({color:y}),I.disable(I.SCISSOR_TEST)}let Mp=n.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Gd}=Mp;function xs(d,t,o,h){d.emplaceBack(t,o,h)}class Sp{constructor(t){this.vertexArray=new n.d9,this.indices=new n.aP,xs(this.vertexArray,-1,-1,1),xs(this.vertexArray,1,-1,1),xs(this.vertexArray,-1,1,1),xs(this.vertexArray,1,1,1),xs(this.vertexArray,-1,-1,-1),xs(this.vertexArray,1,-1,-1),xs(this.vertexArray,-1,1,-1),xs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Gd),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.b2.simpleSegment(0,0,36,12)}}function Ao(d,t,o,h,g,y){let b=d.context.gl,I=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),P=((k,z,j,W,q)=>({u_matrix_3f:k,u_sun_direction:z,u_sun_intensity:j,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[q.r,q.g,q.b,q.a],u_luminance:5e-5}))(n.a6.mat3.fromMat4(n.a6.mat3.create(),h),g,O,I,A);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),o.draw(d,b.TRIANGLES,Rt.disabled,Yt.disabled,fn.unblended,jt.frontCW,P,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let Sx=n.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Tx{constructor(t){let o=new n.da;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);let h=new n.aP;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,Sx.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=n.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let v_=n.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Hd{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Tp{constructor(t){this.colorModeAlphaBlendedWriteRGB=new fn([1,Hr,1,Hr],n.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new fn([1,0,1,0],n.bA.transparent,[!1,!1,!1,!0]),this.params=new Hd,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){let o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Tx(o);let h=this.params.sizeRange,g=this.params.intensityRange,y=function(P){let k=n.dd(30),z=[];for(let j=0;j<P;++j){let W=2*Math.PI*k(),q=Math.acos(1-2*k())-.5*Math.PI;z.push(n.a6.vec3.fromValues(Math.cos(q)*Math.cos(W),Math.cos(q)*Math.sin(W),Math.sin(q)))}return z}(this.params.starsCount),b=n.dd(300),I=new n.db,A=new n.aP,O=0;for(let P=0;P<y.length;++P){let k=n.a6.vec3.scale([],y[P],200),z=Math.max(0,1+.01*h*(1*b()-.5)),j=Math.max(0,1+.01*g*(1*b()-.5));I.emplaceBack(k[0],k[1],k[2],-1,-1,z,j),I.emplaceBack(k[0],k[1],k[2],1,-1,z,j),I.emplaceBack(k[0],k[1],k[2],1,1,z,j),I.emplaceBack(k[0],k[1],k[2],-1,1,z,j),A.emplaceBack(O+0,O+1,O+2),A.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=o.createVertexBuffer(I,v_.members),this.starsIdx=o.createIndexBuffer(A),this.starsSegments=n.b2.simpleSegment(0,0,I.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){let h=t.context,g=h.gl,y=t.transform,b=new Rt(g.LEQUAL,Rt.ReadOnly,[0,1]),I=n.a9(y.zoom),A=t.style.getLut(o.scope),O=o.properties.get("color").toRenderColor(A).toArray01(),P=o.properties.get("high-color").toRenderColor(A).toArray01(),k=o.properties.get("space-color").toRenderColor(A).toArray01PremultipliedAlpha(),z=5e-4,j=n.dc(o.properties.get("horizon-blend"),0,1,z,.25),W=n.cx(t,h,y)&&j===z?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,q=t.frameCounter/1e3%1,X=n.a6.vec3.length(y.globeCenterInViewSpace),Z=Math.sqrt(Math.pow(X,2)-Math.pow(W,2)),Q=Math.acos(Z/X),ie=re=>{let ae=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];re&&ae.push("ALPHA_PASS");let de=t.getOrCreateProgram("globeAtmosphere",{defines:ae}),le=((_e,we,ve,ye,Fe,Ue,Je,nt,st,Ie,Ze,Ne)=>({u_frustum_tl:_e,u_frustum_tr:we,u_frustum_br:ve,u_frustum_bl:ye,u_horizon:Fe,u_transition:Ue,u_fadeout_range:Je,u_color:nt,u_high_color:st,u_space_color:Ie,u_temporal_offset:Ze,u_horizon_angle:Ne}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,I,j,O,P,k,q,Q);t.uploadCommonUniforms(h,de);let he=this.atmosphereBuffer;he&&de.draw(t,g.TRIANGLES,b,Yt.disabled,re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,jt.backCW,le,re?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};ie(!1),ie(!0)}drawStars(t,o){let h=n.ap(o.properties.get("star-intensity"),0,1);if(h===0)return;let g=t.context,y=g.gl,b=t.transform,I=t.getOrCreateProgram("stars"),A=n.a6.quat.identity([]);n.a6.quat.rotateX(A,A,-b._pitch),n.a6.quat.rotateZ(A,A,-b.angle),n.a6.quat.rotateX(A,A,n.bC(b._center.lat)),n.a6.quat.rotateY(A,A,-n.bC(b._center.lng));let O=n.a6.mat4.fromQuat(new Float32Array(16),A),P=n.a6.mat4.multiply([],b.starsProjMatrix,O),k=n.a6.mat3.fromMat4([],O),z=n.a6.mat3.invert([],k),j=[0,1,0];n.a6.vec3.transformMat3(j,j,z),n.a6.vec3.scale(j,j,this.params.sizeMultiplier);let W=[1,0,0];n.a6.vec3.transformMat3(W,W,z),n.a6.vec3.scale(W,W,this.params.sizeMultiplier);let q=(X=j,Z=W,Q=h,{u_matrix:Float32Array.from(P),u_up:X,u_right:Z,u_intensity_multiplier:Q});var X,Z,Q;t.uploadCommonUniforms(g,I),this.starsVx&&this.starsIdx&&I.draw(t,y.TRIANGLES,Rt.disabled,Yt.disabled,this.colorModeAlphaBlendedWriteRGB,jt.disabled,q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ip(d,t){let o=[...d],h=t.cameraWorldSizeForFog/t.worldSize,g=n.a6.mat4.identity([]);return n.a6.mat4.scale(g,g,[h,h,1]),n.a6.mat4.multiply(o,g,o),n.a6.mat4.multiply(o,t.worldToFogMatrix,o),o}function qd(d,t,o,h,g){let y=o.material,b=h.context,{baseColorTexture:I,metallicRoughnessTexture:A}=y.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:P,emissionTexture:k}=y;function z(W,q,X){if(W&&(d.push(q),b.activeTexture.set(b.gl.TEXTURE0+X),W.gfxTexture)){let{minFilter:Z,magFilter:Q,wrapS:ie,wrapT:re}=W.sampler;W.gfxTexture.bindExtraParam(Z,Q,ie,re)}}z(I,"HAS_TEXTURE_u_baseColorTexture",ar.BaseColor),z(A,"HAS_TEXTURE_u_metallicRoughnessTexture",ar.MetallicRoughness),z(O,"HAS_TEXTURE_u_normalTexture",ar.Normal),z(P,"HAS_TEXTURE_u_occlusionTexture",ar.Occlusion),z(k,"HAS_TEXTURE_u_emissionTexture",ar.Emission),g&&(g.texture||(g.texture=new n.df(h.context,g.image,[g.image.height,g.image.height,g.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+ar.LUT),g.texture&&g.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(d.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES");let j=h.shadowRenderer;j&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&d.push("NORMAL_OFFSET"))}function za(d,t,o,h,g,y){let b=o.paint.get("model-opacity"),I=t.context,A=new Rt(t.context.gl.LEQUAL,Rt.ReadWrite,t.depthRangeFor3D),O=t.transform,P=d.mesh,k=P.material,z=k.pbrMetallicRoughness,j=t.style.fog,W;W=t.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:n.a6.mat4.multiply([],h.zScaleMatrix,d.nodeModelMatrix),n.a6.mat4.multiply(W,h.negCameraPosMatrix,W);let q=n.a6.mat4.invert([],W);n.a6.mat4.transpose(q,q);let X=o.paint.get("model-emissive-strength").constantOr(0),Z=jd(new Float32Array(d.worldViewProjection),new Float32Array(W),new Float32Array(q),null,t,b,z.baseColorFactor.toRenderColor(null),k.emissiveFactor,z.metallicFactor,z.roughnessFactor,k,X,o),Q={defines:[]},ie=[],re=t.shadowRenderer;re&&(re.useNormalOffset=!1),qd(Q.defines,ie,P,t,o.lut);let ae=null;if(j){let he=Ip(d.nodeModelMatrix,t.transform);if(ae=new Float32Array(he),O.projection.name!=="globe"){let _e=P.aabb.min,we=P.aabb.max,[ve,ye]=j.getOpacityForBounds(he,_e[0],_e[1],we[0],we[1]);Q.overrideFog=ve>=it||ye>=it}}let de=_s(t,o.paint.get("model-cutoff-fade-range"));de.shouldRenderCutoff&&Q.defines.push("RENDER_CUTOFF");let le=t.getOrCreateProgram("model",Q);t.uploadCommonUniforms(I,le,null,ae,de),t.renderPass!=="shadow"&&re&&re.setupShadowsFromMatrix(d.nodeModelMatrix,le),le.draw(t,I.gl.TRIANGLES,A,g,y,P.material.doubleSided?jt.disabled:jt.backCCW,Z,o.id,P.vertexBuffer,P.indexBuffer,P.segments,o.paint,t.transform.zoom,void 0,ie)}function pu(d,t,o,h,g,y,b){let I;I=d.projection.name==="globe"?n.dg(o,d):[...o],n.a6.mat4.multiply(I,I,t.matrix);let A=n.a6.mat4.multiply([],h,I);if(t.meshes)for(let O of t.meshes){if(O.material.alphaMode!=="BLEND"){b.push({mesh:O,depth:0,modelIndex:g,worldViewProjection:A,nodeModelMatrix:I});continue}let P=n.a6.vec3.transformMat4([],O.centroid,A);P[2]>0&&y.push({mesh:O,depth:P[2],modelIndex:g,worldViewProjection:A,nodeModelMatrix:I})}if(t.children)for(let O of t.children)pu(d,O,o,h,g,y,b)}function Wd(d,t,o,h){let g=o.shadowRenderer;if(!g)return;let y=g.getShadowPassDepthMode(),b=g.getShadowPassColorMode(),I=g.calculateShadowPassMatrixFromMatrix(t),A=gp(I);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,y,Yt.disabled,b,jt.backCCW,A,h.id,d.vertexBuffer,d.indexBuffer,d.segments,h.paint,o.transform.zoom,void 0,void 0)}function x_(d,t,o){let h=t.updateZoomBasedPaintProperties(),g=function(y,b,I){let A,O,P,k=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&k>0){let z=y.terrain,j=z.findDEMTileFor(I);j&&j.dem?A=n.di.create(z,I,j):k=0}if(k===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),k===b.validForExaggeration&&(k===0||A&&A._demTile&&A._demTile.tileID===b.validForDEMTile.id&&A._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(let z in b.instancesPerModel){let j=b.instancesPerModel[z];for(let W=0;W<j.instancedDataArray.length;++W){let q=(A?k*A.getElevationAt(0|j.instancedDataArray.float32[16*W],0|j.instancedDataArray.float32[16*W+1],!0,!0):0)+j.instancesEvaluatedElevation[W];j.instancedDataArray.float32[16*W+6]=q,O=O?Math.min(b.terrainElevationMin,q):q,P=P?Math.max(b.terrainElevationMax,q):q}}return b.terrainElevationMin=O||0,b.terrainElevationMax=P||0,b.validForExaggeration=k,b.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,t,o);(h||g)&&(t.uploaded=!1,t.upload(d.context))}let Ho={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.ca([0,0,0],[n.ab,n.ab,0])};function Sr(d,t){let o=1<<d.canonical.z,h=t.getFreeCameraOptions().position,g=t.elevation,y=d.canonical.x/o,b=(d.canonical.x+1)/o,I=d.canonical.y/o,A=(d.canonical.y+1)/o,O=t._centerAltitude;if(g){let j=g.getMinMaxForTile(d);j&&j.max>O&&(O=j.max)}let P=n.ap(h.x,y,b)-h.x,k=n.ap(h.y,I,A)-h.y,z=n.bE(O,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(P*P+k*k+z*z))}function b_(d,t,o,h,g,y,b){let I=d.context,A=d.renderPass==="shadow",O=d.shadowRenderer,P=A&&O?O.getShadowPassDepthMode():new Rt(I.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D),k=d.isTileAffectedByFog(y);if(o.meshes)for(let z of o.meshes){let j=["MODEL_POSITION_ON_GPU"],W=[],q,X,Z;h.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");let Q=_s(d,t.paint.get("model-cutoff-fade-range"));if(Q.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),A&&O)q=d.getOrCreateProgram("modelDepth",{defines:j}),X=gp(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(o.matrix)),Z=O.getShadowPassColorMode();else{qd(j,W,z,d,t.lut),q=d.getOrCreateProgram("model",{defines:j,overrideFog:k});let re=z.material,ae=re.pbrMetallicRoughness,de=t.paint.get("model-opacity"),le=t.paint.get("model-emissive-strength").constantOr(0);X=jd(y.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,d,de,ae.baseColorFactor.toRenderColor(null),re.emissiveFactor,ae.metallicFactor,ae.roughnessFactor,re,le,t,g),O&&(b.shadowUniformsInitialized?q.setShadowUniformValues(I,O.getShadowUniformValues()):(O.setupShadows(y.toUnwrapped(),q,"model-tile",y.overscaledZ),b.shadowUniformsInitialized=!0)),Z=Q.shouldRenderCutoff||de<1||re.alphaMode!=="OPAQUE"?fn.alphaBlended:fn.unblended}d.uploadCommonUniforms(I,q,y.toUnwrapped(),null,Q);let ie=z.material.doubleSided?jt.disabled:jt.backCCW;if(h.instancedDataArray.length>20)W.push(h.instancedDataBuffer),q.draw(d,I.gl.TRIANGLES,P,Yt.disabled,Z,ie,X,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,d.transform.zoom,void 0,W,h.instancedDataArray.length);else{let re=A?"u_instance":"u_normal_matrix";for(let ae=0;ae<h.instancedDataArray.length;++ae)X[re]=new Float32Array(h.instancedDataArray.arrayBuffer,64*ae,16),q.draw(d,I.gl.TRIANGLES,P,Yt.disabled,Z,ie,X,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,d.transform.zoom,void 0,W)}}if(o.children)for(let z of o.children)b_(d,t,z,h,g,y,b)}let mu=[1,-1,1];function ai(d,t,o,h){if(!o.modelManager)return!0;let g=o.modelManager;if(!o.shadowRenderer)return!0;let y=o.shadowRenderer,b=t.aabb,I=!0,A=d.maxHeight;if(A===0){let P=0;for(let k in d.instancesPerModel){let z=g.getModel(k,h);z?P=Math.max(P,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):I=!1}A=d.maxScale*P*1.41+d.maxVerticalOffset,I&&(d.maxHeight=A)}b.max[2]=A,b.min[2]+=d.terrainElevationMin,b.max[2]+=d.terrainElevationMax,n.a6.vec3.transformMat4(b.min,b.min,t.tileMatrix),n.a6.vec3.transformMat4(b.max,b.max,t.tileMatrix);let O=b.intersects(y.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=O===2),O===0}function Dn(d,t){let o=d.uniformValues.u_cutoff_params[0],h=d.uniformValues.u_cutoff_params[1],g=d.uniformValues.u_cutoff_params[2],y=d.uniformValues.u_cutoff_params[3];return h===o||y===g?1:n.ap(((t-o)/(h-o)-g)/(y-g),0,1)}function w_(d,t,o,h){if(t.pitch<20)return 1;let g=t.getWorldToCameraMatrix();n.a6.mat4.multiply(g,g,d);let y=n.a6.vec4.fromValues(o.min[0],o.min[1],o.min[2],1),b=n.a6.vec4.transformMat4(n.a6.vec4.create(),y,g),I=b,A=b;y[1]=o.max[1],b=n.a6.vec4.transformMat4(n.a6.vec4.create(),y,g),I=b[1]<I[1]?b:I,A=b[1]>A[1]?b:A,y[0]=o.max[0],b=n.a6.vec4.transformMat4(n.a6.vec4.create(),y,g),I=b[1]<I[1]?b:I,A=b[1]>A[1]?b:A,y[1]=o.min[1],b=n.a6.vec4.transformMat4(n.a6.vec4.create(),y,g),I=b[1]<I[1]?b:I,A=b[1]>A[1]?b:A;let O=n.ap(h[0],0,1),P=100*t.pixelsPerMeter*n.ap(h[1],0,1),k=n.ap(h[2],0,1),z=n.a6.vec4.lerp(n.a6.vec4.create(),I,A,O),j=Math.tan(.5*t.fovX),W=-z[2]*j;if(P===0)return z[1]<-Math.abs(W)?k:1;let q=(-Math.abs(W)-z[1])/P,X=(Q,ie,re)=>(1-re)*Q+re*ie,Z=n.ap(X(1,k,q),k,1);return X(1,Z,n.ap((t.pitch-20)/20,0,1))}class Ks{}class Zd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,h){{let k=this._storage.get(o.id);if(k)return k.lastUsedFrameIdx=t,k.buf}let g=h.gl,y=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),b=new ArrayBuffer(y),I=new Int16Array(b);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));let A=new n.dk;for(let k=0;k<y/2;k+=3){let z=I[k],j=I[k+1],W=I[k+2];A.emplaceBack(z,j),A.emplaceBack(j,W),A.emplaceBack(W,z)}let O=h.bindVertexArrayOES.current,P=new Ks;return P.buf=new Js(h,A),P.lastUsedFrameIdx=t,this._storage.set(o.id,P),h.bindVertexArrayOES.set(O),P.buf}update(t){for(let[o,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(o))}destroy(){for(let[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class Hl{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class Dp{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let gu={symbol:function(d,t,o,h,g){if(d.renderPass!=="translucent")return;let y=Yt.disabled,b=d.colorModeForRenderPass(),I=o.layout.get("text-variable-anchor"),A=o.layout.get("text-size-scale-range"),O=n.ap(d.scaleFactor,A[0],A[1]);I&&function(z,j,W,q,X,Z,Q,ie){let re=j.transform,ae=X==="map",de=Z==="map";for(let le of z){let he=q.getTile(le),_e=he.getBucket(W);if(!_e||!_e.text||!_e.text.segments.get().length)continue;let we=n.bk(_e.textSizeData,re.zoom,ie),ve=Ws(le,_e.getProjection(),re),ye=re.calculatePixelsToTileUnitsMatrix(he),Fe=bn(ve,he.tileID.canonical,de,ae,re,_e.getProjection(),ye),Ue=_e.hasIconTextFit()&&_e.hasIconData();if(we){let Je=Math.pow(2,re.zoom-he.tileID.overscaledZ);vp(_e,ae,de,Q,n.cS,re,Fe,le,Je,we,Ue)}}}(h,d,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g,O);let P=o.paint.get("icon-opacity").constantOr(1)!==0,k=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||k)?hu(d,t,o,h,y,b):(P&&hu(d,t,o,h,y,b,{onlyIcons:!0}),k&&hu(d,t,o,h,y,b,{onlyText:!0})),t.map.showCollisionBoxes&&(yp(d,t,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),yp(d,t,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,o,h){if(d.renderPass!=="translucent")return;let g=o.paint.get("circle-opacity"),y=o.paint.get("circle-stroke-width"),b=o.paint.get("circle-stroke-opacity"),I=o.layout.get("circle-sort-key").constantOr(1)!==void 0,A=o.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;let O=d.context,P=O.gl,k=d.transform,z=d.depthModeForSublayer(0,Rt.ReadOnly),j=Yt.disabled,W=d.colorModeForDrapableLayerRenderPass(A),q=k.projection.name==="globe",X=[n.am(k.center.lng),n.at(k.center.lat)],Z=[];for(let ie=0;ie<h.length;ie++){let re=h[ie],ae=t.getTile(re),de=ae.getBucket(o);if(!de||de.projection.name!==k.projection.name)continue;let le=de.programConfigurations.get(o.id),he=n.cT(o),_e=d.isTileAffectedByFog(re);q&&he.push("PROJECTION_GLOBE_VIEW"),he.push("DEPTH_D24"),d.terrain&&k.depthOcclusionForSymbolsAndCircles&&he.push("DEPTH_OCCLUSION");let we=d.getOrCreateProgram("circle",{config:le,defines:he,overrideFog:_e}),ve=de.layoutVertexBuffer,ye=de.globeExtVertexBuffer,Fe=de.indexBuffer,Ue=k.projection.createInversionMatrix(k,re.canonical),Je={programConfiguration:le,program:we,layoutVertexBuffer:ve,globeExtVertexBuffer:ye,indexBuffer:Fe,uniformValues:n.cU(d,re,ae,Ue,X,o),tile:ae};if(I){let nt=de.segments.get();for(let st of nt)Z.push({segments:new n.b2([st]),sortKey:st.sortKey,state:Je})}else Z.push({segments:de.segments,sortKey:0,state:Je})}I&&Z.sort((ie,re)=>ie.sortKey-re.sortKey);let Q={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(let ie of Z){let{programConfiguration:re,program:ae,layoutVertexBuffer:de,globeExtVertexBuffer:le,indexBuffer:he,uniformValues:_e,tile:we}=ie.state,ve=ie.segments;d.terrain&&d.terrain.setupElevationDraw(we,ae,Q),d.uploadCommonUniforms(O,ae,we.tileID.toUnwrapped()),ae.draw(d,P.TRIANGLES,z,j,W,jt.disabled,_e,o.id,de,he,ve,o.paint,k.zoom,re,[le])}},heatmap:function(d,t,o,h){if(o.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let g=d.context,y=g.gl,b=Yt.disabled,I=new fn([y.ONE,y.ONE,y.ONE,y.ONE],n.bA.transparent,[!0,!0,!0,!0]);(function(j,W,q,X){let Z=j.gl,Q=W.width*X,ie=W.height*X;j.activeTexture.set(Z.TEXTURE1),j.viewport.set([0,0,Q,ie]);let re=q.heatmapFbo;if(!re||re&&(re.width!==Q||re.height!==ie)){re&&re.destroy();let ae=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,ae),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),re=q.heatmapFbo=j.createFramebuffer(Q,ie,!0,null),function(de,le,he,_e,we,ve){let ye=de.gl;ye.texImage2D(ye.TEXTURE_2D,0,de.extRenderToTextureHalfFloat?ye.RGBA16F:ye.RGBA,we,ve,0,ye.RGBA,de.extRenderToTextureHalfFloat?ye.HALF_FLOAT:ye.UNSIGNED_BYTE,null),_e.colorAttachment.set(he)}(j,0,ae,re,Q,ie)}else Z.bindTexture(Z.TEXTURE_2D,re.colorAttachment.get()),j.bindFramebuffer.set(re.framebuffer)})(g,d,o,d.transform.projection.name==="globe"?.5:.25),g.clear({color:n.bA.transparent});let A=d.transform,O=A.projection.name==="globe",P=O?["PROJECTION_GLOBE_VIEW"]:[],k=O?jt.frontCCW:jt.disabled,z=[n.am(A.center.lng),n.at(A.center.lat)];for(let j=0;j<h.length;j++){let W=h[j];if(t.hasRenderableParent(W))continue;let q=t.getTile(W),X=q.getBucket(o);if(!X||X.projection.name!==A.projection.name)continue;let Z=d.isTileAffectedByFog(W),Q=X.programConfigurations.get(o.id),ie=d.getOrCreateProgram("heatmap",{config:Q,defines:P,overrideFog:Z}),{zoom:re}=d.transform;d.terrain&&d.terrain.setupElevationDraw(q,ie),d.uploadCommonUniforms(g,ie,W.toUnwrapped());let ae=A.projection.createInversionMatrix(A,W.canonical);ie.draw(d,y.TRIANGLES,Rt.disabled,b,I,k,fp(d,W,q,ae,z,re,o.paint.get("heatmap-intensity")),o.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,o.paint,d.transform.zoom,Q,O?[X.globeExtVertexBuffer]:null)}g.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(g,y){let b=g.context,I=b.gl,A=y.heatmapFbo;if(!A)return;b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,A.colorAttachment.get()),b.activeTexture.set(I.TEXTURE1);let O=y.colorRampTexture;O||(O=y.colorRampTexture=new n.T(b,y.colorRamp,I.RGBA8)),O.bind(I.LINEAR,I.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,I.TRIANGLES,Rt.disabled,Yt.disabled,g.colorModeForRenderPass(),jt.disabled,((P,k,z,j)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)}(d,o))},line:function(d,t,o,h){if(d.renderPass!=="translucent")return;let g=o.paint.get("line-opacity"),y=o.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;let b=o.paint.get("line-emissive-strength"),I=o.paint.get("line-occlusion-opacity"),A=o.layout.get("line-elevation-reference")==="sea",O=d.context,P=O.gl,k=!o.isDraped();if(k&&d.transform.projection.name==="globe")return;let z=o.layout.get("line-cross-slope"),j=z!==void 0,W=z<1,q=k?new Rt(d.depthOcclusion?P.GREATER:P.LEQUAL,Rt.ReadOnly,d.depthRangeFor3D):d.depthModeForSublayer(0,Rt.ReadOnly),X=d.colorModeForDrapableLayerRenderPass(b),Z=d.terrain&&d.terrain.renderingToTexture,Q=Z?1:n.q.devicePixelRatio,ie=o.paint.get("line-dasharray"),re=ie.constantOr(1),ae=o.layout.get("line-cap"),de=ie.constantOr(null),le=ae.constantOr(null),he=o.paint.get("line-pattern"),_e=he.constantOr(1),we=he.constantOr(null),ve=o.paint.get("line-opacity").constantOr(1),ye=!_e&&ve!==1||d.depthOcclusion&&I>0&&I<1,Fe=o.paint.get("line-gradient"),Ue=_e?"linePattern":"line",Je=n.cV(o),nt;if(Z&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ye=!1),I!==0&&d.depthOcclusion){let Ie=o.paint._values["line-opacity"];Ie&&Ie.value&&Ie.value.kind==="constant"?nt=Ie.value:n.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}if(k&&(d.forceTerrainMode=!0),!k&&I!==0&&d.terrain&&!Z)return void n.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`);let st=ye&&k?d.stencilModeFor3D():Yt.disabled;k&&(Je.push("ELEVATED"),j&&Je.push(W?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),A&&Je.push("ELEVATION_REFERENCE_SEA"));for(let Ie of h){let Ze=t.getTile(Ie);if(_e&&!Ze.patternsLoaded())continue;let Ne=Ze.getBucket(o);if(!Ne)continue;d.prepareDrawTile();let Xe=Ne.programConfigurations.get(o.id),Ke=d.isTileAffectedByFog(Ie),We=d.getOrCreateProgram(Ue,{config:Xe,defines:Je,overrideFog:Ke,overrideRtt:!k&&void 0});if(we&&Ze.imageAtlas){let ht=Ze.imageAtlas.patternPositions[we.toString()];ht&&Xe.setConstantPatternPositions(ht)}if(!_e&&de&&le&&Ze.lineAtlas){let ht=Ze.lineAtlas.getDash(de,le);ht&&Xe.setConstantPatternPositions(ht)}let[ut,bt]=o.paint.get("line-trim-offset");(le==="round"||le==="square")&&ut!==bt&&(ut===0&&(ut-=1),bt===1&&(bt+=1));let It=Z?Ie.projMatrix:null,_t=_e?n.cW(d,Ze,o,It,Q,[ut,bt]):n.cX(d,Ze,o,It,Ne.lineClipsArray.length,Q,[ut,bt]);if(Fe){let ht=Ne.gradients[o.id],Lt=ht.texture;if(o.gradientVersion!==ht.version){let Kt=256;if(o.stepInterpolant){let mn=t.getSource().maxzoom,Kn=Ie.canonical.z===mn?Math.ceil(1<<d.transform.maxZoom-Ie.canonical.z):1;Kt=n.ap(n.cY(Ne.maxLineLength/n.ab*1024*Kn),256,O.maxTextureSize)}ht.gradient=n.cZ({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Kt,image:ht.gradient||void 0,clips:Ne.lineClipsArray}),ht.texture?ht.texture.update(ht.gradient):ht.texture=new n.T(O,ht.gradient,P.RGBA8),ht.version=o.gradientVersion,Lt=ht.texture}O.activeTexture.set(P.TEXTURE1),Lt.bind(o.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}re&&(O.activeTexture.set(P.TEXTURE0),Ze.lineAtlasTexture&&Ze.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),Xe.updatePaintBuffers()),_e&&(O.activeTexture.set(P.TEXTURE0),Ze.imageAtlasTexture&&Ze.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Xe.updatePaintBuffers()),k&&!A&&d.terrain.setupElevationDraw(Ze,We),d.uploadCommonUniforms(O,We,Ie.toUnwrapped());let At=ht=>{nt!=null&&(nt.value=ve*I),We.draw(d,P.TRIANGLES,q,ht,X,jt.disabled,_t,o.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,o.paint,d.transform.zoom,Xe,[Ne.layoutVertexBuffer2,Ne.patternVertexBuffer,Ne.zOffsetVertexBuffer]),nt!=null&&(nt.value=ve)};if(ye&&!k){let ht=d.stencilModeForClipping(Ie).ref;ht===0&&Z&&O.clear({stencil:0});let Lt={func:P.EQUAL,mask:255};_t.u_alpha_discard_threshold=.8,At(new Yt(Lt,ht,255,P.KEEP,P.KEEP,P.INVERT)),_t.u_alpha_discard_threshold=0,At(new Yt(Lt,ht,255,P.KEEP,P.KEEP,P.KEEP))}else ye&&k&&(_t.u_alpha_discard_threshold=.001),At(k?st:d.stencilModeForClipping(Ie))}k&&(d.forceTerrainMode=!1),ye&&(d.resetStencilClippingMasks(),Z&&O.clear({stencil:0})),I===0||d.depthOcclusion||Z||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,t,o,h){let g=o.paint.get("fill-color"),y=o.paint.get("fill-opacity"),b=o.is3D(),I=new Rt(d.context.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D);if(y.constantOr(1)===0)return;let A=o.paint.get("fill-emissive-strength"),O=d.colorModeForDrapableLayerRenderPass(A),P=o.paint.get("fill-pattern"),k=d.opaquePassEnabledForLayer()&&!P.constantOr(1)&&g.constantOr(n.bA.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===k){let z=b?I:d.depthModeForSublayer(1,d.renderPass==="opaque"?Rt.ReadWrite:Rt.ReadOnly);Ud(d,t,o,h,z,O,!1)}if(!b&&d.renderPass==="translucent"&&o.paint.get("fill-antialias")){let z=b?I:d.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Rt.ReadOnly);Ud(d,t,o,h,z,O,!0)}},"fill-extrusion":function(d,t,o,h){let g=o.paint.get("fill-extrusion-opacity"),y=d.context,b=y.gl,I=d.terrain,A=I&&I.renderingToTexture;if(g===0)return;let O=d.conflationActive&&d.style.isLayerClipped(o,t.getSource()),P=d.style.order.indexOf(o.fqid);if(O&&function(k,z,j,W,q){for(let X of W){let Z=z.getTile(X).getBucket(j);Z&&(Z.updateReplacement(X,k.replacementSource,q),Z.uploadCentroid(k.context))}}(d,t,o,h,P),I||O)for(let k of h){let z=t.getTile(k).getBucket(o);z&&p_(d.context,t,k,z,o,I,O)}if(d.renderPass==="shadow"&&d.shadowRenderer){let k=d.shadowRenderer;if(I&&g<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a4)return;let z=k.getShadowPassDepthMode(),j=k.getShadowPassColorMode();lr(d,t,o,h,z,Yt.disabled,j,O)}else if(d.renderPass==="translucent"){let k=!o.paint.get("fill-extrusion-pattern").constantOr(1),z=o.paint.get("fill-extrusion-color").constantOr(n.bA.white);if(!A&&z.a!==0){let j=new Rt(d.context.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D);g===1&&k?lr(d,t,o,h,j,Yt.disabled,fn.unblended,O):(lr(d,t,o,h,j,Yt.disabled,fn.disabled,O),lr(d,t,o,h,j,d.stencilModeFor3D(),d.colorModeForRenderPass(),O),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&k&&(!I&&d.transform.projection.name!=="globe"||A)){let j=o.paint.get("fill-extrusion-opacity"),W=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=o.paint.get("fill-extrusion-flood-light-intensity"),Z=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(o.lut).toArray01().slice(0,3),Q=W>0&&q>0,ie=X>0,re=(de,le,he)=>(1-he)*de+he*le,ae=de=>{let le=d.depthModeForSublayer(1,Rt.ReadOnly,b.LEQUAL,!0),he=o.paint.get(de?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_e=re(.1,3,he),we=d._showOverdrawInspector;if(!we){let ve=new Yt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),ye=new fn([b.ONE,b.ONE,b.ONE,b.ONE],n.bA.transparent,[!1,!1,!1,!0],b.MIN);Xr(d,t,o,h,le,ve,ye,jt.disabled,de,"sdf",j,W,q,X,Z,_e,O,!1)}{let ve=we?Yt.disabled:new Yt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),ye=we?d.colorModeForRenderPass():new fn([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],n.bA.transparent,[!0,!0,!0,!0]);Xr(d,t,o,h,le,ve,ye,jt.disabled,de,"color",j,W,q,X,Z,_e,O,!1)}};if(A){let de=(le,he,_e)=>{let we=d.depthModeForSublayer(1,Rt.ReadOnly,b.LEQUAL,!1),ve=o.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ye=re(.1,3,ve);{let Fe=new fn([b.ONE,b.ONE,b.ONE,b.ONE],n.bA.transparent,[!1,!1,!1,!0]);Xr(d,t,o,h,we,Yt.disabled,Fe,jt.disabled,le,"clear",j,W,q,X,Z,ye,O,he)}{let Fe=new Yt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ue=new fn([b.ONE,b.ONE,b.ONE,b.ONE],n.bA.transparent,[!1,!1,!1,!0],b.MIN);Xr(d,t,o,h,we,Fe,Ue,jt.disabled,le,"sdf",j,W,q,X,Z,ye,O,he)}{let Fe=le?b.ZERO:b.ONE_MINUS_DST_ALPHA,Ue=new Yt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Je=new fn([Fe,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],n.bA.transparent,[!0,!0,!0,!0]);Xr(d,t,o,h,we,Ue,Je,jt.disabled,le,"color",j,W,q,X,Z,ye,O,he)}{let Fe=new fn([b.ONE,b.ONE,b.ONE,le?b.ZERO:b.ONE],n.bA.transparent,[!1,!1,!1,!0],le?b.FUNC_ADD:b.MAX);Xr(d,t,o,h,we,Yt.disabled,Fe,jt.disabled,le,"clear",j,W,q,X,Z,ye,O,he,_e)}};if(Q||ie){let le;if(d.prepareDrawTile(),I){let he=I.drapeBufferSize[0],_e=I.drapeBufferSize[1];le=I.framebufferCopyTexture,le&&(!le||le.size[0]===he&&le.size[1]===_e)||(le&&le.destroy(),le=I.framebufferCopyTexture=new n.T(y,new n.r({width:he,height:_e}),b.RGBA8)),le.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,he,_e)}Q&&de(!0,!1,le),ie&&de(!1,!0,le)}}else Q&&ae(!0),ie&&ae(!1),(Q||ie)&&d.resetStencilClippingMasks()}}},hillshade:function(d,t,o,h){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;let g=d.context,y=d.terrain&&d.terrain.renderingToTexture,[b,I]=d.renderPass!=="translucent"||y?[{},h]:d.stencilConfigForOverlap(h);for(let A of I){let O=t.getTile(A);if(O.needsHillshadePrepare&&d.renderPass==="offscreen")Fl(d,O,o);else if(d.renderPass==="translucent"){let P=d.depthModeForSublayer(0,Rt.ReadOnly),k=o.paint.get("hillshade-emissive-strength"),z=d.colorModeForDrapableLayerRenderPass(k),j=y&&d.terrain?d.terrain.stencilModeForRTTOverlap(A):b[A.overscaledZ];Dd(d,A,O,o,P,j,z)}}g.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,t,o,h,g,y){if(d.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;let b=d.transform.projection.name==="globe",I=o.paint.get("raster-elevation")!==0,A=I&&b;if(d.renderElevatedRasterBackface&&!A)return;let O=d.context,P=O.gl,k=t.getSource(),z=function(de,le,he,_e){let we=le.paint.get("raster-color"),ve=de.type==="raster-array",ye=[],Fe=le.paint.get("raster-resampling"),Ue=le.paint.get("raster-color-mix"),Je=le.paint.get("raster-color-range"),nt=[Ue[0],Ue[1],Ue[2],0],st=Ue[3],Ie=Fe==="nearest"?_e.NEAREST:_e.LINEAR;if(ve&&(ye.push("RASTER_ARRAY"),we||ye.push("RASTER_COLOR"),Fe==="linear"&&ye.push("RASTER_ARRAY_LINEAR"),Ie=_e.NEAREST,!Je&&de.rasterLayers)){let Ze=de.rasterLayers.find(({id:Ne})=>Ne===le.sourceLayer);Ze&&Ze.fields&&Ze.fields.range&&(Je=Ze.fields.range)}if(Je=Je||[0,1],we){ye.push("RASTER_COLOR"),he.activeTexture.set(_e.TEXTURE2),le.updateColorRamp(Je);let Ze=le.colorRampTexture;Ze||(Ze=le.colorRampTexture=new n.T(he,le.colorRamp,_e.RGBA8)),Ze.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:nt,range:Je,offset:st,defines:ye,resampling:Ie}}(k,o,O,P);if(k instanceof n.aD&&!h.length&&!b)return;let j=o.paint.get("raster-emissive-strength"),W=d.colorModeForDrapableLayerRenderPass(j),q=d.terrain&&d.terrain.renderingToTexture,X=!d.options.moving,Z=o.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(k instanceof n.aD&&!h.length&&(k.onNorthPole||k.onSouthPole)){let de=I?d.stencilModeFor3D():Yt.disabled;return void bi(!!k.onNorthPole,null,d,t,o,j,z,jt.disabled,de)}if(!h.length)return;let[Q,ie]=k instanceof n.aD||q?[{},h]:d.stencilConfigForOverlap(h),re=ie[ie.length-1].overscaledZ;A&&z.defines.push("PROJECTION_GLOBE_VIEW"),I&&z.defines.push("RENDER_CUTOFF");let ae=(de,le,he)=>{for(let _e of de){let we=_e.toUnwrapped(),ve=t.getTile(_e);if(q&&(!ve||!ve.hasData()))continue;O.activeTexture.set(P.TEXTURE0);let ye=Cp(ve,k,o,z);if(!ye||!ye.texture)continue;let{texture:Fe,mix:Ue,offset:Je,tileSize:nt,buffer:st}=ye,Ie,Ze;q?(Ie=Rt.disabled,Ze=_e.projMatrix):I?(Ie=new Rt(P.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D),Ze=b?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(we,X)):(Ie=d.depthModeForSublayer(_e.overscaledZ-re,o.paint.get("raster-opacity")===1?Rt.ReadWrite:Rt.ReadOnly,P.LESS),Ze=d.transform.calculateProjMatrix(we,X));let Ne=d.terrain&&q?d.terrain.stencilModeForRTTOverlap(_e):Q[_e.overscaledZ],Xe=y?0:o.paint.get("raster-fade-duration");ve.registerFadeDuration(Xe);let Ke=t.findLoadedParent(_e,0),We=Fd(ve,Ke,t,d.transform,Xe),ut,bt;d.terrain&&d.terrain.prepareDrawTile(),O.activeTexture.set(P.TEXTURE0),Fe.bind(Z,P.CLAMP_TO_EDGE),O.activeTexture.set(P.TEXTURE1),Ke?(Ke.texture&&Ke.texture.bind(Z,P.CLAMP_TO_EDGE),ut=Math.pow(2,Ke.tileID.overscaledZ-ve.tileID.overscaledZ),bt=[ve.tileID.canonical.x*ut%1,ve.tileID.canonical.y*ut%1]):Fe.bind(Z,P.CLAMP_TO_EDGE),Fe.useMipmap&&O.extTextureFilterAnisotropic&&d.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);let It=d.transform,_t,At=I?$d(It):[0,0,0,0],ht,Lt,Kt,mn,Kn,Mn=0;if(A&&k instanceof n.aD&&k.coordinates.length>3)ht=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0)))),Lt=Float32Array.from(It.globeMatrix),Kt=Float32Array.from(n.cy(It)),mn=[n.am(It.center.lng),n.at(It.center.lat)],_t=k.elevatedGlobePerspectiveTransform,Kn=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){let un=n.cz(_e.canonical);Mn=n.cA(un.getCenter().lat),ht=Float32Array.from(n.b6(n.cC(_e.canonical))),Lt=Float32Array.from(It.globeMatrix),Kt=Float32Array.from(n.cy(It)),mn=[n.am(It.center.lng),n.at(It.center.lat)],_t=[0,0],Kn=Float32Array.from(n.cB(_e.canonical,un,Mn,It.worldSize/It._pixelsPerMercatorPixel))}else _t=k instanceof n.aD?k.perspectiveTransform:[0,0],ht=new Float32Array(16),Lt=new Float32Array(9),Kt=new Float32Array(16),mn=[0,0],Kn=new Float32Array(9);let ri=zd(Ze,ht,Lt,Kt,Kn,bt||[0,0],n.a9(d.transform.zoom),mn,At,ut||1,We,o,_t,I?o.paint.get("raster-elevation"):0,2,Ue,Je,z.range,nt,st,j),An=d.isTileAffectedByFog(_e),Qn=d.getOrCreateProgram("raster",{defines:z.defines,overrideFog:An});if(d.uploadCommonUniforms(O,Qn,we),k instanceof n.aD){let un=k.elevatedGlobeVertexBuffer,Xn=k.elevatedGlobeIndexBuffer;if(q||!b)k.boundsBuffer&&k.boundsSegments&&Qn.draw(d,P.TRIANGLES,Ie,Yt.disabled,W,jt.disabled,ri,o.id,k.boundsBuffer,d.quadTriangleIndexBuffer,k.boundsSegments);else if(un&&Xn){let Gn=It.zoom<=n.c3?k.elevatedGlobeSegments:k.getSegmentsForLongitude(It.center.lng);Gn&&Qn.draw(d,P.TRIANGLES,Ie,Yt.disabled,W,le,ri,o.id,un,Xn,Gn)}}else if(A){Ie=new Rt(P.LEQUAL,Rt.ReadOnly,d.depthRangeFor3D);let un=d.globeSharedBuffers;if(un){let[Xn,Gn,Fn]=un.getGridBuffers(Mn,!1);Qn.draw(d,P.TRIANGLES,Ie,he||Ne,d.colorModeForRenderPass(),le,ri,o.id,Xn,Gn,Fn)}}else{let{tileBoundsBuffer:un,tileBoundsIndexBuffer:Xn,tileBoundsSegments:Gn}=d.getTileBoundsBuffers(ve);Qn.draw(d,P.TRIANGLES,Ie,Ne,W,jt.disabled,ri,o.id,un,Xn,Gn)}}if(!(k instanceof n.aD)&&A)for(let _e of de){let we=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&bi(!0,_e,d,t,o,j,z,le,he||Yt.disabled),we&&bi(!1,_e,d,t,o,j,z,le===jt.frontCW?jt.backCW:jt.frontCW,he||Yt.disabled)}};A?ae(ie,d.renderElevatedRasterBackface?jt.backCW:jt.frontCW,d.stencilModeFor3D()):ae(ie,jt.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,t,o,h,g,y){d.renderPass==="offscreen"&&function(b,I,A,O){if(!O.length)return;let P=b.context,k=P.gl,z=I.getSource();if(!(z instanceof jo))return;let j=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count"))),W=A.particlePositionRGBAImage;if(!W||W.width!==j){let ie=function(re){let ae=re*re,de=new Uint8Array(4*ae),le=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},he=1/1.1;for(let _e=0;_e<ae;_e++){let we=he*(le(2*_e+0)+La),ve=he*(le(2*_e+1)+La),ye=255*we%1,Fe=255*ve%1,Ue=ye,Je=ve-Fe/255,nt=Fe;de[4*_e+0]=255*(we-ye/255),de[4*_e+1]=255*Ue,de[4*_e+2]=255*Je,de[4*_e+3]=255*nt}return de}(j);W=A.particlePositionRGBAImage=new n.r({width:j,height:j},ie)}let q=A.particleFramebuffer;q?q.width!==j&&(q.destroy(),q=A.particleFramebuffer=P.createFramebuffer(j,j,!0,null)):q=A.particleFramebuffer=P.createFramebuffer(j,j,!0,null);let X=[];for(let ie of O){let re=I.getTile(ie);if(!(re instanceof hd))continue;let ae=y_(re,z,A);if(!ae)continue;let de=[re.tileSize,re.tileSize],le=A.tileFramebuffer;le||(le=A.tileFramebuffer=P.createFramebuffer(de[0],de[1],!0,null));let he=re.rasterParticleState;he||(he=re.rasterParticleState=new __(P,ie,de,W));let _e=he.update(A.lastInvalidatedAt);he.particleTextureDimension!==j&&he.updateParticleTexture(ie,W);let we=he.targetColorTexture;he.targetColorTexture=he.backgroundColorTexture,he.backgroundColorTexture=we;let ve=he.particleTexture0;he.particleTexture0=he.particleTexture1,he.particleTexture1=ve,X.push([ie,ae,he,_e])}if(X.length===0)return;let Z=n.q.now(),Q=A.previousDrawTimestamp?.001*(Z-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=Z,A.hasColorMap()){P.activeTexture.set(k.TEXTURE0+2);let ie=A.colorRampTexture;ie||(ie=A.colorRampTexture=new n.T(P,A.colorRamp,k.RGBA8)),ie.bind(k.LINEAR,k.CLAMP_TO_EDGE)}P.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(ie,re,ae){let de=ie.context,le=de.gl,he=re.tileFramebuffer;de.activeTexture.set(le.TEXTURE0);let _e={u_texture:0,u_opacity:1.05*(ve=re.paint.get("raster-particle-fade-opacity-factor"))/(ve+.05)},we=ie.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ve;for(let ye of ae){let[,,Fe,Ue]=ye;he.colorAttachment.set(Fe.targetColorTexture.texture),de.viewport.set([0,0,he.width,he.height]),de.clear({color:n.bA.transparent}),Ue&&(Fe.backgroundColorTexture.bind(le.NEAREST,le.CLAMP_TO_EDGE),we.draw(ie,le.TRIANGLES,Rt.disabled,Yt.disabled,fn.alphaBlended,jt.disabled,_e,re.id,ie.viewportBuffer,ie.quadTriangleIndexBuffer,ie.viewportSegments))}}(b,A,X),function(ie,re,ae,de){let le=ie.context,he=le.gl,_e=ae.tileFramebuffer,we=ie.transform.projection.name==="globe",ve=ae.paint.get("raster-particle-max-speed");for(let ye of de){let[Fe,Ue,Je]=ye;le.activeTexture.set(he.TEXTURE0+0),Ue.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),_e.colorAttachment.set(Je.targetColorTexture.texture);let nt=ie.getOrCreateProgram("rasterParticleDraw",{defines:Ue.defines,overrideFog:!1});le.activeTexture.set(he.TEXTURE0+1);let st=Ue.scalarData?[]:[0,1,2,3].map(Ne=>n.c$[Ne](Fe));st.push(Fe);let Ie=Fe.canonical.x,Ze=Fe.canonical.y;for(let Ne of st){let Xe=re.getTile(we?Ne.wrapped():Ne);if(!Xe)continue;let Ke=Xe.rasterParticleState;if(!Ke)continue;let We=Ne.canonical.x+(1<<Ne.canonical.z)*(Ne.wrap-Fe.wrap),ut=Ne.canonical.y;Ke.particleTexture0.bind(he.NEAREST,he.CLAMP_TO_EDGE);let bt=Vd(1,Ke.particleTexture0.size[0],[We-Ie,ut-Ze],0,Ue.texture.size,2,ve,Ue.textureOffset,Ue.scale,Ue.offset);nt.draw(ie,he.POINTS,Rt.disabled,Yt.disabled,fn.alphaBlended,jt.disabled,bt,ae.id,Ke.particleIndexBuffer,void 0,Ke.particleSegment)}}}(b,I,A,X),P.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(ie,re,ae,de){let le=ie.context,he=le.gl,_e=re.paint.get("raster-particle-max-speed"),we=de*re.paint.get("raster-particle-speed-factor")*.15,ve=function(Fe){return Math.pow(Fe,6)}(.01+1*re.paint.get("raster-particle-reset-rate-factor")),ye=re.particleFramebuffer;le.viewport.set([0,0,ye.width,ye.height]);for(let Fe of ae){let[,Ue,Je]=Fe;le.activeTexture.set(he.TEXTURE0+0),Ue.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),le.activeTexture.set(he.TEXTURE0+1);let nt=Je.particleTexture0;nt.bind(he.NEAREST,he.CLAMP_TO_EDGE);let st=pp(1,nt.size[0],0,Ue.texture.size,_e,we,ve,Ue.textureOffset,Ue.scale,Ue.offset);ye.colorAttachment.set(Je.particleTexture1.texture),le.clear({color:n.bA.transparent}),ie.getOrCreateProgram("rasterParticleUpdate",{defines:Ue.defines}).draw(ie,he.TRIANGLES,Rt.disabled,Yt.disabled,fn.unblended,jt.disabled,st,re.id,ie.viewportBuffer,ie.quadTriangleIndexBuffer,ie.viewportSegments)}}(b,A,X,Q)}(d,t,o,h),d.renderPass==="translucent"&&(function(b,I,A,O,P){let k=b.context,z=k.gl,j=I.getSource().tileSize,W=5*(1-n.a7(n.bV,n.bV+1,b.transform.zoom))*j+A.paint.get("raster-particle-elevation"),q=!b.options.moving,X=b.transform.projection.name==="globe";if(!O.length)return;let[Z,Q]=b.stencilConfigForOverlap(O),ie=[];X&&ie.push("PROJECTION_GLOBE_VIEW");let re=b.stencilModeFor3D();for(let ae of Q){let de=ae.toUnwrapped(),le=I.getTile(ae);if(!le.rasterParticleState)continue;let he=le.rasterParticleState,_e=100;le.registerFadeDuration(_e);let we=I.findLoadedParent(ae,0),ve=Fd(le,we,I,b.transform,_e),ye,Fe;b.terrain&&b.terrain.prepareDrawTile(),k.activeTexture.set(z.TEXTURE0),he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),k.activeTexture.set(z.TEXTURE1),we&&we.rasterParticleState?(we.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ye=Math.pow(2,we.tileID.overscaledZ-le.tileID.overscaledZ),Fe=[le.tileID.canonical.x*ye%1,le.tileID.canonical.y*ye%1]):he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);let Ue=X?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(de,q),Je=b.transform,nt=Mx(Je),st=n.cz(ae.canonical),Ie=n.cA(st.getCenter().lat),Ze,Ne,Xe,Ke,We;X?(Ze=Float32Array.from(n.b6(n.cC(ae.canonical))),Ne=Float32Array.from(Je.globeMatrix),Xe=Float32Array.from(n.cy(Je)),Ke=[n.am(Je.center.lng),n.at(Je.center.lat)],We=Float32Array.from(n.cB(ae.canonical,st,Ie,Je.worldSize/Je._pixelsPerMercatorPixel))):(Ze=new Float32Array(16),Ne=new Float32Array(9),Xe=new Float32Array(16),Ke=[0,0],We=new Float32Array(9));let ut=Bd(Ue,Ze,Ne,Xe,We,Fe||[0,0],n.a9(b.transform.zoom),Ke,nt,ye||1,ve,W),bt=b.isTileAffectedByFog(ae),It=b.getOrCreateProgram("rasterParticle",{defines:ie,overrideFog:bt});if(b.uploadCommonUniforms(k,It,de),X){let _t=new Rt(z.LEQUAL,Rt.ReadOnly,b.depthRangeFor3D),At=0,ht=b.globeSharedBuffers;if(ht){let[Lt,Kt,mn]=ht.getGridBuffers(Ie,At!==0);It.draw(b,z.TRIANGLES,_t,re,fn.alphaBlended,b.renderElevatedRasterBackface?jt.frontCCW:jt.backCCW,ut,A.id,Lt,Kt,mn)}}else{let _t=b.depthModeForSublayer(0,Rt.ReadOnly),At=Z[ae.overscaledZ],{tileBoundsBuffer:ht,tileBoundsIndexBuffer:Lt,tileBoundsSegments:Kt}=b.getTileBoundsBuffers(le);It.draw(b,z.TRIANGLES,_t,At,fn.alphaBlended,jt.disabled,ut,A.id,ht,Lt,Kt)}}b.resetStencilClippingMasks()}(d,t,o,h),d.style.map.triggerRepaint())},background:function(d,t,o,h){let g=o.paint.get("background-color"),y=o.paint.get("background-opacity"),b=o.paint.get("background-emissive-strength"),I=o.paint.get("background-pitch-alignment")==="viewport";if(y===0)return;let A=d.context,O=A.gl,P=d.transform,k=P.tileSize,z=o.paint.get("background-pattern"),j;if(z!==void 0&&(z===null||(j=d.imageManager.getPattern(z.toString(),o.scope,d.style.getLut(o.scope)),!j)))return;let W=!z&&g.a===1&&y===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==W)return;let q=Yt.disabled,X=d.depthModeForSublayer(0,W==="opaque"?Rt.ReadWrite:Rt.ReadOnly),Z=d.colorModeForDrapableLayerRenderPass(b),Q=z?"backgroundPattern":"background",ie,re=h;if(re||(ie=d.getBackgroundTiles(),re=Object.values(ie).map(ae=>ae.tileID)),z&&(A.activeTexture.set(O.TEXTURE0),d.imageManager.bind(d.context,o.scope)),I){let ae=d.getOrCreateProgram(Q,{overrideFog:!1,overrideRtt:!0}),de=new Float32Array(n.a6.mat4.identity([])),le=new n.aA(0,0,0,0,0),he=z?uu(de,b,y,d,0,o.scope,j,I,{tileID:le,tileSize:k}):Fa(de,b,y,g.toRenderColor(o.lut));ae.draw(d,O.TRIANGLES,X,q,Z,jt.disabled,he,o.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(let ae of re){let de=d.isTileAffectedByFog(ae),le=d.getOrCreateProgram(Q,{overrideFog:de}),he=ae.toUnwrapped(),_e=h?ae.projMatrix:d.transform.calculateProjMatrix(he);d.prepareDrawTile();let we=t?t.getTile(ae):ie?ie[ae.key]:new $o(ae,k,P.zoom,d),ve=z?uu(_e,b,y,d,0,o.scope,j,I,{tileID:ae,tileSize:k}):Fa(_e,b,y,g.toRenderColor(o.lut));d.uploadCommonUniforms(A,le,he);let{tileBoundsBuffer:ye,tileBoundsIndexBuffer:Fe,tileBoundsSegments:Ue}=d.getTileBoundsBuffers(we);le.draw(d,O.TRIANGLES,X,q,Z,jt.disabled,ve,o.id,ye,Fe,Ue)}},sky:function(d,t,o){let h=d._atmosphere?n.a9(d.transform.zoom):1,g=o.paint.get("sky-opacity")*h;if(g===0)return;let y=d.context,b=o.paint.get("sky-type"),I=new Rt(y.gl.LEQUAL,Rt.ReadOnly,[0,1]),A=d.frameCounter/1e3%1;b==="atmosphere"?d.renderPass==="offscreen"?o.needsSkyboxCapture(d)&&(function(O,P,k,z){let j=O.context,W=j.gl,q=P.skyboxFbo;if(!q){q=P.skyboxFbo=j.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new Sp(j),P.skyboxTexture=j.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,P.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let ie=0;ie<6;++ie)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(q.framebuffer),j.viewport.set([0,0,32,32]);let X=P.getCenter(O,!0),Z=O.getOrCreateProgram("skyboxCapture"),Q=new Float64Array(16);n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,.5*-Math.PI),Ao(O,P,Z,Q,X,0),n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,.5*Math.PI),Ao(O,P,Z,Q,X,1),n.a6.mat4.identity(Q),n.a6.mat4.rotateX(Q,Q,.5*-Math.PI),Ao(O,P,Z,Q,X,2),n.a6.mat4.identity(Q),n.a6.mat4.rotateX(Q,Q,.5*Math.PI),Ao(O,P,Z,Q,X,3),n.a6.mat4.identity(Q),Ao(O,P,Z,Q,X,4),n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,Math.PI),Ao(O,P,Z,Q,X,5),j.viewport.set([0,0,O.width,O.height])}(d,o),o.markSkyboxValid(d)):d.renderPass==="sky"&&function(O,P,k,z,j){let W=O.context,q=W.gl,X=O.transform,Z=O.getOrCreateProgram("skybox");W.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,P.skyboxTexture);let Q=((ie,re,ae,de,le)=>({u_matrix:ie,u_sun_direction:re,u_cubemap:0,u_opacity:de,u_temporal_offset:le}))(X.skyboxMatrix,P.getCenter(O,!1),0,z,j);O.uploadCommonUniforms(W,Z),Z.draw(O,q.TRIANGLES,k,Yt.disabled,O.colorModeForRenderPass(),jt.backCW,Q,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(d,o,I,g,A):b==="gradient"&&d.renderPass==="sky"&&function(O,P,k,z,j){let W=O.context,q=W.gl,X=O.transform,Z=O.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new Sp(W)),W.activeTexture.set(q.TEXTURE0);let Q=P.colorRampTexture;Q||(Q=P.colorRampTexture=new n.T(W,P.colorRamp,q.RGBA8)),Q.bind(q.LINEAR,q.CLAMP_TO_EDGE);let ie=((re,ae,de,le,he)=>({u_matrix:re,u_color_ramp:0,u_center_direction:ae,u_radius:n.bC(de),u_opacity:le,u_temporal_offset:he}))(X.skyboxMatrix,P.getCenter(O,!1),P.paint.get("sky-gradient-radius"),z,j);O.uploadCommonUniforms(W,Z),Z.draw(O,q.TRIANGLES,k,Yt.disabled,O.colorModeForRenderPass(),jt.backCW,ie,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(d,o,I,g,A)},debug:function(d,t,o,h,g,y){for(let b=0;b<o.length;b++)if(g){let O=new n.bA(h.r*.8,h.g*.8,h.b*.8,1);si(d,t,o[b],h,-1,-1,y),si(d,t,o[b],h,-1,1,y),si(d,t,o[b],h,1,1,y),si(d,t,o[b],h,1,-1,y),si(d,t,o[b],O,0,0,y)}else si(d,t,o[b],h,0,0,y)},custom:function(d,t,o,h){let g=d.context,y=o.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&o.isDraped(t)){if(d.renderPass==="offscreen"){let b=y.prerender;if(b){if(d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){let I=d.transform.pointMerc;b.call(y,g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),n.a9(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else b.call(y,g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){let I=y.renderToTile;if(I){let A=h[0].canonical,O=new n.a5(A.x+h[0].wrap*(1<<A.z),A.y,A.z);g.setDepthMode(Rt.disabled),g.setStencilMode(Yt.disabled),g.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),I.call(y,g.gl,O),g.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),g.setColorMode(d.colorModeForRenderPass()),g.setStencilMode(Yt.disabled);let b=y.renderingMode==="3d"?new Rt(d.context.gl.LEQUAL,Rt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Rt.ReadOnly);if(g.setDepthMode(b),d.transform.projection.name==="globe"){let I=d.transform.pointMerc;y.render(g.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),n.a9(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else y.render(g.gl,d.transform.customLayerMatrix());g.setDirty(),d.setBaseState(),g.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,t,o,h){if(d.renderPass==="opaque")return;let g=o.paint.get("model-opacity");if(g===0)return;let y=o.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!y||d.terrain&&g<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof n.a4))return;let b=d.shadowRenderer,I=o.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,I||(b.enabled=!1));let A=()=>{b&&(b.useNormalOffset=!0,I||(b.enabled=!0))},O=t.getSource();if(d.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(Z,Q,ie,re,ae){let de=Z.transform;if(de.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${de.projection.name} projection is not yet implemented`);let le=de.getFreeCameraOptions().position;if(!Z.modelManager)return;let he=Z.modelManager;ie.modelManager=he;let _e=Z.shadowRenderer;if(!ie._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let we=ie._unevaluatedLayout._values["model-id"],ve=Mt({},ie.layout.get("model-id").parameters),ye=Z.style.order.indexOf(ie.fqid);for(let Fe of re){let Ue=Q.getTile(Fe).getBucket(ie);if(!Ue||Ue.projection.name!==de.projection.name)continue;let Je=Ue.getModelUris();Je&&!Ue.modelsRequested&&(he.addModelsFromBucket(Je,ae),Ue.modelsRequested=!0);let nt=Sr(Fe,de);ve.zoom=nt;let st=we.possiblyEvaluate(ve);if(x_(Z,Ue,Fe),Ho.shadowUniformsInitialized=!1,Ho.useSingleShadowCascade=!!_e&&_e.getMaxCascadeForTile(Fe.toUnwrapped())===0,Z.renderPass==="shadow"&&_e){if(Z.currentShadowCascade===1&&Ue.isInsideFirstShadowMapFrustum)continue;let Ne=de.calculatePosMatrix(Fe.toUnwrapped(),de.worldSize);if(Ho.tileMatrix.set(Ne),Ho.shadowTileMatrix=Float32Array.from(_e.calculateShadowPassMatrixFromMatrix(Ne)),Ho.aabb.min.fill(0),Ho.aabb.max[0]=Ho.aabb.max[1]=n.ab,Ho.aabb.max[2]=0,ai(Ue,Ho,Z,ie.scope))continue}let Ie=1<<Fe.canonical.z,Ze=[((le.x-Fe.wrap)*Ie-Fe.canonical.x)*n.ab,(le.y*Ie-Fe.canonical.y)*n.ab,le.z*Ie*n.ab];Z.conflationActive&&Object.keys(Ue.instancesPerModel).length>0&&Z.style.isLayerClipped(ie,Q.getSource())&&Ue.updateReplacement(Fe,Z.replacementSource,ye,ae)&&(Ue.uploaded=!1,Ue.upload(Z.context));for(let Ne in Ue.instancesPerModel){let Xe=Ue.instancesPerModel[Ne];Xe.features.length>0&&(Ne=st.evaluate(Xe.features[0].feature,{}));let Ke=he.getModel(Ne,ae);if(Ke&&Ke.uploaded)for(let We of Ke.nodes)b_(Z,ie,We,Xe,Ze,Fe,Ho)}}}(d,t,o,h,O.type==="vector"?o.scope:""),void A();if(!O.loaded())return;if(O.type==="batched-model")return function(Z,Q,ie,re){ie.resetLayerRenderingStats(Z);let ae=Z.context,de=Z.transform,le=Z.style.fog,he=Z.shadowRenderer;if(de.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${de.projection.name} projection is not yet implemented`);let _e=Z.transform.getFreeCameraOptions().position,we=n.a6.vec3.scale([],[_e.x,_e.y,_e.z],Z.transform.worldSize),ve=n.a6.vec3.negate([],we),ye=n.a6.mat4.identity([]),Fe=n.de(de.center.lat,de.zoom),Ue=n.a6.mat4.fromScaling([],[1,1,1/Fe]);n.a6.mat4.translate(ye,ye,ve);let Je=ie.paint.get("model-opacity"),nt=new Rt(ae.gl.LEQUAL,Rt.ReadWrite,Z.depthRangeFor3D),st=new Rt(ae.gl.LEQUAL,Rt.ReadOnly,Z.depthRangeFor3D),Ie=new n.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ze=Z.renderPass==="shadow",Ne=Ze&&he?he.getCurrentCascadeFrustum():de.getFrustum(de.scaleZoom(de.worldSize)),Xe=ie.paint.get("model-front-cutoff"),Ke=Xe[2]<1,We=_s(Z,ie.paint.get("model-cutoff-fade-range")),ut=ie.getLayerRenderingStats();(function(bt,It,_t,At){let ht=bt.terrain?bt.terrain.exaggeration():0,Lt=bt.transform.zoom;for(let Kt of At){let mn=It.getTile(Kt).getBucket(_t);mn&&(bt.conflationActive&&mn.updateReplacement(Kt,bt.replacementSource),mn.evaluateScale(bt,_t),bt.terrain&&ht>0&&mn.elevationUpdate(bt.terrain,ht,Kt,_t.source),mn.needsReEvaluation(bt,Lt,_t)&&mn.evaluate(_t))}})(Z,Q,ie,re),function(){let bt,It,_t;Ke?(bt=re.length-1,It=-1,_t=-1):(bt=0,It=re.length,_t=1);let At=new Float64Array(16),ht=n.a6.vec3.create(),Lt=new n.P(0,0);for(let Kt=bt;Kt!==It;Kt+=_t){let mn=re[Kt],Kn=Q.getTile(mn).getBucket(ie);if(!Kn||!Kn.uploaded)continue;let Mn=!1;he&&(Mn=he.getMaxCascadeForTile(mn.toUnwrapped())===0);let ri=de.calculatePosMatrix(mn.toUnwrapped(),de.worldSize),An=Kn.modelTraits;!Ze&&Ke&&(n.a6.mat4.invert(At,ri),n.a6.vec3.transformMat4(ht,we,At),Lt.x=ht[0],Lt.y=ht[1]);let Qn=[];for(let un of Kn.getNodesInfo()){if(un.hiddenByReplacement||!un.node.meshes)continue;let Xn=un.node,Gn=0;Z.terrain&&Xn.elevation&&(Gn=Xn.elevation*Z.terrain.exaggeration());let Fn=(()=>{let Si=un.aabb;return Ie.min=[...Si.min],Ie.max=[...Si.max],Ie.min[2]+=Gn,Ie.max[2]+=Gn,n.a6.vec3.transformMat4(Ie.min,Ie.min,ri),n.a6.vec3.transformMat4(Ie.max,Ie.max,ri),Ie})(),ui=un.evaluatedScale;if(ui[0]<=1&&ui[1]<=1&&ui[2]<=1&&Fn.intersects(Ne)===0)continue;if(!Ze&&Ke){let Si=.16666666666666666;un.cameraCollisionOpacity=we[0]>Fn.min[0]&&we[0]<Fn.max[0]&&we[1]>Fn.min[1]&&we[1]<Fn.max[1]&&we[2]*Fe<Fn.max[2]&&Xn.footprint&&n.bv(Lt,Xn.footprint)?Math.max(un.cameraCollisionOpacity-Si,0):Math.min(1,un.cameraCollisionOpacity+Si)}let Vi=[...ri],Jr=Xn.anchor?Xn.anchor[0]:0,uo=Xn.anchor?Xn.anchor[1]:0;n.a6.mat4.translate(Vi,Vi,[Jr*(ui[0]-1),uo*(ui[1]-1),Gn]),n.a6.vec3.exactEquals(ui,n.dh)||n.a6.mat4.scale(Vi,Vi,ui);let Gi=n.a6.mat4.multiply([],Vi,Xn.matrix),Cn=n.a6.mat4.multiply([],de.expandedFarZProjMatrix,Gi),gn=n.a6.mat4.multiply([],de.expandedFarZProjMatrix,Vi),Pn=n.a6.vec4.transformMat4([],[Jr,uo,Gn,1],Cn)[2];Xn.hidden=!1;let ni=Je;Ze||(Ke&&(ni*=un.cameraCollisionOpacity,ni*=w_(Vi,de,un.aabb,Xe)),ni*=Dn(We,Pn)),ni!==0?Qn.push({nodeInfo:un,depth:Pn,opacity:ni,wvpForNode:Cn,wvpForTile:gn,nodeModelMatrix:Gi,tileModelMatrix:Vi}):Xn.hidden=!0}Ze||Qn.sort((un,Xn)=>!Ke||un.opacity===1&&Xn.opacity===1?un.depth<Xn.depth?-1:1:un.opacity===1?-1:Xn.opacity===1?1:un.depth>Xn.depth?-1:1);for(let un of Qn){let Xn=un.nodeInfo,Gn=Xn.node,Fn=n.a6.mat4.multiply([],Ue,un.tileModelMatrix);n.a6.mat4.multiply(Fn,ye,Fn);let ui=n.a6.mat4.invert([],Fn);n.a6.mat4.transpose(ui,ui),n.a6.mat4.scale(ui,ui,mu),Fn=n.a6.mat4.multiply(Fn,Fn,Gn.matrix);let Vi=Z.renderPass==="light-beam",Jr=An&n.dj.HasMapboxMeshFeatures,uo=Jr?0:Xn.evaluatedRMEA[0][2];for(let Gi=0;Gi<Gn.meshes.length;++Gi){let Cn=Gn.meshes[Gi],gn=Gi===Gn.lightMeshIndex,Pn=un.wvpForNode;if(gn){if(!Vi&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}Pn=un.wvpForTile}else if(Vi)continue;let ni={defines:[]},Si=[];if(!Ze&&he&&(he.useNormalOffset=!!Cn.normalBuffer),qd(ni.defines,Si,Cn,Z,ie.lut),Jr||ni.defines.push("DIFFUSE_SHADED"),Mn&&ni.defines.push("SHADOWS_SINGLE_CASCADE"),ut&&(Ze?ut.numRenderedVerticesInShadowPass+=Cn.vertexArray.length:ut.numRenderedVerticesInTransparentPass+=Cn.vertexArray.length),Ze){Wd(Cn,un.nodeModelMatrix,Z,ie);continue}let di=null;if(le){let Ro=Ip(un.nodeModelMatrix,Z.transform);if(di=new Float32Array(Ro),de.projection.name!=="globe"){let Fr=Cn.aabb.min,Ts=Cn.aabb.max,[fo,Bn]=le.getOpacityForBounds(Ro,Fr[0],Fr[1],Ts[0],Ts[1]);ni.overrideFog=fo>=it||Bn>=it}}let Yi=Cn.material,Zo;Yi.occlusionTexture&&Yi.occlusionTexture.offsetScale&&(Zo=Yi.occlusionTexture.offsetScale,ni.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let Or=Z.getOrCreateProgram("model",ni);!Ze&&he&&he.setupShadowsFromMatrix(un.tileModelMatrix,Or,he.useNormalOffset),Z.uploadCommonUniforms(ae,Or,null,di);let Lr=Yi.pbrMetallicRoughness;Lr.metallicFactor=.9,Lr.roughnessFactor=.5;let ho=jd(new Float32Array(Pn),new Float32Array(Fn),new Float32Array(ui),new Float32Array(Gn.matrix),Z,un.opacity,Lr.baseColorFactor.toRenderColor(null),Yi.emissiveFactor,Lr.metallicFactor,Lr.roughnessFactor,Yi,uo,ie,[0,0,0],Zo);!gn&&(Xn.hasTranslucentParts||un.opacity<1)&&Or.draw(Z,ae.gl.TRIANGLES,nt,Yt.disabled,fn.disabled,jt.backCCW,ho,ie.id,Cn.vertexBuffer,Cn.indexBuffer,Cn.segments,ie.paint,Z.transform.zoom,void 0,Si),Or.draw(Z,ae.gl.TRIANGLES,gn?st:nt,Yt.disabled,gn||un.opacity<1||Xn.hasTranslucentParts?fn.alphaBlended:fn.unblended,jt.backCCW,ho,ie.id,Cn.vertexBuffer,Cn.indexBuffer,Cn.segments,ie.paint,Z.transform.zoom,void 0,Si)}}}}()}(d,t,o,h),void A();if(O.type!=="model")return;let P=O.getModels(),k=[],z=d.transform.getFreeCameraOptions().position,j=n.a6.vec3.scale([],[z.x,z.y,z.z],d.transform.worldSize);n.a6.vec3.negate(j,j);let W=[],q=[],X=0;for(let Z of P){let Q=o.paint.get("model-rotation").constantOr(null),ie=o.paint.get("model-scale").constantOr(null),re=o.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(d,Q,ie,re,!0,!0,!1);let ae=n.a6.mat4.identity([]),de=n.de(Z.position.lat,d.transform.zoom),le=n.a6.mat4.fromScaling([],[1,1,1/de]);n.a6.mat4.translate(ae,ae,j),k.push({zScaleMatrix:le,negCameraPosMatrix:ae});for(let he of Z.nodes)pu(d.transform,he,Z.matrix,d.transform.expandedFarZProjMatrix,X,W,q);X++}if(W.sort((Z,Q)=>Q.depth-Z.depth),d.renderPass!=="shadow"){if(g===1)for(let Z of q)za(Z,d,o,k[Z.modelIndex],Yt.disabled,d.colorModeForRenderPass());else{for(let Z of q)za(Z,d,o,k[Z.modelIndex],Yt.disabled,fn.disabled);for(let Z of q)za(Z,d,o,k[Z.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(let Z of W)za(Z,d,o,k[Z.modelIndex],Yt.disabled,d.colorModeForRenderPass());A()}else{for(let Z of q)Wd(Z.mesh,Z.nodeModelMatrix,d,o);for(let Z of W)Wd(Z.mesh,Z.nodeModelMatrix,d,o);A()}}},bs={model:function(d,t,o){let h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,h.type==="vector"?d.scope:""));if(h.type==="batched-model"||h.type!=="model")return;let g=h.getModels();for(let y of g)y.upload(o.context)},raster:function(d,t,o){let h=t.getSource();if(!(h instanceof jo&&h.loaded()))return;let g=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;let y=d.paint.get("raster-array-band")||h.getInitialBand(g);if(y==null)return;let b=t.getIds().map(I=>t.getTileByID(I));for(let I of b)I.updateNeeded(g,y)&&h.prepareTile(I,g,y)},"raster-particle":function(d,t,o){let h=t.getSource();if(!(h instanceof jo&&h.loaded()))return;let g=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;let y=d.paint.get("raster-particle-array-band")||h.getInitialBand(g);if(y==null)return;let b=t.getIds().map(I=>t.getTileByID(I));for(let I of b)I.updateNeeded(g,y)&&h.prepareTile(I,g,y)}};class Qs{constructor(t,o,h,g,y){this.context=new Cx(t,o),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let b=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let A of b)this._debugParams.enabledLayers[A]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let A of b)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new Hl(y),this.setup(),this.numSublayers=Ar.maxUnderzooming+Ar.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Bg(this),this._wireframeDebugCache=new Zd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let I=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g}updateTerrain(t,o){let h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new sp(this,t));let g=this._terrain;this.transform.elevation=h?g:null,g.update(t,this.transform,o),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){let o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[h,g]=o.getFovAdjustedRange(this.transform._fov);if(h>g)return void(this.transform.fogCullDistSq=null);let y=h+.78*(g-h);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new sp(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*n.q.devicePixelRatio,this.height=o*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let h of this.style.order)this.style._mergedLayers[h].resize()}setup(){let t=this.context,o=new n.a$;o.emplaceBack(0,0),o.emplaceBack(n.ab,0),o.emplaceBack(0,n.ab),o.emplaceBack(n.ab,n.ab),this.tileExtentBuffer=t.createVertexBuffer(o,n.b1.members),this.tileExtentSegments=n.b2.simpleSegment(0,0,4,2);let h=new n.a$;h.emplaceBack(0,0),h.emplaceBack(n.ab,0),h.emplaceBack(0,n.ab),h.emplaceBack(n.ab,n.ab),this.debugBuffer=t.createVertexBuffer(h,n.b1.members),this.debugSegments=n.b2.simpleSegment(0,0,4,5);let g=new n.a$;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,n.b1.members),this.viewportSegments=n.b2.simpleSegment(0,0,4,2);let y=new n.aO;y.emplaceBack(0,0,0,0),y.emplaceBack(n.ab,0,n.ab,0),y.emplaceBack(0,n.ab,0,n.ab),y.emplaceBack(n.ab,n.ab,n.ab,n.ab),this.mercatorBoundsBuffer=t.createVertexBuffer(y,n.b4.members),this.mercatorBoundsSegments=n.b2.simpleSegment(0,0,4,2);let b=new n.aP;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);let I=new n.b0;for(let O of[0,1,3,2,0])I.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new n.T(t,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.a6.mat4.create();let A=this.context.gl;this.stencilClearMode=new Yt({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Rt.disabled,this.stencilClearMode,fn.disabled,jt.disabled,au(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,h){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(let A of h)if(this._tileClippingMaskIDs[A.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=o.id;let g=this.context,y=g.gl;this.nextStencilID+h.length>256&&this.clearStencil(),g.setColorMode(fn.disabled),g.setDepthMode(Rt.disabled);let b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let I of h){let A=o.getTile(I),O=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:k,tileBoundsSegments:z}=this.getTileBoundsBuffers(A);b.draw(this,y.TRIANGLES,Rt.disabled,new Yt({func:y.ALWAYS,mask:0},O,255,y.KEEP,y.KEEP,y.REPLACE),fn.disabled,jt.disabled,au(I.projMatrix),"$clipping",P,k,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,o=this.context.gl;return new Yt({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let o=this.context.gl;return new Yt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){let o=this.context.gl,h=t.sort((b,I)=>I.overscaledZ-b.overscaledZ),g=h[h.length-1].overscaledZ,y=h[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();let b={};for(let I=0;I<y;I++)b[I+g]=new Yt({func:o.GEQUAL,mask:255},I+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[b,h]}return[{[g]:Yt.disabled},h]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new fn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.bA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fn.unblended:fn.alphaBlended}colorModeForDrapableLayerRenderPass(t){let o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new fn([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new n.bA(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,h,g=!1){if(this.depthOcclusion)return new Rt(this.context.gl.GREATER,Rt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Rt.disabled;let y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Rt(h||this.context.gl.LEQUAL,o,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let t=this.context.gl,o=Math.ceil(this.width),h=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&h!==0&&(this.depthFBO=new h_(this.context,o,h,!1,"texture"),this.depthTexture=new n.T(this.context,{width:o,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,h,0,0,o,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,o)=>t+o/this._fpsHistory.length,0))}render(t,o){let h=n.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;let g=this.style._mergedLayers,y=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(ve=>{let ye=g[ve];return!(ye.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ye.type]}),b=!1,I=!1;for(let ve of y){let ye=g[ve];ye.type==="circle"&&(b=!0),ye.type==="symbol"&&(ye.hasInitialOcclusionOpacityProperties?I=!0:b=!0)}let A=y.map(ve=>g[ve]),O=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let P=0,k=!1;for(let ve in O){let ye=O[ve];ye.used&&(ye.prepare(this.context),ye.getSource().usedInConflation&&++P)}let z=!1;for(let ve of A)ve.isHidden(this.transform.zoom)||(ve.type==="clip"&&(z=!0),this.prepareLayer(ve));let j={},W={},q={},X={},Z={};for(let ve in O){let ye=O[ve];j[ve]=ye.getVisibleCoordinates(),W[ve]=j[ve].slice().reverse(),q[ve]=ye.getVisibleCoordinates(!0).reverse(),X[ve]=ye.getShadowCasterCoordinates(),Z[ve]=ye.sortCoordinatesByDistance(j[ve])}let Q=ve=>{let ye=this.style.getLayerSourceCache(ve);return ye&&ye.used?ye.getSource():null};if(P||z||this._clippingActiveLastFrame){let ve=[],ye=[],Fe=0;for(let Ue of A)this.isSourceForClippingOrConflation(Ue,Q(Ue))&&(ve.push(Ue),ye.push(Fe)),Fe++;if(ve&&(z||ve.length>1)||this._clippingActiveLastFrame){z=!1;let Ue=[];for(let Je=0;Je<ve.length;Je++){let nt=ve[Je],st=ye[Je],Ie=this.style.getLayerSourceCache(nt);if(!Ie||!Ie.used||!Ie.getSource().usedInConflation&&nt.type!=="clip")continue;let Ze=n.dn,Ne=n.bt.None,Xe=[],Ke=!0;if(nt.type==="clip"){Ze=st;for(let We of nt.layout.get("clip-layer-types"))Ne|=We==="model"?n.bt.Model:We==="symbol"?n.bt.Symbol:n.bt.FillExtrusion;for(let We of nt.layout.get("clip-layer-scope"))Xe.push(We);nt.isHidden(this.transform.zoom)?Ke=!1:z=!0}Ke&&Ue.push({layer:nt.fqid,cache:Ie,order:Ze,clipMask:Ne,clipScope:Xe})}this.replacementSource.setSources(Ue),k=!0}}this._clippingActiveLastFrame=z,k||this.replacementSource.clear(),this.conflationActive=k,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ve=0;ve<A.length;ve++){let ye=A[ve],Fe=ye.cutoffRange();if(this.longestCutoffRange=Math.max(Fe,this.longestCutoffRange),Fe>0){let Ue=Q(ye);Ue&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom)),ye.minzoom&&(this.minCutoffZoom=Math.max(ye.minzoom,this.minCutoffZoom))}ye.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ve),this._lastOcclusionLayer=ve)}let ie=this.style&&this.style.fog;ie?(this._fogVisible=ie.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ie.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(q),this.opaquePassCutoff=0);let re=this._shadowRenderer;if(re){re.updateShadowParameters(this.transform,this.style.directionalLight);for(let ve in O)for(let ye of j[ve]){let Fe={min:0,max:0};this.terrain&&(Fe=this.terrain.getMinMaxForTile(ye)||Fe),re.addShadowReceiver(ye.toUnwrapped(),Fe.min,Fe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Tp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!hs.has(this.context.gl))return;this.renderPass="offscreen";for(let ve of A){let ye=t.getLayerSourceCache(ve);if(!ve.hasOffscreenPass()||ve.isHidden(this.transform.zoom))continue;let Fe=ye?W[ye.id]:void 0;(ve.type==="custom"||ve.type==="raster"||ve.type==="raster-particle"||ve.isSky()||Fe&&Fe.length)&&this.renderLayer(this,ye,ve,Fe)}this.depthRangeFor3D=[0,1-(A.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,X)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),de=(()=>{if(o.showOverdrawInspector)return n.bA.black;let ve=this.style.fog;if(ve&&this.transform.projection.supportsFog){let ye=this.style.getLut(ve.scope);if(!ae){let Fe=ve.properties.get("color").toRenderColor(ye).toArray01();return new n.bA(...Fe)}if(ae){let Fe=ve.properties.get("space-color").toRenderColor(ye).toArray01();return new n.bA(...Fe)}}return n.bA.transparent})();if(this.context.clear({color:de,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){let ve=A[this.currentLayer],ye=t.getLayerSourceCache(ve);if(ve.isSky())continue;let Fe=ye?(ve.is3D()?Z:W)[ye.id]:void 0;this._renderTileClippingMasks(ve,ye,Fe),this.renderLayer(this,ye,ve,Fe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){let ve=A[this.currentLayer],ye=t.getLayerSourceCache(ve);ve.isSky()&&this.renderLayer(this,ye,ve,ye?W[ye.id]:void 0)}function le(ve,ye){let Fe;return ye&&(Fe=(ve.type==="symbol"?q:ve.is3D()?Z:W)[ye.id]),Fe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<y.length;){let ve=A[this.currentLayer];if(ve.type==="raster"||ve.type==="raster-particle"){let ye=t.getLayerSourceCache(ve);this.renderLayer(this,ye,ve,le(ve,ye))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let he=0;re&&(he=re.getShadowCastingLayerCount());let _e=!1,we=-1;for(let ve=0;ve<y.length;++ve){let ye=A[ve];ye.isHidden(this.transform.zoom)||ye.is3D()&&(we=ve)}for(I&&we===-1&&(b=!0);this.currentLayer<y.length;){let ve=A[this.currentLayer],ye=t.getLayerSourceCache(ve);if(ve.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ve)){if(ve.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(b&&!_e&&this.terrain&&!this.transform.isOrthographic&&(_e=!0,this.blitDepth()),I&&we!==-1&&this.currentLayer===we+1&&!this.transform.isOrthographic&&this.blitDepth(),ve.is3D()||this.terrain||this._renderTileClippingMasks(ve,ye,ye?j[ye.id]:void 0),this.renderLayer(this,ye,ve,le(ve,ye)),!this.terrain&&re&&he>0&&ve.hasShadowPass()&&--he==0&&(re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Fe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Fe;this.currentLayer++){let Ue=A[this.currentLayer];if(!Ue.hasLightBeamPass())continue;let Je=t.getLayerSourceCache(Ue);this.renderLayer(this,Je,Ue,Je?W[Je.id]:void 0)}this.currentLayer=Fe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Fe=this.currentLayer;this.depthOcclusion=!0;for(let Ue of this.layersWithOcclusionOpacity){this.currentLayer=Ue;let Je=A[this.currentLayer],nt=t.getLayerSourceCache(Je),st=nt?W[nt.id]:void 0;Je.is3D()||this.terrain||this._renderTileClippingMasks(Je,nt,nt?j[nt.id]:void 0),this.renderLayer(this,nt,Je,st)}this.depthOcclusion=!1,this.currentLayer=Fe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ve=null;A.forEach(ye=>{let Fe=t.getLayerSourceCache(ye);Fe&&!ye.isHidden(this.transform.zoom)&&Fe.getVisibleCoordinates().length&&(!ve||ve.getSource().maxzoom<Fe.getSource().maxzoom)&&(ve=Fe)}),ve&&this.options.showTileBoundaries&&gu.debug(this,ve,ve.getVisibleCoordinates(),n.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&gu.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ve){let ye=ve.transform.padding;Oe(ve,ve.transform.height-(ye.top||0),3,Ul),Oe(ve,ye.bottom||0,3,$l),Ep(ve,ye.left||0,3,ot),Ep(ve,ve.transform.width-(ye.right||0),3,Tt);let Fe=ve.transform.centerPoint;(function(Ue,Je,nt,st){Na(Ue,Je-1,nt-10,2,20,st),Na(Ue,Je-10,nt-1,20,2,st)})(ve,Fe.x,ve.transform.height-Fe.y,Gl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),k||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);let{unsupportedLayers:o}=this.transform.projection,h=!o||!o.includes(t.type);if(bs[t.type]&&(h||this.terrain&&t.type==="custom")){let g=this.style.getLayerSourceCache(t);bs[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,o,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||g&&g.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||gu[h.type](t,o,h,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let o=this.context.extTimerQuery,h=this.context.gl,g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),g.calls++,h.beginQuery(o.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,o=this.context.gl,h=o.createQuery();this.deferredRenderGpuTimeQueries.push(h),o.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let o={};for(let h in t){let g=t[h],y=this.context.extTimerQuery,b=y.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(g.query),o[h]=b}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let o=this.context.gl,h=0;for(let g of t)h+=o.getQueryParameter(g,o.QUERY_RESULT)/1e6,o.deleteQuery(g);return h}translatePosMatrix(t,o,h,g,y){if(!h[0]&&!h[1])return t;let b=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(b){let O=Math.sin(b),P=Math.cos(b);h=[h[0]*P-h[1]*O,h[0]*O+h[1]*P]}let I=[y?h[0]:n.ak(o,h[0],this.transform.zoom),y?h[1]:n.ak(o,h[1],this.transform.zoom),0],A=new Float32Array(16);return n.a6.mat4.translate(A,t,I),A}saveTileTexture(t){let o=t.size[0],h=this._tileTextures[o];h?h.push(t):this._tileTextures[o]=[t]}getTileTexture(t){let o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,h){let g=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||g||o!==void 0&&!o||y.push("FOG","FOG_DITHERING"),g&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,o){this.cache=this.cache||{};let h=o&&o.defines||[],g=o&&o.config,y=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(h),b=vs.cacheKey(Xs[t],t,y,g);return this.cache[b]||(this.cache[b]=new vs(this.context,t,Xs[t],g,ka[t],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){let h=this.style.directionalLight,g=this.style.ambientLight;if(h&&g){let y=((b,I,A)=>{let O=b.properties.get("direction"),P=b.properties.get("color").toRenderColor(A.getLut(b.scope)).toArray01(),k=b.properties.get("intensity"),z=I.properties.get("color").toRenderColor(A.getLut(I.scope)).toArray01(),j=I.properties.get("intensity"),W=[O.x,O.y,O.z],q=n.cH(z,j),X=n.cH(P,k);return{u_lighting_ambient_color:q,u_lighting_directional_dir:W,u_lighting_directional_color:X,u_ground_radiance:ap(W,X,q)}})(h,g,this.style);o.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,o,h,g,y){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;let b=this.style.fog;if(b){let I=b.getOpacity(this.transform.pitch),A=((O,P,k,z,j,W,q,X,Z,Q,ie,re)=>{let ae=O.transform,de=P.properties.get("color").toRenderColor(O.style.getLut(P.scope)).toArray01();de[3]=z;let le=O.frameCounter/1e3%1,[he,_e]=P.properties.get("vertical-range");return{u_fog_matrix:k?ae.calculateFogTileMatrix(k):re||O.identityMat,u_fog_range:P.getFovAdjustedRange(ae._fov),u_fog_color:de,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,_e),_e],u_fog_temporal_offset:le,u_frustum_tl:j,u_frustum_tr:W,u_frustum_br:q,u_frustum_bl:X,u_globe_pos:Z,u_globe_radius:Q,u_viewport:ie,u_globe_transition:n.a9(ae.zoom),u_is_globe:+(ae.projection.name==="globe")}})(this,b,h,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],g);o.setFogUniformValues(t,A)}y&&o.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,o=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(let g of h)o[g.key]=t[g.key]||new $o(g,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=it||o[1]>=it}setupDepthForOcclusion(t,o,h){let g=this.context,y=g.gl,b=!!h;var I;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),g.activeTexture.set(y.TEXTURE0),b||o.setTerrainUniformValues(g,h)}}function ws(d,t){let o=!1,h=null,g=()=>{h=null,o&&(d(),h=setTimeout(g,t),o=!1)};return()=>(o=!0,h||g(),h)}class Xd{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ws(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let o=_u(t);if(this._hashName){let h=this._hashName,g=!1,y=location.hash.slice(1).split("&").map(b=>{let I=b.split("=")[0];return I===h?(g=!0,`${I}=${o}`):b}).filter(b=>b);return g||y.push(`${h}=${o}`),`#${y.join("&")}`}return`#${o}`}_getCurrentHash(){let t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(o=h)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){let h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function _u(d,t){let o=d.getCenter(),h=Math.round(100*d.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),b=Math.round(o.lng*y)/y,I=Math.round(o.lat*y)/y,A=d.getBearing(),O=d.getPitch(),P=t?`/${b}/${I}/${h}`:`${h}/${I}/${b}`;return(A||O)&&(P+="/"+Math.round(10*A)/10),O&&(P+=`/${Math.round(O)}`),P}let ql={linearity:.3,easing:n.dp(0,0,.3,1)},Ap=n.l({deceleration:2500,maxSpeed:1400},ql),Pp=n.l({deceleration:20,maxSpeed:1400},ql),ea=n.l({deceleration:1e3,maxSpeed:360},ql),Rp=n.l({deceleration:1e3,maxSpeed:90},ql);class Yd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,o=n.q.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let o={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);let h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(o.pan.mag()){let y=Zl(o.pan.mag(),h,n.l({},Ap,t||{}));g.offset=o.pan.mult(y.amount/o.pan.mag()),g.center=this._map.transform.center,Wl(g,y)}if(o.zoom){let y=Zl(o.zoom,h,Pp);g.zoom=this._map.transform.zoom+y.amount,Wl(g,y)}if(o.bearing){let y=Zl(o.bearing,h,ea);g.bearing=this._map.transform.bearing+n.ap(y.amount,-179,179),Wl(g,y)}if(o.pitch){let y=Zl(o.pitch,h,Rp);g.pitch=this._map.transform.pitch+y.amount,Wl(g,y)}if(g.zoom||g.bearing){let y=o.pinchAround===void 0?o.around:o.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function Wl(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function Zl(d,t,o){let{maxSpeed:h,linearity:g,deceleration:y}=o,b=n.ap(d*g/(t/1e3),-h,h),I=Math.abs(b)/(y*g);return{easing:o.easing,duration:1e3*I,amount:b*(I/2)}}class _i extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,h,g={}){let y=xi(o.getCanvasContainer(),h),b=o.unproject(y);super(t,n.l({point:y,lngLat:b,originalEvent:h},g)),this._defaultPrevented=!1,this.target=o}}class Xl extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,h){let g=t==="touchend"?h.changedTouches:h.touches,y=Qi(o.getCanvasContainer(),g),b=y.map(A=>o.unproject(A)),I=y.reduce((A,O,P,k)=>A.add(O.div(k.length)),new n.P(0,0));super(t,{points:y,point:I,lngLats:b,lngLat:o.unproject(I),originalEvent:h}),this._defaultPrevented=!1}}class Op extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class Yl{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Op(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new _i(t.type,this._map,t))}mouseup(t){this._map.fire(new _i(t.type,this._map,t))}preclick(t){let o=n.l({},t);o.type="preclick",this._map.fire(new _i(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new _i(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new _i(t.type,this._map,t))}mouseover(t){this._map.fire(new _i(t.type,this._map,t))}mouseout(t){this._map.fire(new _i(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Xl(t.type,this._map,t))}touchmove(t){this._map.fire(new Xl(t.type,this._map,t))}touchend(t){this._map.fire(new Xl(t.type,this._map,t))}touchcancel(t){this._map.fire(new Xl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ba{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new _i(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new _i(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lp{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ut(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;let h=o,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(h)||!this._box&&h.dist(g)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=Ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let b=Math.min(g.x,h.x),I=Math.max(g.x,h.x),A=Math.min(g.y,h.y),O=Math.max(g.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=I-b+"px",this._box.style.height=O-A+"px")})}mouseupWindow(t,o){if(!this._active)return;let h=this._startPos,g=o;if(h&&t.button===0){if(this.reset(),Pt(),h.x!==g.x||h.y!==g.y)return this._map.fire(new n.x("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(h,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ln(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new n.x(t,{originalEvent:o}))}}function Jd(d,t){let o={};for(let h=0;h<d.length;h++)o[d[h].identifier]=t[h];return o}class C_{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){let y=new n.P(0,0);for(let b of g)y._add(b);return y.div(g.length)}(o),this.touches=Jd(h,o)))}touchmove(t,o,h){if(this.aborted||!this.centroid)return;let g=Jd(h,o);for(let y in this.touches){let b=g[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,o,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class yu{constructor(t){this.singleTap=new C_(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,h){this.singleTap.touchstart(t,o,h)}touchmove(t,o,h){this.singleTap.touchmove(t,o,h)}touchend(t,o,h){let g=this.singleTap.touchend(t,o,h);if(g){let y=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(g)<30;if(y&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Fp{constructor(){this._zoomIn=new yu({numTouches:1,numTaps:2}),this._zoomOut=new yu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,h){this._zoomIn.touchstart(t,o,h),this._zoomOut.touchstart(t,o,h)}touchmove(t,o,h){this._zoomIn.touchmove(t,o,h),this._zoomOut.touchmove(t,o,h)}touchend(t,o,h){let g=this._zoomIn.touchend(t,o,h),y=this._zoomOut.touchend(t,o,h);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(g)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let vu={0:1,2:2};class xu{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;let h=zt(t);this._correctButton(t,h)&&(this._lastPoint=o,this._eventButton=h)}mousemoveWindow(t,o){let h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(g,y){let b=vu[y];return g.buttons===void 0||(g.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(h,o)}}mouseupWindow(t){this._lastPoint&&zt(t)===this._eventButton&&(this._moved&&Pt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kd extends xu{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Qd extends xu{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){let h=.8*(o.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){t.preventDefault()}}class eh extends xu{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){let h=-.5*(o.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){t.preventDefault()}}class E_{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,o,h){return this._calculateTransform(t,o,h)}touchmove(t,o,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!n.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,h)}}touchend(t,o,h){this._calculateTransform(t,o,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,h){h.length>0&&(this._active=!0);let g=Jd(h,o),y=new n.P(0,0),b=new n.P(0,0),I=0;for(let O in g){let P=g[O],k=this._touches[O];k&&(y._add(P),b._add(P.sub(k)),I++,g[O]=P)}if(this._touches=g,I<this._minTouches||!b.mag())return;let A=b.div(I);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(I),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class th{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,h){return{}}touchstart(t,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,h){let g=this._firstTwoTouches;if(!g)return;t.preventDefault();let[y,b]=g,I=bu(h,o,y),A=bu(h,o,b);if(!I||!A)return;let O=this._aroundCenter?null:I.add(A).div(2);return this._move([I,A],O,t)}touchend(t,o,h){if(!this._firstTwoTouches)return;let[g,y]=this._firstTwoTouches,b=bu(h,o,g),I=bu(h,o,y);b&&I||(this._active&&Pt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bu(d,t,o){for(let h=0;h<d.length;h++)if(d[h].identifier===o)return t[h]}function kp(d,t){return Math.log(d/t)/Math.LN2}class M_ extends th{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){let h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(kp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:kp(this._distance,h),pinchAround:o}}}function Np(d,t){return 180*d.angleWith(t)/Math.PI}class S_ extends th{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){let h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Np(this._vector,h),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let o=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;let g=Np(t,h);return Math.abs(g)<o}}function nh(d){return Math.abs(d.y)>Math.abs(d.x)}class T_ extends th{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,nh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,h){let g=this._lastPoints;if(!g)return;let y=t[0].sub(g[0]),b=t[1].sub(g[1]);return this._map._cooperativeGestures&&!n.dq()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(y,b,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5})}gestureBeginsVertically(t,o,h){if(this._valid!==void 0)return this._valid;let g=t.mag()>=2,y=o.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;let b=t.y>0==o.y>0;return nh(t)&&nh(o)&&b}}let I_={panStep:100,bearingStep:15,pitchStep:10};class D_{constructor(){let t=I_;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,h=0,g=0,y=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:I=>{let A=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:A_,zoom:o?Math.round(A)+o*(t.shiftKey?2:1):A,bearing:I.getBearing()+h*this._bearingStep,pitch:I.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function A_(d){return d*(2-d)}let zp=4.000244140625,Ix=1/450;class Dx{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ix,n.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,h=n.q.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%zp==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let o=xi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let O=this._type==="wheel"&&Math.abs(this._delta)>zp?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&P!==0&&(P=1/P);let k=o(),z=Math.pow(2,k),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*P))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let h=typeof this._targetZoom=="number"?this._targetZoom:o(),g=this._startZoom,y=this._easing,b,I=!1;if(this._type==="wheel"&&g&&y){let O=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),P=y(O);b=n.aa(g,h,P),O<1?this._frameId||(this._frameId=!0):I=!0}else b=h,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=b-o();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=n.dr;if(this._prevEase){let h=this._prevEase,g=(n.q.now()-h.start)/h.duration,y=h.easing(g+.01)-h.easing(g),b=.27/Math.sqrt(y*y+1e-4)*.01,I=Math.sqrt(.0729-b*b);o=n.dp(b,I,.25,1)}return this._prevEase={start:n.q.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Mi{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class P_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ax{constructor(){this._tap=new yu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=o[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,o,h))}touchmove(t,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;let g=o[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,o,h)}touchend(t,o,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,o,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Px{constructor(t,o,h){this._el=t,this._mousePan=o,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class wu{constructor(t,o,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class R_{constructor(t,o,h,g){this._el=t,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Jl=d=>d.zoom||d.drag||d.pitch||d.rotate;class ih extends n.x{}class Cs{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){let h=n.a6.vec3.sub([],o,t);this.radius=n.a6.vec3.length(h[2]<0?n.a6.vec3.div([],h,this.constants):[h[0],h[1],0])}projectRay(t){n.a6.vec3.div(t,t,this.constants),n.a6.vec3.normalize(t,t),n.a6.vec3.mul(t,t,this.constants);let o=n.a6.vec3.scale([],t,this.radius);if(o[2]>0){let h=n.a6.vec3.scale([],[0,0,1],n.a6.vec3.dot(o,[0,0,1])),g=n.a6.vec3.scale([],n.a6.vec3.normalize([],[o[0],o[1],0]),this.radius),y=n.a6.vec3.add([],o,n.a6.vec3.scale([],n.a6.vec3.sub([],n.a6.vec3.add([],g,h),o),2));o[0]=y[0],o[1]=y[1]}return o}}function Va(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class $i{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yd(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Cs,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.aJ(["handleEvent","handleWindowEvent"],this);let h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(let[g,y,b]of this._listeners){let I=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(y,I,b)}}destroy(){for(let[t,o,h]of this._listeners){let g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,g,h)}}_addDefaultHandlers(t){let o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Yl(o,t));let g=o.boxZoom=new Lp(o,t);this._add("boxZoom",g);let y=new Fp,b=new P_;o.doubleClickZoom=new Mi(b,y),this._add("tapZoom",y),this._add("clickZoom",b);let I=new Ax;this._add("tapDragZoom",I);let A=o.touchPitch=new T_(o);this._add("touchPitch",A);let O=new Qd(t),P=new eh(t);o.dragRotate=new wu(t,O,P),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let k=new Kd(t),z=new E_(o,t);o.dragPan=new Px(h,k,z),this._add("mousePan",k),this._add("touchPan",z,["touchZoom","touchRotate"]);let j=new S_,W=new M_;o.touchZoomRotate=new R_(h,W,j,I),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ba(o));let q=o.scrollZoom=new Dx(o,this);this._add("scrollZoom",q,["mousePan"]);let X=o.keyboard=new D_;this._add("keyboard",X);for(let Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Z]&&o[Z].enable(t[Z])}_add(t,o,h){this._handlers.push({handlerName:t,handler:o,allowed:h}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(let{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Jl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,h){for(let g in t)if(g!==h&&(!o||o.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let o=[];for(let h of t)this._el.contains(h.target)&&o.push(h);return o}handleEvent(t,o){this._updatingCamera=!0;let h=t.type==="renderFrame",g=h?void 0:t,y={needsRenderFrame:!1},b={},I={},A=t.touches?this._getMapTouches(t.touches):void 0,O=A?Qi(this._el,A):h?void 0:xi(this._el,t);for(let{handlerName:z,handler:j,allowed:W}of this._handlers){if(!j.isEnabled())continue;let q;this._blockedByActive(I,W,z)?j.reset():j[o||t.type]&&(q=j[o||t.type](t,O,A),this.mergeHandlerResult(y,b,q,z,g),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||j.isActive())&&(I[z]=j)}let P={};for(let z in this._previousActiveHandlers)I[z]||(P[z]=g);this._previousActiveHandlers=I,(Object.keys(P).length||Va(y))&&(this._changes.push([y,b,P]),this._triggerRenderFrame()),(Object.keys(I).length||Va(y))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:k}=y;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(t,o,h,g,y){if(!h)return;n.l(t,h);let b={handlerName:g,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(o.zoom=b),h.panDelta!==void 0&&(o.drag=b),h.pitchDelta!==void 0&&(o.pitch=b),h.bearingDelta!==void 0&&(o.rotate=b)}_applyChanges(){let t={},o={},h={};for(let[g,y,b]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),n.l(o,y),n.l(h,b);this._updateMapTransform(t,o,h),this._changes=[]}_updateMapTransform(t,o,h){let g=this._map,y=g.transform,b=Q=>[Q.x,Q.y,Q.z];if((Q=>{let ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!Va(t)){let Q=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),Q!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!Va(t))return void this._fireEvents(o,h,!0);let{panDelta:I,zoomDelta:A,bearingDelta:O,pitchDelta:P,around:k,aroundCoord:z,pinchAround:j}=t;y._isCameraConstrained&&(A>0&&(A=0),y._isCameraConstrained=!1),j!==void 0&&(k=j),(A||(Q=>o[Q]&&!this._eventsInProgress[Q])("drag"))&&k&&(this._dragOrigin=b(y.pointCoordinate3D(k)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),k=k||g.transform.centerPoint,O&&(y.bearing+=O),P&&(y.pitch+=P),y._updateCameraState();let W=[0,0,0];if(I)if(y.projection.name==="mercator"){let Q=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(k).dir),ie=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(k.sub(I)).dir);W[0]=ie[0]-Q[0],W[1]=ie[1]-Q[1]}else{let Q=y.pointCoordinate(k);if(y.projection.name==="globe"){I=I.rotate(-y.angle);let ie=y._pixelsPerMercatorPixel/y.worldSize;W[0]=-I.x*n.ds(n.aN(Q.y))*ie,W[1]=-I.y*n.ds(y.center.lat)*ie}else{let ie=y.pointCoordinate(k.sub(I));Q&&ie&&(W[0]=ie.x-Q.x,W[1]=ie.y-Q.y)}}let q=y.zoom,X=[0,0,0];if(A){let Q=b(z||y.pointCoordinate3D(k)),ie={dir:n.a6.vec3.normalize([],n.a6.vec3.sub([],Q,y._camera.position))};if(ie.dir[2]<0){let re=y.zoomDeltaToMovement(Q,A);n.a6.vec3.scale(X,ie.dir,re)}}let Z=n.a6.vec3.add(W,W,X);y._translateCameraConstrained(Z),A&&Math.abs(y.zoom-q)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,h,!0)}_fireEvents(t,o,h){let g=Jl(this._eventsInProgress),y=Jl(t),b={};for(let P in t){let{originalEvent:k}=t[P];this._eventsInProgress[P]||(b[`${P}start`]=k),this._eventsInProgress[P]=t[P]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(let P in b)this._fireEvent(P,b[P]);y&&this._fireEvent("move",y.originalEvent);for(let P in t){let{originalEvent:k}=t[P];this._fireEvent(P,k)}let I={},A;for(let P in this._eventsInProgress){let{handlerName:k,originalEvent:z}=this._eventsInProgress[P];this._handlersById[k].isActive()||(delete this._eventsInProgress[P],A=o[k]||z,I[`${P}end`]=A)}for(let P in I)this._fireEvent(P,I[P]);let O=Jl(this._eventsInProgress);if(h&&(g||y)&&!O){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;P?(k(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:A})):(this._map.fire(new n.x("moveend",{originalEvent:A})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new n.x(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new ih("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let qo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Bp extends n.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.aJ(["_renderFrameCallback"],this)}getCenter(){return new n.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,h){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,n.l({offset:t},o),h)}panTo(t,o,h){return this.easeTo(n.l({center:t},o),h)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,h){return this.easeTo(n.l({zoom:t},o),h)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,h){return this.easeTo(n.l({bearing:t},o),h)}resetNorth(t,o){return this.rotateTo(0,n.l({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=n.as.convert(t);let h=o&&o.bearing||0,g=o&&o.pitch||0,y=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,y,b,h,g,o)}_extendPadding(t){let o={top:0,right:0,bottom:0,left:0};return t==null?n.l({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:n.l({},o,t)}_extendCameraOptions(t){return(t=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){let h=o.max[0]-o.min[0],g=o.max[1]-o.min[1];return h/g>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,h,g,y,b){let I=t.clone(),A=this._extendCameraOptions(b);I.bearing=g,I.pitch=y;let O=n.bL.convert(o),P=n.bL.convert(h),k=.5*(O.lat+P.lat),z=.5*(O.lng+P.lng),j=n.dt(k,z),W=n.a6.vec3.normalize([],j),q=n.a6.vec3.normalize([],n.a6.vec3.cross([],W,[0,1,0])),X=n.a6.vec3.cross([],q,W),Z=[q[0],q[1],q[2],0,X[0],X[1],X[2],0,W[0],W[1],W[2],0,0,0,0,1],Q=[j,n.dt(O.lat,O.lng),n.dt(P.lat,O.lng),n.dt(P.lat,P.lng),n.dt(O.lat,P.lng),n.dt(k,O.lng),n.dt(k,P.lng),n.dt(O.lat,z),n.dt(P.lat,z)],ie=n.ca.fromPoints(Q.map(Ne=>[n.a6.vec3.dot(q,Ne),n.a6.vec3.dot(X,Ne),n.a6.vec3.dot(W,Ne)])),re=n.a6.vec3.transformMat4([],ie.center,Z);n.a6.vec3.squaredLength(re)===0&&n.a6.vec3.set(re,0,0,1),n.a6.vec3.normalize(re,re),n.a6.vec3.scale(re,re,n.aq),I.center=n.du(re);let ae=I.getWorldToCameraMatrix(),de=n.a6.mat4.invert(new Float64Array(16),ae);ie=n.ca.applyTransform(ie,n.a6.mat4.multiply([],ae,Z));let le=this._extendAABB(ie,I,A,g);if(!le)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ie=le,n.a6.vec3.transformMat4(re,re,ae);let he=.5*(ie.max[2]-ie.min[2]),_e=this._minimumAABBFrustumDistance(I,ie),we=n.a6.vec3.scale([],[0,0,1],he),ve=n.a6.vec3.add(we,re,we),ye=_e+(I.pitch===0?0:n.a6.vec3.distance(re,ve)),Fe=I.globeCenterInViewSpace,Ue=n.a6.vec3.sub([],re,[Fe[0],Fe[1],Fe[2]]);n.a6.vec3.normalize(Ue,Ue),n.a6.vec3.scale(Ue,Ue,ye);let Je=n.a6.vec3.add([],re,Ue);n.a6.vec3.transformMat4(Je,Je,de);let nt=n.dw/n.aq,st=n.a6.vec3.length(Je),Ie=n.bE(Math.max(st*nt-n.dw,Number.EPSILON),0),Ze=Math.min(I.zoomFromMercatorZAdjusted(Ie),A.maxZoom);return Ze>.5*(n.c3+n.bV)?(I.setProjection({name:"mercator"}),I.zoom=Ze,this._cameraForBounds(I,o,h,g,y,b)):{center:I.center,zoom:Ze,bearing:g,pitch:y}}_extendAABB(t,o,h,g){let y=.5*((h.padding.left||0)+(h.padding.right||0)),b=.5*((h.padding.top||0)+(h.padding.bottom||0)),I=b,A=y,O=y,P=b,k=o.width-(A+O),z=o.height-(I+P),j=n.a6.vec3.sub([],t.max,t.min),W=Math.min(k/j[0],z/j[1]),q=Math.min(o.scaleZoom(o.scale*W),h.maxZoom);if(isNaN(q))return null;let X=o.scale/o.zoomScale(q),Z=new n.ca([t.min[0]-A*X,t.min[1]-P*X,t.min[2]],[t.max[0]+O*X,t.max[1]+I*X,t.max[2]]),Q=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new n.P(h.offset.x,h.offset.y):n.P.convert(h.offset)).rotate(-n.bC(g));return Z.center[0]-=Q.x*X,Z.center[1]+=Q.y*X,Z}queryTerrainElevation(t,o){let h=this.transform.elevation;return h?(o=n.l({},{exaggerated:!0},o),h.getAtPoint(n.a5.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,h,g,y,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,h,g,y,b);let I=t.clone(),A=this._extendCameraOptions(b);I.bearing=g,I.pitch=y;let O=n.bL.convert(o),P=n.bL.convert(h),k=new n.bL(O.lng,P.lat),z=new n.bL(P.lng,O.lat),j=I.project(O),W=I.project(P),q=this.queryTerrainElevation(O),X=this.queryTerrainElevation(P),Z=this.queryTerrainElevation(k),Q=this.queryTerrainElevation(z),ie=[[j.x,j.y,Math.min(q||0,X||0,Z||0,Q||0)],[W.x,W.y,Math.max(q||0,X||0,Z||0,Q||0)]],re=n.ca.fromPoints(ie),ae=I.getWorldToCameraMatrix(),de=n.a6.mat4.invert(new Float64Array(16),ae);re=n.ca.applyTransform(re,ae);let le=this._extendAABB(re,I,A,g);if(!le)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=le;let he=.5*n.a6.vec3.sub([],re.max,re.min)[2],_e=this._minimumAABBFrustumDistance(I,re),we=[0,0,1,0];n.a6.vec4.transformMat4(we,we,ae),n.a6.vec4.normalize(we,we);let ve=n.a6.vec3.scale([],we,_e+he),ye=n.a6.vec3.add([],re.center,ve);n.a6.vec3.transformMat4(re.center,re.center,de),n.a6.vec3.transformMat4(ye,ye,de);let Fe=I.unproject(new n.P(re.center[0],re.center[1])),Ue=n.dv(I.projection,Fe),Je=Math.pow(2,Ue),nt=Math.min(I._zoomFromMercatorZ(ye[2]*I.pixelsPerMeter*Je/I.worldSize),A.maxZoom);return I.mercatorFromTransition&&nt<.5*(n.c3+n.bV)?(I.setProjection({name:"globe"}),I.zoom=nt,this._cameraForBounds(I,o,h,g,y,b)):{center:Fe,zoom:nt,bearing:g,pitch:y}}fitBounds(t,o,h){let g=this.cameraForBounds(t,o);return this._fitInternal(g,o,h)}fitScreenCoordinates(t,o,h,g,y){let b=n.P.convert(t),I=n.P.convert(o),A=new n.P(Math.min(b.x,I.x),Math.min(b.y,I.y)),O=new n.P(Math.max(b.x,I.x),Math.max(b.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,I))return this;let P=this.transform.pointLocation3D(A),k=this.transform.pointLocation3D(O),z=this.transform.pointLocation3D(new n.P(A.x,O.y)),j=this.transform.pointLocation3D(new n.P(O.x,A.y)),W=[Math.min(P.lng,k.lng,z.lng,j.lng),Math.min(P.lat,k.lat,z.lat,j.lat)],q=[Math.max(P.lng,k.lng,z.lng,j.lng),Math.max(P.lat,k.lat,z.lat,j.lat)],X=g&&g.pitch?g.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,W,q,h,X,g);return this._fitInternal(Z,g,y)}_fitInternal(t,o,h){return t?(o=n.l(t,o)).linear?this.easeTo(o,h):this.flyTo(o,h):this}jumpTo(t,o){this.stop();let h=t.preloadOnly?this.transform.clone():this.transform,g=!1,y=!1,b=!1;"zoom"in t&&h.zoom!==+t.zoom&&(g=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=n.bL.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(y=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(b=!0,h.pitch=+t.pitch);let I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(I))if(t.retainPadding===!1){let A=h.clone();A.padding=I,h.setLocationAtPoint(h.center,A.centerPoint)}else h.padding=I;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new n.x("movestart",o)).fire(new n.x("move",o)),g&&this.fire(new n.x("zoomstart",o)).fire(new n.x("zoom",o)).fire(new n.x("zoomend",o)),y&&this.fire(new n.x("rotatestart",o)).fire(new n.x("rotate",o)).fire(new n.x("rotateend",o)),b&&this.fire(new n.x("pitchstart",o)).fire(new n.x("pitch",o)).fire(new n.x("pitchend",o)),this.fire(new n.x("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(qo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){let h=this.transform;if(!h.projection.supportsFreeCamera)return n.w(qo),this;this.stop();let g=h.zoom,y=h.pitch,b=h.bearing;h.setFreeCameraOptions(t);let I=g!==h.zoom,A=y!==h.pitch,O=b!==h.bearing;return this.fire(new n.x("movestart",o)).fire(new n.x("move",o)),I&&this.fire(new n.x("zoomstart",o)).fire(new n.x("zoom",o)).fire(new n.x("zoomend",o)),O&&this.fire(new n.x("rotatestart",o)).fire(new n.x("rotate",o)).fire(new n.x("rotateend",o)),A&&this.fire(new n.x("pitchstart",o)).fire(new n.x("pitch",o)).fire(new n.x("pitchend",o)),this.fire(new n.x("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=n.l({offset:[0,0],duration:500,easing:n.dr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let h=this.transform,g=this.getZoom(),y=this.getBearing(),b=this.getPitch(),I=this.getPadding(),A="zoom"in t?+t.zoom:g,O="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:b,k=this._extendPadding(t.padding),z=n.P.convert(t.offset),j,W,q;if(h.projection.name==="globe"){let we=n.a5.fromLngLat(h.center),ve=z.rotate(-h.angle);we.x+=ve.x/h.worldSize,we.y+=ve.y/h.worldSize;let ye=we.toLngLat(),Fe=n.bL.convert(t.center||ye);this._normalizeCenter(Fe),j=h.centerPoint.add(ve),W=new n.P(we.x,we.y).mult(h.worldSize),q=new n.P(n.am(Fe.lng),n.at(Fe.lat)).mult(h.worldSize).sub(W)}else{j=h.centerPoint.add(z);let we=h.pointLocation(j),ve=n.bL.convert(t.center||we);this._normalizeCenter(ve),W=h.project(we),q=h.project(ve).sub(W)}let X=h.zoomScale(A-g),Z,Q;t.around&&(Z=n.bL.convert(t.around),Q=h.locationPoint(Z));let ie=this._zooming||A!==g,re=this._rotating||y!==O,ae=this._pitching||P!==b,de=!h.isPaddingEqual(k),le=t.retainPadding===!1?h.clone():h,he=we=>ve=>{if(ie&&(we.zoom=n.aa(g,A,ve)),re&&(we.bearing=n.aa(y,O,ve)),ae&&(we.pitch=n.aa(b,P,ve)),de&&(le.interpolatePadding(I,k,ve),j=le.centerPoint.add(z)),Z)we.setLocationAtPoint(Z,Q);else{let ye=we.zoomScale(we.zoom-g),Fe=A>g?Math.min(2,X):Math.max(.5,X),Ue=Math.pow(Fe,1-ve),Je=we.unproject(W.add(q.mult(ve*Ue)).mult(ye));we.setLocationAtPoint(we.renderWorldCopies?Je.wrap():Je,j)}return t.preloadOnly||this._fireMoveEvents(o),we};if(t.preloadOnly){let we=this._emulate(he,t.duration,h);return this._preloadTiles(we),this}let _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=re,this._pitching=ae,this._padding=de,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,_e),this._ease(he(h),we=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(o,we)},t),this}_prepareEase(t,o,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||h.moving||this.fire(new n.x("movestart",t)),this._zooming&&!h.zooming&&this.fire(new n.x("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new n.x("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new n.x("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.x("move",t)),this._zooming&&this.fire(new n.x("zoom",t)),this._rotating&&this.fire(new n.x("rotate",t)),this._pitching&&this.fire(new n.x("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let h=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new n.x("zoomend",t)),g&&this.fire(new n.x("rotateend",t)),y&&this.fire(new n.x("pitchend",t)),this.fire(new n.x("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){let Ne=n.ar(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ne,o)}this.stop(),t=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dr},t);let h=this.transform,g=this.getZoom(),y=this.getBearing(),b=this.getPitch(),I=this.getPadding(),A="zoom"in t?n.ap(+t.zoom,h.minZoom,h.maxZoom):g,O="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:b,k=this._extendPadding(t.padding),z=h.zoomScale(A-g),j=n.P.convert(t.offset),W=h.centerPoint.add(j),q=h.pointLocation(W),X=n.bL.convert(t.center||q);this._normalizeCenter(X);let Z=h.project(q),Q=h.project(X).sub(Z),ie=t.curve,re=Math.max(h.width,h.height),ae=re/z,de=Q.mag();if("minZoom"in t){let Ne=n.ap(Math.min(t.minZoom,g,A),h.minZoom,h.maxZoom),Xe=re/h.zoomScale(Ne-g);ie=Math.sqrt(Xe/de*2)}let le=ie*ie;function he(Ne){let Xe=(ae*ae-re*re+(Ne?-1:1)*le*le*de*de)/(2*(Ne?ae:re)*le*de);return Math.log(Math.sqrt(Xe*Xe+1)-Xe)}function _e(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function we(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}let ve=he(0),ye=function(Ne){return we(ve)/we(ve+ie*Ne)},Fe=function(Ne){return re*((we(ve)*(_e(Xe=ve+ie*Ne)/we(Xe))-_e(ve))/le)/de;var Xe},Ue=(he(1)-ve)/ie;if(Math.abs(de)<1e-6||!isFinite(Ue)){if(Math.abs(re-ae)<1e-6)return this.easeTo(t,o);let Ne=ae<re?-1:1;Ue=Math.abs(Math.log(ae/re))/ie,Fe=function(){return 0},ye=function(Xe){return Math.exp(Ne*ie*Xe)}}t.duration="duration"in t?+t.duration:1e3*Ue/("screenSpeed"in t?+t.screenSpeed/ie:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let Je=y!==O,nt=P!==b,st=!h.isPaddingEqual(k),Ie=t.retainPadding===!1?h.clone():h,Ze=Ne=>Xe=>{let Ke=Xe*Ue,We=1/ye(Ke);Ne.zoom=Xe===1?A:g+Ne.scaleZoom(We),Je&&(Ne.bearing=n.aa(y,O,Xe)),nt&&(Ne.pitch=n.aa(b,P,Xe)),st&&(Ie.interpolatePadding(I,k,Xe),W=Ie.centerPoint.add(j));let ut=Xe===1?X:Ne.unproject(Z.add(Q.mult(Fe(Ke))).mult(We));return Ne.setLocationAtPoint(Ne.renderWorldCopies?ut.wrap():ut,W),Ne._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),Ne};if(t.preloadOnly){let Ne=this._emulate(Ze,t.duration,h);return this._preloadTiles(Ne),this}return this._zooming=!0,this._rotating=Je,this._pitching=nt,this._padding=st,this._prepareEase(o,!1),this._ease(Ze(h),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,o)}if(!t){let h=this.handlers;h&&h.stop(!1)}return this}_ease(t,o,h){h.animate===!1||h.duration===0?(t(1),o()):(this._easeStart=n.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=n.bB(t,-180,180);let h=Math.abs(t-o);return Math.abs(t-360-o)<h&&(t-=360),Math.abs(t+360-o)<h&&(t+=360),t}_normalizeCenter(t){let o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;let h=t.lng-o.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,h){let g=Math.ceil(15*o/1e3),y=[],b=t(h.clone());for(let I=0;I<=g;I++){let A=b(I/g);y.push(A.clone())}return y}_preloadTiles(t,o){}}class rh{constructor(t={}){this.options=t,n.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let o=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ye("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);let g=Ye("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",h),this._innerContainer=Ye("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){let h=o.reduce((g,y,b)=>(y.value&&(g+=`${y.key}=${y.value}${b<o.length-1?"&":""}`),g),"?");t.href=`${n.e.FEEDBACK_URL}/${h}#${_u(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let o=this._map.style._mergedSourceCaches;for(let g in o){let y=o[g];if(y.used){let b=y.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((g,y)=>g.length-y.length),t=t.filter((g,y)=>{for(let b=y+1;b<t.length;b++)if(t[b].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Vp{constructor(){n.aJ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Ye("div","mapboxgl-ctrl");let o=Ye("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let o in t){let h=t[o].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class O_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){let o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(let g of h)if(g.id===t)return void(g.cancelled=!0)}run(t=0){let o=this._currentlyRunning=this._queue;this._queue=[];for(let h of o)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Cu{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let o=n.cw((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,h){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+h}}let Rx={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},L_=["mouseenter","mouseover","mouseleave","mouseout"];class oh extends n.x{constructor(t,o,h,g){let{point:y,lngLat:b,originalEvent:I,target:A}=t;super(t.type,{point:y,lngLat:b,originalEvent:I,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=h,this.feature=g}}class jp{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);let{type:h,filter:g}=o;if(g){let b=n.M(g,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(b.result==="error")throw new Error(b.value.map(I=>`${I.key}: ${I.message}`).join(", "));this.filters.set(t,b.value)}let y=this.interactionsByType.get(h)||new Map;y.size===0&&(L_.includes(h)?this.map.on(h,o.featureset,this.handleType):this.map.on(h,this.handleType),this.interactionsByType.set(h,y)),y.set(t,o),this.typeById.set(t,h)}remove(t){let o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);let h=this.interactionsByType.get(o);h&&(h.delete(t),h.size===0&&this.map.off(o,this.handleType))}handleType(t){let o=this.interactionsByType.get(t.type),h=Array.from(o).reverse(),g=[];for(let[,I]of h)I.featureset&&g.push({featureset:I.featureset,filter:I.filter,radius:I.radius});let y=this.map.style.queryRenderedFeaturesForInteractions(t.point,g,this.map.transform);!y.length&&L_.includes(t.type)&&(y=[null]);let b=!1;for(let I of y){for(let[A,O]of h){let{handler:P,featureset:k}=O;if(k&&(I==null||n.bi(I.featureset,k))&&P(new oh(t,A,O,I))!==!1){b=!0;break}}if(b)break}if(!b)for(let[I,A]of h){let{handler:O,featureset:P}=A;if(!P&&O(new oh(t,I,A,null))!==!1)break}}}function Eu(d,t){if(Array.isArray(d)&&Array.isArray(t)){let o=new Set(d),h=new Set(t);return o.size===h.size&&d.every(g=>h.has(g))}return n.bi(d,t)}let Kl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},Es={showCompass:!0,showZoom:!0,visualizePitch:!1};class Po{constructor(t,o,h=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Qd({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new eh({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),Ut()}move(t,o){let h=this.map,g=this.mouseRotate.mousemoveWindow(t,o),y=g&&g.bearingDelta;if(y&&h.setBearing(h.getBearing()+y),this.mousePitch){let b=this.mousePitch.mousemoveWindow(t,o),I=b&&b.pitchDelta;I&&h.setPitch(h.getPitch()+I)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ln(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),xi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,xi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Qi(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Qi(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ms(d,t,o){if(d=new n.bL(d.lng,d.lat),t){let h=new n.bL(d.lng-360,d.lat),g=new n.bL(d.lng+360,d.lat),y=360*Math.ceil(Math.abs(d.lng-o.center.lng)/360),b=o.locationPoint(d).distSqr(t),I=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint(h).distSqr(t)<b&&(I||Math.abs(h.lng-o.center.lng)<y)?d=h:o.locationPoint(g).distSqr(t)<b&&(I||Math.abs(g.lng-o.center.lng)<y)&&(d=g)}for(;Math.abs(d.lng-o.center.lng)>180;){let h=o.locationPoint(d);if(h.x>=0&&h.y>=0&&h.x<=o.width&&h.y<=o.height)break;d.lng>o.center.lng?d.lng-=360:d.lng+=360}return d}let Ss={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Wo extends n.E{constructor(t,o){if(super(),(t instanceof HTMLElement||o)&&(t=n.l({element:t},o)),n.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ye("div");let y=41,b=27,I=wt("svg",{display:"block",height:y*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${y}`},this._element),A=wt("radialGradient",{id:"shadowGradient"},wt("defs",{},I));wt("stop",{offset:"10%","stop-opacity":.4},A),wt("stop",{offset:"100%","stop-opacity":.05},A),wt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),wt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),wt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),wt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=n.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});let h=this._element.classList;for(let y in Ss)h.remove(`mapboxgl-marker-anchor-${y}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`);let g=t&&t.className?t.className.trim().split(/\s+/):[];h.add(...g),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.bL.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let o=t.code,h=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){let o=t.originalEvent.target,h=this._element;this._popup&&(o===h||h.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,o=this._pos;if(!t||!o)return!1;let h=t.unproject(o),g=t.getFreeCameraOptions();if(!g.position)return!1;let y=g.position.toLngLat();return y.distanceTo(h)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();let h=t.unproject(o),g;t._showingGlobe()&&n.dz(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Ss[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){let t=this._pos,o=this._map,h=this.getPitchAlignment();if(!o||!t||h!=="map")return"";if(!o._showingGlobe()){let A=o.getPitch();return A?`rotateX(${A}deg)`:""}let g=n.c1(n.dA(o.transform,this._lngLat)),y=t.sub(n.dB(o.transform)),b=Math.abs(y.x)+Math.abs(y.y);if(b===0)return"";let I=g/b;return`rotateX(${-y.y*I}deg) rotateY(${y.x*I}deg)`}_calculateZTransform(){let t=this._pos,o=this._map;if(!o||!t)return"";let h=0,g=this.getRotationAlignment();if(g==="map")if(o._showingGlobe()){let y=o.project(new n.bL(this._lngLat.lng,this._lngLat.lat+.001)),b=o.project(new n.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(y);h=n.c1(Math.atan2(b.y,b.x))-90}else h=-o.getBearing();else if(g==="horizon"){let y=n.a7(4,6,o.getZoom()),b=n.dB(o.transform);b.y+=y*o.transform.height;let I=t.sub(b),A=n.c1(Math.atan2(I.y,I.x));h=(A>90?A-270:A+90)*(1-y)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);let o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Ms(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let o=this._map;if(!o)return;let h=this._pointerdownPos,g=this._positionDelta;if(h&&g){if(!this._isDragging){let y=this._clickTolerance||o._clickTolerance;if(t.point.dist(h)<y)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.x("dragstart"))),this.fire(new n.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.x("dragend")),this._state="inactive"}_addDragHandler(t){let o=this._map,h=this._pos;o&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Ox={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Lx={maxWidth:100,unit:"metric"},Fx={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},kx={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},F_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cr(d=new n.P(0,0),t="bottom"){if(typeof d=="number"){let o=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(t){case"top":return new n.P(0,d);case"top-left":return new n.P(o,o);case"top-right":return new n.P(-o,o);case"bottom":return new n.P(0,-d);case"bottom-left":return new n.P(o,-o);case"bottom-right":return new n.P(-o,-o);case"left":return new n.P(d,0);case"right":return new n.P(-d,0)}return new n.P(0,0)}return d instanceof n.P||Array.isArray(d)?n.P.convert(d):n.P.convert(d[t]||[0,0])}return{version:R,supported:tt.supported,setRTLTextPlugin:n.dC,getRTLTextPluginStatus:n.dD,Map:class extends Bp{constructor(d){G.mark($.create);let t=d;if((d=n.l({},Kl,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&n.dx(window)&&(d.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new bd(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new O_,this._domRenderTaskQueue=new O_,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aQ(),this._locale=n.l({},Rx,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Cu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new ad(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Mt({},d.contextCreateOptions):{},typeof d.container=="string"){let o=document.getElementById(d.container);if(!o)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=o}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),n.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Dp),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new $i(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||n.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new Xd(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});let o=d.bounds;o&&(this.resize(),this.fitBounds(o,n.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new rh({customAttribution:d.customAttribution})),this._logoControl=new Vp,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new n.x(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new n.x(`${o.dataType}dataloading`,o))}),this._interactions=new jp(this)}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new n.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=d.onAdd(this);this._controls.push(d);let h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new n.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new n.x("movestart",d)).fire(new n.x("move",d)),this.fire(new n.x("resize",d)),t&&this.fire(new n.x("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(n.as.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(t=>t==="auto"?navigator.language:t):d}setLanguage(d){let t=this._parseLanguage(d);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let d=this.transform,t=d.projection.name,o;t==="globe"&&d.zoom>=n.bV?(d.setMercatorFromTransition(),o=!0):t==="mercator"&&d.zoom<n.bV&&(d.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,t){return this._updateProjection(d||t||{name:"mercator"})}_updateProjection(d){let t;return t=d.name==="globe"&&this.transform.zoom>=n.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(n.bL.convert(d))}unproject(d){return this.transform.pointLocation3D(n.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,t,o){let h=g=>{let y=[];if(Array.isArray(t)){let b=t.filter(I=>this.getLayer(I));y=b.length?this.queryRenderedFeatures(g,{layers:b}):[]}else y=this.queryRenderedFeatures(g,{featureset:t});return y};if(d==="mouseenter"||d==="mouseover"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:b=>{let I=h(b.point);I.length?g||(g=!0,o.call(this,new _i(d,this,b.originalEvent,{features:I}))):g=!1},mouseout:()=>{g=!1}}}}if(d==="mouseleave"||d==="mouseout"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:I=>{h(I.point).length?g=!0:g&&(g=!1,o.call(this,new _i(d,this,I.originalEvent)))},mouseout:I=>{g&&(g=!1,o.call(this,new _i(d,this,I.originalEvent)))}}}}{let g=y=>{let b=h(y.point);b.length&&(y.features=b,o.call(this,y),delete y.features)};return{listener:o,targets:t,delegates:{[d]:g}}}}on(d,t,o){if(typeof t=="function"||o===void 0)return super.on(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let h=this._createDelegatedListener(d,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(h);for(let g in h.delegates)this.on(g,h.delegates[g]);return this}once(d,t,o){if(typeof t=="function"||o===void 0)return super.once(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let h=this._createDelegatedListener(d,t,o);for(let g in h.delegates)this.once(g,h.delegates[g]);return this}off(d,t,o){if(typeof t=="function"||o===void 0)return super.off(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let h=this._delegatedListeners?this._delegatedListeners[d]:void 0;return h&&(g=>{for(let y=0;y<g.length;y++){let b=g[y];if(b.listener===o&&Eu(b.targets,t)){for(let I in b.delegates)this.off(I,b.delegates[I]);return g.splice(y,1),this}}})(h),this}queryRenderedFeatures(d,t){if(!this.style)return[];if(t!==void 0||d===void 0||d instanceof n.P||Array.isArray(d)||(t=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(t=t||{}))return this._isFeaturesetDescriptorValid(t.featureset)?this.style.queryRenderedFeaturesForInteractions(d,[t],this.transform):[];if(t.layers&&Array.isArray(t.layers)){for(let o of t.layers)if(!this._isValidId(o))return[]}return this.style.queryRenderedFeatures(d,t,this.transform)}querySourceFeatures(d,t){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,t)}isPointOnSurface(d){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(d))}addInteraction(d,t){return this._interactions.add(d,t),this}removeInteraction(d){return this._interactions.remove(d),this}setStyle(d,t){return t=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&d&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(d,(o,h)=>{o?(n.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(d,t)):h&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){let t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){let o=n.l({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new Wr(this,o).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new n.t(new Error("IDs can't be empty."))),!1):!n.aK(d)||(this.fire(new n.t(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isFeaturesetDescriptorValid(d){return"featuresetId"in d?this._isValidId(d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(let t of d)if(!this._isValidId(t))return!1;return!0}return this._isFeaturesetDescriptorValid(d)}addSource(d,t){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,o)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,t,{pixelRatio:o=1,sdf:h=!1,stretchX:g,stretchY:y,content:b}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){let{width:I,height:A,data:O}=n.q.getImageData(t);this.style.addImage(d,{data:new n.r({width:I,height:A},O),pixelRatio:o,stretchX:g,stretchY:y,content:b,sdf:h,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new n.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:I,height:A}=t,O=t;this.style.addImage(d,{data:new n.r({width:I,height:A},new Uint8Array(O.data)),pixelRatio:o,stretchX:g,stretchY:y,content:b,sdf:h,version:0,userImage:O}),O.onAdd&&O.onAdd(this,d)}}updateImage(d,t){this._lazyInitEmptyStyle();let o=this.style.getImage(d);if(!o)return void this.fire(new n.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let h=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.q.getImageData(t):t,{width:g,height:y,data:b}=h;if(g===void 0||y===void 0)return void this.fire(new n.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==o.data.width||y!==o.data.height)return void this.fire(new n.t(new Error(`The width and height of the updated image (${g}, ${y})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));let I=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);o.data.replace(b,I),this.style.updateImage(d,o)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new n.t(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){n.o(this._requestManager.transformRequest(d,n.R.Image),(o,h)=>{t(o,h instanceof HTMLImageElement?n.q.getImageData(h):h)})}listImages(){return this.style.listImages()}addModel(d,t){this._lazyInitEmptyStyle(),this.style.addModel(d,t)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new n.t(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,t){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)):this}getSlot(d){let t=this.getLayer(d);return t&&t.slot||null}setSlot(d,t){return this.style.setSlot(d,t),this.style.mergeLayers(),this._update(!0)}addImport(d,t){return this.style.addImport(d,t),this}updateImport(d,t){return typeof t!="string"&&t.id!==d?(this.removeImport(d),this.addImport(t)):(this.style.updateImport(d,t),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,t){return this.style.moveImport(d,t),this._update(!0)}moveLayer(d,t){return this._isValidId(d)?(this.style.moveLayer(d,t),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;let t=this.style.getOwnLayer(d);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,t,o){return this._isValidId(d)?(this.style.setLayerZoomRange(d,t,o),this._update(!0)):this}setFilter(d,t,o={}){return this._isValidId(d)?(this.style.setFilter(d,t,o),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,t,o,h={}){return this._isValidId(d)?(this.style.setPaintProperty(d,t,o,h),this._update(!0)):this}getPaintProperty(d,t){return this._isValidId(d)?this.style.getPaintProperty(d,t):null}setLayoutProperty(d,t,o,h={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,t,o,h),this._update(!0)):this}getLayoutProperty(d,t){return this._isValidId(d)?this.style.getLayoutProperty(d,t):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,t){return this.style.setSchema(d,t),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,t){return this.style.setConfig(d,t),this._update(!0)}getConfigProperty(d,t){return this.style.getConfigProperty(d,t)}setConfigProperty(d,t,o){return this.style.setConfigProperty(d,t,o),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){let t=d[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bL.convert(d),this.transform):0}setFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,t),this._update())}removeFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,t),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,o,h,g,y=this._container;for(;y&&(!h||!g);){let b=window.getComputedStyle(y).transform;b&&b!=="none"&&(o=b.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(h=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(g=o[3])),y=y.parentElement}this._containerWidth=h?Math.abs(d/h):d,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ye("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=Ye("div","mapboxgl-canvas-container",d);this._canvas=Ye("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let o=this._controlContainer=Ye("div","mapboxgl-control-container",d),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{h[g]=Ye("div",`mapboxgl-ctrl-${g}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){let o=n.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(d),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){let t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){let t=this._popups.indexOf(d);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let d=n.l({},tt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",d);t?($s(t,!0),this.painter=new Qs(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(t)):this.fire(new n.t(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.x("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new n.x("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;this.fire(new n.x("renderstart")),++this._frameId;let o=this.painter.context.extTimerQuery,h=n.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let O=this.transform.zoom,P=this.transform.pitch,k=n.q.now(),z=new n.a3(O,{now:k,fadeDuration:y,pitch:P,transition:this.style.transition});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(h),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(h);let I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,G.mark($.load),this.fire(new n.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let O=n.q.now()-h;g.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{let P=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new n.x("gpu-timing-frame",{cpuTime:O,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){let O=this.painter.collectGpuTimers();setTimeout(()=>{let P=this.painter.queryGpuTimers(O);this.fire(new n.x("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){let O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let P=this.painter.queryGpuTimeDeferredRender(O);this.fire(new n.x("gpu-timing-deferred-render",{gpuTime:P}))},50)}let A=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(A||this._repaint)this.triggerRepaint();else{let O=this.idle();if(O&&(b=this._updateAverageElevation(h,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new n.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let P=this._calculateSpeedIndex();this.fire(new n.x("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,G.mark($.fullLoad),this._performanceMetricsCollection&&Bc(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(let t of this._markers)d&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!d||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(d,t=!1){let o=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);let h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let g=this.transform.averageElevation,y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;let b=Math.abs(g-y);if(b>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(y),o(y);this._averageElevation.easeTo(y,d,300)}else if(b>1e-4)return this._averageElevation.jumpTo(y),o(y)}return!!this._averageElevation.isEasing(d)&&o(this._averageElevation.getValue(d))}_authenticate(){Ee(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===Us||d.status===401)){let t=this.painter.context.gl;$s(t,!1),this._logoControl instanceof Vp&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),zc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ao(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let o=this.painter.context.gl,h=o.createFramebuffer();function g(y){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,y,0);let b=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,b),b}return o.bindFramebuffer(o.FRAMEBUFFER,h),this._canvasPixelComparison(g(d),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(d,t,o){let h=o[1]-o[0],g=d.length/4;for(let y=0;y<t.length;y++){let b=t[y],I=0;for(let A=0;A<b.length;A+=4)b[A]===d[A]&&b[A+1]===d[A+1]&&b[A+2]===d[A+2]&&b[A+3]===d[A+3]&&(I+=1);h+=(o[y+2]-o[y+1])*(1-I/g)}return h}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),hs.delete(this.painter.context.gl),ba.remove(),en.remove(),this._removed=!0,this.fire(new n.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=n.q.frame(t=>{let o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(d){let t=this.style?this.style.getSourceCaches():[];return n.bg(t,(o,h)=>o._preloadTiles(d,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,t){n.dy(d,t)}get version(){return R}},NavigationControl:class{constructor(d={}){this.options=n.l({},Es,d),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=Ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let t=d.getZoom(),o=t===d.getMaxZoom(),h=t===d.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Po(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,t){let o=Ye("button",d,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(d,t){if(!this._map)return;let o=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",o),d.firstElementChild&&d.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.E{constructor(d={}){super();let t=navigator.geolocation;this.options=n.l({geolocation:t},Ox,d),n.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ws(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){let t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,d(o)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>t(o.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(d){let t=this._map.getMaxBounds(),o=d.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new n.x("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("geolocate",d)),this._finish()}}_updateCamera(d){let t=new n.bL(d.coords.longitude,d.coords.latitude),o=d.coords.accuracy,h=this._map.getBearing(),g=n.l({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),g,{geolocateSource:!0})}_updateMarker(d){if(d){let t=new n.bL(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map.transform,t=n.bE(1,d._center.lat)*d.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Ye("button","mapboxgl-ctrl-geolocate",this._container),Ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ye("div","mapboxgl-user-location"),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Wo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.x("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:rh,ScaleControl:class{constructor(d={}){this.options=n.l({},Lx,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let d=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,h=t._containerWidth/2-d/2,g=t.unproject([h,o]),y=t.unproject([h+d,o]),b=g.distanceTo(y);if(this.options.unit==="imperial"){let I=3.2808*b;I>5280?this._setScale(d,I/5280,"mile"):this._setScale(d,I,"foot")}else this.options.unit==="nautical"?this._setScale(d,b/1852,"nautical-mile"):b>=1e3?this._setScale(d,b/1e3,"kilometer"):this._setScale(d,b,"meter")}_setScale(d,t,o){this._map._requestDomTask(()=>{let h=function(y){let b=Math.pow(10,`${Math.floor(y)}`.length-1),I=y/b;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(A){let O=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*O)/O}(I),b*I}(t),g=h/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(h):`${h}&nbsp;${Fx[o]}`,this._container.style.width=d*g+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:n.w("Full screen control 'container' must be a DOM element.")),n.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=Ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ye("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(d){super(),this.options=n.l(Object.create(kx),d),n.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new n.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new n.x("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=n.bL.convert(d),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let t=document.createDocumentFragment(),o=document.createElement("body"),h;for(o.innerHTML=d;h=o.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Ye("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(d),this.options.closeButton){let o=this._closeButton=Ye("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._updateClassList(),t}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let t=this._map,o=this._container,h=this._pos;if(!t||!o||!h)return"bottom";let g=o.offsetWidth,y=o.offsetHeight,b=h.x<g/2,I=h.x>t.transform.width-g/2;if(h.y+d<y)return b?"top-left":I?"top-right":"top";if(h.y>t.transform.height-y){if(b)return"bottom-left";if(I)return"bottom-right"}return b?"left":I?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),d.className=t.join(" ")}_update(d){let t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let h=this._container;if(h||(h=this._container=Ye("div","mapboxgl-popup",t.getContainer()),this._tip=Ye("div","mapboxgl-popup-tip",h),h.appendChild(o)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ms(this._lngLat,this._pos,t.transform)),!this._trackPointer||d){let g=this._pos=this._trackPointer&&d instanceof n.P?d:t.project(this._lngLat),y=cr(this.options.offset),b=this._anchor=this._getAnchor(y.y),I=cr(this.options.offset,b),A=g.add(I).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Ss[b]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){let g=n.dz(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(F_);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Wo,Style:Wr,LngLat:n.bL,LngLatBounds:n.as,Point:n.P,MercatorCoordinate:n.a5,FreeCameraOptions:Zs,Evented:n.E,config:n.e,prewarm:n.dE,clearPrewarmedResources:n.dF,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(d){n.e.ACCESS_TOKEN=d},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(d){n.e.API_URL=d},get workerCount(){return n.dG.workerCount},set workerCount(d){n.dG.workerCount=d},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){n.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){n.dH(d)},get workerUrl(){return n.dI.workerUrl},set workerUrl(d){n.dI.workerUrl=d},get workerClass(){return n.dI.workerClass},set workerClass(d){n.dI.workerClass=d},get workerParams(){return n.dI.workerParams},set workerParams(d){n.dI.workerParams=d},get dracoUrl(){return n.dJ()},set dracoUrl(d){n.dK(d)},get meshoptUrl(){return n.dL()},set meshoptUrl(d){n.dM(d)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var x=a;return x})});function iI(i,s){return Object.is(i,s)}var hr=null,My=!1,Sy=1,$a=Symbol("SIGNAL");function gi(i){let s=hr;return hr=i,s}function rI(){return hr}var Mm={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function eb(i){if(My)throw new Error("");if(hr===null)return;hr.consumerOnSignalRead(i);let s=hr.nextProducerIndex++;if(Ay(hr),s<hr.producerNode.length&&hr.producerNode[s]!==i&&Em(hr)){let a=hr.producerNode[s];Dy(a,hr.producerIndexOfThis[s])}hr.producerNode[s]!==i&&(hr.producerNode[s]=i,hr.producerIndexOfThis[s]=Em(hr)?lI(i,hr,s):0),hr.producerLastReadVersion[s]=i.version}function KF(){Sy++}function oI(i){if(!(Em(i)&&!i.dirty)&&!(!i.dirty&&i.lastCleanEpoch===Sy)){if(!i.producerMustRecompute(i)&&!nb(i)){i.dirty=!1,i.lastCleanEpoch=Sy;return}i.producerRecomputeValue(i),i.dirty=!1,i.lastCleanEpoch=Sy}}function sI(i){if(i.liveConsumerNode===void 0)return;let s=My;My=!0;try{for(let a of i.liveConsumerNode)a.dirty||QF(a)}finally{My=s}}function aI(){return hr?.consumerAllowSignalWrites!==!1}function QF(i){i.dirty=!0,sI(i),i.consumerMarkedDirty?.(i)}function Iy(i){return i&&(i.nextProducerIndex=0),gi(i)}function tb(i,s){if(gi(s),!(!i||i.producerNode===void 0||i.producerIndexOfThis===void 0||i.producerLastReadVersion===void 0)){if(Em(i))for(let a=i.nextProducerIndex;a<i.producerNode.length;a++)Dy(i.producerNode[a],i.producerIndexOfThis[a]);for(;i.producerNode.length>i.nextProducerIndex;)i.producerNode.pop(),i.producerLastReadVersion.pop(),i.producerIndexOfThis.pop()}}function nb(i){Ay(i);for(let s=0;s<i.producerNode.length;s++){let a=i.producerNode[s],f=i.producerLastReadVersion[s];if(f!==a.version||(oI(a),f!==a.version))return!0}return!1}function ib(i){if(Ay(i),Em(i))for(let s=0;s<i.producerNode.length;s++)Dy(i.producerNode[s],i.producerIndexOfThis[s]);i.producerNode.length=i.producerLastReadVersion.length=i.producerIndexOfThis.length=0,i.liveConsumerNode&&(i.liveConsumerNode.length=i.liveConsumerIndexOfThis.length=0)}function lI(i,s,a){if(cI(i),i.liveConsumerNode.length===0&&uI(i))for(let f=0;f<i.producerNode.length;f++)i.producerIndexOfThis[f]=lI(i.producerNode[f],i,f);return i.liveConsumerIndexOfThis.push(a),i.liveConsumerNode.push(s)-1}function Dy(i,s){if(cI(i),i.liveConsumerNode.length===1&&uI(i))for(let f=0;f<i.producerNode.length;f++)Dy(i.producerNode[f],i.producerIndexOfThis[f]);let a=i.liveConsumerNode.length-1;if(i.liveConsumerNode[s]=i.liveConsumerNode[a],i.liveConsumerIndexOfThis[s]=i.liveConsumerIndexOfThis[a],i.liveConsumerNode.length--,i.liveConsumerIndexOfThis.length--,s<i.liveConsumerNode.length){let f=i.liveConsumerIndexOfThis[s],x=i.liveConsumerNode[s];Ay(x),x.producerIndexOfThis[f]=s}}function Em(i){return i.consumerIsAlwaysLive||(i?.liveConsumerNode?.length??0)>0}function Ay(i){i.producerNode??=[],i.producerIndexOfThis??=[],i.producerLastReadVersion??=[]}function cI(i){i.liveConsumerNode??=[],i.liveConsumerIndexOfThis??=[]}function uI(i){return i.producerNode!==void 0}function dI(i){let s=Object.create(ek);s.computation=i;let a=()=>{if(oI(s),eb(s),s.value===Ty)throw s.error;return s.value};return a[$a]=s,a}var K1=Symbol("UNSET"),Q1=Symbol("COMPUTING"),Ty=Symbol("ERRORED"),ek=ei(Mt({},Mm),{value:K1,dirty:!0,error:null,equal:iI,producerMustRecompute(i){return i.value===K1||i.value===Q1},producerRecomputeValue(i){if(i.value===Q1)throw new Error("Detected cycle in computations.");let s=i.value;i.value=Q1;let a=Iy(i),f;try{f=i.computation()}catch(x){f=Ty,i.error=x}finally{tb(i,a)}if(s!==K1&&s!==Ty&&f!==Ty&&i.equal(s,f)){i.value=s;return}i.value=f,i.version++}});function tk(){throw new Error}var hI=tk;function fI(){hI()}function pI(i){hI=i}var nk=null;function mI(i){let s=Object.create(_I);s.value=i;let a=()=>(eb(s),s.value);return a[$a]=s,a}function rb(i,s){aI()||fI(),i.equal(i.value,s)||(i.value=s,ik(i))}function gI(i,s){aI()||fI(),rb(i,s(i.value))}var _I=ei(Mt({},Mm),{equal:iI,value:void 0});function ik(i){i.version++,KF(),sI(i),nk?.()}function Nn(i){return typeof i=="function"}function xh(i){let a=i(f=>{Error.call(f),f.stack=new Error().stack});return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}var Py=xh(i=>function(a){i(this),this.message=a?`${a.length} errors occurred during unsubscription:
${a.map((f,x)=>`${x+1}) ${f.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=a});function Sm(i,s){if(i){let a=i.indexOf(s);0<=a&&i.splice(a,1)}}var ir=class i{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;let{_parentage:a}=this;if(a)if(this._parentage=null,Array.isArray(a))for(let n of a)n.remove(this);else a.remove(this);let{initialTeardown:f}=this;if(Nn(f))try{f()}catch(n){s=n instanceof Py?n.errors:[n]}let{_finalizers:x}=this;if(x){this._finalizers=null;for(let n of x)try{yI(n)}catch(R){s=s??[],R instanceof Py?s=[...s,...R.errors]:s.push(R)}}if(s)throw new Py(s)}}add(s){var a;if(s&&s!==this)if(this.closed)yI(s);else{if(s instanceof i){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=(a=this._finalizers)!==null&&a!==void 0?a:[]).push(s)}}_hasParent(s){let{_parentage:a}=this;return a===s||Array.isArray(a)&&a.includes(s)}_addParent(s){let{_parentage:a}=this;this._parentage=Array.isArray(a)?(a.push(s),a):a?[a,s]:s}_removeParent(s){let{_parentage:a}=this;a===s?this._parentage=null:Array.isArray(a)&&Sm(a,s)}remove(s){let{_finalizers:a}=this;a&&Sm(a,s),s instanceof i&&s._removeParent(this)}};ir.EMPTY=(()=>{let i=new ir;return i.closed=!0,i})();var ob=ir.EMPTY;function Ry(i){return i instanceof ir||i&&"closed"in i&&Nn(i.remove)&&Nn(i.add)&&Nn(i.unsubscribe)}function yI(i){Nn(i)?i():i.unsubscribe()}var Ls={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var bh={setTimeout(i,s,...a){let{delegate:f}=bh;return f?.setTimeout?f.setTimeout(i,s,...a):setTimeout(i,s,...a)},clearTimeout(i){let{delegate:s}=bh;return(s?.clearTimeout||clearTimeout)(i)},delegate:void 0};function Oy(i){bh.setTimeout(()=>{let{onUnhandledError:s}=Ls;if(s)s(i);else throw i})}function Tm(){}var vI=sb("C",void 0,void 0);function xI(i){return sb("E",void 0,i)}function bI(i){return sb("N",i,void 0)}function sb(i,s,a){return{kind:i,value:s,error:a}}var Fu=null;function wh(i){if(Ls.useDeprecatedSynchronousErrorHandling){let s=!Fu;if(s&&(Fu={errorThrown:!1,error:null}),i(),s){let{errorThrown:a,error:f}=Fu;if(Fu=null,a)throw f}}else i()}function wI(i){Ls.useDeprecatedSynchronousErrorHandling&&Fu&&(Fu.errorThrown=!0,Fu.error=i)}var ku=class extends ir{constructor(s){super(),this.isStopped=!1,s?(this.destination=s,Ry(s)&&s.add(this)):this.destination=sk}static create(s,a,f){return new Ch(s,a,f)}next(s){this.isStopped?lb(bI(s),this):this._next(s)}error(s){this.isStopped?lb(xI(s),this):(this.isStopped=!0,this._error(s))}complete(){this.isStopped?lb(vI,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(s){this.destination.next(s)}_error(s){try{this.destination.error(s)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},rk=Function.prototype.bind;function ab(i,s){return rk.call(i,s)}var cb=class{constructor(s){this.partialObserver=s}next(s){let{partialObserver:a}=this;if(a.next)try{a.next(s)}catch(f){Ly(f)}}error(s){let{partialObserver:a}=this;if(a.error)try{a.error(s)}catch(f){Ly(f)}else Ly(s)}complete(){let{partialObserver:s}=this;if(s.complete)try{s.complete()}catch(a){Ly(a)}}},Ch=class extends ku{constructor(s,a,f){super();let x;if(Nn(s)||!s)x={next:s??void 0,error:a??void 0,complete:f??void 0};else{let n;this&&Ls.useDeprecatedNextContext?(n=Object.create(s),n.unsubscribe=()=>this.unsubscribe(),x={next:s.next&&ab(s.next,n),error:s.error&&ab(s.error,n),complete:s.complete&&ab(s.complete,n)}):x=s}this.destination=new cb(x)}};function Ly(i){Ls.useDeprecatedSynchronousErrorHandling?wI(i):Oy(i)}function ok(i){throw i}function lb(i,s){let{onStoppedNotification:a}=Ls;a&&bh.setTimeout(()=>a(i,s))}var sk={closed:!0,next:Tm,error:ok,complete:Tm};var Eh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Fo(i){return i}function ub(...i){return db(i)}function db(i){return i.length===0?Fo:i.length===1?i[0]:function(a){return i.reduce((f,x)=>x(f),a)}}var fi=(()=>{class i{constructor(a){a&&(this._subscribe=a)}lift(a){let f=new i;return f.source=this,f.operator=a,f}subscribe(a,f,x){let n=lk(a)?a:new Ch(a,f,x);return wh(()=>{let{operator:R,source:$}=this;n.add(R?R.call(n,$):$?this._subscribe(n):this._trySubscribe(n))}),n}_trySubscribe(a){try{return this._subscribe(a)}catch(f){a.error(f)}}forEach(a,f){return f=CI(f),new f((x,n)=>{let R=new Ch({next:$=>{try{a($)}catch(G){n(G),R.unsubscribe()}},error:n,complete:x});this.subscribe(R)})}_subscribe(a){var f;return(f=this.source)===null||f===void 0?void 0:f.subscribe(a)}[Eh](){return this}pipe(...a){return db(a)(this)}toPromise(a){return a=CI(a),new a((f,x)=>{let n;this.subscribe(R=>n=R,R=>x(R),()=>f(n))})}}return i.create=s=>new i(s),i})();function CI(i){var s;return(s=i??Ls.Promise)!==null&&s!==void 0?s:Promise}function ak(i){return i&&Nn(i.next)&&Nn(i.error)&&Nn(i.complete)}function lk(i){return i&&i instanceof ku||ak(i)&&Ry(i)}function hb(i){return Nn(i?.lift)}function pi(i){return s=>{if(hb(s))return s.lift(function(a){try{return i(a,this)}catch(f){this.error(f)}});throw new TypeError("Unable to lift unknown Observable type")}}function oi(i,s,a,f,x){return new fb(i,s,a,f,x)}var fb=class extends ku{constructor(s,a,f,x,n,R){super(s),this.onFinalize=n,this.shouldUnsubscribe=R,this._next=a?function($){try{a($)}catch(G){s.error(G)}}:super._next,this._error=x?function($){try{x($)}catch(G){s.error(G)}finally{this.unsubscribe()}}:super._error,this._complete=f?function(){try{f()}catch($){s.error($)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var s;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:a}=this;super.unsubscribe(),!a&&((s=this.onFinalize)===null||s===void 0||s.call(this))}}};function Mh(){return pi((i,s)=>{let a=null;i._refCount++;let f=oi(s,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount){a=null;return}let x=i._connection,n=a;a=null,x&&(!n||x===n)&&x.unsubscribe(),s.unsubscribe()});i.subscribe(f),f.closed||(a=i.connect())})}var Sh=class extends fi{constructor(s,a){super(),this.source=s,this.subjectFactory=a,this._subject=null,this._refCount=0,this._connection=null,hb(s)&&(this.lift=s.lift)}_subscribe(s){return this.getSubject().subscribe(s)}getSubject(){let s=this._subject;return(!s||s.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:s}=this;this._subject=this._connection=null,s?.unsubscribe()}connect(){let s=this._connection;if(!s){s=this._connection=new ir;let a=this.getSubject();s.add(this.source.subscribe(oi(a,void 0,()=>{this._teardown(),a.complete()},f=>{this._teardown(),a.error(f)},()=>this._teardown()))),s.closed&&(this._connection=null,s=ir.EMPTY)}return s}refCount(){return Mh()(this)}};var EI=xh(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var _r=(()=>{class i extends fi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(a){let f=new Fy(this,this);return f.operator=a,f}_throwIfClosed(){if(this.closed)throw new EI}next(a){wh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let f of this.currentObservers)f.next(a)}})}error(a){wh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=a;let{observers:f}=this;for(;f.length;)f.shift().error(a)}})}complete(){wh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:a}=this;for(;a.length;)a.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var a;return((a=this.observers)===null||a===void 0?void 0:a.length)>0}_trySubscribe(a){return this._throwIfClosed(),super._trySubscribe(a)}_subscribe(a){return this._throwIfClosed(),this._checkFinalizedStatuses(a),this._innerSubscribe(a)}_innerSubscribe(a){let{hasError:f,isStopped:x,observers:n}=this;return f||x?ob:(this.currentObservers=null,n.push(a),new ir(()=>{this.currentObservers=null,Sm(n,a)}))}_checkFinalizedStatuses(a){let{hasError:f,thrownError:x,isStopped:n}=this;f?a.error(x):n&&a.complete()}asObservable(){let a=new fi;return a.source=this,a}}return i.create=(s,a)=>new Fy(s,a),i})(),Fy=class extends _r{constructor(s,a){super(),this.destination=s,this.source=a}next(s){var a,f;(f=(a=this.destination)===null||a===void 0?void 0:a.next)===null||f===void 0||f.call(a,s)}error(s){var a,f;(f=(a=this.destination)===null||a===void 0?void 0:a.error)===null||f===void 0||f.call(a,s)}complete(){var s,a;(a=(s=this.destination)===null||s===void 0?void 0:s.complete)===null||a===void 0||a.call(s)}_subscribe(s){var a,f;return(f=(a=this.source)===null||a===void 0?void 0:a.subscribe(s))!==null&&f!==void 0?f:ob}};var Ir=class extends _r{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){let a=super._subscribe(s);return!a.closed&&s.next(this._value),a}getValue(){let{hasError:s,thrownError:a,_value:f}=this;if(s)throw a;return this._throwIfClosed(),f}next(s){super.next(this._value=s)}};var ko=new fi(i=>i.complete());function MI(i){return i&&Nn(i.schedule)}function SI(i){return i[i.length-1]}function ky(i){return Nn(SI(i))?i.pop():void 0}function dc(i){return MI(SI(i))?i.pop():void 0}function II(i,s,a,f){function x(n){return n instanceof a?n:new a(function(R){R(n)})}return new(a||(a=Promise))(function(n,R){function $(Me){try{se(f.next(Me))}catch(ke){R(ke)}}function G(Me){try{se(f.throw(Me))}catch(ke){R(ke)}}function se(Me){Me.done?n(Me.value):x(Me.value).then($,G)}se((f=f.apply(i,s||[])).next())})}function TI(i){var s=typeof Symbol=="function"&&Symbol.iterator,a=s&&i[s],f=0;if(a)return a.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&f>=i.length&&(i=void 0),{value:i&&i[f++],done:!i}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nu(i){return this instanceof Nu?(this.v=i,this):new Nu(i)}function DI(i,s,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f=a.apply(i,s||[]),x,n=[];return x=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),$("next"),$("throw"),$("return",R),x[Symbol.asyncIterator]=function(){return this},x;function R(Ye){return function(wt){return Promise.resolve(wt).then(Ye,ke)}}function $(Ye,wt){f[Ye]&&(x[Ye]=function(mt){return new Promise(function(Ht,_n){n.push([Ye,mt,Ht,_n])>1||G(Ye,mt)})},wt&&(x[Ye]=wt(x[Ye])))}function G(Ye,wt){try{se(f[Ye](wt))}catch(mt){tt(n[0][3],mt)}}function se(Ye){Ye.value instanceof Nu?Promise.resolve(Ye.value.v).then(Me,ke):tt(n[0][2],Ye)}function Me(Ye){G("next",Ye)}function ke(Ye){G("throw",Ye)}function tt(Ye,wt){Ye(wt),n.shift(),n.length&&G(n[0][0],n[0][1])}}function AI(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=i[Symbol.asyncIterator],a;return s?s.call(i):(i=typeof TI=="function"?TI(i):i[Symbol.iterator](),a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a);function f(n){a[n]=i[n]&&function(R){return new Promise(function($,G){R=i[n](R),x($,G,R.done,R.value)})}}function x(n,R,$,G){Promise.resolve(G).then(function(se){n({value:se,done:$})},R)}}var Ny=i=>i&&typeof i.length=="number"&&typeof i!="function";function zy(i){return Nn(i?.then)}function By(i){return Nn(i[Eh])}function Vy(i){return Symbol.asyncIterator&&Nn(i?.[Symbol.asyncIterator])}function jy(i){return new TypeError(`You provided ${i!==null&&typeof i=="object"?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function ck(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Uy=ck();function $y(i){return Nn(i?.[Uy])}function Gy(i){return DI(this,arguments,function*(){let a=i.getReader();try{for(;;){let{value:f,done:x}=yield Nu(a.read());if(x)return yield Nu(void 0);yield yield Nu(f)}}finally{a.releaseLock()}})}function Hy(i){return Nn(i?.getReader)}function rr(i){if(i instanceof fi)return i;if(i!=null){if(By(i))return uk(i);if(Ny(i))return dk(i);if(zy(i))return hk(i);if(Vy(i))return PI(i);if($y(i))return fk(i);if(Hy(i))return pk(i)}throw jy(i)}function uk(i){return new fi(s=>{let a=i[Eh]();if(Nn(a.subscribe))return a.subscribe(s);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function dk(i){return new fi(s=>{for(let a=0;a<i.length&&!s.closed;a++)s.next(i[a]);s.complete()})}function hk(i){return new fi(s=>{i.then(a=>{s.closed||(s.next(a),s.complete())},a=>s.error(a)).then(null,Oy)})}function fk(i){return new fi(s=>{for(let a of i)if(s.next(a),s.closed)return;s.complete()})}function PI(i){return new fi(s=>{mk(i,s).catch(a=>s.error(a))})}function pk(i){return PI(Gy(i))}function mk(i,s){var a,f,x,n;return II(this,void 0,void 0,function*(){try{for(a=AI(i);f=yield a.next(),!f.done;){let R=f.value;if(s.next(R),s.closed)return}}catch(R){x={error:R}}finally{try{f&&!f.done&&(n=a.return)&&(yield n.call(a))}finally{if(x)throw x.error}}s.complete()})}function go(i,s,a,f=0,x=!1){let n=s.schedule(function(){a(),x?i.add(this.schedule(null,f)):this.unsubscribe()},f);if(i.add(n),!x)return n}function qy(i,s=0){return pi((a,f)=>{a.subscribe(oi(f,x=>go(f,i,()=>f.next(x),s),()=>go(f,i,()=>f.complete(),s),x=>go(f,i,()=>f.error(x),s)))})}function Wy(i,s=0){return pi((a,f)=>{f.add(i.schedule(()=>a.subscribe(f),s))})}function RI(i,s){return rr(i).pipe(Wy(s),qy(s))}function OI(i,s){return rr(i).pipe(Wy(s),qy(s))}function LI(i,s){return new fi(a=>{let f=0;return s.schedule(function(){f===i.length?a.complete():(a.next(i[f++]),a.closed||this.schedule())})})}function FI(i,s){return new fi(a=>{let f;return go(a,s,()=>{f=i[Uy](),go(a,s,()=>{let x,n;try{({value:x,done:n}=f.next())}catch(R){a.error(R);return}n?a.complete():a.next(x)},0,!0)}),()=>Nn(f?.return)&&f.return()})}function Zy(i,s){if(!i)throw new Error("Iterable cannot be null");return new fi(a=>{go(a,s,()=>{let f=i[Symbol.asyncIterator]();go(a,s,()=>{f.next().then(x=>{x.done?a.complete():a.next(x.value)})},0,!0)})})}function kI(i,s){return Zy(Gy(i),s)}function NI(i,s){if(i!=null){if(By(i))return RI(i,s);if(Ny(i))return LI(i,s);if(zy(i))return OI(i,s);if(Vy(i))return Zy(i,s);if($y(i))return FI(i,s);if(Hy(i))return kI(i,s)}throw jy(i)}function ki(i,s){return s?NI(i,s):rr(i)}function vn(...i){let s=dc(i);return ki(i,s)}function Th(i,s){let a=Nn(i)?i:()=>i,f=x=>x.error(a());return new fi(s?x=>s.schedule(f,0,x):f)}function pb(i){return!!i&&(i instanceof fi||Nn(i.lift)&&Nn(i.subscribe))}var Ga=xh(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});function jn(i,s){return pi((a,f)=>{let x=0;a.subscribe(oi(f,n=>{f.next(i.call(s,n,x++))}))})}var{isArray:gk}=Array;function _k(i,s){return gk(s)?i(...s):i(s)}function Xy(i){return jn(s=>_k(i,s))}var{isArray:yk}=Array,{getPrototypeOf:vk,prototype:xk,keys:bk}=Object;function Yy(i){if(i.length===1){let s=i[0];if(yk(s))return{args:s,keys:null};if(wk(s)){let a=bk(s);return{args:a.map(f=>s[f]),keys:a}}}return{args:i,keys:null}}function wk(i){return i&&typeof i=="object"&&vk(i)===xk}function Jy(i,s){return i.reduce((a,f,x)=>(a[f]=s[x],a),{})}function Im(...i){let s=dc(i),a=ky(i),{args:f,keys:x}=Yy(i);if(f.length===0)return ki([],s);let n=new fi(Ck(f,s,x?R=>Jy(x,R):Fo));return a?n.pipe(Xy(a)):n}function Ck(i,s,a=Fo){return f=>{zI(s,()=>{let{length:x}=i,n=new Array(x),R=x,$=x;for(let G=0;G<x;G++)zI(s,()=>{let se=ki(i[G],s),Me=!1;se.subscribe(oi(f,ke=>{n[G]=ke,Me||(Me=!0,$--),$||f.next(a(n.slice()))},()=>{--R||f.complete()}))},f)},f)}}function zI(i,s,a){i?go(a,i,s):s()}function BI(i,s,a,f,x,n,R,$){let G=[],se=0,Me=0,ke=!1,tt=()=>{ke&&!G.length&&!se&&s.complete()},Ye=mt=>se<f?wt(mt):G.push(mt),wt=mt=>{n&&s.next(mt),se++;let Ht=!1;rr(a(mt,Me++)).subscribe(oi(s,_n=>{x?.(_n),n?Ye(_n):s.next(_n)},()=>{Ht=!0},void 0,()=>{if(Ht)try{for(se--;G.length&&se<f;){let _n=G.shift();R?go(s,R,()=>wt(_n)):wt(_n)}tt()}catch(_n){s.error(_n)}}))};return i.subscribe(oi(s,Ye,()=>{ke=!0,tt()})),()=>{$?.()}}function or(i,s,a=1/0){return Nn(s)?or((f,x)=>jn((n,R)=>s(f,n,x,R))(rr(i(f,x))),a):(typeof s=="number"&&(a=s),pi((f,x)=>BI(f,x,i,a)))}function Ih(i=1/0){return or(Fo,i)}function VI(){return Ih(1)}function Dh(...i){return VI()(ki(i,dc(i)))}function Ky(i){return new fi(s=>{rr(i()).subscribe(s)})}function mb(...i){let s=ky(i),{args:a,keys:f}=Yy(i),x=new fi(n=>{let{length:R}=a;if(!R){n.complete();return}let $=new Array(R),G=R,se=R;for(let Me=0;Me<R;Me++){let ke=!1;rr(a[Me]).subscribe(oi(n,tt=>{ke||(ke=!0,se--),$[Me]=tt},()=>G--,void 0,()=>{(!G||!ke)&&(se||n.next(f?Jy(f,$):$),n.complete())}))}});return s?x.pipe(Xy(s)):x}function _o(i,s){return pi((a,f)=>{let x=0;a.subscribe(oi(f,n=>i.call(s,n,x++)&&f.next(n)))})}function hc(i){return pi((s,a)=>{let f=null,x=!1,n;f=s.subscribe(oi(a,void 0,void 0,R=>{n=rr(i(R,hc(i)(s))),f?(f.unsubscribe(),f=null,n.subscribe(a)):x=!0})),x&&(f.unsubscribe(),f=null,n.subscribe(a))})}function jI(i,s,a,f,x){return(n,R)=>{let $=a,G=s,se=0;n.subscribe(oi(R,Me=>{let ke=se++;G=$?i(G,Me,ke):($=!0,Me),f&&R.next(G)},x&&(()=>{$&&R.next(G),R.complete()})))}}function Ha(i,s){return Nn(s)?or(i,s,1):or(i,1)}function fc(i){return pi((s,a)=>{let f=!1;s.subscribe(oi(a,x=>{f=!0,a.next(x)},()=>{f||a.next(i),a.complete()}))})}function qa(i){return i<=0?()=>ko:pi((s,a)=>{let f=0;s.subscribe(oi(a,x=>{++f<=i&&(a.next(x),i<=f&&a.complete())}))})}function gb(i){return jn(()=>i)}function Qy(i=Ek){return pi((s,a)=>{let f=!1;s.subscribe(oi(a,x=>{f=!0,a.next(x)},()=>f?a.complete():a.error(i())))})}function Ek(){return new Ga}function zu(i){return pi((s,a)=>{try{s.subscribe(a)}finally{a.add(i)}})}function ra(i,s){let a=arguments.length>=2;return f=>f.pipe(i?_o((x,n)=>i(x,n,f)):Fo,qa(1),a?fc(s):Qy(()=>new Ga))}function Ah(i){return i<=0?()=>ko:pi((s,a)=>{let f=[];s.subscribe(oi(a,x=>{f.push(x),i<f.length&&f.shift()},()=>{for(let x of f)a.next(x);a.complete()},void 0,()=>{f=null}))})}function _b(i,s){let a=arguments.length>=2;return f=>f.pipe(i?_o((x,n)=>i(x,n,f)):Fo,Ah(1),a?fc(s):Qy(()=>new Ga))}function yb(i,s){return pi(jI(i,s,arguments.length>=2,!0))}function vb(...i){let s=dc(i);return pi((a,f)=>{(s?Dh(i,a,s):Dh(i,a)).subscribe(f)})}function yo(i,s){return pi((a,f)=>{let x=null,n=0,R=!1,$=()=>R&&!x&&f.complete();a.subscribe(oi(f,G=>{x?.unsubscribe();let se=0,Me=n++;rr(i(G,Me)).subscribe(x=oi(f,ke=>f.next(s?s(G,ke,Me,se++):ke),()=>{x=null,$()}))},()=>{R=!0,$()}))})}function xb(i){return pi((s,a)=>{rr(i).subscribe(oi(a,()=>a.complete(),Tm)),!a.closed&&s.subscribe(a)})}function yr(i,s,a){let f=Nn(i)||s||a?{next:i,error:s,complete:a}:i;return f?pi((x,n)=>{var R;(R=f.subscribe)===null||R===void 0||R.call(f);let $=!0;x.subscribe(oi(n,G=>{var se;(se=f.next)===null||se===void 0||se.call(f,G),n.next(G)},()=>{var G;$=!1,(G=f.complete)===null||G===void 0||G.call(f),n.complete()},G=>{var se;$=!1,(se=f.error)===null||se===void 0||se.call(f,G),n.error(G)},()=>{var G,se;$&&((G=f.unsubscribe)===null||G===void 0||G.call(f)),(se=f.finalize)===null||se===void 0||se.call(f)}))}):Fo}var MD="https://g.co/ng/security#xss",hn=class extends Error{constructor(s,a){super(L0(s,a)),this.code=s}};function L0(i,s){return`${`NG0${Math.abs(i)}`}${s?": "+s:""}`}function zm(i){return{toString:i}.toString()}var e0="__parameters__";function Mk(i){return function(...a){if(i){let f=i(...a);for(let x in f)this[x]=f[x]}}}function SD(i,s,a){return zm(()=>{let f=Mk(s);function x(...n){if(this instanceof x)return f.apply(this,n),this;let R=new x(...n);return $.annotation=R,$;function $(G,se,Me){let ke=G.hasOwnProperty(e0)?G[e0]:Object.defineProperty(G,e0,{value:[]})[e0];for(;ke.length<=Me;)ke.push(null);return(ke[Me]=ke[Me]||[]).push(R),G}}return a&&(x.prototype=Object.create(a.prototype)),x.prototype.ngMetadataName=i,x.annotationCls=x,x})}var Pm=globalThis;function Pi(i){for(let s in i)if(i[s]===Pi)return s;throw Error("Could not find renamed property on target object.")}function Sk(i,s){for(let a in s)s.hasOwnProperty(a)&&!i.hasOwnProperty(a)&&(i[a]=s[a])}function eo(i){if(typeof i=="string")return i;if(Array.isArray(i))return"["+i.map(eo).join(", ")+"]";if(i==null)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;let s=i.toString();if(s==null)return""+s;let a=s.indexOf(`
`);return a===-1?s:s.substring(0,a)}function UI(i,s){return i==null||i===""?s===null?"":s:s==null||s===""?i:i+" "+s}var Tk=Pi({__forward_ref__:Pi});function vo(i){return i.__forward_ref__=vo,i.toString=function(){return eo(this())},i}function Qr(i){return TD(i)?i():i}function TD(i){return typeof i=="function"&&i.hasOwnProperty(Tk)&&i.__forward_ref__===vo}function Jt(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function ns(i){return{providers:i.providers||[],imports:i.imports||[]}}function F0(i){return $I(i,DD)||$I(i,AD)}function ID(i){return F0(i)!==null}function $I(i,s){return i.hasOwnProperty(s)?i[s]:null}function Ik(i){let s=i&&(i[DD]||i[AD]);return s||null}function GI(i){return i&&(i.hasOwnProperty(HI)||i.hasOwnProperty(Dk))?i[HI]:null}var DD=Pi({\u0275prov:Pi}),HI=Pi({\u0275inj:Pi}),AD=Pi({ngInjectableDef:Pi}),Dk=Pi({ngInjectorDef:Pi}),on=class{constructor(s,a){this._desc=s,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof a=="number"?this.__NG_ELEMENT_ID__=a:a!==void 0&&(this.\u0275prov=Jt({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function PD(i){return i&&!!i.\u0275providers}var Ak=Pi({\u0275cmp:Pi}),Pk=Pi({\u0275dir:Pi}),Rk=Pi({\u0275pipe:Pi}),Ok=Pi({\u0275mod:Pi}),h0=Pi({\u0275fac:Pi}),Am=Pi({__NG_ELEMENT_ID__:Pi}),qI=Pi({__NG_ENV_ID__:Pi});function k0(i){return typeof i=="string"?i:i==null?"":String(i)}function Lk(i){return typeof i=="function"?i.name||i.toString():typeof i=="object"&&i!=null&&typeof i.type=="function"?i.type.name||i.type.toString():k0(i)}function Fk(i,s){let a=s?`. Dependency path: ${s.join(" > ")} > ${i}`:"";throw new hn(-200,i)}function Tw(i,s){throw new hn(-201,!1)}var Jn=function(i){return i[i.Default=0]="Default",i[i.Host=1]="Host",i[i.Self=2]="Self",i[i.SkipSelf=4]="SkipSelf",i[i.Optional=8]="Optional",i}(Jn||{}),Lb;function RD(){return Lb}function Ko(i){let s=Lb;return Lb=i,s}function OD(i,s,a){let f=F0(i);if(f&&f.providedIn=="root")return f.value===void 0?f.value=f.factory():f.value;if(a&Jn.Optional)return null;if(s!==void 0)return s;Tw(i,"Injector")}var kk={},Rm=kk,Fb="__NG_DI_FLAG__",f0="ngTempTokenPath",Nk="ngTokenPath",zk=/\n/gm,Bk="\u0275",WI="__source",Fh;function Vk(){return Fh}function pc(i){let s=Fh;return Fh=i,s}function jk(i,s=Jn.Default){if(Fh===void 0)throw new hn(-203,!1);return Fh===null?OD(i,void 0,s):Fh.get(i,s&Jn.Optional?null:void 0,s)}function sn(i,s=Jn.Default){return(RD()||jk)(Qr(i),s)}function Ct(i,s=Jn.Default){return sn(i,N0(s))}function N0(i){return typeof i>"u"||typeof i=="number"?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function kb(i){let s=[];for(let a=0;a<i.length;a++){let f=Qr(i[a]);if(Array.isArray(f)){if(f.length===0)throw new hn(900,!1);let x,n=Jn.Default;for(let R=0;R<f.length;R++){let $=f[R],G=Uk($);typeof G=="number"?G===-1?x=$.token:n|=G:x=$}s.push(sn(x,n))}else s.push(sn(f))}return s}function LD(i,s){return i[Fb]=s,i.prototype[Fb]=s,i}function Uk(i){return i[Fb]}function $k(i,s,a,f){let x=i[f0];throw s[WI]&&x.unshift(s[WI]),i.message=Gk(`
`+i.message,x,a,f),i[Nk]=x,i[f0]=null,i}function Gk(i,s,a,f=null){i=i&&i.charAt(0)===`
`&&i.charAt(1)==Bk?i.slice(2):i;let x=eo(s);if(Array.isArray(s))x=s.map(eo).join(" -> ");else if(typeof s=="object"){let n=[];for(let R in s)if(s.hasOwnProperty(R)){let $=s[R];n.push(R+":"+(typeof $=="string"?JSON.stringify($):eo($)))}x=`{${n.join(", ")}}`}return`${a}${f?"("+f+")":""}[${x}]: ${i.replace(zk,`
  `)}`}var Iw=LD(SD("Optional"),8);var FD=LD(SD("SkipSelf"),4);function Nh(i,s){let a=i.hasOwnProperty(h0);return a?i[h0]:null}function Hk(i,s,a){if(i.length!==s.length)return!1;for(let f=0;f<i.length;f++){let x=i[f],n=s[f];if(a&&(x=a(x),n=a(n)),n!==x)return!1}return!0}function qk(i){return i.flat(Number.POSITIVE_INFINITY)}function Dw(i,s){i.forEach(a=>Array.isArray(a)?Dw(a,s):s(a))}function kD(i,s,a){s>=i.length?i.push(a):i.splice(s,0,a)}function p0(i,s){return s>=i.length-1?i.pop():i.splice(s,1)[0]}function Wk(i,s,a,f){let x=i.length;if(x==s)i.push(a,f);else if(x===1)i.push(f,i[0]),i[0]=a;else{for(x--,i.push(i[x-1],i[x]);x>s;){let n=x-2;i[x]=i[n],x--}i[s]=a,i[s+1]=f}}function Zk(i,s,a){let f=Bm(i,s);return f>=0?i[f|1]=a:(f=~f,Wk(i,f,s,a)),f}function bb(i,s){let a=Bm(i,s);if(a>=0)return i[a|1]}function Bm(i,s){return Xk(i,s,1)}function Xk(i,s,a){let f=0,x=i.length>>a;for(;x!==f;){let n=f+(x-f>>1),R=i[n<<a];if(s===R)return n<<a;R>s?x=n:f=n+1}return~(x<<a)}var zh={},Qo=[],Bh=new on(""),ND=new on("",-1),zD=new on(""),m0=class{get(s,a=Rm){if(a===Rm){let f=new Error(`NullInjectorError: No provider for ${eo(s)}!`);throw f.name="NullInjectorError",f}return a}},BD=function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i}(BD||{}),aa=function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i}(aa||{}),_c=function(i){return i[i.None=0]="None",i[i.SignalBased=1]="SignalBased",i[i.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",i}(_c||{});function Yk(i,s,a){let f=i.length;for(;;){let x=i.indexOf(s,a);if(x===-1)return x;if(x===0||i.charCodeAt(x-1)<=32){let n=s.length;if(x+n===f||i.charCodeAt(x+n)<=32)return x}a=x+1}}function Nb(i,s,a){let f=0;for(;f<a.length;){let x=a[f];if(typeof x=="number"){if(x!==0)break;f++;let n=a[f++],R=a[f++],$=a[f++];i.setAttribute(s,R,$,n)}else{let n=x,R=a[++f];Jk(n)?i.setProperty(s,n,R):i.setAttribute(s,n,R),f++}}return f}function VD(i){return i===3||i===4||i===6}function Jk(i){return i.charCodeAt(0)===64}function Om(i,s){if(!(s===null||s.length===0))if(i===null||i.length===0)i=s.slice();else{let a=-1;for(let f=0;f<s.length;f++){let x=s[f];typeof x=="number"?a=x:a===0||(a===-1||a===2?ZI(i,a,x,null,s[++f]):ZI(i,a,x,null,null))}}return i}function ZI(i,s,a,f,x){let n=0,R=i.length;if(s===-1)R=-1;else for(;n<i.length;){let $=i[n++];if(typeof $=="number"){if($===s){R=-1;break}else if($>s){R=n-1;break}}}for(;n<i.length;){let $=i[n];if(typeof $=="number")break;if($===a){if(f===null){x!==null&&(i[n+1]=x);return}else if(f===i[n+1]){i[n+2]=x;return}}n++,f!==null&&n++,x!==null&&n++}R!==-1&&(i.splice(R,0,s),n=R+1),i.splice(n++,0,a),f!==null&&i.splice(n++,0,f),x!==null&&i.splice(n++,0,x)}var jD="ng-template";function Kk(i,s,a,f){let x=0;if(f){for(;x<s.length&&typeof s[x]=="string";x+=2)if(s[x]==="class"&&Yk(s[x+1].toLowerCase(),a,0)!==-1)return!0}else if(Aw(i))return!1;if(x=s.indexOf(1,x),x>-1){let n;for(;++x<s.length&&typeof(n=s[x])=="string";)if(n.toLowerCase()===a)return!0}return!1}function Aw(i){return i.type===4&&i.value!==jD}function Qk(i,s,a){let f=i.type===4&&!a?jD:i.value;return s===f}function e3(i,s,a){let f=4,x=i.attrs,n=x!==null?i3(x):0,R=!1;for(let $=0;$<s.length;$++){let G=s[$];if(typeof G=="number"){if(!R&&!Fs(f)&&!Fs(G))return!1;if(R&&Fs(G))continue;R=!1,f=G|f&1;continue}if(!R)if(f&4){if(f=2|f&1,G!==""&&!Qk(i,G,a)||G===""&&s.length===1){if(Fs(f))return!1;R=!0}}else if(f&8){if(x===null||!Kk(i,x,G,a)){if(Fs(f))return!1;R=!0}}else{let se=s[++$],Me=t3(G,x,Aw(i),a);if(Me===-1){if(Fs(f))return!1;R=!0;continue}if(se!==""){let ke;if(Me>n?ke="":ke=x[Me+1].toLowerCase(),f&2&&se!==ke){if(Fs(f))return!1;R=!0}}}}return Fs(f)||R}function Fs(i){return(i&1)===0}function t3(i,s,a,f){if(s===null)return-1;let x=0;if(f||!a){let n=!1;for(;x<s.length;){let R=s[x];if(R===i)return x;if(R===3||R===6)n=!0;else if(R===1||R===2){let $=s[++x];for(;typeof $=="string";)$=s[++x];continue}else{if(R===4)break;if(R===0){x+=4;continue}}x+=n?1:2}return-1}else return r3(s,i)}function n3(i,s,a=!1){for(let f=0;f<s.length;f++)if(e3(i,s[f],a))return!0;return!1}function i3(i){for(let s=0;s<i.length;s++){let a=i[s];if(VD(a))return s}return i.length}function r3(i,s){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){let f=i[a];if(typeof f=="number")return-1;if(f===s)return a;a++}return-1}function XI(i,s){return i?":not("+s.trim()+")":s}function o3(i){let s=i[0],a=1,f=2,x="",n=!1;for(;a<i.length;){let R=i[a];if(typeof R=="string")if(f&2){let $=i[++a];x+="["+R+($.length>0?'="'+$+'"':"")+"]"}else f&8?x+="."+R:f&4&&(x+=" "+R);else x!==""&&!Fs(R)&&(s+=XI(n,x),x=""),f=R,n=n||!Fs(f);a++}return x!==""&&(s+=XI(n,x)),s}function s3(i){return i.map(o3).join(",")}function a3(i){let s=[],a=[],f=1,x=2;for(;f<i.length;){let n=i[f];if(typeof n=="string")x===2?n!==""&&s.push(n,i[++f]):x===8&&a.push(n);else{if(!Fs(x))break;x=n}f++}return{attrs:s,classes:a}}function Rn(i){return zm(()=>{let s=qD(i),a=ei(Mt({},s),{decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===BD.OnPush,directiveDefs:null,pipeDefs:null,dependencies:s.standalone&&i.dependencies||null,getStandaloneInjector:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||aa.Emulated,styles:i.styles||Qo,_:null,schemas:i.schemas||null,tView:null,id:""});WD(a);let f=i.dependencies;return a.directiveDefs=JI(f,!1),a.pipeDefs=JI(f,!0),a.id=u3(a),a})}function l3(i){return yc(i)||UD(i)}function c3(i){return i!==null}function is(i){return zm(()=>({type:i.type,bootstrap:i.bootstrap||Qo,declarations:i.declarations||Qo,imports:i.imports||Qo,exports:i.exports||Qo,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function YI(i,s){if(i==null)return zh;let a={};for(let f in i)if(i.hasOwnProperty(f)){let x=i[f],n,R,$=_c.None;Array.isArray(x)?($=x[0],n=x[1],R=x[2]??n):(n=x,R=x),s?(a[n]=$!==_c.None?[f,$]:f,s[n]=R):a[n]=f}return a}function Ni(i){return zm(()=>{let s=qD(i);return WD(s),s})}function yc(i){return i[Ak]||null}function UD(i){return i[Pk]||null}function $D(i){return i[Rk]||null}function GD(i){let s=yc(i)||UD(i)||$D(i);return s!==null?s.standalone:!1}function HD(i,s){let a=i[Ok]||null;if(!a&&s===!0)throw new Error(`Type ${eo(i)} does not have '\u0275mod' property.`);return a}function qD(i){let s={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:s,inputTransforms:null,inputConfig:i.inputs||zh,exportAs:i.exportAs||null,standalone:i.standalone===!0,signals:i.signals===!0,selectors:i.selectors||Qo,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:YI(i.inputs,s),outputs:YI(i.outputs),debugInfo:null}}function WD(i){i.features?.forEach(s=>s(i))}function JI(i,s){if(!i)return null;let a=s?$D:l3;return()=>(typeof i=="function"?i():i).map(f=>a(f)).filter(c3)}function u3(i){let s=0,a=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,i.consts,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery].join("|");for(let x of a)s=Math.imul(31,s)+x.charCodeAt(0)<<0;return s+=2147483648,"c"+s}function Vm(i){return{\u0275providers:i}}function Pw(...i){return{\u0275providers:ZD(!0,i),\u0275fromNgModule:!0}}function ZD(i,...s){let a=[],f=new Set,x,n=R=>{a.push(R)};return Dw(s,R=>{let $=R;zb($,n,[],f)&&(x||=[],x.push($))}),x!==void 0&&XD(x,n),a}function XD(i,s){for(let a=0;a<i.length;a++){let{ngModule:f,providers:x}=i[a];Rw(x,n=>{s(n,f)})}}function zb(i,s,a,f){if(i=Qr(i),!i)return!1;let x=null,n=GI(i),R=!n&&yc(i);if(!n&&!R){let G=i.ngModule;if(n=GI(G),n)x=G;else return!1}else{if(R&&!R.standalone)return!1;x=i}let $=f.has(x);if(R){if($)return!1;if(f.add(x),R.dependencies){let G=typeof R.dependencies=="function"?R.dependencies():R.dependencies;for(let se of G)zb(se,s,a,f)}}else if(n){if(n.imports!=null&&!$){f.add(x);let se;try{Dw(n.imports,Me=>{zb(Me,s,a,f)&&(se||=[],se.push(Me))})}finally{}se!==void 0&&XD(se,s)}if(!$){let se=Nh(x)||(()=>new x);s({provide:x,useFactory:se,deps:Qo},x),s({provide:zD,useValue:x,multi:!0},x),s({provide:Bh,useValue:()=>sn(x),multi:!0},x)}let G=n.providers;if(G!=null&&!$){let se=i;Rw(G,Me=>{s(Me,se)})}}else return!1;return x!==i&&i.providers!==void 0}function Rw(i,s){for(let a of i)PD(a)&&(a=a.\u0275providers),Array.isArray(a)?Rw(a,s):s(a)}var d3=Pi({provide:String,useValue:Pi});function YD(i){return i!==null&&typeof i=="object"&&d3 in i}function h3(i){return!!(i&&i.useExisting)}function f3(i){return!!(i&&i.useFactory)}function Vh(i){return typeof i=="function"}function p3(i){return!!i.useClass}var z0=new on(""),s0={},m3={},wb;function Ow(){return wb===void 0&&(wb=new m0),wb}var to=class{},Lm=class extends to{get destroyed(){return this._destroyed}constructor(s,a,f,x){super(),this.parent=a,this.source=f,this.scopes=x,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Vb(s,R=>this.processProvider(R)),this.records.set(ND,Ph(void 0,this)),x.has("environment")&&this.records.set(to,Ph(void 0,this));let n=this.records.get(z0);n!=null&&typeof n.value=="string"&&this.scopes.add(n.value),this.injectorDefTypes=new Set(this.get(zD,Qo,Jn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let s=gi(null);try{for(let f of this._ngOnDestroyHooks)f.ngOnDestroy();let a=this._onDestroyHooks;this._onDestroyHooks=[];for(let f of a)f()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),gi(s)}}onDestroy(s){return this.assertNotDestroyed(),this._onDestroyHooks.push(s),()=>this.removeOnDestroy(s)}runInContext(s){this.assertNotDestroyed();let a=pc(this),f=Ko(void 0),x;try{return s()}finally{pc(a),Ko(f)}}get(s,a=Rm,f=Jn.Default){if(this.assertNotDestroyed(),s.hasOwnProperty(qI))return s[qI](this);f=N0(f);let x,n=pc(this),R=Ko(void 0);try{if(!(f&Jn.SkipSelf)){let G=this.records.get(s);if(G===void 0){let se=x3(s)&&F0(s);se&&this.injectableDefInScope(se)?G=Ph(Bb(s),s0):G=null,this.records.set(s,G)}if(G!=null)return this.hydrate(s,G)}let $=f&Jn.Self?Ow():this.parent;return a=f&Jn.Optional&&a===Rm?null:a,$.get(s,a)}catch($){if($.name==="NullInjectorError"){if(($[f0]=$[f0]||[]).unshift(eo(s)),n)throw $;return $k($,s,"R3InjectorError",this.source)}else throw $}finally{Ko(R),pc(n)}}resolveInjectorInitializers(){let s=gi(null),a=pc(this),f=Ko(void 0),x;try{let n=this.get(Bh,Qo,Jn.Self);for(let R of n)R()}finally{pc(a),Ko(f),gi(s)}}toString(){let s=[],a=this.records;for(let f of a.keys())s.push(eo(f));return`R3Injector[${s.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new hn(205,!1)}processProvider(s){s=Qr(s);let a=Vh(s)?s:Qr(s&&s.provide),f=_3(s);if(!Vh(s)&&s.multi===!0){let x=this.records.get(a);x||(x=Ph(void 0,s0,!0),x.factory=()=>kb(x.multi),this.records.set(a,x)),a=s,x.multi.push(s)}this.records.set(a,f)}hydrate(s,a){let f=gi(null);try{return a.value===s0&&(a.value=m3,a.value=a.factory()),typeof a.value=="object"&&a.value&&v3(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}finally{gi(f)}}injectableDefInScope(s){if(!s.providedIn)return!1;let a=Qr(s.providedIn);return typeof a=="string"?a==="any"||this.scopes.has(a):this.injectorDefTypes.has(a)}removeOnDestroy(s){let a=this._onDestroyHooks.indexOf(s);a!==-1&&this._onDestroyHooks.splice(a,1)}};function Bb(i){let s=F0(i),a=s!==null?s.factory:Nh(i);if(a!==null)return a;if(i instanceof on)throw new hn(204,!1);if(i instanceof Function)return g3(i);throw new hn(204,!1)}function g3(i){if(i.length>0)throw new hn(204,!1);let a=Ik(i);return a!==null?()=>a.factory(i):()=>new i}function _3(i){if(YD(i))return Ph(void 0,i.useValue);{let s=JD(i);return Ph(s,s0)}}function JD(i,s,a){let f;if(Vh(i)){let x=Qr(i);return Nh(x)||Bb(x)}else if(YD(i))f=()=>Qr(i.useValue);else if(f3(i))f=()=>i.useFactory(...kb(i.deps||[]));else if(h3(i))f=()=>sn(Qr(i.useExisting));else{let x=Qr(i&&(i.useClass||i.provide));if(y3(i))f=()=>new x(...kb(i.deps));else return Nh(x)||Bb(x)}return f}function Ph(i,s,a=!1){return{factory:i,value:s,multi:a?[]:void 0}}function y3(i){return!!i.deps}function v3(i){return i!==null&&typeof i=="object"&&typeof i.ngOnDestroy=="function"}function x3(i){return typeof i=="function"||typeof i=="object"&&i instanceof on}function Vb(i,s){for(let a of i)Array.isArray(a)?Vb(a,s):a&&PD(a)?Vb(a.\u0275providers,s):s(a)}function rs(i,s){i instanceof Lm&&i.assertNotDestroyed();let a,f=pc(i),x=Ko(void 0);try{return s()}finally{pc(f),Ko(x)}}function KD(){return RD()!==void 0||Vk()!=null}function b3(i){if(!KD())throw new hn(-203,!1)}function w3(i){return typeof i=="function"}var Ja=0,Hn=1,In=2,kr=3,ks=4,zs=5,g0=6,_0=7,Ns=8,jh=9,la=10,fr=11,Fm=12,KI=13,Xh=14,ca=15,Vu=16,Rh=17,Wa=18,B0=19,QD=20,mc=21,Cb=22,es=23,Za=25,e2=1;var ju=7,y0=8,Uh=9,No=10,v0=function(i){return i[i.None=0]="None",i[i.HasTransplantedViews=2]="HasTransplantedViews",i}(v0||{});function gc(i){return Array.isArray(i)&&typeof i[e2]=="object"}function Ka(i){return Array.isArray(i)&&i[e2]===!0}function t2(i){return(i.flags&4)!==0}function V0(i){return i.componentOffset>-1}function Lw(i){return(i.flags&1)===1}function vc(i){return!!i.template}function jb(i){return(i[In]&512)!==0}var Ub=class{constructor(s,a,f){this.previousValue=s,this.currentValue=a,this.firstChange=f}isFirstChange(){return this.firstChange}};function n2(i,s,a,f){s!==null?s.applyValueToInputSignal(s,f):i[a]=f}function da(){return i2}function i2(i){return i.type.prototype.ngOnChanges&&(i.setInput=E3),C3}da.ngInherit=!0;function C3(){let i=o2(this),s=i?.current;if(s){let a=i.previous;if(a===zh)i.previous=s;else for(let f in s)a[f]=s[f];i.current=null,this.ngOnChanges(s)}}function E3(i,s,a,f,x){let n=this.declaredInputs[f],R=o2(i)||M3(i,{previous:zh,current:null}),$=R.current||(R.current={}),G=R.previous,se=G[n];$[n]=new Ub(se&&se.currentValue,a,G===zh),n2(i,s,x,a)}var r2="__ngSimpleChanges__";function o2(i){return i[r2]||null}function M3(i,s){return i[r2]=s}var QI=null;var oa=function(i,s,a){QI?.(i,s,a)},s2="svg",S3="math";function ua(i){for(;Array.isArray(i);)i=i[Ja];return i}function a2(i,s){return ua(s[i])}function os(i,s){return ua(s[i.index])}function l2(i,s){return i.data[s]}function T3(i,s){return i[s]}function bc(i,s){let a=s[i];return gc(a)?a:a[Ja]}function I3(i){return(i[In]&4)===4}function Fw(i){return(i[In]&128)===128}function D3(i){return Ka(i[kr])}function x0(i,s){return s==null?null:i[s]}function c2(i){i[Rh]=0}function u2(i){i[In]&1024||(i[In]|=1024,Fw(i)&&U0(i))}function A3(i,s){for(;i>0;)s=s[Xh],i--;return s}function j0(i){return!!(i[In]&9216||i[es]?.dirty)}function $b(i){i[la].changeDetectionScheduler?.notify(8),i[In]&64&&(i[In]|=1024),j0(i)&&U0(i)}function U0(i){i[la].changeDetectionScheduler?.notify(0);let s=Uu(i);for(;s!==null&&!(s[In]&8192||(s[In]|=8192,!Fw(s)));)s=Uu(s)}function d2(i,s){if((i[In]&256)===256)throw new hn(911,!1);i[mc]===null&&(i[mc]=[]),i[mc].push(s)}function P3(i,s){if(i[mc]===null)return;let a=i[mc].indexOf(s);a!==-1&&i[mc].splice(a,1)}function Uu(i){let s=i[kr];return Ka(s)?s[kr]:s}var qn={lFrame:x2(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var h2=!1;function R3(){return qn.lFrame.elementDepthCount}function O3(){qn.lFrame.elementDepthCount++}function L3(){qn.lFrame.elementDepthCount--}function f2(){return qn.bindingsEnabled}function F3(){return qn.skipHydrationRootTNode!==null}function k3(i){return qn.skipHydrationRootTNode===i}function N3(){qn.skipHydrationRootTNode=null}function Ti(){return qn.lFrame.lView}function no(){return qn.lFrame.tView}function jm(i){return qn.lFrame.contextLView=i,i[Ns]}function Um(i){return qn.lFrame.contextLView=null,i}function io(){let i=p2();for(;i!==null&&i.type===64;)i=i.parent;return i}function p2(){return qn.lFrame.currentTNode}function z3(){let i=qn.lFrame,s=i.currentTNode;return i.isParent?s:s.parent}function $m(i,s){let a=qn.lFrame;a.currentTNode=i,a.isParent=s}function m2(){return qn.lFrame.isParent}function B3(){qn.lFrame.isParent=!1}function V3(){return qn.lFrame.contextLView}function g2(){return h2}function eD(i){h2=i}function j3(i){return qn.lFrame.bindingIndex=i}function $0(){return qn.lFrame.bindingIndex++}function U3(i){let s=qn.lFrame,a=s.bindingIndex;return s.bindingIndex=s.bindingIndex+i,a}function $3(){return qn.lFrame.inI18n}function G3(i,s){let a=qn.lFrame;a.bindingIndex=a.bindingRootIndex=i,Gb(s)}function H3(){return qn.lFrame.currentDirectiveIndex}function Gb(i){qn.lFrame.currentDirectiveIndex=i}function q3(i){let s=qn.lFrame.currentDirectiveIndex;return s===-1?null:i[s]}function _2(){return qn.lFrame.currentQueryIndex}function kw(i){qn.lFrame.currentQueryIndex=i}function W3(i){let s=i[Hn];return s.type===2?s.declTNode:s.type===1?i[zs]:null}function y2(i,s,a){if(a&Jn.SkipSelf){let x=s,n=i;for(;x=x.parent,x===null&&!(a&Jn.Host);)if(x=W3(n),x===null||(n=n[Xh],x.type&10))break;if(x===null)return!1;s=x,i=n}let f=qn.lFrame=v2();return f.currentTNode=s,f.lView=i,!0}function Nw(i){let s=v2(),a=i[Hn];qn.lFrame=s,s.currentTNode=a.firstChild,s.lView=i,s.tView=a,s.contextLView=i,s.bindingIndex=a.bindingStartIndex,s.inI18n=!1}function v2(){let i=qn.lFrame,s=i===null?null:i.child;return s===null?x2(i):s}function x2(i){let s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return i!==null&&(i.child=s),s}function b2(){let i=qn.lFrame;return qn.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}var w2=b2;function zw(){let i=b2();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Z3(i){return(qn.lFrame.contextLView=A3(i,qn.lFrame.contextLView))[Ns]}function Yh(){return qn.lFrame.selectedIndex}function $u(i){qn.lFrame.selectedIndex=i}function Bw(){let i=qn.lFrame;return l2(i.tView,i.selectedIndex)}function Xu(){qn.lFrame.currentNamespace=s2}function Gm(){X3()}function X3(){qn.lFrame.currentNamespace=null}function Y3(){return qn.lFrame.currentNamespace}var C2=!0;function Vw(){return C2}function jw(i){C2=i}function J3(i,s,a){let{ngOnChanges:f,ngOnInit:x,ngDoCheck:n}=s.type.prototype;if(f){let R=i2(s);(a.preOrderHooks??=[]).push(i,R),(a.preOrderCheckHooks??=[]).push(i,R)}x&&(a.preOrderHooks??=[]).push(0-i,x),n&&((a.preOrderHooks??=[]).push(i,n),(a.preOrderCheckHooks??=[]).push(i,n))}function Uw(i,s){for(let a=s.directiveStart,f=s.directiveEnd;a<f;a++){let n=i.data[a].type.prototype,{ngAfterContentInit:R,ngAfterContentChecked:$,ngAfterViewInit:G,ngAfterViewChecked:se,ngOnDestroy:Me}=n;R&&(i.contentHooks??=[]).push(-a,R),$&&((i.contentHooks??=[]).push(a,$),(i.contentCheckHooks??=[]).push(a,$)),G&&(i.viewHooks??=[]).push(-a,G),se&&((i.viewHooks??=[]).push(a,se),(i.viewCheckHooks??=[]).push(a,se)),Me!=null&&(i.destroyHooks??=[]).push(a,Me)}}function a0(i,s,a){E2(i,s,3,a)}function l0(i,s,a,f){(i[In]&3)===a&&E2(i,s,a,f)}function Eb(i,s){let a=i[In];(a&3)===s&&(a&=16383,a+=1,i[In]=a)}function E2(i,s,a,f){let x=f!==void 0?i[Rh]&65535:0,n=f??-1,R=s.length-1,$=0;for(let G=x;G<R;G++)if(typeof s[G+1]=="number"){if($=s[G],f!=null&&$>=f)break}else s[G]<0&&(i[Rh]+=65536),($<n||n==-1)&&(K3(i,a,s,G),i[Rh]=(i[Rh]&4294901760)+G+2),G++}function tD(i,s){oa(4,i,s);let a=gi(null);try{s.call(i)}finally{gi(a),oa(5,i,s)}}function K3(i,s,a,f){let x=a[f]<0,n=a[f+1],R=x?-a[f]:a[f],$=i[R];x?i[In]>>14<i[Rh]>>16&&(i[In]&3)===s&&(i[In]+=16384,tD($,n)):tD($,n)}var kh=-1,Gu=class{constructor(s,a,f){this.factory=s,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=f}};function Q3(i){return i instanceof Gu}function eN(i){return(i.flags&8)!==0}function tN(i){return(i.flags&16)!==0}var Mb={},Hb=class{constructor(s,a){this.injector=s,this.parentInjector=a}get(s,a,f){f=N0(f);let x=this.injector.get(s,Mb,f);return x!==Mb||a===Mb?x:this.parentInjector.get(s,a,f)}};function M2(i){return i!==kh}function b0(i){return i&32767}function nN(i){return i>>16}function w0(i,s){let a=nN(i),f=s;for(;a>0;)f=f[Xh],a--;return f}var qb=!0;function nD(i){let s=qb;return qb=i,s}var iN=256,S2=iN-1,T2=5,rN=0,sa={};function oN(i,s,a){let f;typeof a=="string"?f=a.charCodeAt(0)||0:a.hasOwnProperty(Am)&&(f=a[Am]),f==null&&(f=a[Am]=rN++);let x=f&S2,n=1<<x;s.data[i+(x>>T2)]|=n}function C0(i,s){let a=I2(i,s);if(a!==-1)return a;let f=s[Hn];f.firstCreatePass&&(i.injectorIndex=s.length,Sb(f.data,i),Sb(s,null),Sb(f.blueprint,null));let x=$w(i,s),n=i.injectorIndex;if(M2(x)){let R=b0(x),$=w0(x,s),G=$[Hn].data;for(let se=0;se<8;se++)s[n+se]=$[R+se]|G[R+se]}return s[n+8]=x,n}function Sb(i,s){i.push(0,0,0,0,0,0,0,0,s)}function I2(i,s){return i.injectorIndex===-1||i.parent&&i.parent.injectorIndex===i.injectorIndex||s[i.injectorIndex+8]===null?-1:i.injectorIndex}function $w(i,s){if(i.parent&&i.parent.injectorIndex!==-1)return i.parent.injectorIndex;let a=0,f=null,x=s;for(;x!==null;){if(f=O2(x),f===null)return kh;if(a++,x=x[Xh],f.injectorIndex!==-1)return f.injectorIndex|a<<16}return kh}function Wb(i,s,a){oN(i,s,a)}function sN(i,s){if(s==="class")return i.classes;if(s==="style")return i.styles;let a=i.attrs;if(a){let f=a.length,x=0;for(;x<f;){let n=a[x];if(VD(n))break;if(n===0)x=x+2;else if(typeof n=="number")for(x++;x<f&&typeof a[x]=="string";)x++;else{if(n===s)return a[x+1];x=x+2}}}return null}function D2(i,s,a){if(a&Jn.Optional||i!==void 0)return i;Tw(s,"NodeInjector")}function A2(i,s,a,f){if(a&Jn.Optional&&f===void 0&&(f=null),!(a&(Jn.Self|Jn.Host))){let x=i[jh],n=Ko(void 0);try{return x?x.get(s,f,a&Jn.Optional):OD(s,f,a&Jn.Optional)}finally{Ko(n)}}return D2(f,s,a)}function P2(i,s,a,f=Jn.Default,x){if(i!==null){if(s[In]&2048&&!(f&Jn.Self)){let R=uN(i,s,a,f,sa);if(R!==sa)return R}let n=R2(i,s,a,f,sa);if(n!==sa)return n}return A2(s,a,f,x)}function R2(i,s,a,f,x){let n=lN(a);if(typeof n=="function"){if(!y2(s,i,f))return f&Jn.Host?D2(x,a,f):A2(s,a,f,x);try{let R;if(R=n(f),R==null&&!(f&Jn.Optional))Tw(a);else return R}finally{w2()}}else if(typeof n=="number"){let R=null,$=I2(i,s),G=kh,se=f&Jn.Host?s[ca][zs]:null;for(($===-1||f&Jn.SkipSelf)&&(G=$===-1?$w(i,s):s[$+8],G===kh||!rD(f,!1)?$=-1:(R=s[Hn],$=b0(G),s=w0(G,s)));$!==-1;){let Me=s[Hn];if(iD(n,$,Me.data)){let ke=aN($,s,a,R,f,se);if(ke!==sa)return ke}G=s[$+8],G!==kh&&rD(f,s[Hn].data[$+8]===se)&&iD(n,$,s)?(R=Me,$=b0(G),s=w0(G,s)):$=-1}}return x}function aN(i,s,a,f,x,n){let R=s[Hn],$=R.data[i+8],G=f==null?V0($)&&qb:f!=R&&($.type&3)!==0,se=x&Jn.Host&&n===$,Me=c0($,R,a,G,se);return Me!==null?Hu(s,R,Me,$):sa}function c0(i,s,a,f,x){let n=i.providerIndexes,R=s.data,$=n&1048575,G=i.directiveStart,se=i.directiveEnd,Me=n>>20,ke=f?$:$+Me,tt=x?$+Me:se;for(let Ye=ke;Ye<tt;Ye++){let wt=R[Ye];if(Ye<G&&a===wt||Ye>=G&&wt.type===a)return Ye}if(x){let Ye=R[G];if(Ye&&vc(Ye)&&Ye.type===a)return G}return null}function Hu(i,s,a,f){let x=i[a],n=s.data;if(Q3(x)){let R=x;R.resolving&&Fk(Lk(n[a]));let $=nD(R.canSeeViewProviders);R.resolving=!0;let G,se=R.injectImpl?Ko(R.injectImpl):null,Me=y2(i,f,Jn.Default);try{x=i[a]=R.factory(void 0,n,i,f),s.firstCreatePass&&a>=f.directiveStart&&J3(a,n[a],s)}finally{se!==null&&Ko(se),nD($),R.resolving=!1,w2()}}return x}function lN(i){if(typeof i=="string")return i.charCodeAt(0)||0;let s=i.hasOwnProperty(Am)?i[Am]:void 0;return typeof s=="number"?s>=0?s&S2:cN:s}function iD(i,s,a){let f=1<<i;return!!(a[s+(i>>T2)]&f)}function rD(i,s){return!(i&Jn.Self)&&!(i&Jn.Host&&s)}var Bu=class{constructor(s,a){this._tNode=s,this._lView=a}get(s,a,f){return P2(this._tNode,this._lView,s,N0(f),a)}};function cN(){return new Bu(io(),Ti())}function ha(i){return zm(()=>{let s=i.prototype.constructor,a=s[h0]||Zb(s),f=Object.prototype,x=Object.getPrototypeOf(i.prototype).constructor;for(;x&&x!==f;){let n=x[h0]||Zb(x);if(n&&n!==a)return n;x=Object.getPrototypeOf(x)}return n=>new n})}function Zb(i){return TD(i)?()=>{let s=Zb(Qr(i));return s&&s()}:Nh(i)}function uN(i,s,a,f,x){let n=i,R=s;for(;n!==null&&R!==null&&R[In]&2048&&!(R[In]&512);){let $=R2(n,R,a,f|Jn.Self,sa);if($!==sa)return $;let G=n.parent;if(!G){let se=R[QD];if(se){let Me=se.get(a,sa,f);if(Me!==sa)return Me}G=O2(R),R=R[Xh]}n=G}return x}function O2(i){let s=i[Hn],a=s.type;return a===2?s.declTNode:a===1?i[zs]:null}function Gw(i){return sN(io(),i)}function oD(i,s=null,a=null,f){let x=L2(i,s,a,f);return x.resolveInjectorInitializers(),x}function L2(i,s=null,a=null,f,x=new Set){let n=[a||Qo,Pw(i)];return f=f||(typeof i=="object"?void 0:eo(i)),new Lm(n,s||Ow(),f||null,x)}var ts=class i{static{this.THROW_IF_NOT_FOUND=Rm}static{this.NULL=new m0}static create(s,a){if(Array.isArray(s))return oD({name:""},a,s,"");{let f=s.name??"";return oD({name:f},s.parent,s.providers,f)}}static{this.\u0275prov=Jt({token:i,providedIn:"any",factory:()=>sn(ND)})}static{this.__NG_ELEMENT_ID__=-1}};var dN=new on("");dN.__NG_ELEMENT_ID__=i=>{let s=io();if(s===null)throw new hn(204,!1);if(s.type&2)return s.value;if(i&Jn.Optional)return null;throw new hn(204,!1)};var hN="ngOriginalError";function Tb(i){return i[hN]}var F2=!0,Hw=(()=>{class i{static{this.__NG_ELEMENT_ID__=fN}static{this.__NG_ENV_ID__=a=>a}}return i})(),Xb=class extends Hw{constructor(s){super(),this._lView=s}onDestroy(s){return d2(this._lView,s),()=>P3(this._lView,s)}};function fN(){return new Xb(Ti())}var wc=(()=>{class i{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ir(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let a=this.taskId++;return this.pendingTasks.add(a),a}remove(a){this.pendingTasks.delete(a),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275prov=Jt({token:i,providedIn:"root",factory:()=>new i})}}return i})();var Yb=class extends _r{constructor(s=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=s,KD()&&(this.destroyRef=Ct(Hw,{optional:!0})??void 0,this.pendingTasks=Ct(wc,{optional:!0})??void 0)}emit(s){let a=gi(null);try{super.next(s)}finally{gi(a)}}subscribe(s,a,f){let x=s,n=a||(()=>null),R=f;if(s&&typeof s=="object"){let G=s;x=G.next?.bind(G),n=G.error?.bind(G),R=G.complete?.bind(G)}this.__isAsync&&(n=this.wrapInTimeout(n),x&&(x=this.wrapInTimeout(x)),R&&(R=this.wrapInTimeout(R)));let $=super.subscribe({next:x,error:n,complete:R});return s instanceof ir&&s.add($),$}wrapInTimeout(s){return a=>{let f=this.pendingTasks?.add();setTimeout(()=>{s(a),f!==void 0&&this.pendingTasks?.remove(f)})}}},qi=Yb;function E0(...i){}function k2(i){let s,a;function f(){i=E0;try{a!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(a),s!==void 0&&clearTimeout(s)}catch{}}return s=setTimeout(()=>{i(),f()}),typeof requestAnimationFrame=="function"&&(a=requestAnimationFrame(()=>{i(),f()})),()=>f()}function sD(i){return queueMicrotask(()=>i()),()=>{i=E0}}var qw="isAngularZone",M0=qw+"_ID",pN=0,Wi=class i{constructor(s){this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new qi(!1),this.onMicrotaskEmpty=new qi(!1),this.onStable=new qi(!1),this.onError=new qi(!1);let{enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:f=!1,shouldCoalesceRunChangeDetection:x=!1,scheduleInRootZone:n=F2}=s;if(typeof Zone>"u")throw new hn(908,!1);Zone.assertZonePatched();let R=this;R._nesting=0,R._outer=R._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(R._inner=R._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(R._inner=R._inner.fork(Zone.longStackTraceZoneSpec)),R.shouldCoalesceEventChangeDetection=!x&&f,R.shouldCoalesceRunChangeDetection=x,R.callbackScheduled=!1,R.scheduleInRootZone=n,_N(R)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(qw)===!0}static assertInAngularZone(){if(!i.isInAngularZone())throw new hn(909,!1)}static assertNotInAngularZone(){if(i.isInAngularZone())throw new hn(909,!1)}run(s,a,f){return this._inner.run(s,a,f)}runTask(s,a,f,x){let n=this._inner,R=n.scheduleEventTask("NgZoneEvent: "+x,s,mN,E0,E0);try{return n.runTask(R,a,f)}finally{n.cancelTask(R)}}runGuarded(s,a,f){return this._inner.runGuarded(s,a,f)}runOutsideAngular(s){return this._outer.run(s)}},mN={};function Ww(i){if(i._nesting==0&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function gN(i){if(i.isCheckStableRunning||i.callbackScheduled)return;i.callbackScheduled=!0;function s(){k2(()=>{i.callbackScheduled=!1,Jb(i),i.isCheckStableRunning=!0,Ww(i),i.isCheckStableRunning=!1})}i.scheduleInRootZone?Zone.root.run(()=>{s()}):i._outer.run(()=>{s()}),Jb(i)}function _N(i){let s=()=>{gN(i)},a=pN++;i._inner=i._inner.fork({name:"angular",properties:{[qw]:!0,[M0]:a,[M0+a]:!0},onInvokeTask:(f,x,n,R,$,G)=>{if(yN(G))return f.invokeTask(n,R,$,G);try{return aD(i),f.invokeTask(n,R,$,G)}finally{(i.shouldCoalesceEventChangeDetection&&R.type==="eventTask"||i.shouldCoalesceRunChangeDetection)&&s(),lD(i)}},onInvoke:(f,x,n,R,$,G,se)=>{try{return aD(i),f.invoke(n,R,$,G,se)}finally{i.shouldCoalesceRunChangeDetection&&!i.callbackScheduled&&!vN(G)&&s(),lD(i)}},onHasTask:(f,x,n,R)=>{f.hasTask(n,R),x===n&&(R.change=="microTask"?(i._hasPendingMicrotasks=R.microTask,Jb(i),Ww(i)):R.change=="macroTask"&&(i.hasPendingMacrotasks=R.macroTask))},onHandleError:(f,x,n,R)=>(f.handleError(n,R),i.runOutsideAngular(()=>i.onError.emit(R)),!1)})}function Jb(i){i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&i.callbackScheduled===!0?i.hasPendingMicrotasks=!0:i.hasPendingMicrotasks=!1}function aD(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function lD(i){i._nesting--,Ww(i)}var Kb=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new qi,this.onMicrotaskEmpty=new qi,this.onStable=new qi,this.onError=new qi}run(s,a,f){return s.apply(a,f)}runGuarded(s,a,f){return s.apply(a,f)}runOutsideAngular(s){return s()}runTask(s,a,f,x){return s.apply(a,f)}};function yN(i){return N2(i,"__ignore_ng_zone__")}function vN(i){return N2(i,"__scheduler_tick__")}function N2(i,s){return!Array.isArray(i)||i.length!==1?!1:i[0]?.data?.[s]===!0}var Xa=class{constructor(){this._console=console}handleError(s){let a=this._findOriginalError(s);this._console.error("ERROR",s),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(s){let a=s&&Tb(s);for(;a&&Tb(a);)a=Tb(a);return a||null}},xN=new on("",{providedIn:"root",factory:()=>{let i=Ct(Wi),s=Ct(Xa);return a=>i.runOutsideAngular(()=>s.handleError(a))}});function bN(){return Jh(io(),Ti())}function Jh(i,s){return new xo(os(i,s))}var xo=(()=>{class i{constructor(a){this.nativeElement=a}static{this.__NG_ELEMENT_ID__=bN}}return i})();function wN(i){return i instanceof xo?i.nativeElement:i}function CN(){return this._results[Symbol.iterator]()}var Qb=class i{get changes(){return this._changes??=new qi}constructor(s=!1){this._emitDistinctChangesOnly=s,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let a=i.prototype;a[Symbol.iterator]||(a[Symbol.iterator]=CN)}get(s){return this._results[s]}map(s){return this._results.map(s)}filter(s){return this._results.filter(s)}find(s){return this._results.find(s)}reduce(s,a){return this._results.reduce(s,a)}forEach(s){this._results.forEach(s)}some(s){return this._results.some(s)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(s,a){this.dirty=!1;let f=qk(s);(this._changesDetected=!Hk(this._results,f,a))&&(this._results=f,this.length=f.length,this.last=f[this.length-1],this.first=f[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(s){this._onDirty=s}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function z2(i){return(i.flags&128)===128}var B2=new Map,EN=0;function MN(){return EN++}function SN(i){B2.set(i[B0],i)}function ew(i){B2.delete(i[B0])}var cD="__ngContext__";function qu(i,s){gc(s)?(i[cD]=s[B0],SN(s)):i[cD]=s}function V2(i){return U2(i[Fm])}function j2(i){return U2(i[ks])}function U2(i){for(;i!==null&&!Ka(i);)i=i[ks];return i}var tw;function $2(i){tw=i}function TN(){if(tw!==void 0)return tw;if(typeof document<"u")return document;throw new hn(210,!1)}var Zw=new on("",{providedIn:"root",factory:()=>IN}),IN="ng",Xw=new on(""),fa=new on("",{providedIn:"platform",factory:()=>"unknown"});var Yw=new on("",{providedIn:"root",factory:()=>TN().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var DN="h",AN="b";var PN=()=>null;function Jw(i,s,a=!1){return PN(i,s,a)}var G2=!1,RN=new on("",{providedIn:"root",factory:()=>G2});var t0;function ON(){if(t0===void 0&&(t0=null,Pm.trustedTypes))try{t0=Pm.trustedTypes.createPolicy("angular",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return t0}function LN(i){return ON()?.createScriptURL(i)||i}var n0;function FN(){if(n0===void 0&&(n0=null,Pm.trustedTypes))try{n0=Pm.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return n0}function uD(i){return FN()?.createScriptURL(i)||i}var S0=class{constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${MD})`}};function Hm(i){return i instanceof S0?i.changingThisBreaksApplicationSecurity:i}function Kw(i,s){let a=kN(i);if(a!=null&&a!==s){if(a==="ResourceURL"&&s==="URL")return!0;throw new Error(`Required a safe ${s}, got a ${a} (see ${MD})`)}return a===s}function kN(i){return i instanceof S0&&i.getTypeName()||null}var NN=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function H2(i){return i=String(i),i.match(NN)?i:"unsafe:"+i}var G0=function(i){return i[i.NONE=0]="NONE",i[i.HTML=1]="HTML",i[i.STYLE=2]="STYLE",i[i.SCRIPT=3]="SCRIPT",i[i.URL=4]="URL",i[i.RESOURCE_URL=5]="RESOURCE_URL",i}(G0||{});function Qa(i){let s=W2();return s?s.sanitize(G0.URL,i)||"":Kw(i,"URL")?Hm(i):H2(k0(i))}function zN(i){let s=W2();if(s)return uD(s.sanitize(G0.RESOURCE_URL,i)||"");if(Kw(i,"ResourceURL"))return uD(Hm(i));throw new hn(904,!1)}function Ui(i){return LN(i[0])}function BN(i,s){return s==="src"&&(i==="embed"||i==="frame"||i==="iframe"||i==="media"||i==="script")||s==="href"&&(i==="base"||i==="link")?zN:Qa}function q2(i,s,a){return BN(s,a)(i)}function W2(){let i=Ti();return i&&i[la].sanitizer}function Z2(i){return i instanceof Function?i():i}function VN(i){return(i??Ct(ts)).get(fa)==="browser"}var Ya=function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i}(Ya||{}),jN;function Qw(i,s){return jN(i,s)}function Oh(i,s,a,f,x){if(f!=null){let n,R=!1;Ka(f)?n=f:gc(f)&&(R=!0,f=f[Ja]);let $=ua(f);i===0&&a!==null?x==null?Q2(s,a,$):T0(s,a,$,x||null,!0):i===1&&a!==null?T0(s,a,$,x||null,!0):i===2?nz(s,$,R):i===3&&s.destroyNode($),n!=null&&rz(s,i,n,a,x)}}function UN(i,s){return i.createText(s)}function $N(i,s,a){i.setValue(s,a)}function X2(i,s,a){return i.createElement(s,a)}function GN(i,s){Y2(i,s),s[Ja]=null,s[zs]=null}function HN(i,s,a,f,x,n){f[Ja]=x,f[zs]=s,H0(i,f,a,1,x,n)}function Y2(i,s){s[la].changeDetectionScheduler?.notify(9),H0(i,s,s[fr],2,null,null)}function qN(i){let s=i[Fm];if(!s)return Ib(i[Hn],i);for(;s;){let a=null;if(gc(s))a=s[Fm];else{let f=s[No];f&&(a=f)}if(!a){for(;s&&!s[ks]&&s!==i;)gc(s)&&Ib(s[Hn],s),s=s[kr];s===null&&(s=i),gc(s)&&Ib(s[Hn],s),a=s&&s[ks]}s=a}}function WN(i,s,a,f){let x=No+f,n=a.length;f>0&&(a[x-1][ks]=s),f<n-No?(s[ks]=a[x],kD(a,No+f,s)):(a.push(s),s[ks]=null),s[kr]=a;let R=s[Vu];R!==null&&a!==R&&J2(R,s);let $=s[Wa];$!==null&&$.insertView(i),$b(s),s[In]|=128}function J2(i,s){let a=i[Uh],f=s[kr];if(gc(f))i[In]|=v0.HasTransplantedViews;else{let x=f[kr][ca];s[ca]!==x&&(i[In]|=v0.HasTransplantedViews)}a===null?i[Uh]=[s]:a.push(s)}function eC(i,s){let a=i[Uh],f=a.indexOf(s);a.splice(f,1)}function nw(i,s){if(i.length<=No)return;let a=No+s,f=i[a];if(f){let x=f[Vu];x!==null&&x!==i&&eC(x,f),s>0&&(i[a-1][ks]=f[ks]);let n=p0(i,No+s);GN(f[Hn],f);let R=n[Wa];R!==null&&R.detachView(n[Hn]),f[kr]=null,f[ks]=null,f[In]&=-129}return f}function K2(i,s){if(!(s[In]&256)){let a=s[fr];a.destroyNode&&H0(i,s,a,3,null,null),qN(s)}}function Ib(i,s){if(s[In]&256)return;let a=gi(null);try{s[In]&=-129,s[In]|=256,s[es]&&ib(s[es]),XN(i,s),ZN(i,s),s[Hn].type===1&&s[fr].destroy();let f=s[Vu];if(f!==null&&Ka(s[kr])){f!==s[kr]&&eC(f,s);let x=s[Wa];x!==null&&x.detachView(i)}ew(s)}finally{gi(a)}}function ZN(i,s){let a=i.cleanup,f=s[_0];if(a!==null)for(let n=0;n<a.length-1;n+=2)if(typeof a[n]=="string"){let R=a[n+3];R>=0?f[R]():f[-R].unsubscribe(),n+=2}else{let R=f[a[n+1]];a[n].call(R)}f!==null&&(s[_0]=null);let x=s[mc];if(x!==null){s[mc]=null;for(let n=0;n<x.length;n++){let R=x[n];R()}}}function XN(i,s){let a;if(i!=null&&(a=i.destroyHooks)!=null)for(let f=0;f<a.length;f+=2){let x=s[a[f]];if(!(x instanceof Gu)){let n=a[f+1];if(Array.isArray(n))for(let R=0;R<n.length;R+=2){let $=x[n[R]],G=n[R+1];oa(4,$,G);try{G.call($)}finally{oa(5,$,G)}}else{oa(4,x,n);try{n.call(x)}finally{oa(5,x,n)}}}}}function YN(i,s,a){return JN(i,s.parent,a)}function JN(i,s,a){let f=s;for(;f!==null&&f.type&168;)s=f,f=s.parent;if(f===null)return a[Ja];{let{componentOffset:x}=f;if(x>-1){let{encapsulation:n}=i.data[f.directiveStart+x];if(n===aa.None||n===aa.Emulated)return null}return os(f,a)}}function T0(i,s,a,f,x){i.insertBefore(s,a,f,x)}function Q2(i,s,a){i.appendChild(s,a)}function dD(i,s,a,f,x){f!==null?T0(i,s,a,f,x):Q2(i,s,a)}function eA(i,s){return i.parentNode(s)}function KN(i,s){return i.nextSibling(s)}function QN(i,s,a){return tz(i,s,a)}function ez(i,s,a){return i.type&40?os(i,a):null}var tz=ez,hD;function tC(i,s,a,f){let x=YN(i,f,s),n=s[fr],R=f.parent||s[zs],$=QN(R,f,s);if(x!=null)if(Array.isArray(a))for(let G=0;G<a.length;G++)dD(n,x,a[G],$,!1);else dD(n,x,a,$,!1);hD!==void 0&&hD(n,f,s,a,x)}function Dm(i,s){if(s!==null){let a=s.type;if(a&3)return os(s,i);if(a&4)return iw(-1,i[s.index]);if(a&8){let f=s.child;if(f!==null)return Dm(i,f);{let x=i[s.index];return Ka(x)?iw(-1,x):ua(x)}}else{if(a&128)return Dm(i,s.next);if(a&32)return Qw(s,i)()||ua(i[s.index]);{let f=tA(i,s);if(f!==null){if(Array.isArray(f))return f[0];let x=Uu(i[ca]);return Dm(x,f)}else return Dm(i,s.next)}}}return null}function tA(i,s){if(s!==null){let f=i[ca][zs],x=s.projection;return f.projection[x]}return null}function iw(i,s){let a=No+i+1;if(a<s.length){let f=s[a],x=f[Hn].firstChild;if(x!==null)return Dm(f,x)}return s[ju]}function nz(i,s,a){i.removeChild(null,s,a)}function nC(i,s,a,f,x,n,R){for(;a!=null;){if(a.type===128){a=a.next;continue}let $=f[a.index],G=a.type;if(R&&s===0&&($&&qu(ua($),f),a.flags|=2),(a.flags&32)!==32)if(G&8)nC(i,s,a.child,f,x,n,!1),Oh(s,i,x,$,n);else if(G&32){let se=Qw(a,f),Me;for(;Me=se();)Oh(s,i,x,Me,n);Oh(s,i,x,$,n)}else G&16?iz(i,s,f,a,x,n):Oh(s,i,x,$,n);a=R?a.projectionNext:a.next}}function H0(i,s,a,f,x,n){nC(a,f,i.firstChild,s,x,n,!1)}function iz(i,s,a,f,x,n){let R=a[ca],G=R[zs].projection[f.projection];if(Array.isArray(G))for(let se=0;se<G.length;se++){let Me=G[se];Oh(s,i,x,Me,n)}else{let se=G,Me=R[kr];z2(f)&&(se.flags|=128),nC(i,s,se,Me,x,n,!0)}}function rz(i,s,a,f,x){let n=a[ju],R=ua(a);n!==R&&Oh(s,i,f,n,x);for(let $=No;$<a.length;$++){let G=a[$];H0(G[Hn],G,i,s,f,n)}}function oz(i,s,a,f,x){if(s)x?i.addClass(a,f):i.removeClass(a,f);else{let n=f.indexOf("-")===-1?void 0:Ya.DashCase;x==null?i.removeStyle(a,f,n):(typeof x=="string"&&x.endsWith("!important")&&(x=x.slice(0,-10),n|=Ya.Important),i.setStyle(a,f,x,n))}}function sz(i,s,a){i.setAttribute(s,"style",a)}function nA(i,s,a){a===""?i.removeAttribute(s,"class"):i.setAttribute(s,"class",a)}function iA(i,s,a){let{mergedAttrs:f,classes:x,styles:n}=a;f!==null&&Nb(i,s,f),x!==null&&nA(i,s,x),n!==null&&sz(i,s,n)}var Kh={};function Ft(i=1){rA(no(),Ti(),Yh()+i,!1)}function rA(i,s,a,f){if(!f)if((s[In]&3)===3){let n=i.preOrderCheckHooks;n!==null&&a0(s,n,a)}else{let n=i.preOrderHooks;n!==null&&l0(s,n,0,a)}$u(a)}function St(i,s=Jn.Default){let a=Ti();if(a===null)return sn(i,s);let f=io();return P2(f,a,Qr(i),s)}function oA(){let i="invalid";throw new Error(i)}function sA(i,s,a,f,x,n){let R=gi(null);try{let $=null;x&_c.SignalBased&&($=s[f][$a]),$!==null&&$.transformFn!==void 0&&(n=$.transformFn(n)),x&_c.HasDecoratorInputTransform&&(n=i.inputTransforms[f].call(s,n)),i.setInput!==null?i.setInput(s,$,n,a,f):n2(s,$,f,n)}finally{gi(R)}}function az(i,s){let a=i.hostBindingOpCodes;if(a!==null)try{for(let f=0;f<a.length;f++){let x=a[f];if(x<0)$u(~x);else{let n=x,R=a[++f],$=a[++f];G3(R,n);let G=s[n];$(2,G)}}}finally{$u(-1)}}function q0(i,s,a,f,x,n,R,$,G,se,Me){let ke=s.blueprint.slice();return ke[Ja]=x,ke[In]=f|4|128|8|64,(se!==null||i&&i[In]&2048)&&(ke[In]|=2048),c2(ke),ke[kr]=ke[Xh]=i,ke[Ns]=a,ke[la]=R||i&&i[la],ke[fr]=$||i&&i[fr],ke[jh]=G||i&&i[jh]||null,ke[zs]=n,ke[B0]=MN(),ke[g0]=Me,ke[QD]=se,ke[ca]=s.type==2?i[ca]:ke,ke}function W0(i,s,a,f,x){let n=i.data[s];if(n===null)n=lz(i,s,a,f,x),$3()&&(n.flags|=32);else if(n.type&64){n.type=a,n.value=f,n.attrs=x;let R=z3();n.injectorIndex=R===null?-1:R.injectorIndex}return $m(n,!0),n}function lz(i,s,a,f,x){let n=p2(),R=m2(),$=R?n:n&&n.parent,G=i.data[s]=pz(i,$,a,s,f,x);return i.firstChild===null&&(i.firstChild=G),n!==null&&(R?n.child==null&&G.parent!==null&&(n.child=G):n.next===null&&(n.next=G,G.prev=n)),G}function aA(i,s,a,f){if(a===0)return-1;let x=s.length;for(let n=0;n<a;n++)s.push(f),i.blueprint.push(f),i.data.push(null);return x}function lA(i,s,a,f,x){let n=Yh(),R=f&2;try{$u(-1),R&&s.length>Za&&rA(i,s,Za,!1),oa(R?2:0,x),a(f,x)}finally{$u(n),oa(R?3:1,x)}}function cA(i,s,a){if(t2(s)){let f=gi(null);try{let x=s.directiveStart,n=s.directiveEnd;for(let R=x;R<n;R++){let $=i.data[R];if($.contentQueries){let G=a[R];$.contentQueries(1,G,R)}}}finally{gi(f)}}}function uA(i,s,a){f2()&&(xz(i,s,a,os(a,s)),(a.flags&64)===64&&gA(i,s,a))}function dA(i,s,a=os){let f=s.localNames;if(f!==null){let x=s.index+1;for(let n=0;n<f.length;n+=2){let R=f[n+1],$=R===-1?a(s,i):i[R];i[x++]=$}}}function hA(i){let s=i.tView;return s===null||s.incompleteFirstPass?i.tView=iC(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):s}function iC(i,s,a,f,x,n,R,$,G,se,Me){let ke=Za+f,tt=ke+x,Ye=cz(ke,tt),wt=typeof se=="function"?se():se;return Ye[Hn]={type:i,blueprint:Ye,template:a,queries:null,viewQuery:$,declTNode:s,data:Ye.slice().fill(null,ke),bindingStartIndex:ke,expandoStartIndex:tt,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof n=="function"?n():n,pipeRegistry:typeof R=="function"?R():R,firstChild:null,schemas:G,consts:wt,incompleteFirstPass:!1,ssrId:Me}}function cz(i,s){let a=[];for(let f=0;f<s;f++)a.push(f<i?null:Kh);return a}function uz(i,s,a,f){let n=f.get(RN,G2)||a===aa.ShadowDom,R=i.selectRootElement(s,n);return dz(R),R}function dz(i){hz(i)}var hz=()=>null;function fz(i,s,a,f){let x=vA(s);x.push(a),i.firstCreatePass&&xA(i).push(f,x.length-1)}function pz(i,s,a,f,x,n){let R=s?s.injectorIndex:-1,$=0;return F3()&&($|=128),{type:a,index:f,insertBeforeIndex:null,injectorIndex:R,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:$,providerIndexes:0,value:x,attrs:n,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function fD(i,s,a,f,x){for(let n in s){if(!s.hasOwnProperty(n))continue;let R=s[n];if(R===void 0)continue;f??={};let $,G=_c.None;Array.isArray(R)?($=R[0],G=R[1]):$=R;let se=n;if(x!==null){if(!x.hasOwnProperty(n))continue;se=x[n]}i===0?pD(f,a,se,$,G):pD(f,a,se,$)}return f}function pD(i,s,a,f,x){let n;i.hasOwnProperty(a)?(n=i[a]).push(s,f):n=i[a]=[s,f],x!==void 0&&n.push(x)}function mz(i,s,a){let f=s.directiveStart,x=s.directiveEnd,n=i.data,R=s.attrs,$=[],G=null,se=null;for(let Me=f;Me<x;Me++){let ke=n[Me],tt=a?a.get(ke):null,Ye=tt?tt.inputs:null,wt=tt?tt.outputs:null;G=fD(0,ke.inputs,Me,G,Ye),se=fD(1,ke.outputs,Me,se,wt);let mt=G!==null&&R!==null&&!Aw(s)?Pz(G,Me,R):null;$.push(mt)}G!==null&&(G.hasOwnProperty("class")&&(s.flags|=8),G.hasOwnProperty("style")&&(s.flags|=16)),s.initialInputs=$,s.inputs=G,s.outputs=se}function gz(i){return i==="class"?"className":i==="for"?"htmlFor":i==="formaction"?"formAction":i==="innerHtml"?"innerHTML":i==="readonly"?"readOnly":i==="tabindex"?"tabIndex":i}function fA(i,s,a,f,x,n,R,$){let G=os(s,a),se=s.inputs,Me;!$&&se!=null&&(Me=se[f])?(rC(i,a,Me,f,x),V0(s)&&_z(a,s.index)):s.type&3?(f=gz(f),x=R!=null?R(x,s.value||"",f):x,n.setProperty(G,f,x)):s.type&12}function _z(i,s){let a=bc(s,i);a[In]&16||(a[In]|=64)}function pA(i,s,a,f){if(f2()){let x=f===null?null:{"":-1},n=wz(i,a),R,$;n===null?R=$=null:[R,$]=n,R!==null&&mA(i,s,a,R,x,$),x&&Cz(a,f,x)}a.mergedAttrs=Om(a.mergedAttrs,a.attrs)}function mA(i,s,a,f,x,n){for(let se=0;se<f.length;se++)Wb(C0(a,s),i,f[se].type);Mz(a,i.data.length,f.length);for(let se=0;se<f.length;se++){let Me=f[se];Me.providersResolver&&Me.providersResolver(Me)}let R=!1,$=!1,G=aA(i,s,f.length,null);for(let se=0;se<f.length;se++){let Me=f[se];a.mergedAttrs=Om(a.mergedAttrs,Me.hostAttrs),Sz(i,a,s,G,Me),Ez(G,Me,x),Me.contentQueries!==null&&(a.flags|=4),(Me.hostBindings!==null||Me.hostAttrs!==null||Me.hostVars!==0)&&(a.flags|=64);let ke=Me.type.prototype;!R&&(ke.ngOnChanges||ke.ngOnInit||ke.ngDoCheck)&&((i.preOrderHooks??=[]).push(a.index),R=!0),!$&&(ke.ngOnChanges||ke.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(a.index),$=!0),G++}mz(i,a,n)}function yz(i,s,a,f,x){let n=x.hostBindings;if(n){let R=i.hostBindingOpCodes;R===null&&(R=i.hostBindingOpCodes=[]);let $=~s.index;vz(R)!=$&&R.push($),R.push(a,f,n)}}function vz(i){let s=i.length;for(;s>0;){let a=i[--s];if(typeof a=="number"&&a<0)return a}return 0}function xz(i,s,a,f){let x=a.directiveStart,n=a.directiveEnd;V0(a)&&Tz(s,a,i.data[x+a.componentOffset]),i.firstCreatePass||C0(a,s),qu(f,s);let R=a.initialInputs;for(let $=x;$<n;$++){let G=i.data[$],se=Hu(s,i,$,a);if(qu(se,s),R!==null&&Az(s,$-x,se,G,a,R),vc(G)){let Me=bc(a.index,s);Me[Ns]=Hu(s,i,$,a)}}}function gA(i,s,a){let f=a.directiveStart,x=a.directiveEnd,n=a.index,R=H3();try{$u(n);for(let $=f;$<x;$++){let G=i.data[$],se=s[$];Gb($),(G.hostBindings!==null||G.hostVars!==0||G.hostAttrs!==null)&&bz(G,se)}}finally{$u(-1),Gb(R)}}function bz(i,s){i.hostBindings!==null&&i.hostBindings(1,s)}function wz(i,s){let a=i.directiveRegistry,f=null,x=null;if(a)for(let n=0;n<a.length;n++){let R=a[n];if(n3(s,R.selectors,!1))if(f||(f=[]),vc(R))if(R.findHostDirectiveDefs!==null){let $=[];x=x||new Map,R.findHostDirectiveDefs(R,$,x),f.unshift(...$,R);let G=$.length;rw(i,s,G)}else f.unshift(R),rw(i,s,0);else x=x||new Map,R.findHostDirectiveDefs?.(R,f,x),f.push(R)}return f===null?null:[f,x]}function rw(i,s,a){s.componentOffset=a,(i.components??=[]).push(s.index)}function Cz(i,s,a){if(s){let f=i.localNames=[];for(let x=0;x<s.length;x+=2){let n=a[s[x+1]];if(n==null)throw new hn(-301,!1);f.push(s[x],n)}}}function Ez(i,s,a){if(a){if(s.exportAs)for(let f=0;f<s.exportAs.length;f++)a[s.exportAs[f]]=i;vc(s)&&(a[""]=i)}}function Mz(i,s,a){i.flags|=1,i.directiveStart=s,i.directiveEnd=s+a,i.providerIndexes=s}function Sz(i,s,a,f,x){i.data[f]=x;let n=x.factory||(x.factory=Nh(x.type,!0)),R=new Gu(n,vc(x),St);i.blueprint[f]=R,a[f]=R,yz(i,s,f,aA(i,a,x.hostVars,Kh),x)}function Tz(i,s,a){let f=os(s,i),x=hA(a),n=i[la].rendererFactory,R=16;a.signals?R=4096:a.onPush&&(R=64);let $=Z0(i,q0(i,x,null,R,f,s,null,n.createRenderer(f,a),null,null,null));i[s.index]=$}function Iz(i,s,a,f,x,n){let R=os(i,s);Dz(s[fr],R,n,i.value,a,f,x)}function Dz(i,s,a,f,x,n,R){if(n==null)i.removeAttribute(s,x,a);else{let $=R==null?k0(n):R(n,f||"",x);i.setAttribute(s,x,$,a)}}function Az(i,s,a,f,x,n){let R=n[s];if(R!==null)for(let $=0;$<R.length;){let G=R[$++],se=R[$++],Me=R[$++],ke=R[$++];sA(f,a,G,se,Me,ke)}}function Pz(i,s,a){let f=null,x=0;for(;x<a.length;){let n=a[x];if(n===0){x+=4;continue}else if(n===5){x+=2;continue}if(typeof n=="number")break;if(i.hasOwnProperty(n)){f===null&&(f=[]);let R=i[n];for(let $=0;$<R.length;$+=3)if(R[$]===s){f.push(n,R[$+1],R[$+2],a[x+1]);break}}x+=2}return f}function _A(i,s,a,f){return[i,!0,0,s,null,f,null,a,null,null]}function yA(i,s){let a=i.contentQueries;if(a!==null){let f=gi(null);try{for(let x=0;x<a.length;x+=2){let n=a[x],R=a[x+1];if(R!==-1){let $=i.data[R];kw(n),$.contentQueries(2,s[R],R)}}}finally{gi(f)}}}function Z0(i,s){return i[Fm]?i[KI][ks]=s:i[Fm]=s,i[KI]=s,s}function ow(i,s,a){kw(0);let f=gi(null);try{s(i,a)}finally{gi(f)}}function vA(i){return i[_0]??=[]}function xA(i){return i.cleanup??=[]}function bA(i,s){let a=i[jh],f=a?a.get(Xa,null):null;f&&f.handleError(s)}function rC(i,s,a,f,x){for(let n=0;n<a.length;){let R=a[n++],$=a[n++],G=a[n++],se=s[R],Me=i.data[R];sA(Me,se,f,$,G,x)}}function Rz(i,s,a){let f=a2(s,i);$N(i[fr],f,a)}function Oz(i,s){let a=bc(s,i),f=a[Hn];Lz(f,a);let x=a[Ja];x!==null&&a[g0]===null&&(a[g0]=Jw(x,a[jh])),oC(f,a,a[Ns])}function Lz(i,s){for(let a=s.length;a<i.blueprint.length;a++)s.push(i.blueprint[a])}function oC(i,s,a){Nw(s);try{let f=i.viewQuery;f!==null&&ow(1,f,a);let x=i.template;x!==null&&lA(i,s,x,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),s[Wa]?.finishViewCreation(i),i.staticContentQueries&&yA(i,s),i.staticViewQueries&&ow(2,i.viewQuery,a);let n=i.components;n!==null&&Fz(s,n)}catch(f){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),f}finally{s[In]&=-5,zw()}}function Fz(i,s){for(let a=0;a<s.length;a++)Oz(i,s[a])}function kz(i,s,a,f){let x=gi(null);try{let n=s.tView,$=i[In]&4096?4096:16,G=q0(i,n,a,$,null,s,null,null,f?.injector??null,f?.embeddedViewInjector??null,f?.dehydratedView??null),se=i[s.index];G[Vu]=se;let Me=i[Wa];return Me!==null&&(G[Wa]=Me.createEmbeddedView(n)),oC(n,G,a),G}finally{gi(x)}}function mD(i,s){return!s||s.firstChild===null||z2(i)}function Nz(i,s,a,f=!0){let x=s[Hn];if(WN(x,s,i,a),f){let R=iw(a,i),$=s[fr],G=eA($,i[ju]);G!==null&&HN(x,i[zs],$,s,G,R)}let n=s[g0];n!==null&&n.firstChild!==null&&(n.firstChild=null)}function I0(i,s,a,f,x=!1){for(;a!==null;){if(a.type===128){a=x?a.projectionNext:a.next;continue}let n=s[a.index];n!==null&&f.push(ua(n)),Ka(n)&&zz(n,f);let R=a.type;if(R&8)I0(i,s,a.child,f);else if(R&32){let $=Qw(a,s),G;for(;G=$();)f.push(G)}else if(R&16){let $=tA(s,a);if(Array.isArray($))f.push(...$);else{let G=Uu(s[ca]);I0(G[Hn],G,$,f,!0)}}a=x?a.projectionNext:a.next}return f}function zz(i,s){for(let a=No;a<i.length;a++){let f=i[a],x=f[Hn].firstChild;x!==null&&I0(f[Hn],f,x,s)}i[ju]!==i[Ja]&&s.push(i[ju])}var wA=[];function Bz(i){return i[es]??Vz(i)}function Vz(i){let s=wA.pop()??Object.create(Uz);return s.lView=i,s}function jz(i){i.lView[es]!==i&&(i.lView=null,wA.push(i))}var Uz=ei(Mt({},Mm),{consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{U0(i.lView)},consumerOnSignalRead(){this.lView[es]=this}});function $z(i){let s=i[es]??Object.create(Gz);return s.lView=i,s}var Gz=ei(Mt({},Mm),{consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{let s=Uu(i.lView);for(;s&&!CA(s[Hn]);)s=Uu(s);s&&u2(s)},consumerOnSignalRead(){this.lView[es]=this}});function CA(i){return i.type!==2}var Hz=100;function EA(i,s=!0,a=0){let f=i[la],x=f.rendererFactory,n=!1;n||x.begin?.();try{qz(i,a)}catch(R){throw s&&bA(i,R),R}finally{n||(x.end?.(),f.inlineEffectRunner?.flush())}}function qz(i,s){let a=g2();try{eD(!0),sw(i,s);let f=0;for(;j0(i);){if(f===Hz)throw new hn(103,!1);f++,sw(i,1)}}finally{eD(a)}}function Wz(i,s,a,f){let x=s[In];if((x&256)===256)return;let n=!1,R=!1;!n&&s[la].inlineEffectRunner?.flush(),Nw(s);let $=!0,G=null,se=null;n||(CA(i)?(se=Bz(s),G=Iy(se)):rI()===null?($=!1,se=$z(s),G=Iy(se)):s[es]&&(ib(s[es]),s[es]=null));try{c2(s),j3(i.bindingStartIndex),a!==null&&lA(i,s,a,2,f);let Me=(x&3)===3;if(!n)if(Me){let Ye=i.preOrderCheckHooks;Ye!==null&&a0(s,Ye,null)}else{let Ye=i.preOrderHooks;Ye!==null&&l0(s,Ye,0,null),Eb(s,0)}if(R||Zz(s),MA(s,0),i.contentQueries!==null&&yA(i,s),!n)if(Me){let Ye=i.contentCheckHooks;Ye!==null&&a0(s,Ye)}else{let Ye=i.contentHooks;Ye!==null&&l0(s,Ye,1),Eb(s,1)}az(i,s);let ke=i.components;ke!==null&&TA(s,ke,0);let tt=i.viewQuery;if(tt!==null&&ow(2,tt,f),!n)if(Me){let Ye=i.viewCheckHooks;Ye!==null&&a0(s,Ye)}else{let Ye=i.viewHooks;Ye!==null&&l0(s,Ye,2),Eb(s,2)}if(i.firstUpdatePass===!0&&(i.firstUpdatePass=!1),s[Cb]){for(let Ye of s[Cb])Ye();s[Cb]=null}n||(s[In]&=-73)}catch(Me){throw n||U0(s),Me}finally{se!==null&&(tb(se,G),$&&jz(se)),zw()}}function MA(i,s){for(let a=V2(i);a!==null;a=j2(a))for(let f=No;f<a.length;f++){let x=a[f];SA(x,s)}}function Zz(i){for(let s=V2(i);s!==null;s=j2(s)){if(!(s[In]&v0.HasTransplantedViews))continue;let a=s[Uh];for(let f=0;f<a.length;f++){let x=a[f];u2(x)}}}function Xz(i,s,a){let f=bc(s,i);SA(f,a)}function SA(i,s){Fw(i)&&sw(i,s)}function sw(i,s){let f=i[Hn],x=i[In],n=i[es],R=!!(s===0&&x&16);if(R||=!!(x&64&&s===0),R||=!!(x&1024),R||=!!(n?.dirty&&nb(n)),R||=!1,n&&(n.dirty=!1),i[In]&=-9217,R)Wz(f,i,f.template,i[Ns]);else if(x&8192){MA(i,1);let $=f.components;$!==null&&TA(i,$,1)}}function TA(i,s,a){for(let f=0;f<s.length;f++)Xz(i,s[f],a)}function sC(i,s){let a=g2()?64:1088;for(i[la].changeDetectionScheduler?.notify(s);i;){i[In]|=a;let f=Uu(i);if(jb(i)&&!f)return i;i=f}return null}var Wu=class{get rootNodes(){let s=this._lView,a=s[Hn];return I0(a,s,a.firstChild,[])}constructor(s,a,f=!0){this._lView=s,this._cdRefInjectingView=a,this.notifyErrorHandler=f,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ns]}set context(s){this._lView[Ns]=s}get destroyed(){return(this._lView[In]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let s=this._lView[kr];if(Ka(s)){let a=s[y0],f=a?a.indexOf(this):-1;f>-1&&(nw(s,f),p0(a,f))}this._attachedToViewContainer=!1}K2(this._lView[Hn],this._lView)}onDestroy(s){d2(this._lView,s)}markForCheck(){sC(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[In]&=-129}reattach(){$b(this._lView),this._lView[In]|=128}detectChanges(){this._lView[In]|=1024,EA(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new hn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let s=jb(this._lView),a=this._lView[Vu];a!==null&&!s&&eC(a,this._lView),Y2(this._lView[Hn],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new hn(902,!1);this._appRef=s;let a=jb(this._lView),f=this._lView[Vu];f!==null&&!a&&J2(f,this._lView),$b(this._lView)}},$h=(()=>{class i{static{this.__NG_ELEMENT_ID__=Kz}}return i})(),Yz=$h,Jz=class extends Yz{constructor(s,a,f){super(),this._declarationLView=s,this._declarationTContainer=a,this.elementRef=f}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(s,a){return this.createEmbeddedViewImpl(s,a)}createEmbeddedViewImpl(s,a,f){let x=kz(this._declarationLView,this._declarationTContainer,s,{embeddedViewInjector:a,dehydratedView:f});return new Wu(x)}};function Kz(){return X0(io(),Ti())}function X0(i,s){return i.type&4?new Jz(s,i,Jh(i,s)):null}var zq=new RegExp(`^(\\d+)*(${AN}|${DN})*(.*)`);var Qz=()=>null;function gD(i,s){return Qz(i,s)}var Gh=class{},aC=new on("",{providedIn:"root",factory:()=>!1});var IA=new on(""),DA=new on(""),aw=class{},D0=class{};function e4(i){let s=Error(`No component factory found for ${eo(i)}.`);return s[t4]=i,s}var t4="ngComponent";var lw=class{resolveComponentFactory(s){throw e4(s)}},Hh=class{static{this.NULL=new lw}},qh=class{},pa=(()=>{class i{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>n4()}}return i})();function n4(){let i=Ti(),s=io(),a=bc(s.index,i);return(gc(a)?a:i)[fr]}var i4=(()=>{class i{static{this.\u0275prov=Jt({token:i,providedIn:"root",factory:()=>null})}}return i})();function cw(i,s,a){let f=a?i.styles:null,x=a?i.classes:null,n=0;if(s!==null)for(let R=0;R<s.length;R++){let $=s[R];if(typeof $=="number")n=$;else if(n==1)x=UI(x,$);else if(n==2){let G=$,se=s[++R];f=UI(f,G+": "+se+";")}}a?i.styles=f:i.stylesWithoutHost=f,a?i.classes=x:i.classesWithoutHost=x}var A0=class extends Hh{constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){let a=yc(s);return new Wh(a,this.ngModule)}};function _D(i,s){let a=[];for(let f in i){if(!i.hasOwnProperty(f))continue;let x=i[f];if(x===void 0)continue;let n=Array.isArray(x),R=n?x[0]:x,$=n?x[1]:_c.None;s?a.push({propName:R,templateName:f,isSignal:($&_c.SignalBased)!==0}):a.push({propName:R,templateName:f})}return a}function r4(i){let s=i.toLowerCase();return s==="svg"?s2:s==="math"?S3:null}var Wh=class extends D0{get inputs(){let s=this.componentDef,a=s.inputTransforms,f=_D(s.inputs,!0);if(a!==null)for(let x of f)a.hasOwnProperty(x.propName)&&(x.transform=a[x.propName]);return f}get outputs(){return _D(this.componentDef.outputs,!1)}constructor(s,a){super(),this.componentDef=s,this.ngModule=a,this.componentType=s.type,this.selector=s3(s.selectors),this.ngContentSelectors=s.ngContentSelectors?s.ngContentSelectors:[],this.isBoundToModule=!!a}create(s,a,f,x){let n=gi(null);try{x=x||this.ngModule;let R=x instanceof to?x:x?.injector;R&&this.componentDef.getStandaloneInjector!==null&&(R=this.componentDef.getStandaloneInjector(R)||R);let $=R?new Hb(s,R):s,G=$.get(qh,null);if(G===null)throw new hn(407,!1);let se=$.get(i4,null),Me=$.get(Gh,null),ke={rendererFactory:G,sanitizer:se,inlineEffectRunner:null,changeDetectionScheduler:Me},tt=G.createRenderer(null,this.componentDef),Ye=this.componentDef.selectors[0][0]||"div",wt=f?uz(tt,f,this.componentDef.encapsulation,$):X2(tt,Ye,r4(Ye)),mt=512;this.componentDef.signals?mt|=4096:this.componentDef.onPush||(mt|=16);let Ht=null;wt!==null&&(Ht=Jw(wt,$,!0));let _n=iC(0,null,null,1,0,null,null,null,null,null,null),Ut=q0(null,_n,null,mt,null,null,ke,tt,$,null,Ht);Nw(Ut);let Ln,mi,Pt=null;try{let xi=this.componentDef,Qi,zt=null;xi.findHostDirectiveDefs?(Qi=[],zt=new Map,xi.findHostDirectiveDefs(xi,Qi,zt),Qi.push(xi)):Qi=[xi];let $t=o4(Ut,wt);Pt=s4($t,wt,xi,Qi,Ut,ke,tt),mi=l2(_n,Za),wt&&c4(tt,xi,wt,f),a!==void 0&&u4(mi,this.ngContentSelectors,a),Ln=l4(Pt,xi,Qi,zt,Ut,[d4]),oC(_n,Ut,null)}catch(xi){throw Pt!==null&&ew(Pt),ew(Ut),xi}finally{zw()}return new uw(this.componentType,Ln,Jh(mi,Ut),Ut,mi)}finally{gi(n)}}},uw=class extends aw{constructor(s,a,f,x,n){super(),this.location=f,this._rootLView=x,this._tNode=n,this.previousInputValues=null,this.instance=a,this.hostView=this.changeDetectorRef=new Wu(x,void 0,!1),this.componentType=s}setInput(s,a){let f=this._tNode.inputs,x;if(f!==null&&(x=f[s])){if(this.previousInputValues??=new Map,this.previousInputValues.has(s)&&Object.is(this.previousInputValues.get(s),a))return;let n=this._rootLView;rC(n[Hn],n,x,s,a),this.previousInputValues.set(s,a);let R=bc(this._tNode.index,n);sC(R,1)}}get injector(){return new Bu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}};function o4(i,s){let a=i[Hn],f=Za;return i[f]=s,W0(a,f,2,"#host",null)}function s4(i,s,a,f,x,n,R){let $=x[Hn];a4(f,i,s,R);let G=null;s!==null&&(G=Jw(s,x[jh]));let se=n.rendererFactory.createRenderer(s,a),Me=16;a.signals?Me=4096:a.onPush&&(Me=64);let ke=q0(x,hA(a),null,Me,x[i.index],i,n,se,null,null,G);return $.firstCreatePass&&rw($,i,f.length-1),Z0(x,ke),x[i.index]=ke}function a4(i,s,a,f){for(let x of i)s.mergedAttrs=Om(s.mergedAttrs,x.hostAttrs);s.mergedAttrs!==null&&(cw(s,s.mergedAttrs,!0),a!==null&&iA(f,a,s))}function l4(i,s,a,f,x,n){let R=io(),$=x[Hn],G=os(R,x);mA($,x,R,a,null,f);for(let Me=0;Me<a.length;Me++){let ke=R.directiveStart+Me,tt=Hu(x,$,ke,R);qu(tt,x)}gA($,x,R),G&&qu(G,x);let se=Hu(x,$,R.directiveStart+R.componentOffset,R);if(i[Ns]=x[Ns]=se,n!==null)for(let Me of n)Me(se,s);return cA($,R,x),se}function c4(i,s,a,f){if(f)Nb(i,a,["ng-version","18.2.9"]);else{let{attrs:x,classes:n}=a3(s.selectors[0]);x&&Nb(i,a,x),n&&n.length>0&&nA(i,a,n.join(" "))}}function u4(i,s,a){let f=i.projection=[];for(let x=0;x<s.length;x++){let n=a[x];f.push(n!=null?Array.from(n):null)}}function d4(){let i=io();Uw(Ti()[Hn],i)}var Yu=(()=>{class i{static{this.__NG_ELEMENT_ID__=h4}}return i})();function h4(){let i=io();return PA(i,Ti())}var f4=Yu,AA=class extends f4{constructor(s,a,f){super(),this._lContainer=s,this._hostTNode=a,this._hostLView=f}get element(){return Jh(this._hostTNode,this._hostLView)}get injector(){return new Bu(this._hostTNode,this._hostLView)}get parentInjector(){let s=$w(this._hostTNode,this._hostLView);if(M2(s)){let a=w0(s,this._hostLView),f=b0(s),x=a[Hn].data[f+8];return new Bu(x,a)}else return new Bu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){let a=yD(this._lContainer);return a!==null&&a[s]||null}get length(){return this._lContainer.length-No}createEmbeddedView(s,a,f){let x,n;typeof f=="number"?x=f:f!=null&&(x=f.index,n=f.injector);let R=gD(this._lContainer,s.ssrId),$=s.createEmbeddedViewImpl(a||{},n,R);return this.insertImpl($,x,mD(this._hostTNode,R)),$}createComponent(s,a,f,x,n){let R=s&&!w3(s),$;if(R)$=a;else{let wt=a||{};$=wt.index,f=wt.injector,x=wt.projectableNodes,n=wt.environmentInjector||wt.ngModuleRef}let G=R?s:new Wh(yc(s)),se=f||this.parentInjector;if(!n&&G.ngModule==null){let mt=(R?se:this.parentInjector).get(to,null);mt&&(n=mt)}let Me=yc(G.componentType??{}),ke=gD(this._lContainer,Me?.id??null),tt=ke?.firstChild??null,Ye=G.create(se,x,tt,n);return this.insertImpl(Ye.hostView,$,mD(this._hostTNode,ke)),Ye}insert(s,a){return this.insertImpl(s,a,!0)}insertImpl(s,a,f){let x=s._lView;if(D3(x)){let $=this.indexOf(s);if($!==-1)this.detach($);else{let G=x[kr],se=new AA(G,G[zs],G[kr]);se.detach(se.indexOf(s))}}let n=this._adjustIndex(a),R=this._lContainer;return Nz(R,x,n,f),s.attachToViewContainerRef(),kD(Db(R),n,s),s}move(s,a){return this.insert(s,a)}indexOf(s){let a=yD(this._lContainer);return a!==null?a.indexOf(s):-1}remove(s){let a=this._adjustIndex(s,-1),f=nw(this._lContainer,a);f&&(p0(Db(this._lContainer),a),K2(f[Hn],f))}detach(s){let a=this._adjustIndex(s,-1),f=nw(this._lContainer,a);return f&&p0(Db(this._lContainer),a)!=null?new Wu(f):null}_adjustIndex(s,a=0){return s??this.length+a}};function yD(i){return i[y0]}function Db(i){return i[y0]||(i[y0]=[])}function PA(i,s){let a,f=s[i.index];return Ka(f)?a=f:(a=_A(f,s,null,i),s[i.index]=a,Z0(s,a)),m4(a,s,i,f),new AA(a,i,s)}function p4(i,s){let a=i[fr],f=a.createComment(""),x=os(s,i),n=eA(a,x);return T0(a,n,f,KN(a,x),!1),f}var m4=y4,g4=()=>!1;function _4(i,s,a){return g4(i,s,a)}function y4(i,s,a,f){if(i[ju])return;let x;a.type&8?x=ua(f):x=p4(s,a),i[ju]=x}var dw=class i{constructor(s){this.queryList=s,this.matches=null}clone(){return new i(this.queryList)}setDirty(){this.queryList.setDirty()}},hw=class i{constructor(s=[]){this.queries=s}createEmbeddedView(s){let a=s.queries;if(a!==null){let f=s.contentQueries!==null?s.contentQueries[0]:a.length,x=[];for(let n=0;n<f;n++){let R=a.getByIndex(n),$=this.queries[R.indexInDeclarationView];x.push($.clone())}return new i(x)}return null}insertView(s){this.dirtyQueriesWithMatches(s)}detachView(s){this.dirtyQueriesWithMatches(s)}finishViewCreation(s){this.dirtyQueriesWithMatches(s)}dirtyQueriesWithMatches(s){for(let a=0;a<this.queries.length;a++)lC(s,a).matches!==null&&this.queries[a].setDirty()}},fw=class{constructor(s,a,f=null){this.flags=a,this.read=f,typeof s=="string"?this.predicate=S4(s):this.predicate=s}},pw=class i{constructor(s=[]){this.queries=s}elementStart(s,a){for(let f=0;f<this.queries.length;f++)this.queries[f].elementStart(s,a)}elementEnd(s){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(s)}embeddedTView(s){let a=null;for(let f=0;f<this.length;f++){let x=a!==null?a.length:0,n=this.getByIndex(f).embeddedTView(s,x);n&&(n.indexInDeclarationView=f,a!==null?a.push(n):a=[n])}return a!==null?new i(a):null}template(s,a){for(let f=0;f<this.queries.length;f++)this.queries[f].template(s,a)}getByIndex(s){return this.queries[s]}get length(){return this.queries.length}track(s){this.queries.push(s)}},mw=class i{constructor(s,a=-1){this.metadata=s,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(s,a){this.isApplyingToNode(a)&&this.matchTNode(s,a)}elementEnd(s){this._declarationNodeIndex===s.index&&(this._appliesToNextNode=!1)}template(s,a){this.elementStart(s,a)}embeddedTView(s,a){return this.isApplyingToNode(s)?(this.crossesNgTemplate=!0,this.addMatch(-s.index,a),new i(this.metadata)):null}isApplyingToNode(s){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let a=this._declarationNodeIndex,f=s.parent;for(;f!==null&&f.type&8&&f.index!==a;)f=f.parent;return a===(f!==null?f.index:-1)}return this._appliesToNextNode}matchTNode(s,a){let f=this.metadata.predicate;if(Array.isArray(f))for(let x=0;x<f.length;x++){let n=f[x];this.matchTNodeWithReadOption(s,a,v4(a,n)),this.matchTNodeWithReadOption(s,a,c0(a,s,n,!1,!1))}else f===$h?a.type&4&&this.matchTNodeWithReadOption(s,a,-1):this.matchTNodeWithReadOption(s,a,c0(a,s,f,!1,!1))}matchTNodeWithReadOption(s,a,f){if(f!==null){let x=this.metadata.read;if(x!==null)if(x===xo||x===Yu||x===$h&&a.type&4)this.addMatch(a.index,-2);else{let n=c0(a,s,x,!1,!1);n!==null&&this.addMatch(a.index,n)}else this.addMatch(a.index,f)}}addMatch(s,a){this.matches===null?this.matches=[s,a]:this.matches.push(s,a)}};function v4(i,s){let a=i.localNames;if(a!==null){for(let f=0;f<a.length;f+=2)if(a[f]===s)return a[f+1]}return null}function x4(i,s){return i.type&11?Jh(i,s):i.type&4?X0(i,s):null}function b4(i,s,a,f){return a===-1?x4(s,i):a===-2?w4(i,s,f):Hu(i,i[Hn],a,s)}function w4(i,s,a){if(a===xo)return Jh(s,i);if(a===$h)return X0(s,i);if(a===Yu)return PA(s,i)}function RA(i,s,a,f){let x=s[Wa].queries[f];if(x.matches===null){let n=i.data,R=a.matches,$=[];for(let G=0;R!==null&&G<R.length;G+=2){let se=R[G];if(se<0)$.push(null);else{let Me=n[se];$.push(b4(s,Me,R[G+1],a.metadata.read))}}x.matches=$}return x.matches}function gw(i,s,a,f){let x=i.queries.getByIndex(a),n=x.matches;if(n!==null){let R=RA(i,s,x,a);for(let $=0;$<n.length;$+=2){let G=n[$];if(G>0)f.push(R[$/2]);else{let se=n[$+1],Me=s[-G];for(let ke=No;ke<Me.length;ke++){let tt=Me[ke];tt[Vu]===tt[kr]&&gw(tt[Hn],tt,se,f)}if(Me[Uh]!==null){let ke=Me[Uh];for(let tt=0;tt<ke.length;tt++){let Ye=ke[tt];gw(Ye[Hn],Ye,se,f)}}}}}return f}function C4(i,s){return i[Wa].queries[s].queryList}function E4(i,s,a){let f=new Qb((a&4)===4);return fz(i,s,f,f.destroy),(s[Wa]??=new hw).queries.push(new dw(f))-1}function M4(i,s,a){let f=no();return f.firstCreatePass&&(T4(f,new fw(i,s,a),-1),(s&2)===2&&(f.staticViewQueries=!0)),E4(f,Ti(),s)}function S4(i){return i.split(",").map(s=>s.trim())}function T4(i,s,a){i.queries===null&&(i.queries=new pw),i.queries.track(new mw(s,a))}function lC(i,s){return i.queries.getByIndex(s)}function I4(i,s){let a=i[Hn],f=lC(a,s);return f.crossesNgTemplate?gw(a,i,s,[]):RA(a,i,f,s)}var vD=new Set;function Qh(i){vD.has(i)||(vD.add(i),performance?.mark?.("mark_feature_usage",{detail:{feature:i}}))}function D4(i){return typeof i=="function"&&i[$a]!==void 0}function ef(i,s){Qh("NgSignals");let a=mI(i),f=a[$a];return s?.equal&&(f.equal=s.equal),a.set=x=>rb(f,x),a.update=x=>gI(f,x),a.asReadonly=A4.bind(a),a}function A4(){let i=this[$a];if(i.readonlyFn===void 0){let s=()=>this();s[$a]=i,i.readonlyFn=s}return i.readonlyFn}function OA(i){return D4(i)&&typeof i.set=="function"}function P4(i){return Object.getPrototypeOf(i.prototype).constructor}function Nr(i){let s=P4(i.type),a=!0,f=[i];for(;s;){let x;if(vc(i))x=s.\u0275cmp||s.\u0275dir;else{if(s.\u0275cmp)throw new hn(903,!1);x=s.\u0275dir}if(x){if(a){f.push(x);let R=i;R.inputs=i0(i.inputs),R.inputTransforms=i0(i.inputTransforms),R.declaredInputs=i0(i.declaredInputs),R.outputs=i0(i.outputs);let $=x.hostBindings;$&&k4(i,$);let G=x.viewQuery,se=x.contentQueries;if(G&&L4(i,G),se&&F4(i,se),R4(i,x),Sk(i.outputs,x.outputs),vc(x)&&x.data.animation){let Me=i.data;Me.animation=(Me.animation||[]).concat(x.data.animation)}}let n=x.features;if(n)for(let R=0;R<n.length;R++){let $=n[R];$&&$.ngInherit&&$(i),$===Nr&&(a=!1)}}s=Object.getPrototypeOf(s)}O4(f)}function R4(i,s){for(let a in s.inputs){if(!s.inputs.hasOwnProperty(a)||i.inputs.hasOwnProperty(a))continue;let f=s.inputs[a];if(f!==void 0&&(i.inputs[a]=f,i.declaredInputs[a]=s.declaredInputs[a],s.inputTransforms!==null)){let x=Array.isArray(f)?f[0]:f;if(!s.inputTransforms.hasOwnProperty(x))continue;i.inputTransforms??={},i.inputTransforms[x]=s.inputTransforms[x]}}}function O4(i){let s=0,a=null;for(let f=i.length-1;f>=0;f--){let x=i[f];x.hostVars=s+=x.hostVars,x.hostAttrs=Om(x.hostAttrs,a=Om(a,x.hostAttrs))}}function i0(i){return i===zh?{}:i===Qo?[]:i}function L4(i,s){let a=i.viewQuery;a?i.viewQuery=(f,x)=>{s(f,x),a(f,x)}:i.viewQuery=s}function F4(i,s){let a=i.contentQueries;a?i.contentQueries=(f,x,n)=>{s(f,x,n),a(f,x,n)}:i.contentQueries=s}function k4(i,s){let a=i.hostBindings;a?i.hostBindings=(f,x)=>{s(f,x),a(f,x)}:i.hostBindings=s}function cC(i){let s=i.inputConfig,a={};for(let f in s)if(s.hasOwnProperty(f)){let x=s[f];Array.isArray(x)&&x[3]&&(a[f]=x[3])}i.inputTransforms=a}var xc=class{},km=class{};var _w=class extends xc{constructor(s,a,f,x=!0){super(),this.ngModuleType=s,this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new A0(this);let n=HD(s);this._bootstrapComponents=Z2(n.bootstrap),this._r3Injector=L2(s,a,[{provide:xc,useValue:this},{provide:Hh,useValue:this.componentFactoryResolver},...f],eo(s),new Set(["environment"])),x&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}},yw=class extends km{constructor(s){super(),this.moduleType=s}create(s){return new _w(this.moduleType,s,[])}};var P0=class extends xc{constructor(s){super(),this.componentFactoryResolver=new A0(this),this.instance=null;let a=new Lm([...s.providers,{provide:xc,useValue:this},{provide:Hh,useValue:this.componentFactoryResolver}],s.parent||Ow(),s.debugName,new Set(["environment"]));this.injector=a,s.runEnvironmentInitializers&&a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}};function Y0(i,s,a=null){return new P0({providers:i,parent:s,debugName:a,runEnvironmentInitializers:!0}).injector}function qm(i,s,a){let f=i[s];return Object.is(f,a)?!1:(i[s]=a,!0)}function N4(i){return(i.flags&32)===32}function z4(i,s,a,f,x,n,R,$,G){let se=s.consts,Me=W0(s,i,4,R||null,$||null);pA(s,a,Me,x0(se,G)),Uw(s,Me);let ke=Me.tView=iC(2,Me,f,x,n,s.directiveRegistry,s.pipeRegistry,null,s.schemas,se,null);return s.queries!==null&&(s.queries.template(s,Me),ke.queries=s.queries.embeddedTView(Me)),Me}function B4(i,s,a,f,x,n,R,$,G,se){let Me=a+Za,ke=s.firstCreatePass?z4(Me,s,i,f,x,n,R,$,G):s.data[Me];$m(ke,!1);let tt=V4(s,i,ke,a);Vw()&&tC(s,i,tt,ke),qu(tt,i);let Ye=_A(tt,i,tt,ke);return i[Me]=Ye,Z0(i,Ye),_4(Ye,ke,i),Lw(ke)&&uA(s,i,ke),G!=null&&dA(i,ke,se),ke}function yi(i,s,a,f,x,n,R,$){let G=Ti(),se=no(),Me=x0(se.consts,n);return B4(G,se,i,s,a,f,x,Me,R,$),yi}var V4=j4;function j4(i,s,a,f){return jw(!0),s[fr].createComment("")}var Lh=function(i){return i[i.EarlyRead=0]="EarlyRead",i[i.Write=1]="Write",i[i.MixedReadWrite=2]="MixedReadWrite",i[i.Read=3]="Read",i}(Lh||{}),LA=(()=>{class i{constructor(){this.impl=null}execute(){this.impl?.execute()}static{this.\u0275prov=Jt({token:i,providedIn:"root",factory:()=>new i})}}return i})(),vw=class i{constructor(){this.ngZone=Ct(Wi),this.scheduler=Ct(Gh),this.errorHandler=Ct(Xa,{optional:!0}),this.sequences=new Set,this.deferredRegistrations=new Set,this.executing=!1}static{this.PHASES=[Lh.EarlyRead,Lh.Write,Lh.MixedReadWrite,Lh.Read]}execute(){this.executing=!0;for(let s of i.PHASES)for(let a of this.sequences)if(!(a.erroredOrDestroyed||!a.hooks[s]))try{a.pipelinedValue=this.ngZone.runOutsideAngular(()=>a.hooks[s](a.pipelinedValue))}catch(f){a.erroredOrDestroyed=!0,this.errorHandler?.handleError(f)}this.executing=!1;for(let s of this.sequences)s.afterRun(),s.once&&(this.sequences.delete(s),s.destroy());for(let s of this.deferredRegistrations)this.sequences.add(s);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(s){this.executing?this.deferredRegistrations.add(s):(this.sequences.add(s),this.scheduler.notify(6))}unregister(s){this.executing&&this.sequences.has(s)?(s.erroredOrDestroyed=!0,s.pipelinedValue=void 0,s.once=!0):(this.sequences.delete(s),this.deferredRegistrations.delete(s))}static{this.\u0275prov=Jt({token:i,providedIn:"root",factory:()=>new i})}},xw=class{constructor(s,a,f,x){this.impl=s,this.hooks=a,this.once=f,this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.unregisterOnDestroy=x?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}};function uC(i,s){!s?.injector&&b3(uC);let a=s?.injector??Ct(ts);return VN(a)?(Qh("NgAfterNextRender"),$4(i,a,s,!0)):G4}function U4(i,s){if(i instanceof Function){let a=[void 0,void 0,void 0,void 0];return a[s]=i,a}else return[i.earlyRead,i.write,i.mixedReadWrite,i.read]}function $4(i,s,a,f){let x=s.get(LA);x.impl??=s.get(vw);let n=a?.phase??Lh.MixedReadWrite,R=a?.manualCleanup!==!0?s.get(Hw):null,$=new xw(x.impl,U4(i,n),f,R);return x.impl.register($),$}var G4={destroy(){}};function Ju(i,s,a,f){let x=Ti(),n=$0();if(qm(x,n,s)){let R=no(),$=Bw();Iz($,x,i,s,a,f)}return Ju}function H4(i,s,a,f){return qm(i,$0(),a)?s+k0(a)+f:Kh}function r0(i,s){return i<<17|s<<2}function Zu(i){return i>>17&32767}function q4(i){return(i&2)==2}function W4(i,s){return i&131071|s<<17}function bw(i){return i|2}function Zh(i){return(i&131068)>>2}function Ab(i,s){return i&-131069|s<<2}function Z4(i){return(i&1)===1}function ww(i){return i|1}function X4(i,s,a,f,x,n){let R=n?s.classBindings:s.styleBindings,$=Zu(R),G=Zh(R);i[f]=a;let se=!1,Me;if(Array.isArray(a)){let ke=a;Me=ke[1],(Me===null||Bm(ke,Me)>0)&&(se=!0)}else Me=a;if(x)if(G!==0){let tt=Zu(i[$+1]);i[f+1]=r0(tt,$),tt!==0&&(i[tt+1]=Ab(i[tt+1],f)),i[$+1]=W4(i[$+1],f)}else i[f+1]=r0($,0),$!==0&&(i[$+1]=Ab(i[$+1],f)),$=f;else i[f+1]=r0(G,0),$===0?$=f:i[G+1]=Ab(i[G+1],f),G=f;se&&(i[f+1]=bw(i[f+1])),xD(i,Me,f,!0),xD(i,Me,f,!1),Y4(s,Me,i,f,n),R=r0($,G),n?s.classBindings=R:s.styleBindings=R}function Y4(i,s,a,f,x){let n=x?i.residualClasses:i.residualStyles;n!=null&&typeof s=="string"&&Bm(n,s)>=0&&(a[f+1]=ww(a[f+1]))}function xD(i,s,a,f){let x=i[a+1],n=s===null,R=f?Zu(x):Zh(x),$=!1;for(;R!==0&&($===!1||n);){let G=i[R],se=i[R+1];J4(G,s)&&($=!0,i[R+1]=f?ww(se):bw(se)),R=f?Zu(se):Zh(se)}$&&(i[a+1]=f?bw(x):ww(x))}function J4(i,s){return i===null||s==null||(Array.isArray(i)?i[1]:i)===s?!0:Array.isArray(i)&&typeof s=="string"?Bm(i,s)>=0:!1}function qt(i,s,a){let f=Ti(),x=$0();if(qm(f,x,s)){let n=no(),R=Bw();fA(n,R,f,i,s,f[fr],a,!1)}return qt}function bD(i,s,a,f,x){let n=s.inputs,R=x?"class":"style";rC(i,a,n[R],R,f)}function J0(i,s){return K4(i,s,null,!0),J0}function K4(i,s,a,f){let x=Ti(),n=no(),R=U3(2);if(n.firstUpdatePass&&eB(n,i,R,f),s!==Kh&&qm(x,R,s)){let $=n.data[Yh()];oB(n,$,x,x[fr],i,x[R+1]=sB(s,a),f,R)}}function Q4(i,s){return s>=i.expandoStartIndex}function eB(i,s,a,f){let x=i.data;if(x[a+1]===null){let n=x[Yh()],R=Q4(i,a);aB(n,f)&&s===null&&!R&&(s=!1),s=tB(x,n,s,f),X4(x,n,s,a,R,f)}}function tB(i,s,a,f){let x=q3(i),n=f?s.residualClasses:s.residualStyles;if(x===null)(f?s.classBindings:s.styleBindings)===0&&(a=Pb(null,i,s,a,f),a=Nm(a,s.attrs,f),n=null);else{let R=s.directiveStylingLast;if(R===-1||i[R]!==x)if(a=Pb(x,i,s,a,f),n===null){let G=nB(i,s,f);G!==void 0&&Array.isArray(G)&&(G=Pb(null,i,s,G[1],f),G=Nm(G,s.attrs,f),iB(i,s,f,G))}else n=rB(i,s,f)}return n!==void 0&&(f?s.residualClasses=n:s.residualStyles=n),a}function nB(i,s,a){let f=a?s.classBindings:s.styleBindings;if(Zh(f)!==0)return i[Zu(f)]}function iB(i,s,a,f){let x=a?s.classBindings:s.styleBindings;i[Zu(x)]=f}function rB(i,s,a){let f,x=s.directiveEnd;for(let n=1+s.directiveStylingLast;n<x;n++){let R=i[n].hostAttrs;f=Nm(f,R,a)}return Nm(f,s.attrs,a)}function Pb(i,s,a,f,x){let n=null,R=a.directiveEnd,$=a.directiveStylingLast;for($===-1?$=a.directiveStart:$++;$<R&&(n=s[$],f=Nm(f,n.hostAttrs,x),n!==i);)$++;return i!==null&&(a.directiveStylingLast=$),f}function Nm(i,s,a){let f=a?1:2,x=-1;if(s!==null)for(let n=0;n<s.length;n++){let R=s[n];typeof R=="number"?x=R:x===f&&(Array.isArray(i)||(i=i===void 0?[]:["",i]),Zk(i,R,a?!0:s[++n]))}return i===void 0?null:i}function oB(i,s,a,f,x,n,R,$){if(!(s.type&3))return;let G=i.data,se=G[$+1],Me=Z4(se)?wD(G,s,a,x,Zh(se),R):void 0;if(!R0(Me)){R0(n)||q4(se)&&(n=wD(G,null,a,x,$,R));let ke=a2(Yh(),a);oz(f,R,ke,x,n)}}function wD(i,s,a,f,x,n){let R=s===null,$;for(;x>0;){let G=i[x],se=Array.isArray(G),Me=se?G[1]:G,ke=Me===null,tt=a[x+1];tt===Kh&&(tt=ke?Qo:void 0);let Ye=ke?bb(tt,f):Me===f?tt:void 0;if(se&&!R0(Ye)&&(Ye=bb(G,f)),R0(Ye)&&($=Ye,R))return $;let wt=i[x+1];x=R?Zu(wt):Zh(wt)}if(s!==null){let G=n?s.residualClasses:s.residualStyles;G!=null&&($=bb(G,f))}return $}function R0(i){return i!==void 0}function sB(i,s){return i==null||i===""||(typeof s=="string"?i=i+s:typeof i=="object"&&(i=eo(Hm(i)))),i}function aB(i,s){return(i.flags&(s?8:16))!==0}function lB(i,s,a,f,x,n){let R=s.consts,$=x0(R,x),G=W0(s,i,2,f,$);return pA(s,a,G,x0(R,n)),G.attrs!==null&&cw(G,G.attrs,!1),G.mergedAttrs!==null&&cw(G,G.mergedAttrs,!0),s.queries!==null&&s.queries.elementStart(s,G),G}function fe(i,s,a,f){let x=Ti(),n=no(),R=Za+i,$=x[fr],G=n.firstCreatePass?lB(R,n,x,s,a,f):n.data[R],se=cB(n,x,G,$,s,i);x[R]=se;let Me=Lw(G);return $m(G,!0),iA($,se,G),!N4(G)&&Vw()&&tC(n,x,se,G),R3()===0&&qu(se,x),O3(),Me&&(uA(n,x,G),cA(n,G,x)),f!==null&&dA(x,G),fe}function ue(){let i=io();m2()?B3():(i=i.parent,$m(i,!1));let s=i;k3(s)&&N3(),L3();let a=no();return a.firstCreatePass&&(Uw(a,i),t2(i)&&a.queries.elementEnd(i)),s.classesWithoutHost!=null&&eN(s)&&bD(a,s,Ti(),s.classesWithoutHost,!0),s.stylesWithoutHost!=null&&tN(s)&&bD(a,s,Ti(),s.stylesWithoutHost,!1),ue}function qe(i,s,a,f){return fe(i,s,a,f),ue(),qe}var cB=(i,s,a,f,x,n)=>(jw(!0),X2(f,x,Y3()));function Wm(){return Ti()}var O0="en-US";var uB=O0;function dB(i){typeof i=="string"&&(uB=i.toLowerCase().replace(/_/g,"-"))}var hB=(i,s,a)=>{};function Wn(i,s,a,f){let x=Ti(),n=no(),R=io();return FA(n,x,x[fr],R,i,s,f),Wn}function fB(i,s,a,f){let x=i.cleanup;if(x!=null)for(let n=0;n<x.length-1;n+=2){let R=x[n];if(R===a&&x[n+1]===f){let $=s[_0],G=x[n+2];return $.length>G?$[G]:null}typeof R=="string"&&(n+=2)}return null}function FA(i,s,a,f,x,n,R){let $=Lw(f),se=i.firstCreatePass&&xA(i),Me=s[Ns],ke=vA(s),tt=!0;if(f.type&3||R){let mt=os(f,s),Ht=R?R(mt):mt,_n=ke.length,Ut=R?mi=>R(ua(mi[f.index])):f.index,Ln=null;if(!R&&$&&(Ln=fB(i,s,x,f.index)),Ln!==null){let mi=Ln.__ngLastListenerFn__||Ln;mi.__ngNextListenerFn__=n,Ln.__ngLastListenerFn__=n,tt=!1}else{n=ED(f,s,Me,n),hB(mt,x,n);let mi=a.listen(Ht,x,n);ke.push(n,mi),se&&se.push(x,Ut,_n,_n+1)}}else n=ED(f,s,Me,n);let Ye=f.outputs,wt;if(tt&&Ye!==null&&(wt=Ye[x])){let mt=wt.length;if(mt)for(let Ht=0;Ht<mt;Ht+=2){let _n=wt[Ht],Ut=wt[Ht+1],Pt=s[_n][Ut].subscribe(n),xi=ke.length;ke.push(n,Pt),se&&se.push(x,f.index,xi,-(xi+1))}}}function CD(i,s,a,f){let x=gi(null);try{return oa(6,s,a),a(f)!==!1}catch(n){return bA(i,n),!1}finally{oa(7,s,a),gi(x)}}function ED(i,s,a,f){return function x(n){if(n===Function)return f;let R=i.componentOffset>-1?bc(i.index,s):s;sC(R,5);let $=CD(s,a,f,n),G=x.__ngNextListenerFn__;for(;G;)$=CD(s,a,G,n)&&$,G=G.__ngNextListenerFn__;return $}}function ss(i=1){return Z3(i)}function kA(i,s,a){M4(i,s,a)}function dC(i){let s=Ti(),a=no(),f=_2();kw(f+1);let x=lC(a,f);if(i.dirty&&I3(s)===((x.metadata.flags&2)===2)){if(x.matches===null)i.reset([]);else{let n=I4(s,f);i.reset(n,wN),i.notifyOnChanges()}return!0}return!1}function hC(){return C4(Ti(),_2())}function K0(i){let s=V3();return T3(s,Za+i)}function Pe(i,s=""){let a=Ti(),f=no(),x=i+Za,n=f.firstCreatePass?W0(f,x,1,s,null):f.data[x],R=pB(f,a,n,s,i);a[x]=R,Vw()&&tC(f,a,R,n),$m(n,!1)}var pB=(i,s,a,f,x)=>(jw(!0),UN(s[fr],f));function el(i){return NA("",i,""),el}function NA(i,s,a){let f=Ti(),x=H4(f,i,s,a);return x!==Kh&&Rz(f,Yh(),x),NA}function tf(i,s,a){OA(s)&&(s=s());let f=Ti(),x=$0();if(qm(f,x,s)){let n=no(),R=Bw();fA(n,R,f,i,s,f[fr],a,!1)}return tf}function Zm(i,s){let a=OA(i);return a&&i.set(s),a}function nf(i,s){let a=Ti(),f=no(),x=io();return FA(f,a,a[fr],x,i,s),nf}function mB(i,s,a){let f=no();if(f.firstCreatePass){let x=vc(i);Cw(a,f.data,f.blueprint,x,!0),Cw(s,f.data,f.blueprint,x,!1)}}function Cw(i,s,a,f,x){if(i=Qr(i),Array.isArray(i))for(let n=0;n<i.length;n++)Cw(i[n],s,a,f,x);else{let n=no(),R=Ti(),$=io(),G=Vh(i)?i:Qr(i.provide),se=JD(i),Me=$.providerIndexes&1048575,ke=$.directiveStart,tt=$.providerIndexes>>20;if(Vh(i)||!i.multi){let Ye=new Gu(se,x,St),wt=Ob(G,s,x?Me:Me+tt,ke);wt===-1?(Wb(C0($,R),n,G),Rb(n,i,s.length),s.push(G),$.directiveStart++,$.directiveEnd++,x&&($.providerIndexes+=1048576),a.push(Ye),R.push(Ye)):(a[wt]=Ye,R[wt]=Ye)}else{let Ye=Ob(G,s,Me+tt,ke),wt=Ob(G,s,Me,Me+tt),mt=Ye>=0&&a[Ye],Ht=wt>=0&&a[wt];if(x&&!Ht||!x&&!mt){Wb(C0($,R),n,G);let _n=yB(x?_B:gB,a.length,x,f,se);!x&&Ht&&(a[wt].providerFactory=_n),Rb(n,i,s.length,0),s.push(G),$.directiveStart++,$.directiveEnd++,x&&($.providerIndexes+=1048576),a.push(_n),R.push(_n)}else{let _n=zA(a[x?wt:Ye],se,!x&&f);Rb(n,i,Ye>-1?Ye:wt,_n)}!x&&f&&Ht&&a[wt].componentProviders++}}}function Rb(i,s,a,f){let x=Vh(s),n=p3(s);if(x||n){let G=(n?Qr(s.useClass):s).prototype.ngOnDestroy;if(G){let se=i.destroyHooks||(i.destroyHooks=[]);if(!x&&s.multi){let Me=se.indexOf(a);Me===-1?se.push(a,[f,G]):se[Me+1].push(f,G)}else se.push(a,G)}}}function zA(i,s,a){return a&&i.componentProviders++,i.multi.push(s)-1}function Ob(i,s,a,f){for(let x=a;x<f;x++)if(s[x]===i)return x;return-1}function gB(i,s,a,f){return Ew(this.multi,[])}function _B(i,s,a,f){let x=this.multi,n;if(this.providerFactory){let R=this.providerFactory.componentProviders,$=Hu(a,a[Hn],this.providerFactory.index,f);n=$.slice(0,R),Ew(x,n);for(let G=R;G<$.length;G++)n.push($[G])}else n=[],Ew(x,n);return n}function Ew(i,s){for(let a=0;a<i.length;a++){let f=i[a];s.push(f())}return s}function yB(i,s,a,f,x){let n=new Gu(i,a,St);return n.multi=[],n.index=s,n.componentProviders=0,zA(n,x,f&&!a),n}function as(i,s=[]){return a=>{a.providersResolver=(f,x)=>mB(f,x?x(i):i,s)}}var vB=(()=>{class i{constructor(a){this._injector=a,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a)){let f=ZD(!1,a.type),x=f.length>0?Y0([f],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a,x)}return this.cachedInjectors.get(a)}ngOnDestroy(){try{for(let a of this.cachedInjectors.values())a!==null&&a.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Jt({token:i,providedIn:"environment",factory:()=>new i(sn(to))})}}return i})();function On(i){Qh("NgStandalone"),i.getStandaloneInjector=s=>s.get(vB).getOrCreateStandaloneInjector(i)}function BA(i,s){return X0(i,s)}var Q0=(()=>{class i{log(a){console.log(a)}warn(a){console.warn(a)}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"platform"})}}return i})();var VA=new on("");function Ku(i){return!!i&&typeof i.then=="function"}function jA(i){return!!i&&typeof i.subscribe=="function"}var ev=new on(""),UA=(()=>{class i{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,f)=>{this.resolve=a,this.reject=f}),this.appInits=Ct(ev,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let a=[];for(let x of this.appInits){let n=x();if(Ku(n))a.push(n);else if(jA(n)){let R=new Promise(($,G)=>{n.subscribe({complete:$,error:G})});a.push(R)}}let f=()=>{this.done=!0,this.resolve()};Promise.all(a).then(()=>{f()}).catch(x=>{this.reject(x)}),a.length===0&&f(),this.initialized=!0}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Xm=new on("");function xB(){pI(()=>{throw new hn(600,!1)})}function bB(i){return i.isBoundToModule}var wB=10;function CB(i,s,a){try{let f=a();return Ku(f)?f.catch(x=>{throw s.runOutsideAngular(()=>i.handleError(x)),x}):f}catch(f){throw s.runOutsideAngular(()=>i.handleError(f)),f}}var Cc=(()=>{class i{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ct(xN),this.afterRenderManager=Ct(LA),this.zonelessEnabled=Ct(aC),this.dirtyFlags=0,this.deferredDirtyFlags=0,this.externalTestViews=new Set,this.beforeRender=new _r,this.afterTick=new _r,this.componentTypes=[],this.components=[],this.isStable=Ct(wc).hasPendingTasks.pipe(jn(a=>!a)),this._injector=Ct(to)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let a;return new Promise(f=>{a=this.isStable.subscribe({next:x=>{x&&f()}})}).finally(()=>{a.unsubscribe()})}get injector(){return this._injector}bootstrap(a,f){let x=a instanceof D0;if(!this._injector.get(UA).done){let tt=!x&&GD(a),Ye=!1;throw new hn(405,Ye)}let R;x?R=a:R=this._injector.get(Hh).resolveComponentFactory(a),this.componentTypes.push(R.componentType);let $=bB(R)?void 0:this._injector.get(xc),G=f||R.selector,se=R.create(ts.NULL,[],G,$),Me=se.location.nativeElement,ke=se.injector.get(VA,null);return ke?.registerApplication(Me),se.onDestroy(()=>{this.detachView(se.hostView),u0(this.components,se),ke?.unregisterApplication(Me)}),this._loadComponent(se),se}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){if(this._runningTick)throw new hn(101,!1);let a=gi(null);try{this._runningTick=!0,this.synchronize()}catch(f){this.internalErrorHandler(f)}finally{this._runningTick=!1,gi(a),this.afterTick.next()}}synchronize(){let a=null;this._injector.destroyed||(a=this._injector.get(qh,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let f=0;for(;this.dirtyFlags!==0&&f++<wB;)this.synchronizeOnce(a)}synchronizeOnce(a){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&7){let f=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8,this.beforeRender.next(f);for(let{_lView:x,notifyErrorHandler:n}of this._views)EB(x,n,f,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&7)return}else a?.begin?.(),a?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:a})=>j0(a))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(a){let f=a;this._views.push(f),f.attachToAppRef(this)}detachView(a){let f=a;u0(this._views,f),f.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a);let f=this._injector.get(Xm,[]);[...this._bootstrapListeners,...f].forEach(x=>x(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>u0(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new hn(406,!1);let a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function u0(i,s){let a=i.indexOf(s);a>-1&&i.splice(a,1)}function EB(i,s,a,f){if(!a&&!j0(i))return;EA(i,s,a&&!f?0:1)}var Mw=class{constructor(s,a){this.ngModuleFactory=s,this.componentFactories=a}},tv=(()=>{class i{compileModuleSync(a){return new yw(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){let f=this.compileModuleSync(a),x=HD(a),n=Z2(x.declarations).reduce((R,$)=>{let G=yc($);return G&&R.push(new Wh(G)),R},[]);return new Mw(f,n)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var MB=(()=>{class i{constructor(){this.zone=Ct(Wi),this.changeDetectionScheduler=Ct(Gh),this.applicationRef=Ct(Cc)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function SB({ngZoneFactory:i,ignoreChangesOutsideZone:s,scheduleInRootZone:a}){return i??=()=>new Wi(ei(Mt({},TB()),{scheduleInRootZone:a})),[{provide:Wi,useFactory:i},{provide:Bh,multi:!0,useFactory:()=>{let f=Ct(MB,{optional:!0});return()=>f.initialize()}},{provide:Bh,multi:!0,useFactory:()=>{let f=Ct(IB);return()=>{f.initialize()}}},s===!0?{provide:IA,useValue:!0}:[],{provide:DA,useValue:a??F2}]}function TB(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}var IB=(()=>{class i{constructor(){this.subscription=new ir,this.initialized=!1,this.zone=Ct(Wi),this.pendingTasks=Ct(wc)}initialize(){if(this.initialized)return;this.initialized=!0;let a=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(a=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Wi.assertNotInAngularZone(),queueMicrotask(()=>{a!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(a),a=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Wi.assertInAngularZone(),a??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var DB=(()=>{class i{constructor(){this.appRef=Ct(Cc),this.taskService=Ct(wc),this.ngZone=Ct(Wi),this.zonelessEnabled=Ct(aC),this.disableScheduling=Ct(IA,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new ir,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(M0):null,this.scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Ct(DA,{optional:!0})??!1),this.cancelScheduledCallback=null,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Kb||!this.zoneIsDefined)}notify(a){if(!this.zonelessEnabled&&a===5)return;switch(a){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 7:{this.appRef.deferredDirtyFlags|=8;break}case 9:case 8:case 6:case 10:default:this.appRef.dirtyFlags|=8}if(!this.shouldScheduleTick())return;let f=this.useMicrotaskScheduler?sD:k2;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>f(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>f(()=>this.tick()))}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(M0+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let a=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(f){throw this.taskService.remove(a),f}finally{this.cleanup()}this.useMicrotaskScheduler=!0,sD(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(a)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let a=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(a)}}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function AB(){return typeof $localize<"u"&&$localize.locale||O0}var fC=new on("",{providedIn:"root",factory:()=>Ct(fC,Jn.Optional|Jn.SkipSelf)||AB()});var Sw=new on("");function o0(i){return!i.moduleRef}function PB(i){let s=o0(i)?i.r3Injector:i.moduleRef.injector,a=s.get(Wi);return a.run(()=>{o0(i)?i.r3Injector.resolveInjectorInitializers():i.moduleRef.resolveInjectorInitializers();let f=s.get(Xa,null),x;if(a.runOutsideAngular(()=>{x=a.onError.subscribe({next:n=>{f.handleError(n)}})}),o0(i)){let n=()=>s.destroy(),R=i.platformInjector.get(Sw);R.add(n),s.onDestroy(()=>{x.unsubscribe(),R.delete(n)})}else{let n=()=>i.moduleRef.destroy(),R=i.platformInjector.get(Sw);R.add(n),i.moduleRef.onDestroy(()=>{u0(i.allPlatformModules,i.moduleRef),x.unsubscribe(),R.delete(n)})}return CB(f,a,()=>{let n=s.get(UA);return n.runInitializers(),n.donePromise.then(()=>{let R=s.get(fC,O0);if(dB(R||O0),o0(i)){let $=s.get(Cc);return i.rootComponent!==void 0&&$.bootstrap(i.rootComponent),$}else return RB(i.moduleRef,i.allPlatformModules),i.moduleRef})})})}function RB(i,s){let a=i.injector.get(Cc);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(f=>a.bootstrap(f));else if(i.instance.ngDoBootstrap)i.instance.ngDoBootstrap(a);else throw new hn(-403,!1);s.push(i)}var d0=null;function OB(i=[],s){return ts.create({name:s,providers:[{provide:z0,useValue:"platform"},{provide:Sw,useValue:new Set([()=>d0=null])},...i]})}function LB(i=[]){if(d0)return d0;let s=OB(i);return d0=s,xB(),FB(s),s}function FB(i){i.get(Xw,null)?.forEach(a=>a())}var Qu=(()=>{class i{static{this.__NG_ELEMENT_ID__=kB}}return i})();function kB(i){return NB(io(),Ti(),(i&16)===16)}function NB(i,s,a){if(V0(i)&&!a){let f=bc(i.index,s);return new Wu(f,f)}else if(i.type&175){let f=s[ca];return new Wu(f,s)}return null}function $A(i){try{let{rootComponent:s,appProviders:a,platformProviders:f}=i,x=LB(f),n=[SB({}),{provide:Gh,useExisting:DB},...a||[]],R=new P0({providers:n,parent:x,debugName:"",runEnvironmentInitializers:!1});return PB({r3Injector:R.injector,platformInjector:x,rootComponent:s})}catch(s){return Promise.reject(s)}}function Ec(i){return typeof i=="boolean"?i:i!=null&&i!=="false"}function rf(i,s){Qh("NgSignals");let a=dI(i);return s?.equal&&(a[$a].equal=s.equal),a}function ma(i){let s=gi(null);try{return i()}finally{gi(s)}}function GA(i){let s=yc(i);if(!s)return null;let a=new Wh(s);return{get selector(){return a.selector},get type(){return a.componentType},get inputs(){return a.inputs},get outputs(){return a.outputs},get ngContentSelectors(){return a.ngContentSelectors},get isStandalone(){return s.standalone},get isSignal(){return s.signals}}}var ZA=null;function nl(){return ZA}function XA(i){ZA??=i}var nv=class{};var zr=new on(""),yC=(()=>{class i{historyGo(a){throw new Error("")}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:()=>Ct(BB),providedIn:"platform"})}}return i})(),YA=new on(""),BB=(()=>{class i extends yC{constructor(){super(),this._doc=Ct(zr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return nl().getBaseHref(this._doc)}onPopState(a){let f=nl().getGlobalEventTarget(this._doc,"window");return f.addEventListener("popstate",a,!1),()=>f.removeEventListener("popstate",a)}onHashChange(a){let f=nl().getGlobalEventTarget(this._doc,"window");return f.addEventListener("hashchange",a,!1),()=>f.removeEventListener("hashchange",a)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(a){this._location.pathname=a}pushState(a,f,x){this._history.pushState(a,f,x)}replaceState(a,f,x){this._history.replaceState(a,f,x)}forward(){this._history.forward()}back(){this._history.back()}historyGo(a=0){this._history.go(a)}getState(){return this._history.state}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:()=>new i,providedIn:"platform"})}}return i})();function vC(i,s){if(i.length==0)return s;if(s.length==0)return i;let a=0;return i.endsWith("/")&&a++,s.startsWith("/")&&a++,a==2?i+s.substring(1):a==1?i+s:i+"/"+s}function HA(i){let s=i.match(/#|\?|$/),a=s&&s.index||i.length,f=a-(i[a-1]==="/"?1:0);return i.slice(0,f)+i.slice(a)}function tl(i){return i&&i[0]!=="?"?"?"+i:i}var il=(()=>{class i{historyGo(a){throw new Error("")}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:()=>Ct(xC),providedIn:"root"})}}return i})(),JA=new on(""),xC=(()=>{class i extends il{constructor(a,f){super(),this._platformLocation=a,this._removeListenerFns=[],this._baseHref=f??this._platformLocation.getBaseHrefFromDOM()??Ct(zr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(a){this._removeListenerFns.push(this._platformLocation.onPopState(a),this._platformLocation.onHashChange(a))}getBaseHref(){return this._baseHref}prepareExternalUrl(a){return vC(this._baseHref,a)}path(a=!1){let f=this._platformLocation.pathname+tl(this._platformLocation.search),x=this._platformLocation.hash;return x&&a?`${f}${x}`:f}pushState(a,f,x,n){let R=this.prepareExternalUrl(x+tl(n));this._platformLocation.pushState(a,f,R)}replaceState(a,f,x,n){let R=this.prepareExternalUrl(x+tl(n));this._platformLocation.replaceState(a,f,R)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(a=0){this._platformLocation.historyGo?.(a)}static{this.\u0275fac=function(f){return new(f||i)(sn(yC),sn(JA,8))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),KA=(()=>{class i extends il{constructor(a,f){super(),this._platformLocation=a,this._baseHref="",this._removeListenerFns=[],f!=null&&(this._baseHref=f)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(a){this._removeListenerFns.push(this._platformLocation.onPopState(a),this._platformLocation.onHashChange(a))}getBaseHref(){return this._baseHref}path(a=!1){let f=this._platformLocation.hash??"#";return f.length>0?f.substring(1):f}prepareExternalUrl(a){let f=vC(this._baseHref,a);return f.length>0?"#"+f:f}pushState(a,f,x,n){let R=this.prepareExternalUrl(x+tl(n));R.length==0&&(R=this._platformLocation.pathname),this._platformLocation.pushState(a,f,R)}replaceState(a,f,x,n){let R=this.prepareExternalUrl(x+tl(n));R.length==0&&(R=this._platformLocation.pathname),this._platformLocation.replaceState(a,f,R)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(a=0){this._platformLocation.historyGo?.(a)}static{this.\u0275fac=function(f){return new(f||i)(sn(yC),sn(JA,8))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),sf=(()=>{class i{constructor(a){this._subject=new qi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=a;let f=this._locationStrategy.getBaseHref();this._basePath=UB(HA(qA(f))),this._locationStrategy.onPopState(x=>{this._subject.emit({url:this.path(!0),pop:!0,state:x.state,type:x.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(a=!1){return this.normalize(this._locationStrategy.path(a))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(a,f=""){return this.path()==this.normalize(a+tl(f))}normalize(a){return i.stripTrailingSlash(jB(this._basePath,qA(a)))}prepareExternalUrl(a){return a&&a[0]!=="/"&&(a="/"+a),this._locationStrategy.prepareExternalUrl(a)}go(a,f="",x=null){this._locationStrategy.pushState(x,"",a,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(a+tl(f)),x)}replaceState(a,f="",x=null){this._locationStrategy.replaceState(x,"",a,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(a+tl(f)),x)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(a=0){this._locationStrategy.historyGo?.(a)}onUrlChange(a){return this._urlChangeListeners.push(a),this._urlChangeSubscription??=this.subscribe(f=>{this._notifyUrlChangeListeners(f.url,f.state)}),()=>{let f=this._urlChangeListeners.indexOf(a);this._urlChangeListeners.splice(f,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(a="",f){this._urlChangeListeners.forEach(x=>x(a,f))}subscribe(a,f,x){return this._subject.subscribe({next:a,error:f,complete:x})}static{this.normalizeQueryParams=tl}static{this.joinWithSlash=vC}static{this.stripTrailingSlash=HA}static{this.\u0275fac=function(f){return new(f||i)(sn(il))}}static{this.\u0275prov=Jt({token:i,factory:()=>VB(),providedIn:"root"})}}return i})();function VB(){return new sf(sn(il))}function jB(i,s){if(!i||!s.startsWith(i))return s;let a=s.substring(i.length);return a===""||["/",";","?","#"].includes(a[0])?a:s}function qA(i){return i.replace(/\/index.html$/,"")}function UB(i){if(new RegExp("^(https?:)?//").test(i)){let[,a]=i.split(/\/\/[^\/]+/);return a}return i}function iv(i,s){s=encodeURIComponent(s);for(let a of i.split(";")){let f=a.indexOf("="),[x,n]=f==-1?[a,""]:[a.slice(0,f),a.slice(f+1)];if(x.trim()===s)return decodeURIComponent(n)}return null}var Mc=(()=>{class i{constructor(a,f){this._viewContainer=a,this._context=new pC,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=f}set ngIf(a){this._context.$implicit=this._context.ngIf=a,this._updateView()}set ngIfThen(a){WA("ngIfThen",a),this._thenTemplateRef=a,this._thenViewRef=null,this._updateView()}set ngIfElse(a){WA("ngIfElse",a),this._elseTemplateRef=a,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(a,f){return!0}static{this.\u0275fac=function(f){return new(f||i)(St(Yu),St($h))}}static{this.\u0275dir=Ni({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return i})(),pC=class{constructor(){this.$implicit=null,this.ngIf=null}};function WA(i,s){if(!!!(!s||s.createEmbeddedView))throw new Error(`${i} must be a TemplateRef, but received '${eo(s)}'.`)}var Bs=(()=>{class i{static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275mod=is({type:i})}static{this.\u0275inj=ns({})}}return i})(),bC="browser",$B="server";function GB(i){return i===bC}function rv(i){return i===$B}var QA=(()=>{class i{static{this.\u0275prov=Jt({token:i,providedIn:"root",factory:()=>GB(Ct(fa))?new mC(Ct(zr),window):new gC})}}return i})(),mC=class{constructor(s,a){this.document=s,this.window=a,this.offset=()=>[0,0]}setOffset(s){Array.isArray(s)?this.offset=()=>s:this.offset=s}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(s){this.window.scrollTo(s[0],s[1])}scrollToAnchor(s){let a=HB(this.document,s);a&&(this.scrollToElement(a),a.focus())}setHistoryScrollRestoration(s){this.window.history.scrollRestoration=s}scrollToElement(s){let a=s.getBoundingClientRect(),f=a.left+this.window.pageXOffset,x=a.top+this.window.pageYOffset,n=this.offset();this.window.scrollTo(f-n[0],x-n[1])}};function HB(i,s){let a=i.getElementById(s)||i.getElementsByName(s)[0];if(a)return a;if(typeof i.createTreeWalker=="function"&&i.body&&typeof i.body.attachShadow=="function"){let f=i.createTreeWalker(i.body,NodeFilter.SHOW_ELEMENT),x=f.currentNode;for(;x;){let n=x.shadowRoot;if(n){let R=n.getElementById(s)||n.querySelector(`[name="${s}"]`);if(R)return R}x=f.nextNode()}}return null}var gC=class{setOffset(s){}getScrollPosition(){return[0,0]}scrollToPosition(s){}scrollToAnchor(s){}setHistoryScrollRestoration(s){}},of=class{};var ed=class{},sv=class{},rl=class i{constructor(s){this.normalizedNames=new Map,this.lazyUpdate=null,s?typeof s=="string"?this.lazyInit=()=>{this.headers=new Map,s.split(`
`).forEach(a=>{let f=a.indexOf(":");if(f>0){let x=a.slice(0,f),n=x.toLowerCase(),R=a.slice(f+1).trim();this.maybeSetNormalizedName(x,n),this.headers.has(n)?this.headers.get(n).push(R):this.headers.set(n,[R])}})}:typeof Headers<"u"&&s instanceof Headers?(this.headers=new Map,s.forEach((a,f)=>{this.setHeaderEntries(f,a)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(s).forEach(([a,f])=>{this.setHeaderEntries(a,f)})}:this.headers=new Map}has(s){return this.init(),this.headers.has(s.toLowerCase())}get(s){this.init();let a=this.headers.get(s.toLowerCase());return a&&a.length>0?a[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(s){return this.init(),this.headers.get(s.toLowerCase())||null}append(s,a){return this.clone({name:s,value:a,op:"a"})}set(s,a){return this.clone({name:s,value:a,op:"s"})}delete(s,a){return this.clone({name:s,value:a,op:"d"})}maybeSetNormalizedName(s,a){this.normalizedNames.has(a)||this.normalizedNames.set(a,s)}init(){this.lazyInit&&(this.lazyInit instanceof i?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(s=>this.applyUpdate(s)),this.lazyUpdate=null))}copyFrom(s){s.init(),Array.from(s.headers.keys()).forEach(a=>{this.headers.set(a,s.headers.get(a)),this.normalizedNames.set(a,s.normalizedNames.get(a))})}clone(s){let a=new i;return a.lazyInit=this.lazyInit&&this.lazyInit instanceof i?this.lazyInit:this,a.lazyUpdate=(this.lazyUpdate||[]).concat([s]),a}applyUpdate(s){let a=s.name.toLowerCase();switch(s.op){case"a":case"s":let f=s.value;if(typeof f=="string"&&(f=[f]),f.length===0)return;this.maybeSetNormalizedName(s.name,a);let x=(s.op==="a"?this.headers.get(a):void 0)||[];x.push(...f),this.headers.set(a,x);break;case"d":let n=s.value;if(!n)this.headers.delete(a),this.normalizedNames.delete(a);else{let R=this.headers.get(a);if(!R)return;R=R.filter($=>n.indexOf($)===-1),R.length===0?(this.headers.delete(a),this.normalizedNames.delete(a)):this.headers.set(a,R)}break}}setHeaderEntries(s,a){let f=(Array.isArray(a)?a:[a]).map(n=>n.toString()),x=s.toLowerCase();this.headers.set(x,f),this.maybeSetNormalizedName(s,x)}forEach(s){this.init(),Array.from(this.normalizedNames.keys()).forEach(a=>s(this.normalizedNames.get(a),this.headers.get(a)))}};var CC=class{encodeKey(s){return eP(s)}encodeValue(s){return eP(s)}decodeKey(s){return decodeURIComponent(s)}decodeValue(s){return decodeURIComponent(s)}};function qB(i,s){let a=new Map;return i.length>0&&i.replace(/^\?/,"").split("&").forEach(x=>{let n=x.indexOf("="),[R,$]=n==-1?[s.decodeKey(x),""]:[s.decodeKey(x.slice(0,n)),s.decodeValue(x.slice(n+1))],G=a.get(R)||[];G.push($),a.set(R,G)}),a}var WB=/%(\d[a-f0-9])/gi,ZB={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function eP(i){return encodeURIComponent(i).replace(WB,(s,a)=>ZB[a]??s)}function ov(i){return`${i}`}var Tc=class i{constructor(s={}){if(this.updates=null,this.cloneFrom=null,this.encoder=s.encoder||new CC,s.fromString){if(s.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=qB(s.fromString,this.encoder)}else s.fromObject?(this.map=new Map,Object.keys(s.fromObject).forEach(a=>{let f=s.fromObject[a],x=Array.isArray(f)?f.map(ov):[ov(f)];this.map.set(a,x)})):this.map=null}has(s){return this.init(),this.map.has(s)}get(s){this.init();let a=this.map.get(s);return a?a[0]:null}getAll(s){return this.init(),this.map.get(s)||null}keys(){return this.init(),Array.from(this.map.keys())}append(s,a){return this.clone({param:s,value:a,op:"a"})}appendAll(s){let a=[];return Object.keys(s).forEach(f=>{let x=s[f];Array.isArray(x)?x.forEach(n=>{a.push({param:f,value:n,op:"a"})}):a.push({param:f,value:x,op:"a"})}),this.clone(a)}set(s,a){return this.clone({param:s,value:a,op:"s"})}delete(s,a){return this.clone({param:s,value:a,op:"d"})}toString(){return this.init(),this.keys().map(s=>{let a=this.encoder.encodeKey(s);return this.map.get(s).map(f=>a+"="+this.encoder.encodeValue(f)).join("&")}).filter(s=>s!=="").join("&")}clone(s){let a=new i({encoder:this.encoder});return a.cloneFrom=this.cloneFrom||this,a.updates=(this.updates||[]).concat(s),a}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(s=>this.map.set(s,this.cloneFrom.map.get(s))),this.updates.forEach(s=>{switch(s.op){case"a":case"s":let a=(s.op==="a"?this.map.get(s.param):void 0)||[];a.push(ov(s.value)),this.map.set(s.param,a);break;case"d":if(s.value!==void 0){let f=this.map.get(s.param)||[],x=f.indexOf(ov(s.value));x!==-1&&f.splice(x,1),f.length>0?this.map.set(s.param,f):this.map.delete(s.param)}else{this.map.delete(s.param);break}}}),this.cloneFrom=this.updates=null)}};var EC=class{constructor(){this.map=new Map}set(s,a){return this.map.set(s,a),this}get(s){return this.map.has(s)||this.map.set(s,s.defaultValue()),this.map.get(s)}delete(s){return this.map.delete(s),this}has(s){return this.map.has(s)}keys(){return this.map.keys()}};function XB(i){switch(i){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function tP(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer}function nP(i){return typeof Blob<"u"&&i instanceof Blob}function iP(i){return typeof FormData<"u"&&i instanceof FormData}function YB(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams}var Ym=class i{constructor(s,a,f,x){this.url=a,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=s.toUpperCase();let n;if(XB(this.method)||x?(this.body=f!==void 0?f:null,n=x):n=f,n&&(this.reportProgress=!!n.reportProgress,this.withCredentials=!!n.withCredentials,n.responseType&&(this.responseType=n.responseType),n.headers&&(this.headers=n.headers),n.context&&(this.context=n.context),n.params&&(this.params=n.params),this.transferCache=n.transferCache),this.headers??=new rl,this.context??=new EC,!this.params)this.params=new Tc,this.urlWithParams=a;else{let R=this.params.toString();if(R.length===0)this.urlWithParams=a;else{let $=a.indexOf("?"),G=$===-1?"?":$<a.length-1?"&":"";this.urlWithParams=a+G+R}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||tP(this.body)||nP(this.body)||iP(this.body)||YB(this.body)?this.body:this.body instanceof Tc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||iP(this.body)?null:nP(this.body)?this.body.type||null:tP(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof Tc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(s={}){let a=s.method||this.method,f=s.url||this.url,x=s.responseType||this.responseType,n=s.transferCache??this.transferCache,R=s.body!==void 0?s.body:this.body,$=s.withCredentials??this.withCredentials,G=s.reportProgress??this.reportProgress,se=s.headers||this.headers,Me=s.params||this.params,ke=s.context??this.context;return s.setHeaders!==void 0&&(se=Object.keys(s.setHeaders).reduce((tt,Ye)=>tt.set(Ye,s.setHeaders[Ye]),se)),s.setParams&&(Me=Object.keys(s.setParams).reduce((tt,Ye)=>tt.set(Ye,s.setParams[Ye]),Me)),new i(a,f,R,{params:Me,headers:se,context:ke,reportProgress:G,responseType:x,withCredentials:$,transferCache:n})}},Ic=function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i}(Ic||{}),Jm=class{constructor(s,a=200,f="OK"){this.headers=s.headers||new rl,this.status=s.status!==void 0?s.status:a,this.statusText=s.statusText||f,this.url=s.url||null,this.ok=this.status>=200&&this.status<300}},av=class i extends Jm{constructor(s={}){super(s),this.type=Ic.ResponseHeader}clone(s={}){return new i({headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},Km=class i extends Jm{constructor(s={}){super(s),this.type=Ic.Response,this.body=s.body!==void 0?s.body:null}clone(s={}){return new i({body:s.body!==void 0?s.body:this.body,headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},Sc=class extends Jm{constructor(s){super(s,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${s.url||"(unknown url)"}`:this.message=`Http failure response for ${s.url||"(unknown url)"}: ${s.status} ${s.statusText}`,this.error=s.error||null}},aP=200,JB=204;function wC(i,s){return{body:s,headers:i.headers,context:i.context,observe:i.observe,params:i.params,reportProgress:i.reportProgress,responseType:i.responseType,withCredentials:i.withCredentials,transferCache:i.transferCache}}var Qm=(()=>{class i{constructor(a){this.handler=a}request(a,f,x={}){let n;if(a instanceof Ym)n=a;else{let G;x.headers instanceof rl?G=x.headers:G=new rl(x.headers);let se;x.params&&(x.params instanceof Tc?se=x.params:se=new Tc({fromObject:x.params})),n=new Ym(a,f,x.body!==void 0?x.body:null,{headers:G,context:x.context,params:se,reportProgress:x.reportProgress,responseType:x.responseType||"json",withCredentials:x.withCredentials,transferCache:x.transferCache})}let R=vn(n).pipe(Ha(G=>this.handler.handle(G)));if(a instanceof Ym||x.observe==="events")return R;let $=R.pipe(_o(G=>G instanceof Km));switch(x.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return $.pipe(jn(G=>{if(G.body!==null&&!(G.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return G.body}));case"blob":return $.pipe(jn(G=>{if(G.body!==null&&!(G.body instanceof Blob))throw new Error("Response is not a Blob.");return G.body}));case"text":return $.pipe(jn(G=>{if(G.body!==null&&typeof G.body!="string")throw new Error("Response is not a string.");return G.body}));case"json":default:return $.pipe(jn(G=>G.body))}case"response":return $;default:throw new Error(`Unreachable: unhandled observe type ${x.observe}}`)}}delete(a,f={}){return this.request("DELETE",a,f)}get(a,f={}){return this.request("GET",a,f)}head(a,f={}){return this.request("HEAD",a,f)}jsonp(a,f){return this.request("JSONP",a,{params:new Tc().append(f,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(a,f={}){return this.request("OPTIONS",a,f)}patch(a,f,x={}){return this.request("PATCH",a,wC(x,f))}post(a,f,x={}){return this.request("POST",a,wC(x,f))}put(a,f,x={}){return this.request("PUT",a,wC(x,f))}static{this.\u0275fac=function(f){return new(f||i)(sn(ed))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),KB=/^\)\]\}',?\n/,QB="X-Request-URL";function rP(i){if(i.url)return i.url;let s=QB.toLocaleLowerCase();return i.headers.get(s)}var e5=(()=>{class i{constructor(){this.fetchImpl=Ct(MC,{optional:!0})?.fetch??((...a)=>globalThis.fetch(...a)),this.ngZone=Ct(Wi)}handle(a){return new fi(f=>{let x=new AbortController;return this.doRequest(a,x.signal,f).then(SC,n=>f.error(new Sc({error:n}))),()=>x.abort()})}doRequest(a,f,x){return vh(this,null,function*(){let n=this.createRequestInit(a),R;try{let Ye=this.ngZone.runOutsideAngular(()=>this.fetchImpl(a.urlWithParams,Mt({signal:f},n)));t5(Ye),x.next({type:Ic.Sent}),R=yield Ye}catch(Ye){x.error(new Sc({error:Ye,status:Ye.status??0,statusText:Ye.statusText,url:a.urlWithParams,headers:Ye.headers}));return}let $=new rl(R.headers),G=R.statusText,se=rP(R)??a.urlWithParams,Me=R.status,ke=null;if(a.reportProgress&&x.next(new av({headers:$,status:Me,statusText:G,url:se})),R.body){let Ye=R.headers.get("content-length"),wt=[],mt=R.body.getReader(),Ht=0,_n,Ut,Ln=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>vh(this,null,function*(){for(;;){let{done:Pt,value:xi}=yield mt.read();if(Pt)break;if(wt.push(xi),Ht+=xi.length,a.reportProgress){Ut=a.responseType==="text"?(Ut??"")+(_n??=new TextDecoder).decode(xi,{stream:!0}):void 0;let Qi=()=>x.next({type:Ic.DownloadProgress,total:Ye?+Ye:void 0,loaded:Ht,partialText:Ut});Ln?Ln.run(Qi):Qi()}}}));let mi=this.concatChunks(wt,Ht);try{let Pt=R.headers.get("Content-Type")??"";ke=this.parseBody(a,mi,Pt)}catch(Pt){x.error(new Sc({error:Pt,headers:new rl(R.headers),status:R.status,statusText:R.statusText,url:rP(R)??a.urlWithParams}));return}}Me===0&&(Me=ke?aP:0),Me>=200&&Me<300?(x.next(new Km({body:ke,headers:$,status:Me,statusText:G,url:se})),x.complete()):x.error(new Sc({error:ke,headers:$,status:Me,statusText:G,url:se}))})}parseBody(a,f,x){switch(a.responseType){case"json":let n=new TextDecoder().decode(f).replace(KB,"");return n===""?null:JSON.parse(n);case"text":return new TextDecoder().decode(f);case"blob":return new Blob([f],{type:x});case"arraybuffer":return f.buffer}}createRequestInit(a){let f={},x=a.withCredentials?"include":void 0;if(a.headers.forEach((n,R)=>f[n]=R.join(",")),a.headers.has("Accept")||(f.Accept="application/json, text/plain, */*"),!a.headers.has("Content-Type")){let n=a.detectContentTypeHeader();n!==null&&(f["Content-Type"]=n)}return{body:a.serializeBody(),method:a.method,headers:f,credentials:x}}concatChunks(a,f){let x=new Uint8Array(f),n=0;for(let R of a)x.set(R,n),n+=R.length;return x}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),MC=class{};function SC(){}function t5(i){i.then(SC,SC)}function n5(i,s){return s(i)}function i5(i,s,a){return(f,x)=>rs(a,()=>s(f,n=>i(n,x)))}var lP=new on(""),r5=new on(""),o5=new on("",{providedIn:"root",factory:()=>!0});var oP=(()=>{class i extends ed{constructor(a,f){super(),this.backend=a,this.injector=f,this.chain=null,this.pendingTasks=Ct(wc),this.contributeToStability=Ct(o5)}handle(a){if(this.chain===null){let f=Array.from(new Set([...this.injector.get(lP),...this.injector.get(r5,[])]));this.chain=f.reduceRight((x,n)=>i5(x,n,this.injector),n5)}if(this.contributeToStability){let f=this.pendingTasks.add();return this.chain(a,x=>this.backend.handle(x)).pipe(zu(()=>this.pendingTasks.remove(f)))}else return this.chain(a,f=>this.backend.handle(f))}static{this.\u0275fac=function(f){return new(f||i)(sn(sv),sn(to))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})();var s5=/^\)\]\}',?\n/;function a5(i){return"responseURL"in i&&i.responseURL?i.responseURL:/^X-Request-URL:/m.test(i.getAllResponseHeaders())?i.getResponseHeader("X-Request-URL"):null}var sP=(()=>{class i{constructor(a){this.xhrFactory=a}handle(a){if(a.method==="JSONP")throw new hn(-2800,!1);let f=this.xhrFactory;return(f.\u0275loadImpl?ki(f.\u0275loadImpl()):vn(null)).pipe(yo(()=>new fi(n=>{let R=f.build();if(R.open(a.method,a.urlWithParams),a.withCredentials&&(R.withCredentials=!0),a.headers.forEach((mt,Ht)=>R.setRequestHeader(mt,Ht.join(","))),a.headers.has("Accept")||R.setRequestHeader("Accept","application/json, text/plain, */*"),!a.headers.has("Content-Type")){let mt=a.detectContentTypeHeader();mt!==null&&R.setRequestHeader("Content-Type",mt)}if(a.responseType){let mt=a.responseType.toLowerCase();R.responseType=mt!=="json"?mt:"text"}let $=a.serializeBody(),G=null,se=()=>{if(G!==null)return G;let mt=R.statusText||"OK",Ht=new rl(R.getAllResponseHeaders()),_n=a5(R)||a.url;return G=new av({headers:Ht,status:R.status,statusText:mt,url:_n}),G},Me=()=>{let{headers:mt,status:Ht,statusText:_n,url:Ut}=se(),Ln=null;Ht!==JB&&(Ln=typeof R.response>"u"?R.responseText:R.response),Ht===0&&(Ht=Ln?aP:0);let mi=Ht>=200&&Ht<300;if(a.responseType==="json"&&typeof Ln=="string"){let Pt=Ln;Ln=Ln.replace(s5,"");try{Ln=Ln!==""?JSON.parse(Ln):null}catch(xi){Ln=Pt,mi&&(mi=!1,Ln={error:xi,text:Ln})}}mi?(n.next(new Km({body:Ln,headers:mt,status:Ht,statusText:_n,url:Ut||void 0})),n.complete()):n.error(new Sc({error:Ln,headers:mt,status:Ht,statusText:_n,url:Ut||void 0}))},ke=mt=>{let{url:Ht}=se(),_n=new Sc({error:mt,status:R.status||0,statusText:R.statusText||"Unknown Error",url:Ht||void 0});n.error(_n)},tt=!1,Ye=mt=>{tt||(n.next(se()),tt=!0);let Ht={type:Ic.DownloadProgress,loaded:mt.loaded};mt.lengthComputable&&(Ht.total=mt.total),a.responseType==="text"&&R.responseText&&(Ht.partialText=R.responseText),n.next(Ht)},wt=mt=>{let Ht={type:Ic.UploadProgress,loaded:mt.loaded};mt.lengthComputable&&(Ht.total=mt.total),n.next(Ht)};return R.addEventListener("load",Me),R.addEventListener("error",ke),R.addEventListener("timeout",ke),R.addEventListener("abort",ke),a.reportProgress&&(R.addEventListener("progress",Ye),$!==null&&R.upload&&R.upload.addEventListener("progress",wt)),R.send($),n.next({type:Ic.Sent}),()=>{R.removeEventListener("error",ke),R.removeEventListener("abort",ke),R.removeEventListener("load",Me),R.removeEventListener("timeout",ke),a.reportProgress&&(R.removeEventListener("progress",Ye),$!==null&&R.upload&&R.upload.removeEventListener("progress",wt)),R.readyState!==R.DONE&&R.abort()}})))}static{this.\u0275fac=function(f){return new(f||i)(sn(of))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),cP=new on(""),l5="XSRF-TOKEN",c5=new on("",{providedIn:"root",factory:()=>l5}),u5="X-XSRF-TOKEN",d5=new on("",{providedIn:"root",factory:()=>u5}),lv=class{},h5=(()=>{class i{constructor(a,f,x){this.doc=a,this.platform=f,this.cookieName=x,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let a=this.doc.cookie||"";return a!==this.lastCookieString&&(this.parseCount++,this.lastToken=iv(a,this.cookieName),this.lastCookieString=a),this.lastToken}static{this.\u0275fac=function(f){return new(f||i)(sn(zr),sn(fa),sn(c5))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})();function f5(i,s){let a=i.url.toLowerCase();if(!Ct(cP)||i.method==="GET"||i.method==="HEAD"||a.startsWith("http://")||a.startsWith("https://"))return s(i);let f=Ct(lv).getToken(),x=Ct(d5);return f!=null&&!i.headers.has(x)&&(i=i.clone({headers:i.headers.set(x,f)})),s(i)}function uP(...i){let s=[Qm,sP,oP,{provide:ed,useExisting:oP},{provide:sv,useFactory:()=>Ct(e5,{optional:!0})??Ct(sP)},{provide:lP,useValue:f5,multi:!0},{provide:cP,useValue:!0},{provide:lv,useClass:h5}];for(let a of i)s.push(...a.\u0275providers);return Vm(s)}var DC=class extends nv{constructor(){super(...arguments),this.supportsDOMEvents=!0}},AC=class i extends DC{static makeCurrent(){XA(new i)}onAndCancel(s,a,f){return s.addEventListener(a,f),()=>{s.removeEventListener(a,f)}}dispatchEvent(s,a){s.dispatchEvent(a)}remove(s){s.remove()}createElement(s,a){return a=a||this.getDefaultDocument(),a.createElement(s)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(s){return s.nodeType===Node.ELEMENT_NODE}isShadowRoot(s){return s instanceof DocumentFragment}getGlobalEventTarget(s,a){return a==="window"?window:a==="document"?s:a==="body"?s.body:null}getBaseHref(s){let a=p5();return a==null?null:m5(a)}resetBaseElement(){eg=null}getUserAgent(){return window.navigator.userAgent}getCookie(s){return iv(document.cookie,s)}},eg=null;function p5(){return eg=eg||document.querySelector("base"),eg?eg.getAttribute("href"):null}function m5(i){return new URL(i,document.baseURI).pathname}var g5=(()=>{class i{build(){return new XMLHttpRequest}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),PC=new on(""),mP=(()=>{class i{constructor(a,f){this._zone=f,this._eventNameToPlugin=new Map,a.forEach(x=>{x.manager=this}),this._plugins=a.slice().reverse()}addEventListener(a,f,x){return this._findPluginFor(f).addEventListener(a,f,x)}getZone(){return this._zone}_findPluginFor(a){let f=this._eventNameToPlugin.get(a);if(f)return f;if(f=this._plugins.find(n=>n.supports(a)),!f)throw new hn(5101,!1);return this._eventNameToPlugin.set(a,f),f}static{this.\u0275fac=function(f){return new(f||i)(sn(PC),sn(Wi))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),cv=class{constructor(s){this._doc=s}},TC="ng-app-id",gP=(()=>{class i{constructor(a,f,x,n={}){this.doc=a,this.appId=f,this.nonce=x,this.platformId=n,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=rv(n),this.resetHostNodes()}addStyles(a){for(let f of a)this.changeUsageCount(f,1)===1&&this.onStyleAdded(f)}removeStyles(a){for(let f of a)this.changeUsageCount(f,-1)<=0&&this.onStyleRemoved(f)}ngOnDestroy(){let a=this.styleNodesInDOM;a&&(a.forEach(f=>f.remove()),a.clear());for(let f of this.getAllStyles())this.onStyleRemoved(f);this.resetHostNodes()}addHost(a){this.hostNodes.add(a);for(let f of this.getAllStyles())this.addStyleToHost(a,f)}removeHost(a){this.hostNodes.delete(a)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(a){for(let f of this.hostNodes)this.addStyleToHost(f,a)}onStyleRemoved(a){let f=this.styleRef;f.get(a)?.elements?.forEach(x=>x.remove()),f.delete(a)}collectServerRenderedStyles(){let a=this.doc.head?.querySelectorAll(`style[${TC}="${this.appId}"]`);if(a?.length){let f=new Map;return a.forEach(x=>{x.textContent!=null&&f.set(x.textContent,x)}),f}return null}changeUsageCount(a,f){let x=this.styleRef;if(x.has(a)){let n=x.get(a);return n.usage+=f,n.usage}return x.set(a,{usage:f,elements:[]}),f}getStyleElement(a,f){let x=this.styleNodesInDOM,n=x?.get(f);if(n?.parentNode===a)return x.delete(f),n.removeAttribute(TC),n;{let R=this.doc.createElement("style");return this.nonce&&R.setAttribute("nonce",this.nonce),R.textContent=f,this.platformIsServer&&R.setAttribute(TC,this.appId),a.appendChild(R),R}}addStyleToHost(a,f){let x=this.getStyleElement(a,f),n=this.styleRef,R=n.get(f)?.elements;R?R.push(x):n.set(f,{elements:[x],usage:1})}resetHostNodes(){let a=this.hostNodes;a.clear(),a.add(this.doc.head)}static{this.\u0275fac=function(f){return new(f||i)(sn(zr),sn(Zw),sn(Yw,8),sn(fa))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),IC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},OC=/%COMP%/g,_P="%COMP%",_5=`_nghost-${_P}`,y5=`_ngcontent-${_P}`,v5=!0,x5=new on("",{providedIn:"root",factory:()=>v5});function b5(i){return y5.replace(OC,i)}function w5(i){return _5.replace(OC,i)}function yP(i,s){return s.map(a=>a.replace(OC,i))}var hP=(()=>{class i{constructor(a,f,x,n,R,$,G,se=null){this.eventManager=a,this.sharedStylesHost=f,this.appId=x,this.removeStylesOnCompDestroy=n,this.doc=R,this.platformId=$,this.ngZone=G,this.nonce=se,this.rendererByCompId=new Map,this.platformIsServer=rv($),this.defaultRenderer=new tg(a,R,G,this.platformIsServer)}createRenderer(a,f){if(!a||!f)return this.defaultRenderer;this.platformIsServer&&f.encapsulation===aa.ShadowDom&&(f=ei(Mt({},f),{encapsulation:aa.Emulated}));let x=this.getOrCreateRenderer(a,f);return x instanceof uv?x.applyToHost(a):x instanceof ng&&x.applyStyles(),x}getOrCreateRenderer(a,f){let x=this.rendererByCompId,n=x.get(f.id);if(!n){let R=this.doc,$=this.ngZone,G=this.eventManager,se=this.sharedStylesHost,Me=this.removeStylesOnCompDestroy,ke=this.platformIsServer;switch(f.encapsulation){case aa.Emulated:n=new uv(G,se,f,this.appId,Me,R,$,ke);break;case aa.ShadowDom:return new RC(G,se,a,f,R,$,this.nonce,ke);default:n=new ng(G,se,f,Me,R,$,ke);break}x.set(f.id,n)}return n}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(f){return new(f||i)(sn(mP),sn(gP),sn(Zw),sn(x5),sn(zr),sn(fa),sn(Wi),sn(Yw))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),tg=class{constructor(s,a,f,x){this.eventManager=s,this.doc=a,this.ngZone=f,this.platformIsServer=x,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(s,a){return a?this.doc.createElementNS(IC[a]||a,s):this.doc.createElement(s)}createComment(s){return this.doc.createComment(s)}createText(s){return this.doc.createTextNode(s)}appendChild(s,a){(fP(s)?s.content:s).appendChild(a)}insertBefore(s,a,f){s&&(fP(s)?s.content:s).insertBefore(a,f)}removeChild(s,a){a.remove()}selectRootElement(s,a){let f=typeof s=="string"?this.doc.querySelector(s):s;if(!f)throw new hn(-5104,!1);return a||(f.textContent=""),f}parentNode(s){return s.parentNode}nextSibling(s){return s.nextSibling}setAttribute(s,a,f,x){if(x){a=x+":"+a;let n=IC[x];n?s.setAttributeNS(n,a,f):s.setAttribute(a,f)}else s.setAttribute(a,f)}removeAttribute(s,a,f){if(f){let x=IC[f];x?s.removeAttributeNS(x,a):s.removeAttribute(`${f}:${a}`)}else s.removeAttribute(a)}addClass(s,a){s.classList.add(a)}removeClass(s,a){s.classList.remove(a)}setStyle(s,a,f,x){x&(Ya.DashCase|Ya.Important)?s.style.setProperty(a,f,x&Ya.Important?"important":""):s.style[a]=f}removeStyle(s,a,f){f&Ya.DashCase?s.style.removeProperty(a):s.style[a]=""}setProperty(s,a,f){s!=null&&(s[a]=f)}setValue(s,a){s.nodeValue=a}listen(s,a,f){if(typeof s=="string"&&(s=nl().getGlobalEventTarget(this.doc,s),!s))throw new Error(`Unsupported event target ${s} for event ${a}`);return this.eventManager.addEventListener(s,a,this.decoratePreventDefault(f))}decoratePreventDefault(s){return a=>{if(a==="__ngUnwrap__")return s;(this.platformIsServer?this.ngZone.runGuarded(()=>s(a)):s(a))===!1&&a.preventDefault()}}};function fP(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var RC=class extends tg{constructor(s,a,f,x,n,R,$,G){super(s,n,R,G),this.sharedStylesHost=a,this.hostEl=f,this.shadowRoot=f.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let se=yP(x.id,x.styles);for(let Me of se){let ke=document.createElement("style");$&&ke.setAttribute("nonce",$),ke.textContent=Me,this.shadowRoot.appendChild(ke)}}nodeOrShadowRoot(s){return s===this.hostEl?this.shadowRoot:s}appendChild(s,a){return super.appendChild(this.nodeOrShadowRoot(s),a)}insertBefore(s,a,f){return super.insertBefore(this.nodeOrShadowRoot(s),a,f)}removeChild(s,a){return super.removeChild(null,a)}parentNode(s){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(s)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},ng=class extends tg{constructor(s,a,f,x,n,R,$,G){super(s,n,R,$),this.sharedStylesHost=a,this.removeStylesOnCompDestroy=x,this.styles=G?yP(G,f.styles):f.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},uv=class extends ng{constructor(s,a,f,x,n,R,$,G){let se=x+"-"+f.id;super(s,a,f,n,R,$,G,se),this.contentAttr=b5(se),this.hostAttr=w5(se)}applyToHost(s){this.applyStyles(),this.setAttribute(s,this.hostAttr,"")}createElement(s,a){let f=super.createElement(s,a);return super.setAttribute(f,this.contentAttr,""),f}},C5=(()=>{class i extends cv{constructor(a){super(a)}supports(a){return!0}addEventListener(a,f,x){return a.addEventListener(f,x,!1),()=>this.removeEventListener(a,f,x)}removeEventListener(a,f,x){return a.removeEventListener(f,x)}static{this.\u0275fac=function(f){return new(f||i)(sn(zr))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})(),pP=["alt","control","meta","shift"],E5={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},M5={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},S5=(()=>{class i extends cv{constructor(a){super(a)}supports(a){return i.parseEventName(a)!=null}addEventListener(a,f,x){let n=i.parseEventName(f),R=i.eventCallback(n.fullKey,x,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>nl().onAndCancel(a,n.domEventName,R))}static parseEventName(a){let f=a.toLowerCase().split("."),x=f.shift();if(f.length===0||!(x==="keydown"||x==="keyup"))return null;let n=i._normalizeKey(f.pop()),R="",$=f.indexOf("code");if($>-1&&(f.splice($,1),R="code."),pP.forEach(se=>{let Me=f.indexOf(se);Me>-1&&(f.splice(Me,1),R+=se+".")}),R+=n,f.length!=0||n.length===0)return null;let G={};return G.domEventName=x,G.fullKey=R,G}static matchEventFullKeyCode(a,f){let x=E5[a.key]||a.key,n="";return f.indexOf("code.")>-1&&(x=a.code,n="code."),x==null||!x?!1:(x=x.toLowerCase(),x===" "?x="space":x==="."&&(x="dot"),pP.forEach(R=>{if(R!==x){let $=M5[R];$(a)&&(n+=R+".")}}),n+=x,n===f)}static eventCallback(a,f,x){return n=>{i.matchEventFullKeyCode(n,a)&&x.runGuarded(()=>f(n))}}static _normalizeKey(a){return a==="esc"?"escape":a}static{this.\u0275fac=function(f){return new(f||i)(sn(zr))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})();function vP(i,s){return $A(Mt({rootComponent:i},T5(s)))}function T5(i){return{appProviders:[...R5,...i?.providers??[]],platformProviders:P5}}function I5(){AC.makeCurrent()}function D5(){return new Xa}function A5(){return $2(document),document}var P5=[{provide:fa,useValue:bC},{provide:Xw,useValue:I5,multi:!0},{provide:zr,useFactory:A5,deps:[]}];var R5=[{provide:z0,useValue:"root"},{provide:Xa,useFactory:D5,deps:[]},{provide:PC,useClass:C5,multi:!0,deps:[zr,Wi,fa]},{provide:PC,useClass:S5,multi:!0,deps:[zr]},hP,gP,mP,{provide:qh,useExisting:hP},{provide:of,useClass:g5,deps:[]},[]];var xP=(()=>{class i{constructor(a){this._doc=a}getTitle(){return this._doc.title}setTitle(a){this._doc.title=a||""}static{this.\u0275fac=function(f){return new(f||i)(sn(zr))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var AP=(()=>{class i{constructor(a,f){this._renderer=a,this._elementRef=f,this.onChange=x=>{},this.onTouched=()=>{}}setProperty(a,f){this._renderer.setProperty(this._elementRef.nativeElement,a,f)}registerOnTouched(a){this.onTouched=a}registerOnChange(a){this.onChange=a}setDisabledState(a){this.setProperty("disabled",a)}static{this.\u0275fac=function(f){return new(f||i)(St(pa),St(xo))}}static{this.\u0275dir=Ni({type:i})}}return i})(),xv=(()=>{class i extends AP{static{this.\u0275fac=(()=>{let a;return function(x){return(a||(a=ha(i)))(x||i)}})()}static{this.\u0275dir=Ni({type:i,features:[Nr]})}}return i})(),hf=new on("");var L5={provide:hf,useExisting:vo(()=>vr),multi:!0};function F5(){let i=nl()?nl().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var k5=new on(""),vr=(()=>{class i extends AP{constructor(a,f,x){super(a,f),this._compositionMode=x,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!F5())}writeValue(a){let f=a??"";this.setProperty("value",f)}_handleInput(a){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(a)}_compositionStart(){this._composing=!0}_compositionEnd(a){this._composing=!1,this._compositionMode&&this.onChange(a)}static{this.\u0275fac=function(f){return new(f||i)(St(pa),St(xo),St(k5,8))}}static{this.\u0275dir=Ni({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(f,x){f&1&&Wn("input",function(R){return x._handleInput(R.target.value)})("blur",function(){return x.onTouched()})("compositionstart",function(){return x._compositionStart()})("compositionend",function(R){return x._compositionEnd(R.target.value)})},features:[as([L5]),Nr]})}}return i})();function Dc(i){return i==null||(typeof i=="string"||Array.isArray(i))&&i.length===0}function PP(i){return i!=null&&typeof i.length=="number"}var td=new on(""),bv=new on(""),N5=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Ot=class{static min(s){return z5(s)}static max(s){return B5(s)}static required(s){return RP(s)}static requiredTrue(s){return V5(s)}static email(s){return j5(s)}static minLength(s){return OP(s)}static maxLength(s){return LP(s)}static pattern(s){return U5(s)}static nullValidator(s){return hv(s)}static compose(s){return VP(s)}static composeAsync(s){return jP(s)}};function z5(i){return s=>{if(Dc(s.value)||Dc(i))return null;let a=parseFloat(s.value);return!isNaN(a)&&a<i?{min:{min:i,actual:s.value}}:null}}function B5(i){return s=>{if(Dc(s.value)||Dc(i))return null;let a=parseFloat(s.value);return!isNaN(a)&&a>i?{max:{max:i,actual:s.value}}:null}}function RP(i){return Dc(i.value)?{required:!0}:null}function V5(i){return i.value===!0?null:{required:!0}}function j5(i){return Dc(i.value)||N5.test(i.value)?null:{email:!0}}function OP(i){return s=>Dc(s.value)||!PP(s.value)?null:s.value.length<i?{minlength:{requiredLength:i,actualLength:s.value.length}}:null}function LP(i){return s=>PP(s.value)&&s.value.length>i?{maxlength:{requiredLength:i,actualLength:s.value.length}}:null}function U5(i){if(!i)return hv;let s,a;return typeof i=="string"?(a="",i.charAt(0)!=="^"&&(a+="^"),a+=i,i.charAt(i.length-1)!=="$"&&(a+="$"),s=new RegExp(a)):(a=i.toString(),s=i),f=>{if(Dc(f.value))return null;let x=f.value;return s.test(x)?null:{pattern:{requiredPattern:a,actualValue:x}}}}function hv(i){return null}function FP(i){return i!=null}function kP(i){return Ku(i)?ki(i):i}function NP(i){let s={};return i.forEach(a=>{s=a!=null?Mt(Mt({},s),a):s}),Object.keys(s).length===0?null:s}function zP(i,s){return s.map(a=>a(i))}function $5(i){return!i.validate}function BP(i){return i.map(s=>$5(s)?s:a=>s.validate(a))}function VP(i){if(!i)return null;let s=i.filter(FP);return s.length==0?null:function(a){return NP(zP(a,s))}}function BC(i){return i!=null?VP(BP(i)):null}function jP(i){if(!i)return null;let s=i.filter(FP);return s.length==0?null:function(a){let f=zP(a,s).map(kP);return mb(f).pipe(jn(NP))}}function VC(i){return i!=null?jP(BP(i)):null}function bP(i,s){return i===null?[s]:Array.isArray(i)?[...i,s]:[i,s]}function UP(i){return i._rawValidators}function $P(i){return i._rawAsyncValidators}function LC(i){return i?Array.isArray(i)?i:[i]:[]}function fv(i,s){return Array.isArray(i)?i.includes(s):i===s}function wP(i,s){let a=LC(s);return LC(i).forEach(x=>{fv(a,x)||a.push(x)}),a}function CP(i,s){return LC(s).filter(a=>!fv(i,a))}var pv=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(s){this._rawValidators=s||[],this._composedValidatorFn=BC(this._rawValidators)}_setAsyncValidators(s){this._rawAsyncValidators=s||[],this._composedAsyncValidatorFn=VC(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(s){this._onDestroyCallbacks.push(s)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(s=>s()),this._onDestroyCallbacks=[]}reset(s=void 0){this.control&&this.control.reset(s)}hasError(s,a){return this.control?this.control.hasError(s,a):!1}getError(s,a){return this.control?this.control.getError(s,a):null}},ol=class extends pv{get formDirective(){return null}get path(){return null}},Ac=class extends pv{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},mv=class{constructor(s){this._cd=s}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},G5={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},u9=ei(Mt({},G5),{"[class.ng-submitted]":"isSubmitted"}),Br=(()=>{class i extends mv{constructor(a){super(a)}static{this.\u0275fac=function(f){return new(f||i)(St(Ac,2))}}static{this.\u0275dir=Ni({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(f,x){f&2&&J0("ng-untouched",x.isUntouched)("ng-touched",x.isTouched)("ng-pristine",x.isPristine)("ng-dirty",x.isDirty)("ng-valid",x.isValid)("ng-invalid",x.isInvalid)("ng-pending",x.isPending)},features:[Nr]})}}return i})(),Vr=(()=>{class i extends mv{constructor(a){super(a)}static{this.\u0275fac=function(f){return new(f||i)(St(ol,10))}}static{this.\u0275dir=Ni({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(f,x){f&2&&J0("ng-untouched",x.isUntouched)("ng-touched",x.isTouched)("ng-pristine",x.isPristine)("ng-dirty",x.isDirty)("ng-valid",x.isValid)("ng-invalid",x.isInvalid)("ng-pending",x.isPending)("ng-submitted",x.isSubmitted)},features:[Nr]})}}return i})();var ig="VALID",dv="INVALID",lf="PENDING",rg="DISABLED",Pc=class{},gv=class extends Pc{constructor(s,a){super(),this.value=s,this.source=a}},sg=class extends Pc{constructor(s,a){super(),this.pristine=s,this.source=a}},ag=class extends Pc{constructor(s,a){super(),this.touched=s,this.source=a}},cf=class extends Pc{constructor(s,a){super(),this.status=s,this.source=a}},FC=class extends Pc{constructor(s){super(),this.source=s}},kC=class extends Pc{constructor(s){super(),this.source=s}};function jC(i){return(wv(i)?i.validators:i)||null}function H5(i){return Array.isArray(i)?BC(i):i||null}function UC(i,s){return(wv(s)?s.asyncValidators:i)||null}function q5(i){return Array.isArray(i)?VC(i):i||null}function wv(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function GP(i,s,a){let f=i.controls;if(!(s?Object.keys(f):f).length)throw new hn(1e3,"");if(!f[a])throw new hn(1001,"")}function HP(i,s,a){i._forEachChild((f,x)=>{if(a[x]===void 0)throw new hn(1002,"")})}var uf=class{constructor(s,a){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=rf(()=>this.statusReactive()),this.statusReactive=ef(void 0),this._pristine=rf(()=>this.pristineReactive()),this.pristineReactive=ef(!0),this._touched=rf(()=>this.touchedReactive()),this.touchedReactive=ef(!1),this._events=new _r,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(s),this._assignAsyncValidators(a)}get validator(){return this._composedValidatorFn}set validator(s){this._rawValidators=this._composedValidatorFn=s}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(s){this._rawAsyncValidators=this._composedAsyncValidatorFn=s}get parent(){return this._parent}get status(){return ma(this.statusReactive)}set status(s){ma(()=>this.statusReactive.set(s))}get valid(){return this.status===ig}get invalid(){return this.status===dv}get pending(){return this.status==lf}get disabled(){return this.status===rg}get enabled(){return this.status!==rg}get pristine(){return ma(this.pristineReactive)}set pristine(s){ma(()=>this.pristineReactive.set(s))}get dirty(){return!this.pristine}get touched(){return ma(this.touchedReactive)}set touched(s){ma(()=>this.touchedReactive.set(s))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(s){this._assignValidators(s)}setAsyncValidators(s){this._assignAsyncValidators(s)}addValidators(s){this.setValidators(wP(s,this._rawValidators))}addAsyncValidators(s){this.setAsyncValidators(wP(s,this._rawAsyncValidators))}removeValidators(s){this.setValidators(CP(s,this._rawValidators))}removeAsyncValidators(s){this.setAsyncValidators(CP(s,this._rawAsyncValidators))}hasValidator(s){return fv(this._rawValidators,s)}hasAsyncValidator(s){return fv(this._rawAsyncValidators,s)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(s={}){let a=this.touched===!1;this.touched=!0;let f=s.sourceControl??this;this._parent&&!s.onlySelf&&this._parent.markAsTouched(ei(Mt({},s),{sourceControl:f})),a&&s.emitEvent!==!1&&this._events.next(new ag(!0,f))}markAllAsTouched(s={}){this.markAsTouched({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:this}),this._forEachChild(a=>a.markAllAsTouched(s))}markAsUntouched(s={}){let a=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let f=s.sourceControl??this;this._forEachChild(x=>{x.markAsUntouched({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:f})}),this._parent&&!s.onlySelf&&this._parent._updateTouched(s,f),a&&s.emitEvent!==!1&&this._events.next(new ag(!1,f))}markAsDirty(s={}){let a=this.pristine===!0;this.pristine=!1;let f=s.sourceControl??this;this._parent&&!s.onlySelf&&this._parent.markAsDirty(ei(Mt({},s),{sourceControl:f})),a&&s.emitEvent!==!1&&this._events.next(new sg(!1,f))}markAsPristine(s={}){let a=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let f=s.sourceControl??this;this._forEachChild(x=>{x.markAsPristine({onlySelf:!0,emitEvent:s.emitEvent})}),this._parent&&!s.onlySelf&&this._parent._updatePristine(s,f),a&&s.emitEvent!==!1&&this._events.next(new sg(!0,f))}markAsPending(s={}){this.status=lf;let a=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new cf(this.status,a)),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.markAsPending(ei(Mt({},s),{sourceControl:a}))}disable(s={}){let a=this._parentMarkedDirty(s.onlySelf);this.status=rg,this.errors=null,this._forEachChild(x=>{x.disable(ei(Mt({},s),{onlySelf:!0}))}),this._updateValue();let f=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new gv(this.value,f)),this._events.next(new cf(this.status,f)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(ei(Mt({},s),{skipPristineCheck:a}),this),this._onDisabledChange.forEach(x=>x(!0))}enable(s={}){let a=this._parentMarkedDirty(s.onlySelf);this.status=ig,this._forEachChild(f=>{f.enable(ei(Mt({},s),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent}),this._updateAncestors(ei(Mt({},s),{skipPristineCheck:a}),this),this._onDisabledChange.forEach(f=>f(!1))}_updateAncestors(s,a){this._parent&&!s.onlySelf&&(this._parent.updateValueAndValidity(s),s.skipPristineCheck||this._parent._updatePristine({},a),this._parent._updateTouched({},a))}setParent(s){this._parent=s}getRawValue(){return this.value}updateValueAndValidity(s={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let f=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ig||this.status===lf)&&this._runAsyncValidator(f,s.emitEvent)}let a=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new gv(this.value,a)),this._events.next(new cf(this.status,a)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.updateValueAndValidity(ei(Mt({},s),{sourceControl:a}))}_updateTreeValidity(s={emitEvent:!0}){this._forEachChild(a=>a._updateTreeValidity(s)),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?rg:ig}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(s,a){if(this.asyncValidator){this.status=lf,this._hasOwnPendingAsyncValidator={emitEvent:a!==!1};let f=kP(this.asyncValidator(this));this._asyncValidationSubscription=f.subscribe(x=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(x,{emitEvent:a,shouldHaveEmitted:s})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let s=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,s}return!1}setErrors(s,a={}){this.errors=s,this._updateControlsErrors(a.emitEvent!==!1,this,a.shouldHaveEmitted)}get(s){let a=s;return a==null||(Array.isArray(a)||(a=a.split(".")),a.length===0)?null:a.reduce((f,x)=>f&&f._find(x),this)}getError(s,a){let f=a?this.get(a):this;return f&&f.errors?f.errors[s]:null}hasError(s,a){return!!this.getError(s,a)}get root(){let s=this;for(;s._parent;)s=s._parent;return s}_updateControlsErrors(s,a,f){this.status=this._calculateStatus(),s&&this.statusChanges.emit(this.status),(s||f)&&this._events.next(new cf(this.status,a)),this._parent&&this._parent._updateControlsErrors(s,a,f)}_initObservables(){this.valueChanges=new qi,this.statusChanges=new qi}_calculateStatus(){return this._allControlsDisabled()?rg:this.errors?dv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(lf)?lf:this._anyControlsHaveStatus(dv)?dv:ig}_anyControlsHaveStatus(s){return this._anyControls(a=>a.status===s)}_anyControlsDirty(){return this._anyControls(s=>s.dirty)}_anyControlsTouched(){return this._anyControls(s=>s.touched)}_updatePristine(s,a){let f=!this._anyControlsDirty(),x=this.pristine!==f;this.pristine=f,this._parent&&!s.onlySelf&&this._parent._updatePristine(s,a),x&&this._events.next(new sg(this.pristine,a))}_updateTouched(s={},a){this.touched=this._anyControlsTouched(),this._events.next(new ag(this.touched,a)),this._parent&&!s.onlySelf&&this._parent._updateTouched(s,a)}_registerOnCollectionChange(s){this._onCollectionChange=s}_setUpdateStrategy(s){wv(s)&&s.updateOn!=null&&(this._updateOn=s.updateOn)}_parentMarkedDirty(s){let a=this._parent&&this._parent.dirty;return!s&&!!a&&!this._parent._anyControlsDirty()}_find(s){return null}_assignValidators(s){this._rawValidators=Array.isArray(s)?s.slice():s,this._composedValidatorFn=H5(this._rawValidators)}_assignAsyncValidators(s){this._rawAsyncValidators=Array.isArray(s)?s.slice():s,this._composedAsyncValidatorFn=q5(this._rawAsyncValidators)}},df=class extends uf{constructor(s,a,f){super(jC(a),UC(f,a)),this.controls=s,this._initObservables(),this._setUpdateStrategy(a),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(s,a){return this.controls[s]?this.controls[s]:(this.controls[s]=a,a.setParent(this),a._registerOnCollectionChange(this._onCollectionChange),a)}addControl(s,a,f={}){this.registerControl(s,a),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}removeControl(s,a={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}setControl(s,a,f={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],a&&this.registerControl(s,a),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}contains(s){return this.controls.hasOwnProperty(s)&&this.controls[s].enabled}setValue(s,a={}){HP(this,!0,s),Object.keys(s).forEach(f=>{GP(this,!0,f),this.controls[f].setValue(s[f],{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a)}patchValue(s,a={}){s!=null&&(Object.keys(s).forEach(f=>{let x=this.controls[f];x&&x.patchValue(s[f],{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a))}reset(s={},a={}){this._forEachChild((f,x)=>{f.reset(s?s[x]:null,{onlySelf:!0,emitEvent:a.emitEvent})}),this._updatePristine(a,this),this._updateTouched(a,this),this.updateValueAndValidity(a)}getRawValue(){return this._reduceChildren({},(s,a,f)=>(s[f]=a.getRawValue(),s))}_syncPendingControls(){let s=this._reduceChildren(!1,(a,f)=>f._syncPendingControls()?!0:a);return s&&this.updateValueAndValidity({onlySelf:!0}),s}_forEachChild(s){Object.keys(this.controls).forEach(a=>{let f=this.controls[a];f&&s(f,a)})}_setUpControls(){this._forEachChild(s=>{s.setParent(this),s._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(s){for(let[a,f]of Object.entries(this.controls))if(this.contains(a)&&s(f))return!0;return!1}_reduceValue(){let s={};return this._reduceChildren(s,(a,f,x)=>((f.enabled||this.disabled)&&(a[x]=f.value),a))}_reduceChildren(s,a){let f=s;return this._forEachChild((x,n)=>{f=a(f,x,n)}),f}_allControlsDisabled(){for(let s of Object.keys(this.controls))if(this.controls[s].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(s){return this.controls.hasOwnProperty(s)?this.controls[s]:null}};var NC=class extends df{};var ff=new on("CallSetDisabledState",{providedIn:"root",factory:()=>cg}),cg="always";function qP(i,s){return[...s.path,i]}function _v(i,s,a=cg){$C(i,s),s.valueAccessor.writeValue(i.value),(i.disabled||a==="always")&&s.valueAccessor.setDisabledState?.(i.disabled),Z5(i,s),Y5(i,s),X5(i,s),W5(i,s)}function EP(i,s,a=!0){let f=()=>{};s.valueAccessor&&(s.valueAccessor.registerOnChange(f),s.valueAccessor.registerOnTouched(f)),vv(i,s),i&&(s._invokeOnDestroyCallbacks(),i._registerOnCollectionChange(()=>{}))}function yv(i,s){i.forEach(a=>{a.registerOnValidatorChange&&a.registerOnValidatorChange(s)})}function W5(i,s){if(s.valueAccessor.setDisabledState){let a=f=>{s.valueAccessor.setDisabledState(f)};i.registerOnDisabledChange(a),s._registerOnDestroy(()=>{i._unregisterOnDisabledChange(a)})}}function $C(i,s){let a=UP(i);s.validator!==null?i.setValidators(bP(a,s.validator)):typeof a=="function"&&i.setValidators([a]);let f=$P(i);s.asyncValidator!==null?i.setAsyncValidators(bP(f,s.asyncValidator)):typeof f=="function"&&i.setAsyncValidators([f]);let x=()=>i.updateValueAndValidity();yv(s._rawValidators,x),yv(s._rawAsyncValidators,x)}function vv(i,s){let a=!1;if(i!==null){if(s.validator!==null){let x=UP(i);if(Array.isArray(x)&&x.length>0){let n=x.filter(R=>R!==s.validator);n.length!==x.length&&(a=!0,i.setValidators(n))}}if(s.asyncValidator!==null){let x=$P(i);if(Array.isArray(x)&&x.length>0){let n=x.filter(R=>R!==s.asyncValidator);n.length!==x.length&&(a=!0,i.setAsyncValidators(n))}}}let f=()=>{};return yv(s._rawValidators,f),yv(s._rawAsyncValidators,f),a}function Z5(i,s){s.valueAccessor.registerOnChange(a=>{i._pendingValue=a,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&WP(i,s)})}function X5(i,s){s.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&WP(i,s),i.updateOn!=="submit"&&i.markAsTouched()})}function WP(i,s){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),s.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function Y5(i,s){let a=(f,x)=>{s.valueAccessor.writeValue(f),x&&s.viewToModelUpdate(f)};i.registerOnChange(a),s._registerOnDestroy(()=>{i._unregisterOnChange(a)})}function ZP(i,s){i==null,$C(i,s)}function J5(i,s){return vv(i,s)}function XP(i,s){if(!i.hasOwnProperty("model"))return!1;let a=i.model;return a.isFirstChange()?!0:!Object.is(s,a.currentValue)}function K5(i){return Object.getPrototypeOf(i.constructor)===xv}function YP(i,s){i._syncPendingControls(),s.forEach(a=>{let f=a.control;f.updateOn==="submit"&&f._pendingChange&&(a.viewToModelUpdate(f._pendingValue),f._pendingChange=!1)})}function JP(i,s){if(!s)return null;Array.isArray(s);let a,f,x;return s.forEach(n=>{n.constructor===vr?a=n:K5(n)?f=n:x=n}),x||f||a||null}function Q5(i,s){let a=i.indexOf(s);a>-1&&i.splice(a,1)}var eV={provide:ol,useExisting:vo(()=>GC)},og=Promise.resolve(),GC=(()=>{class i extends ol{get submitted(){return ma(this.submittedReactive)}constructor(a,f,x){super(),this.callSetDisabledState=x,this._submitted=rf(()=>this.submittedReactive()),this.submittedReactive=ef(!1),this._directives=new Set,this.ngSubmit=new qi,this.form=new df({},BC(a),VC(f))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(a){og.then(()=>{let f=this._findContainer(a.path);a.control=f.registerControl(a.name,a.control),_v(a.control,a,this.callSetDisabledState),a.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(a)})}getControl(a){return this.form.get(a.path)}removeControl(a){og.then(()=>{let f=this._findContainer(a.path);f&&f.removeControl(a.name),this._directives.delete(a)})}addFormGroup(a){og.then(()=>{let f=this._findContainer(a.path),x=new df({});ZP(x,a),f.registerControl(a.name,x),x.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(a){og.then(()=>{let f=this._findContainer(a.path);f&&f.removeControl(a.name)})}getFormGroup(a){return this.form.get(a.path)}updateModel(a,f){og.then(()=>{this.form.get(a.path).setValue(f)})}setValue(a){this.control.setValue(a)}onSubmit(a){return this.submittedReactive.set(!0),YP(this.form,this._directives),this.ngSubmit.emit(a),a?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(a=void 0){this.form.reset(a),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(a){return a.pop(),a.length?this.form.get(a):this.form}static{this.\u0275fac=function(f){return new(f||i)(St(td,10),St(bv,10),St(ff,8))}}static{this.\u0275dir=Ni({type:i,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(f,x){f&1&&Wn("submit",function(R){return x.onSubmit(R)})("reset",function(){return x.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[as([eV]),Nr]})}}return i})();function MP(i,s){let a=i.indexOf(s);a>-1&&i.splice(a,1)}function SP(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var lg=class extends uf{constructor(s=null,a,f){super(jC(a),UC(f,a)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(s),this._setUpdateStrategy(a),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),wv(a)&&(a.nonNullable||a.initialValueIsDefault)&&(SP(s)?this.defaultValue=s.value:this.defaultValue=s)}setValue(s,a={}){this.value=this._pendingValue=s,this._onChange.length&&a.emitModelToViewChange!==!1&&this._onChange.forEach(f=>f(this.value,a.emitViewToModelChange!==!1)),this.updateValueAndValidity(a)}patchValue(s,a={}){this.setValue(s,a)}reset(s=this.defaultValue,a={}){this._applyFormState(s),this.markAsPristine(a),this.markAsUntouched(a),this.setValue(this.value,a),this._pendingChange=!1}_updateValue(){}_anyControls(s){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(s){this._onChange.push(s)}_unregisterOnChange(s){MP(this._onChange,s)}registerOnDisabledChange(s){this._onDisabledChange.push(s)}_unregisterOnDisabledChange(s){MP(this._onDisabledChange,s)}_forEachChild(s){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(s){SP(s)?(this.value=this._pendingValue=s.value,s.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=s}};var tV=i=>i instanceof lg;var nV={provide:Ac,useExisting:vo(()=>HC)},TP=Promise.resolve(),HC=(()=>{class i extends Ac{constructor(a,f,x,n,R,$){super(),this._changeDetectorRef=R,this.callSetDisabledState=$,this.control=new lg,this._registered=!1,this.name="",this.update=new qi,this._parent=a,this._setValidators(f),this._setAsyncValidators(x),this.valueAccessor=JP(this,n)}ngOnChanges(a){if(this._checkForErrors(),!this._registered||"name"in a){if(this._registered&&(this._checkName(),this.formDirective)){let f=a.name.previousValue;this.formDirective.removeControl({name:f,path:this._getPath(f)})}this._setUpControl()}"isDisabled"in a&&this._updateDisabled(a),XP(a,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(a){this.viewModel=a,this.update.emit(a)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){_v(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(a){TP.then(()=>{this.control.setValue(a,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(a){let f=a.isDisabled.currentValue,x=f!==0&&Ec(f);TP.then(()=>{x&&!this.control.disabled?this.control.disable():!x&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(a){return this._parent?qP(a,this._parent):[a]}static{this.\u0275fac=function(f){return new(f||i)(St(ol,9),St(td,10),St(bv,10),St(hf,10),St(Qu,8),St(ff,8))}}static{this.\u0275dir=Ni({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[as([nV]),Nr,da]})}}return i})(),jr=(()=>{class i{static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275dir=Ni({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return i})();var iV={provide:hf,useExisting:vo(()=>qC),multi:!0};var rV=(()=>{class i{constructor(){this._accessors=[]}add(a,f){this._accessors.push([a,f])}remove(a){for(let f=this._accessors.length-1;f>=0;--f)if(this._accessors[f][1]===a){this._accessors.splice(f,1);return}}select(a){this._accessors.forEach(f=>{this._isSameGroup(f,a)&&f[1]!==a&&f[1].fireUncheck(a.value)})}_isSameGroup(a,f){return a[0].control?a[0]._parent===f._control._parent&&a[1].name===f.name:!1}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),qC=(()=>{class i extends xv{constructor(a,f,x,n){super(a,f),this._registry=x,this._injector=n,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=Ct(ff,{optional:!0})??cg}ngOnInit(){this._control=this._injector.get(Ac),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(a){this._state=a===this.value,this.setProperty("checked",this._state)}registerOnChange(a){this._fn=a,this.onChange=()=>{a(this.value),this._registry.select(this)}}setDisabledState(a){(this.setDisabledStateFired||a||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",a),this.setDisabledStateFired=!0}fireUncheck(a){this.writeValue(a)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static{this.\u0275fac=function(f){return new(f||i)(St(pa),St(xo),St(rV),St(ts))}}static{this.\u0275dir=Ni({type:i,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(f,x){f&1&&Wn("change",function(){return x.onChange()})("blur",function(){return x.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[as([iV]),Nr]})}}return i})();var KP=new on("");var oV={provide:ol,useExisting:vo(()=>ro)},ro=(()=>{class i extends ol{get submitted(){return ma(this._submittedReactive)}set submitted(a){this._submittedReactive.set(a)}constructor(a,f,x){super(),this.callSetDisabledState=x,this._submitted=rf(()=>this._submittedReactive()),this._submittedReactive=ef(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new qi,this._setValidators(a),this._setAsyncValidators(f)}ngOnChanges(a){this._checkFormPresent(),a.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(vv(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(a){let f=this.form.get(a.path);return _v(f,a,this.callSetDisabledState),f.updateValueAndValidity({emitEvent:!1}),this.directives.push(a),f}getControl(a){return this.form.get(a.path)}removeControl(a){EP(a.control||null,a,!1),Q5(this.directives,a)}addFormGroup(a){this._setUpFormContainer(a)}removeFormGroup(a){this._cleanUpFormContainer(a)}getFormGroup(a){return this.form.get(a.path)}addFormArray(a){this._setUpFormContainer(a)}removeFormArray(a){this._cleanUpFormContainer(a)}getFormArray(a){return this.form.get(a.path)}updateModel(a,f){this.form.get(a.path).setValue(f)}onSubmit(a){return this._submittedReactive.set(!0),YP(this.form,this.directives),this.ngSubmit.emit(a),this.form._events.next(new FC(this.control)),a?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(a=void 0){this.form.reset(a),this._submittedReactive.set(!1),this.form._events.next(new kC(this.form))}_updateDomValue(){this.directives.forEach(a=>{let f=a.control,x=this.form.get(a.path);f!==x&&(EP(f||null,a),tV(x)&&(_v(x,a,this.callSetDisabledState),a.control=x))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(a){let f=this.form.get(a.path);ZP(f,a),f.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(a){if(this.form){let f=this.form.get(a.path);f&&J5(f,a)&&f.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){$C(this.form,this),this._oldForm&&vv(this._oldForm,this)}_checkFormPresent(){this.form}static{this.\u0275fac=function(f){return new(f||i)(St(td,10),St(bv,10),St(ff,8))}}static{this.\u0275dir=Ni({type:i,selectors:[["","formGroup",""]],hostBindings:function(f,x){f&1&&Wn("submit",function(R){return x.onSubmit(R)})("reset",function(){return x.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[as([oV]),Nr,da]})}}return i})();var sV={provide:Ac,useExisting:vo(()=>oo)},oo=(()=>{class i extends Ac{set isDisabled(a){}static{this._ngModelWarningSentOnce=!1}constructor(a,f,x,n,R){super(),this._ngModelWarningConfig=R,this._added=!1,this.name=null,this.update=new qi,this._ngModelWarningSent=!1,this._parent=a,this._setValidators(f),this._setAsyncValidators(x),this.valueAccessor=JP(this,n)}ngOnChanges(a){this._added||this._setUpControl(),XP(a,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(a){this.viewModel=a,this.update.emit(a)}get path(){return qP(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(f){return new(f||i)(St(ol,13),St(td,10),St(bv,10),St(hf,10),St(KP,8))}}static{this.\u0275dir=Ni({type:i,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[as([sV]),Nr,da]})}}return i})(),aV={provide:hf,useExisting:vo(()=>pf),multi:!0};function QP(i,s){return i==null?`${s}`:(s&&typeof s=="object"&&(s="Object"),`${i}: ${s}`.slice(0,50))}function lV(i){return i.split(":")[0]}var pf=(()=>{class i extends xv{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(a){this._compareWith=a}writeValue(a){this.value=a;let f=this._getOptionId(a),x=QP(f,a);this.setProperty("value",x)}registerOnChange(a){this.onChange=f=>{this.value=this._getOptionValue(f),a(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(a){for(let f of this._optionMap.keys())if(this._compareWith(this._optionMap.get(f),a))return f;return null}_getOptionValue(a){let f=lV(a);return this._optionMap.has(f)?this._optionMap.get(f):a}static{this.\u0275fac=(()=>{let a;return function(x){return(a||(a=ha(i)))(x||i)}})()}static{this.\u0275dir=Ni({type:i,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(f,x){f&1&&Wn("change",function(R){return x.onChange(R.target.value)})("blur",function(){return x.onTouched()})},inputs:{compareWith:"compareWith"},features:[as([aV]),Nr]})}}return i})(),Cv=(()=>{class i{constructor(a,f,x){this._element=a,this._renderer=f,this._select=x,this._select&&(this.id=this._select._registerOption())}set ngValue(a){this._select!=null&&(this._select._optionMap.set(this.id,a),this._setElementValue(QP(this.id,a)),this._select.writeValue(this._select.value))}set value(a){this._setElementValue(a),this._select&&this._select.writeValue(this._select.value)}_setElementValue(a){this._renderer.setProperty(this._element.nativeElement,"value",a)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(f){return new(f||i)(St(xo),St(pa),St(pf,9))}}static{this.\u0275dir=Ni({type:i,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return i})(),cV={provide:hf,useExisting:vo(()=>eR),multi:!0};function IP(i,s){return i==null?`${s}`:(typeof s=="string"&&(s=`'${s}'`),s&&typeof s=="object"&&(s="Object"),`${i}: ${s}`.slice(0,50))}function uV(i){return i.split(":")[0]}var eR=(()=>{class i extends xv{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(a){this._compareWith=a}writeValue(a){this.value=a;let f;if(Array.isArray(a)){let x=a.map(n=>this._getOptionId(n));f=(n,R)=>{n._setSelected(x.indexOf(R.toString())>-1)}}else f=(x,n)=>{x._setSelected(!1)};this._optionMap.forEach(f)}registerOnChange(a){this.onChange=f=>{let x=[],n=f.selectedOptions;if(n!==void 0){let R=n;for(let $=0;$<R.length;$++){let G=R[$],se=this._getOptionValue(G.value);x.push(se)}}else{let R=f.options;for(let $=0;$<R.length;$++){let G=R[$];if(G.selected){let se=this._getOptionValue(G.value);x.push(se)}}}this.value=x,a(x)}}_registerOption(a){let f=(this._idCounter++).toString();return this._optionMap.set(f,a),f}_getOptionId(a){for(let f of this._optionMap.keys())if(this._compareWith(this._optionMap.get(f)._value,a))return f;return null}_getOptionValue(a){let f=uV(a);return this._optionMap.has(f)?this._optionMap.get(f)._value:a}static{this.\u0275fac=(()=>{let a;return function(x){return(a||(a=ha(i)))(x||i)}})()}static{this.\u0275dir=Ni({type:i,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(f,x){f&1&&Wn("change",function(R){return x.onChange(R.target)})("blur",function(){return x.onTouched()})},inputs:{compareWith:"compareWith"},features:[as([cV]),Nr]})}}return i})(),Ev=(()=>{class i{constructor(a,f,x){this._element=a,this._renderer=f,this._select=x,this._select&&(this.id=this._select._registerOption(this))}set ngValue(a){this._select!=null&&(this._value=a,this._setElementValue(IP(this.id,a)),this._select.writeValue(this._select.value))}set value(a){this._select?(this._value=a,this._setElementValue(IP(this.id,a)),this._select.writeValue(this._select.value)):this._setElementValue(a)}_setElementValue(a){this._renderer.setProperty(this._element.nativeElement,"value",a)}_setSelected(a){this._renderer.setProperty(this._element.nativeElement,"selected",a)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(f){return new(f||i)(St(xo),St(pa),St(eR,9))}}static{this.\u0275dir=Ni({type:i,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return i})();function tR(i){return typeof i=="number"?i:parseInt(i,10)}var WC=(()=>{class i{constructor(){this._validator=hv}ngOnChanges(a){if(this.inputName in a){let f=this.normalizeInput(a[this.inputName].currentValue);this._enabled=this.enabled(f),this._validator=this._enabled?this.createValidator(f):hv,this._onChange&&this._onChange()}}validate(a){return this._validator(a)}registerOnValidatorChange(a){this._onChange=a}enabled(a){return a!=null}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275dir=Ni({type:i,features:[da]})}}return i})();var dV={provide:td,useExisting:vo(()=>so),multi:!0};var so=(()=>{class i extends WC{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Ec,this.createValidator=a=>RP}enabled(a){return a}static{this.\u0275fac=(()=>{let a;return function(x){return(a||(a=ha(i)))(x||i)}})()}static{this.\u0275dir=Ni({type:i,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(f,x){f&2&&Ju("required",x._enabled?"":null)},inputs:{required:"required"},features:[as([dV]),Nr]})}}return i})();var hV={provide:td,useExisting:vo(()=>ug),multi:!0},ug=(()=>{class i extends WC{constructor(){super(...arguments),this.inputName="minlength",this.normalizeInput=a=>tR(a),this.createValidator=a=>OP(a)}static{this.\u0275fac=(()=>{let a;return function(x){return(a||(a=ha(i)))(x||i)}})()}static{this.\u0275dir=Ni({type:i,selectors:[["","minlength","","formControlName",""],["","minlength","","formControl",""],["","minlength","","ngModel",""]],hostVars:1,hostBindings:function(f,x){f&2&&Ju("minlength",x._enabled?x.minlength:null)},inputs:{minlength:"minlength"},features:[as([hV]),Nr]})}}return i})(),fV={provide:td,useExisting:vo(()=>nd),multi:!0},nd=(()=>{class i extends WC{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=a=>tR(a),this.createValidator=a=>LP(a)}static{this.\u0275fac=(()=>{let a;return function(x){return(a||(a=ha(i)))(x||i)}})()}static{this.\u0275dir=Ni({type:i,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(f,x){f&2&&Ju("maxlength",x._enabled?x.maxlength:null)},inputs:{maxlength:"maxlength"},features:[as([fV]),Nr]})}}return i})();var nR=(()=>{class i{static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275mod=is({type:i})}static{this.\u0275inj=ns({})}}return i})(),zC=class extends uf{constructor(s,a,f){super(jC(a),UC(f,a)),this.controls=s,this._initObservables(),this._setUpdateStrategy(a),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(s){return this.controls[this._adjustIndex(s)]}push(s,a={}){this.controls.push(s),this._registerControl(s),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}insert(s,a,f={}){this.controls.splice(s,0,a),this._registerControl(a),this.updateValueAndValidity({emitEvent:f.emitEvent})}removeAt(s,a={}){let f=this._adjustIndex(s);f<0&&(f=0),this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),this.controls.splice(f,1),this.updateValueAndValidity({emitEvent:a.emitEvent})}setControl(s,a,f={}){let x=this._adjustIndex(s);x<0&&(x=0),this.controls[x]&&this.controls[x]._registerOnCollectionChange(()=>{}),this.controls.splice(x,1),a&&(this.controls.splice(x,0,a),this._registerControl(a)),this.updateValueAndValidity({emitEvent:f.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(s,a={}){HP(this,!1,s),s.forEach((f,x)=>{GP(this,!1,x),this.at(x).setValue(f,{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a)}patchValue(s,a={}){s!=null&&(s.forEach((f,x)=>{this.at(x)&&this.at(x).patchValue(f,{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a))}reset(s=[],a={}){this._forEachChild((f,x)=>{f.reset(s[x],{onlySelf:!0,emitEvent:a.emitEvent})}),this._updatePristine(a,this),this._updateTouched(a,this),this.updateValueAndValidity(a)}getRawValue(){return this.controls.map(s=>s.getRawValue())}clear(s={}){this.controls.length<1||(this._forEachChild(a=>a._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:s.emitEvent}))}_adjustIndex(s){return s<0?s+this.length:s}_syncPendingControls(){let s=this.controls.reduce((a,f)=>f._syncPendingControls()?!0:a,!1);return s&&this.updateValueAndValidity({onlySelf:!0}),s}_forEachChild(s){this.controls.forEach((a,f)=>{s(a,f)})}_updateValue(){this.value=this.controls.filter(s=>s.enabled||this.disabled).map(s=>s.value)}_anyControls(s){return this.controls.some(a=>a.enabled&&s(a))}_setUpControls(){this._forEachChild(s=>this._registerControl(s))}_allControlsDisabled(){for(let s of this.controls)if(s.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(s){s.setParent(this),s._registerOnCollectionChange(this._onCollectionChange)}_find(s){return this.at(s)??null}};function DP(i){return!!i&&(i.asyncValidators!==void 0||i.validators!==void 0||i.updateOn!==void 0)}var bo=(()=>{class i{constructor(){this.useNonNullable=!1}get nonNullable(){let a=new i;return a.useNonNullable=!0,a}group(a,f=null){let x=this._reduceControls(a),n={};return DP(f)?n=f:f!==null&&(n.validators=f.validator,n.asyncValidators=f.asyncValidator),new df(x,n)}record(a,f=null){let x=this._reduceControls(a);return new NC(x,f)}control(a,f,x){let n={};return this.useNonNullable?(DP(f)?n=f:(n.validators=f,n.asyncValidators=x),new lg(a,ei(Mt({},n),{nonNullable:!0}))):new lg(a,f,x)}array(a,f,x){let n=a.map(R=>this._createControl(R));return new zC(n,f,x)}_reduceControls(a){let f={};return Object.keys(a).forEach(x=>{f[x]=this._createControl(a[x])}),f}_createControl(a){if(a instanceof lg)return a;if(a instanceof uf)return a;if(Array.isArray(a)){let f=a[0],x=a.length>1?a[1]:null,n=a.length>2?a[2]:null;return this.control(f,x,n)}else return this.control(a)}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Mv=(()=>{class i{static withConfig(a){return{ngModule:i,providers:[{provide:ff,useValue:a.callSetDisabledState??cg}]}}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275mod=is({type:i})}static{this.\u0275inj=ns({imports:[nR]})}}return i})(),Ji=(()=>{class i{static withConfig(a){return{ngModule:i,providers:[{provide:KP,useValue:a.warnOnNgModelWithFormControl??"always"},{provide:ff,useValue:a.callSetDisabledState??cg}]}}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275mod=is({type:i})}static{this.\u0275inj=ns({imports:[nR]})}}return i})();var $n="primary",Mg=Symbol("RouteTitle"),KC=class{constructor(s){this.params=s||{}}has(s){return Object.prototype.hasOwnProperty.call(this.params,s)}get(s){if(this.has(s)){let a=this.params[s];return Array.isArray(a)?a[0]:a}return null}getAll(s){if(this.has(s)){let a=this.params[s];return Array.isArray(a)?a:[a]}return[]}get keys(){return Object.keys(this.params)}};function xf(i){return new KC(i)}function pV(i,s,a){let f=a.path.split("/");if(f.length>i.length||a.pathMatch==="full"&&(s.hasChildren()||f.length<i.length))return null;let x={};for(let n=0;n<f.length;n++){let R=f[n],$=i[n];if(R[0]===":")x[R.substring(1)]=$;else if(R!==$.path)return null}return{consumed:i.slice(0,f.length),posParams:x}}function mV(i,s){if(i.length!==s.length)return!1;for(let a=0;a<i.length;++a)if(!ga(i[a],s[a]))return!1;return!0}function ga(i,s){let a=i?QC(i):void 0,f=s?QC(s):void 0;if(!a||!f||a.length!=f.length)return!1;let x;for(let n=0;n<a.length;n++)if(x=a[n],!fR(i[x],s[x]))return!1;return!0}function QC(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function fR(i,s){if(Array.isArray(i)&&Array.isArray(s)){if(i.length!==s.length)return!1;let a=[...i].sort(),f=[...s].sort();return a.every((x,n)=>f[n]===x)}else return i===s}function pR(i){return i.length>0?i[i.length-1]:null}function Lc(i){return pb(i)?i:Ku(i)?ki(Promise.resolve(i)):vn(i)}var gV={exact:gR,subset:_R},mR={exact:_V,subset:yV,ignored:()=>!0};function iR(i,s,a){return gV[a.paths](i.root,s.root,a.matrixParams)&&mR[a.queryParams](i.queryParams,s.queryParams)&&!(a.fragment==="exact"&&i.fragment!==s.fragment)}function _V(i,s){return ga(i,s)}function gR(i,s,a){if(!rd(i.segments,s.segments)||!Iv(i.segments,s.segments,a)||i.numberOfChildren!==s.numberOfChildren)return!1;for(let f in s.children)if(!i.children[f]||!gR(i.children[f],s.children[f],a))return!1;return!0}function yV(i,s){return Object.keys(s).length<=Object.keys(i).length&&Object.keys(s).every(a=>fR(i[a],s[a]))}function _R(i,s,a){return yR(i,s,s.segments,a)}function yR(i,s,a,f){if(i.segments.length>a.length){let x=i.segments.slice(0,a.length);return!(!rd(x,a)||s.hasChildren()||!Iv(x,a,f))}else if(i.segments.length===a.length){if(!rd(i.segments,a)||!Iv(i.segments,a,f))return!1;for(let x in s.children)if(!i.children[x]||!_R(i.children[x],s.children[x],f))return!1;return!0}else{let x=a.slice(0,i.segments.length),n=a.slice(i.segments.length);return!rd(i.segments,x)||!Iv(i.segments,x,f)||!i.children[$n]?!1:yR(i.children[$n],s,n,f)}}function Iv(i,s,a){return s.every((f,x)=>mR[a](i[x].parameters,f.parameters))}var al=class{constructor(s=new wi([],{}),a={},f=null){this.root=s,this.queryParams=a,this.fragment=f}get queryParamMap(){return this._queryParamMap??=xf(this.queryParams),this._queryParamMap}toString(){return bV.serialize(this)}},wi=class{constructor(s,a){this.segments=s,this.children=a,this.parent=null,Object.values(a).forEach(f=>f.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Dv(this)}},id=class{constructor(s,a){this.path=s,this.parameters=a}get parameterMap(){return this._parameterMap??=xf(this.parameters),this._parameterMap}toString(){return xR(this)}};function vV(i,s){return rd(i,s)&&i.every((a,f)=>ga(a.parameters,s[f].parameters))}function rd(i,s){return i.length!==s.length?!1:i.every((a,f)=>a.path===s[f].path)}function xV(i,s){let a=[];return Object.entries(i.children).forEach(([f,x])=>{f===$n&&(a=a.concat(s(x,f)))}),Object.entries(i.children).forEach(([f,x])=>{f!==$n&&(a=a.concat(s(x,f)))}),a}var Sg=(()=>{class i{static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:()=>new bf,providedIn:"root"})}}return i})(),bf=class{parse(s){let a=new tE(s);return new al(a.parseRootSegment(),a.parseQueryParams(),a.parseFragment())}serialize(s){let a=`/${dg(s.root,!0)}`,f=EV(s.queryParams),x=typeof s.fragment=="string"?`#${wV(s.fragment)}`:"";return`${a}${f}${x}`}},bV=new bf;function Dv(i){return i.segments.map(s=>xR(s)).join("/")}function dg(i,s){if(!i.hasChildren())return Dv(i);if(s){let a=i.children[$n]?dg(i.children[$n],!1):"",f=[];return Object.entries(i.children).forEach(([x,n])=>{x!==$n&&f.push(`${x}:${dg(n,!1)}`)}),f.length>0?`${a}(${f.join("//")})`:a}else{let a=xV(i,(f,x)=>x===$n?[dg(i.children[$n],!1)]:[`${x}:${dg(f,!1)}`]);return Object.keys(i.children).length===1&&i.children[$n]!=null?`${Dv(i)}/${a[0]}`:`${Dv(i)}/(${a.join("//")})`}}function vR(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Sv(i){return vR(i).replace(/%3B/gi,";")}function wV(i){return encodeURI(i)}function eE(i){return vR(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Av(i){return decodeURIComponent(i)}function rR(i){return Av(i.replace(/\+/g,"%20"))}function xR(i){return`${eE(i.path)}${CV(i.parameters)}`}function CV(i){return Object.entries(i).map(([s,a])=>`;${eE(s)}=${eE(a)}`).join("")}function EV(i){let s=Object.entries(i).map(([a,f])=>Array.isArray(f)?f.map(x=>`${Sv(a)}=${Sv(x)}`).join("&"):`${Sv(a)}=${Sv(f)}`).filter(a=>a);return s.length?`?${s.join("&")}`:""}var MV=/^[^\/()?;#]+/;function ZC(i){let s=i.match(MV);return s?s[0]:""}var SV=/^[^\/()?;=#]+/;function TV(i){let s=i.match(SV);return s?s[0]:""}var IV=/^[^=?&#]+/;function DV(i){let s=i.match(IV);return s?s[0]:""}var AV=/^[^&#]+/;function PV(i){let s=i.match(AV);return s?s[0]:""}var tE=class{constructor(s){this.url=s,this.remaining=s}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new wi([],{}):new wi([],this.parseChildren())}parseQueryParams(){let s={};if(this.consumeOptional("?"))do this.parseQueryParam(s);while(this.consumeOptional("&"));return s}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let s=[];for(this.peekStartsWith("(")||s.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),s.push(this.parseSegment());let a={};this.peekStartsWith("/(")&&(this.capture("/"),a=this.parseParens(!0));let f={};return this.peekStartsWith("(")&&(f=this.parseParens(!1)),(s.length>0||Object.keys(a).length>0)&&(f[$n]=new wi(s,a)),f}parseSegment(){let s=ZC(this.remaining);if(s===""&&this.peekStartsWith(";"))throw new hn(4009,!1);return this.capture(s),new id(Av(s),this.parseMatrixParams())}parseMatrixParams(){let s={};for(;this.consumeOptional(";");)this.parseParam(s);return s}parseParam(s){let a=TV(this.remaining);if(!a)return;this.capture(a);let f="";if(this.consumeOptional("=")){let x=ZC(this.remaining);x&&(f=x,this.capture(f))}s[Av(a)]=Av(f)}parseQueryParam(s){let a=DV(this.remaining);if(!a)return;this.capture(a);let f="";if(this.consumeOptional("=")){let R=PV(this.remaining);R&&(f=R,this.capture(f))}let x=rR(a),n=rR(f);if(s.hasOwnProperty(x)){let R=s[x];Array.isArray(R)||(R=[R],s[x]=R),R.push(n)}else s[x]=n}parseParens(s){let a={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let f=ZC(this.remaining),x=this.remaining[f.length];if(x!=="/"&&x!==")"&&x!==";")throw new hn(4010,!1);let n;f.indexOf(":")>-1?(n=f.slice(0,f.indexOf(":")),this.capture(n),this.capture(":")):s&&(n=$n);let R=this.parseChildren();a[n]=Object.keys(R).length===1?R[$n]:new wi([],R),this.consumeOptional("//")}return a}peekStartsWith(s){return this.remaining.startsWith(s)}consumeOptional(s){return this.peekStartsWith(s)?(this.remaining=this.remaining.substring(s.length),!0):!1}capture(s){if(!this.consumeOptional(s))throw new hn(4011,!1)}};function bR(i){return i.segments.length>0?new wi([],{[$n]:i}):i}function wR(i){let s={};for(let[f,x]of Object.entries(i.children)){let n=wR(x);if(f===$n&&n.segments.length===0&&n.hasChildren())for(let[R,$]of Object.entries(n.children))s[R]=$;else(n.segments.length>0||n.hasChildren())&&(s[f]=n)}let a=new wi(i.segments,s);return RV(a)}function RV(i){if(i.numberOfChildren===1&&i.children[$n]){let s=i.children[$n];return new wi(i.segments.concat(s.segments),s.children)}return i}function od(i){return i instanceof al}function OV(i,s,a=null,f=null){let x=CR(i);return ER(x,s,a,f)}function CR(i){let s;function a(n){let R={};for(let G of n.children){let se=a(G);R[G.outlet]=se}let $=new wi(n.url,R);return n===i&&(s=$),$}let f=a(i.root),x=bR(f);return s??x}function ER(i,s,a,f){let x=i;for(;x.parent;)x=x.parent;if(s.length===0)return XC(x,x,x,a,f);let n=LV(s);if(n.toRoot())return XC(x,x,new wi([],{}),a,f);let R=FV(n,x,i),$=R.processChildren?pg(R.segmentGroup,R.index,n.commands):SR(R.segmentGroup,R.index,n.commands);return XC(x,R.segmentGroup,$,a,f)}function Pv(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function _g(i){return typeof i=="object"&&i!=null&&i.outlets}function XC(i,s,a,f,x){let n={};f&&Object.entries(f).forEach(([G,se])=>{n[G]=Array.isArray(se)?se.map(Me=>`${Me}`):`${se}`});let R;i===s?R=a:R=MR(i,s,a);let $=bR(wR(R));return new al($,n,x)}function MR(i,s,a){let f={};return Object.entries(i.children).forEach(([x,n])=>{n===s?f[x]=a:f[x]=MR(n,s,a)}),new wi(i.segments,f)}var Rv=class{constructor(s,a,f){if(this.isAbsolute=s,this.numberOfDoubleDots=a,this.commands=f,s&&f.length>0&&Pv(f[0]))throw new hn(4003,!1);let x=f.find(_g);if(x&&x!==pR(f))throw new hn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function LV(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new Rv(!0,0,i);let s=0,a=!1,f=i.reduce((x,n,R)=>{if(typeof n=="object"&&n!=null){if(n.outlets){let $={};return Object.entries(n.outlets).forEach(([G,se])=>{$[G]=typeof se=="string"?se.split("/"):se}),[...x,{outlets:$}]}if(n.segmentPath)return[...x,n.segmentPath]}return typeof n!="string"?[...x,n]:R===0?(n.split("/").forEach(($,G)=>{G==0&&$==="."||(G==0&&$===""?a=!0:$===".."?s++:$!=""&&x.push($))}),x):[...x,n]},[]);return new Rv(a,s,f)}var _f=class{constructor(s,a,f){this.segmentGroup=s,this.processChildren=a,this.index=f}};function FV(i,s,a){if(i.isAbsolute)return new _f(s,!0,0);if(!a)return new _f(s,!1,NaN);if(a.parent===null)return new _f(a,!0,0);let f=Pv(i.commands[0])?0:1,x=a.segments.length-1+f;return kV(a,x,i.numberOfDoubleDots)}function kV(i,s,a){let f=i,x=s,n=a;for(;n>x;){if(n-=x,f=f.parent,!f)throw new hn(4005,!1);x=f.segments.length}return new _f(f,!1,x-n)}function NV(i){return _g(i[0])?i[0].outlets:{[$n]:i}}function SR(i,s,a){if(i??=new wi([],{}),i.segments.length===0&&i.hasChildren())return pg(i,s,a);let f=zV(i,s,a),x=a.slice(f.commandIndex);if(f.match&&f.pathIndex<i.segments.length){let n=new wi(i.segments.slice(0,f.pathIndex),{});return n.children[$n]=new wi(i.segments.slice(f.pathIndex),i.children),pg(n,0,x)}else return f.match&&x.length===0?new wi(i.segments,{}):f.match&&!i.hasChildren()?nE(i,s,a):f.match?pg(i,0,x):nE(i,s,a)}function pg(i,s,a){if(a.length===0)return new wi(i.segments,{});{let f=NV(a),x={};if(Object.keys(f).some(n=>n!==$n)&&i.children[$n]&&i.numberOfChildren===1&&i.children[$n].segments.length===0){let n=pg(i.children[$n],s,a);return new wi(i.segments,n.children)}return Object.entries(f).forEach(([n,R])=>{typeof R=="string"&&(R=[R]),R!==null&&(x[n]=SR(i.children[n],s,R))}),Object.entries(i.children).forEach(([n,R])=>{f[n]===void 0&&(x[n]=R)}),new wi(i.segments,x)}}function zV(i,s,a){let f=0,x=s,n={match:!1,pathIndex:0,commandIndex:0};for(;x<i.segments.length;){if(f>=a.length)return n;let R=i.segments[x],$=a[f];if(_g($))break;let G=`${$}`,se=f<a.length-1?a[f+1]:null;if(x>0&&G===void 0)break;if(G&&se&&typeof se=="object"&&se.outlets===void 0){if(!sR(G,se,R))return n;f+=2}else{if(!sR(G,{},R))return n;f++}x++}return{match:!0,pathIndex:x,commandIndex:f}}function nE(i,s,a){let f=i.segments.slice(0,s),x=0;for(;x<a.length;){let n=a[x];if(_g(n)){let G=BV(n.outlets);return new wi(f,G)}if(x===0&&Pv(a[0])){let G=i.segments[s];f.push(new id(G.path,oR(a[0]))),x++;continue}let R=_g(n)?n.outlets[$n]:`${n}`,$=x<a.length-1?a[x+1]:null;R&&$&&Pv($)?(f.push(new id(R,oR($))),x+=2):(f.push(new id(R,{})),x++)}return new wi(f,{})}function BV(i){let s={};return Object.entries(i).forEach(([a,f])=>{typeof f=="string"&&(f=[f]),f!==null&&(s[a]=nE(new wi([],{}),0,f))}),s}function oR(i){let s={};return Object.entries(i).forEach(([a,f])=>s[a]=`${f}`),s}function sR(i,s,a){return i==a.path&&ga(s,a.parameters)}var mg="imperative",xr=function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i}(xr||{}),ls=class{constructor(s,a){this.id=s,this.url=a}},wf=class extends ls{constructor(s,a,f="imperative",x=null){super(s,a),this.type=xr.NavigationStart,this.navigationTrigger=f,this.restoredState=x}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},_a=class extends ls{constructor(s,a,f){super(s,a),this.urlAfterRedirects=f,this.type=xr.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Bo=function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i}(Bo||{}),Ov=function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i}(Ov||{}),sl=class extends ls{constructor(s,a,f,x){super(s,a),this.reason=f,this.code=x,this.type=xr.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Oc=class extends ls{constructor(s,a,f,x){super(s,a),this.reason=f,this.code=x,this.type=xr.NavigationSkipped}},yg=class extends ls{constructor(s,a,f,x){super(s,a),this.error=f,this.target=x,this.type=xr.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Lv=class extends ls{constructor(s,a,f,x){super(s,a),this.urlAfterRedirects=f,this.state=x,this.type=xr.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},iE=class extends ls{constructor(s,a,f,x){super(s,a),this.urlAfterRedirects=f,this.state=x,this.type=xr.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rE=class extends ls{constructor(s,a,f,x,n){super(s,a),this.urlAfterRedirects=f,this.state=x,this.shouldActivate=n,this.type=xr.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},oE=class extends ls{constructor(s,a,f,x){super(s,a),this.urlAfterRedirects=f,this.state=x,this.type=xr.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sE=class extends ls{constructor(s,a,f,x){super(s,a),this.urlAfterRedirects=f,this.state=x,this.type=xr.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},aE=class{constructor(s){this.route=s,this.type=xr.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},lE=class{constructor(s){this.route=s,this.type=xr.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},cE=class{constructor(s){this.snapshot=s,this.type=xr.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},uE=class{constructor(s){this.snapshot=s,this.type=xr.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},dE=class{constructor(s){this.snapshot=s,this.type=xr.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},hE=class{constructor(s){this.snapshot=s,this.type=xr.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Fv=class{constructor(s,a,f){this.routerEvent=s,this.position=a,this.anchor=f,this.type=xr.Scroll}toString(){let s=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${s}')`}},vg=class{},Cf=class{constructor(s,a){this.url=s,this.navigationBehaviorOptions=a}};function VV(i,s){return i.providers&&!i._injector&&(i._injector=Y0(i.providers,s,`Route: ${i.path}`)),i._injector??s}function Vs(i){return i.outlet||$n}function jV(i,s){let a=i.filter(f=>Vs(f)===s);return a.push(...i.filter(f=>Vs(f)!==s)),a}function Tg(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let s=i.parent;s;s=s.parent){let a=s.routeConfig;if(a?._loadedInjector)return a._loadedInjector;if(a?._injector)return a._injector}return null}var fE=class{get injector(){return Tg(this.route?.snapshot)??this.rootInjector}set injector(s){}constructor(s){this.rootInjector=s,this.outlet=null,this.route=null,this.children=new Ig(this.rootInjector),this.attachRef=null}},Ig=(()=>{class i{constructor(a){this.rootInjector=a,this.contexts=new Map}onChildOutletCreated(a,f){let x=this.getOrCreateContext(a);x.outlet=f,this.contexts.set(a,x)}onChildOutletDestroyed(a){let f=this.getContext(a);f&&(f.outlet=null,f.attachRef=null)}onOutletDeactivated(){let a=this.contexts;return this.contexts=new Map,a}onOutletReAttached(a){this.contexts=a}getOrCreateContext(a){let f=this.getContext(a);return f||(f=new fE(this.rootInjector),this.contexts.set(a,f)),f}getContext(a){return this.contexts.get(a)||null}static{this.\u0275fac=function(f){return new(f||i)(sn(to))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),kv=class{constructor(s){this._root=s}get root(){return this._root.value}parent(s){let a=this.pathFromRoot(s);return a.length>1?a[a.length-2]:null}children(s){let a=pE(s,this._root);return a?a.children.map(f=>f.value):[]}firstChild(s){let a=pE(s,this._root);return a&&a.children.length>0?a.children[0].value:null}siblings(s){let a=mE(s,this._root);return a.length<2?[]:a[a.length-2].children.map(x=>x.value).filter(x=>x!==s)}pathFromRoot(s){return mE(s,this._root).map(a=>a.value)}};function pE(i,s){if(i===s.value)return s;for(let a of s.children){let f=pE(i,a);if(f)return f}return null}function mE(i,s){if(i===s.value)return[s];for(let a of s.children){let f=mE(i,a);if(f.length)return f.unshift(s),f}return[]}var zo=class{constructor(s,a){this.value=s,this.children=a}toString(){return`TreeNode(${this.value})`}};function gf(i){let s={};return i&&i.children.forEach(a=>s[a.value.outlet]=a),s}var Nv=class extends kv{constructor(s,a){super(s),this.snapshot=a,EE(this,s)}toString(){return this.snapshot.toString()}};function TR(i){let s=UV(i),a=new Ir([new id("",{})]),f=new Ir({}),x=new Ir({}),n=new Ir({}),R=new Ir(""),$=new ya(a,f,n,R,x,$n,i,s.root);return $.snapshot=s.root,new Nv(new zo($,[]),s)}function UV(i){let s={},a={},f={},x="",n=new yf([],s,f,x,a,$n,i,null,{});return new Bv("",new zo(n,[]))}var ya=class{constructor(s,a,f,x,n,R,$,G){this.urlSubject=s,this.paramsSubject=a,this.queryParamsSubject=f,this.fragmentSubject=x,this.dataSubject=n,this.outlet=R,this.component=$,this._futureSnapshot=G,this.title=this.dataSubject?.pipe(jn(se=>se[Mg]))??vn(void 0),this.url=s,this.params=a,this.queryParams=f,this.fragment=x,this.data=n}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(jn(s=>xf(s))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(jn(s=>xf(s))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function zv(i,s,a="emptyOnly"){let f,{routeConfig:x}=i;return s!==null&&(a==="always"||x?.path===""||!s.component&&!s.routeConfig?.loadComponent)?f={params:Mt(Mt({},s.params),i.params),data:Mt(Mt({},s.data),i.data),resolve:Mt(Mt(Mt(Mt({},i.data),s.data),x?.data),i._resolvedData)}:f={params:Mt({},i.params),data:Mt({},i.data),resolve:Mt(Mt({},i.data),i._resolvedData??{})},x&&DR(x)&&(f.resolve[Mg]=x.title),f}var yf=class{get title(){return this.data?.[Mg]}constructor(s,a,f,x,n,R,$,G,se){this.url=s,this.params=a,this.queryParams=f,this.fragment=x,this.data=n,this.outlet=R,this.component=$,this.routeConfig=G,this._resolve=se}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=xf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=xf(this.queryParams),this._queryParamMap}toString(){let s=this.url.map(f=>f.toString()).join("/"),a=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${s}', path:'${a}')`}},Bv=class extends kv{constructor(s,a){super(a),this.url=s,EE(this,a)}toString(){return IR(this._root)}};function EE(i,s){s.value._routerState=i,s.children.forEach(a=>EE(i,a))}function IR(i){let s=i.children.length>0?` { ${i.children.map(IR).join(", ")} } `:"";return`${i.value}${s}`}function YC(i){if(i.snapshot){let s=i.snapshot,a=i._futureSnapshot;i.snapshot=a,ga(s.queryParams,a.queryParams)||i.queryParamsSubject.next(a.queryParams),s.fragment!==a.fragment&&i.fragmentSubject.next(a.fragment),ga(s.params,a.params)||i.paramsSubject.next(a.params),mV(s.url,a.url)||i.urlSubject.next(a.url),ga(s.data,a.data)||i.dataSubject.next(a.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function gE(i,s){let a=ga(i.params,s.params)&&vV(i.url,s.url),f=!i.parent!=!s.parent;return a&&!f&&(!i.parent||gE(i.parent,s.parent))}function DR(i){return typeof i.title=="string"||i.title===null}var ME=(()=>{class i{constructor(){this.activated=null,this._activatedRoute=null,this.name=$n,this.activateEvents=new qi,this.deactivateEvents=new qi,this.attachEvents=new qi,this.detachEvents=new qi,this.parentContexts=Ct(Ig),this.location=Ct(Yu),this.changeDetector=Ct(Qu),this.inputBinder=Ct($v,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(a){if(a.name){let{firstChange:f,previousValue:x}=a.name;if(f)return;this.isTrackedInParentContexts(x)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(x)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(a){return this.parentContexts.getContext(a)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let a=this.parentContexts.getContext(this.name);a?.route&&(a.attachRef?this.attach(a.attachRef,a.route):this.activateWith(a.route,a.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new hn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new hn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new hn(4012,!1);this.location.detach();let a=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(a.instance),a}attach(a,f){this.activated=a,this._activatedRoute=f,this.location.insert(a.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(a.instance)}deactivate(){if(this.activated){let a=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(a)}}activateWith(a,f){if(this.isActivated)throw new hn(4013,!1);this._activatedRoute=a;let x=this.location,R=a.snapshot.component,$=this.parentContexts.getOrCreateContext(this.name).children,G=new _E(a,$,x.injector);this.activated=x.createComponent(R,{index:x.length,injector:G,environmentInjector:f}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275dir=Ni({type:i,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[da]})}}return i})(),_E=class i{__ngOutletInjector(s){return new i(this.route,this.childContexts,s)}constructor(s,a,f){this.route=s,this.childContexts=a,this.parent=f}get(s,a){return s===ya?this.route:s===Ig?this.childContexts:this.parent.get(s,a)}},$v=new on(""),aR=(()=>{class i{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(a){this.unsubscribeFromRouteData(a),this.subscribeToRouteData(a)}unsubscribeFromRouteData(a){this.outletDataSubscriptions.get(a)?.unsubscribe(),this.outletDataSubscriptions.delete(a)}subscribeToRouteData(a){let{activatedRoute:f}=a,x=Im([f.queryParams,f.params,f.data]).pipe(yo(([n,R,$],G)=>($=Mt(Mt(Mt({},n),R),$),G===0?vn($):Promise.resolve($)))).subscribe(n=>{if(!a.isActivated||!a.activatedComponentRef||a.activatedRoute!==f||f.component===null){this.unsubscribeFromRouteData(a);return}let R=GA(f.component);if(!R){this.unsubscribeFromRouteData(a);return}for(let{templateName:$}of R.inputs)a.activatedComponentRef.setInput($,n[$])});this.outletDataSubscriptions.set(a,x)}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})();function $V(i,s,a){let f=xg(i,s._root,a?a._root:void 0);return new Nv(f,s)}function xg(i,s,a){if(a&&i.shouldReuseRoute(s.value,a.value.snapshot)){let f=a.value;f._futureSnapshot=s.value;let x=GV(i,s,a);return new zo(f,x)}else{if(i.shouldAttach(s.value)){let n=i.retrieve(s.value);if(n!==null){let R=n.route;return R.value._futureSnapshot=s.value,R.children=s.children.map($=>xg(i,$)),R}}let f=HV(s.value),x=s.children.map(n=>xg(i,n));return new zo(f,x)}}function GV(i,s,a){return s.children.map(f=>{for(let x of a.children)if(i.shouldReuseRoute(f.value,x.value.snapshot))return xg(i,f,x);return xg(i,f)})}function HV(i){return new ya(new Ir(i.url),new Ir(i.params),new Ir(i.queryParams),new Ir(i.fragment),new Ir(i.data),i.outlet,i.component,i)}var bg=class{constructor(s,a){this.redirectTo=s,this.navigationBehaviorOptions=a}},AR="ngNavigationCancelingError";function Vv(i,s){let{redirectTo:a,navigationBehaviorOptions:f}=od(s)?{redirectTo:s,navigationBehaviorOptions:void 0}:s,x=PR(!1,Bo.Redirect);return x.url=a,x.navigationBehaviorOptions=f,x}function PR(i,s){let a=new Error(`NavigationCancelingError: ${i||""}`);return a[AR]=!0,a.cancellationCode=s,a}function qV(i){return RR(i)&&od(i.url)}function RR(i){return!!i&&i[AR]}var WV=(i,s,a,f)=>jn(x=>(new yE(s,x.targetRouterState,x.currentRouterState,a,f).activate(i),x)),yE=class{constructor(s,a,f,x,n){this.routeReuseStrategy=s,this.futureState=a,this.currState=f,this.forwardEvent=x,this.inputBindingEnabled=n}activate(s){let a=this.futureState._root,f=this.currState?this.currState._root:null;this.deactivateChildRoutes(a,f,s),YC(this.futureState.root),this.activateChildRoutes(a,f,s)}deactivateChildRoutes(s,a,f){let x=gf(a);s.children.forEach(n=>{let R=n.value.outlet;this.deactivateRoutes(n,x[R],f),delete x[R]}),Object.values(x).forEach(n=>{this.deactivateRouteAndItsChildren(n,f)})}deactivateRoutes(s,a,f){let x=s.value,n=a?a.value:null;if(x===n)if(x.component){let R=f.getContext(x.outlet);R&&this.deactivateChildRoutes(s,a,R.children)}else this.deactivateChildRoutes(s,a,f);else n&&this.deactivateRouteAndItsChildren(a,f)}deactivateRouteAndItsChildren(s,a){s.value.component&&this.routeReuseStrategy.shouldDetach(s.value.snapshot)?this.detachAndStoreRouteSubtree(s,a):this.deactivateRouteAndOutlet(s,a)}detachAndStoreRouteSubtree(s,a){let f=a.getContext(s.value.outlet),x=f&&s.value.component?f.children:a,n=gf(s);for(let R of Object.values(n))this.deactivateRouteAndItsChildren(R,x);if(f&&f.outlet){let R=f.outlet.detach(),$=f.children.onOutletDeactivated();this.routeReuseStrategy.store(s.value.snapshot,{componentRef:R,route:s,contexts:$})}}deactivateRouteAndOutlet(s,a){let f=a.getContext(s.value.outlet),x=f&&s.value.component?f.children:a,n=gf(s);for(let R of Object.values(n))this.deactivateRouteAndItsChildren(R,x);f&&(f.outlet&&(f.outlet.deactivate(),f.children.onOutletDeactivated()),f.attachRef=null,f.route=null)}activateChildRoutes(s,a,f){let x=gf(a);s.children.forEach(n=>{this.activateRoutes(n,x[n.value.outlet],f),this.forwardEvent(new hE(n.value.snapshot))}),s.children.length&&this.forwardEvent(new uE(s.value.snapshot))}activateRoutes(s,a,f){let x=s.value,n=a?a.value:null;if(YC(x),x===n)if(x.component){let R=f.getOrCreateContext(x.outlet);this.activateChildRoutes(s,a,R.children)}else this.activateChildRoutes(s,a,f);else if(x.component){let R=f.getOrCreateContext(x.outlet);if(this.routeReuseStrategy.shouldAttach(x.snapshot)){let $=this.routeReuseStrategy.retrieve(x.snapshot);this.routeReuseStrategy.store(x.snapshot,null),R.children.onOutletReAttached($.contexts),R.attachRef=$.componentRef,R.route=$.route.value,R.outlet&&R.outlet.attach($.componentRef,$.route.value),YC($.route.value),this.activateChildRoutes(s,null,R.children)}else R.attachRef=null,R.route=x,R.outlet&&R.outlet.activateWith(x,R.injector),this.activateChildRoutes(s,null,R.children)}else this.activateChildRoutes(s,null,f)}},jv=class{constructor(s){this.path=s,this.route=this.path[this.path.length-1]}},vf=class{constructor(s,a){this.component=s,this.route=a}};function ZV(i,s,a){let f=i._root,x=s?s._root:null;return hg(f,x,a,[f.value])}function XV(i){let s=i.routeConfig?i.routeConfig.canActivateChild:null;return!s||s.length===0?null:{node:i,guards:s}}function Mf(i,s){let a=Symbol(),f=s.get(i,a);return f===a?typeof i=="function"&&!ID(i)?i:s.get(i):f}function hg(i,s,a,f,x={canDeactivateChecks:[],canActivateChecks:[]}){let n=gf(s);return i.children.forEach(R=>{YV(R,n[R.value.outlet],a,f.concat([R.value]),x),delete n[R.value.outlet]}),Object.entries(n).forEach(([R,$])=>gg($,a.getContext(R),x)),x}function YV(i,s,a,f,x={canDeactivateChecks:[],canActivateChecks:[]}){let n=i.value,R=s?s.value:null,$=a?a.getContext(i.value.outlet):null;if(R&&n.routeConfig===R.routeConfig){let G=JV(R,n,n.routeConfig.runGuardsAndResolvers);G?x.canActivateChecks.push(new jv(f)):(n.data=R.data,n._resolvedData=R._resolvedData),n.component?hg(i,s,$?$.children:null,f,x):hg(i,s,a,f,x),G&&$&&$.outlet&&$.outlet.isActivated&&x.canDeactivateChecks.push(new vf($.outlet.component,R))}else R&&gg(s,$,x),x.canActivateChecks.push(new jv(f)),n.component?hg(i,null,$?$.children:null,f,x):hg(i,null,a,f,x);return x}function JV(i,s,a){if(typeof a=="function")return a(i,s);switch(a){case"pathParamsChange":return!rd(i.url,s.url);case"pathParamsOrQueryParamsChange":return!rd(i.url,s.url)||!ga(i.queryParams,s.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!gE(i,s)||!ga(i.queryParams,s.queryParams);case"paramsChange":default:return!gE(i,s)}}function gg(i,s,a){let f=gf(i),x=i.value;Object.entries(f).forEach(([n,R])=>{x.component?s?gg(R,s.children.getContext(n),a):gg(R,null,a):gg(R,s,a)}),x.component?s&&s.outlet&&s.outlet.isActivated?a.canDeactivateChecks.push(new vf(s.outlet.component,x)):a.canDeactivateChecks.push(new vf(null,x)):a.canDeactivateChecks.push(new vf(null,x))}function Dg(i){return typeof i=="function"}function KV(i){return typeof i=="boolean"}function QV(i){return i&&Dg(i.canLoad)}function ej(i){return i&&Dg(i.canActivate)}function tj(i){return i&&Dg(i.canActivateChild)}function nj(i){return i&&Dg(i.canDeactivate)}function ij(i){return i&&Dg(i.canMatch)}function OR(i){return i instanceof Ga||i?.name==="EmptyError"}var Tv=Symbol("INITIAL_VALUE");function Ef(){return yo(i=>Im(i.map(s=>s.pipe(qa(1),vb(Tv)))).pipe(jn(s=>{for(let a of s)if(a!==!0){if(a===Tv)return Tv;if(a===!1||rj(a))return a}return!0}),_o(s=>s!==Tv),qa(1)))}function rj(i){return od(i)||i instanceof bg}function oj(i,s){return or(a=>{let{targetSnapshot:f,currentSnapshot:x,guards:{canActivateChecks:n,canDeactivateChecks:R}}=a;return R.length===0&&n.length===0?vn(ei(Mt({},a),{guardsResult:!0})):sj(R,f,x,i).pipe(or($=>$&&KV($)?aj(f,n,i,s):vn($)),jn($=>ei(Mt({},a),{guardsResult:$})))})}function sj(i,s,a,f){return ki(i).pipe(or(x=>hj(x.component,x.route,a,s,f)),ra(x=>x!==!0,!0))}function aj(i,s,a,f){return ki(s).pipe(Ha(x=>Dh(cj(x.route.parent,f),lj(x.route,f),dj(i,x.path,a),uj(i,x.route,a))),ra(x=>x!==!0,!0))}function lj(i,s){return i!==null&&s&&s(new dE(i)),vn(!0)}function cj(i,s){return i!==null&&s&&s(new cE(i)),vn(!0)}function uj(i,s,a){let f=s.routeConfig?s.routeConfig.canActivate:null;if(!f||f.length===0)return vn(!0);let x=f.map(n=>Ky(()=>{let R=Tg(s)??a,$=Mf(n,R),G=ej($)?$.canActivate(s,i):rs(R,()=>$(s,i));return Lc(G).pipe(ra())}));return vn(x).pipe(Ef())}function dj(i,s,a){let f=s[s.length-1],n=s.slice(0,s.length-1).reverse().map(R=>XV(R)).filter(R=>R!==null).map(R=>Ky(()=>{let $=R.guards.map(G=>{let se=Tg(R.node)??a,Me=Mf(G,se),ke=tj(Me)?Me.canActivateChild(f,i):rs(se,()=>Me(f,i));return Lc(ke).pipe(ra())});return vn($).pipe(Ef())}));return vn(n).pipe(Ef())}function hj(i,s,a,f,x){let n=s&&s.routeConfig?s.routeConfig.canDeactivate:null;if(!n||n.length===0)return vn(!0);let R=n.map($=>{let G=Tg(s)??x,se=Mf($,G),Me=nj(se)?se.canDeactivate(i,s,a,f):rs(G,()=>se(i,s,a,f));return Lc(Me).pipe(ra())});return vn(R).pipe(Ef())}function fj(i,s,a,f){let x=s.canLoad;if(x===void 0||x.length===0)return vn(!0);let n=x.map(R=>{let $=Mf(R,i),G=QV($)?$.canLoad(s,a):rs(i,()=>$(s,a));return Lc(G)});return vn(n).pipe(Ef(),LR(f))}function LR(i){return ub(yr(s=>{if(typeof s!="boolean")throw Vv(i,s)}),jn(s=>s===!0))}function pj(i,s,a,f){let x=s.canMatch;if(!x||x.length===0)return vn(!0);let n=x.map(R=>{let $=Mf(R,i),G=ij($)?$.canMatch(s,a):rs(i,()=>$(s,a));return Lc(G)});return vn(n).pipe(Ef(),LR(f))}var wg=class{constructor(s){this.segmentGroup=s||null}},Cg=class extends Error{constructor(s){super(),this.urlTree=s}};function mf(i){return Th(new wg(i))}function mj(i){return Th(new hn(4e3,!1))}function gj(i){return Th(PR(!1,Bo.GuardRejected))}var vE=class{constructor(s,a){this.urlSerializer=s,this.urlTree=a}lineralizeSegments(s,a){let f=[],x=a.root;for(;;){if(f=f.concat(x.segments),x.numberOfChildren===0)return vn(f);if(x.numberOfChildren>1||!x.children[$n])return mj(`${s.redirectTo}`);x=x.children[$n]}}applyRedirectCommands(s,a,f,x,n){if(typeof a!="string"){let $=a,{queryParams:G,fragment:se,routeConfig:Me,url:ke,outlet:tt,params:Ye,data:wt,title:mt}=x,Ht=rs(n,()=>$({params:Ye,data:wt,queryParams:G,fragment:se,routeConfig:Me,url:ke,outlet:tt,title:mt}));if(Ht instanceof al)throw new Cg(Ht);a=Ht}let R=this.applyRedirectCreateUrlTree(a,this.urlSerializer.parse(a),s,f);if(a[0]==="/")throw new Cg(R);return R}applyRedirectCreateUrlTree(s,a,f,x){let n=this.createSegmentGroup(s,a.root,f,x);return new al(n,this.createQueryParams(a.queryParams,this.urlTree.queryParams),a.fragment)}createQueryParams(s,a){let f={};return Object.entries(s).forEach(([x,n])=>{if(typeof n=="string"&&n[0]===":"){let $=n.substring(1);f[x]=a[$]}else f[x]=n}),f}createSegmentGroup(s,a,f,x){let n=this.createSegments(s,a.segments,f,x),R={};return Object.entries(a.children).forEach(([$,G])=>{R[$]=this.createSegmentGroup(s,G,f,x)}),new wi(n,R)}createSegments(s,a,f,x){return a.map(n=>n.path[0]===":"?this.findPosParam(s,n,x):this.findOrReturn(n,f))}findPosParam(s,a,f){let x=f[a.path.substring(1)];if(!x)throw new hn(4001,!1);return x}findOrReturn(s,a){let f=0;for(let x of a){if(x.path===s.path)return a.splice(f),x;f++}return s}},xE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function _j(i,s,a,f,x){let n=FR(i,s,a);return n.matched?(f=VV(s,f),pj(f,s,a,x).pipe(jn(R=>R===!0?n:Mt({},xE)))):vn(n)}function FR(i,s,a){if(s.path==="**")return yj(a);if(s.path==="")return s.pathMatch==="full"&&(i.hasChildren()||a.length>0)?Mt({},xE):{matched:!0,consumedSegments:[],remainingSegments:a,parameters:{},positionalParamSegments:{}};let x=(s.matcher||pV)(a,i,s);if(!x)return Mt({},xE);let n={};Object.entries(x.posParams??{}).forEach(([$,G])=>{n[$]=G.path});let R=x.consumed.length>0?Mt(Mt({},n),x.consumed[x.consumed.length-1].parameters):n;return{matched:!0,consumedSegments:x.consumed,remainingSegments:a.slice(x.consumed.length),parameters:R,positionalParamSegments:x.posParams??{}}}function yj(i){return{matched:!0,parameters:i.length>0?pR(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function lR(i,s,a,f){return a.length>0&&bj(i,a,f)?{segmentGroup:new wi(s,xj(f,new wi(a,i.children))),slicedSegments:[]}:a.length===0&&wj(i,a,f)?{segmentGroup:new wi(i.segments,vj(i,a,f,i.children)),slicedSegments:a}:{segmentGroup:new wi(i.segments,i.children),slicedSegments:a}}function vj(i,s,a,f){let x={};for(let n of a)if(Gv(i,s,n)&&!f[Vs(n)]){let R=new wi([],{});x[Vs(n)]=R}return Mt(Mt({},f),x)}function xj(i,s){let a={};a[$n]=s;for(let f of i)if(f.path===""&&Vs(f)!==$n){let x=new wi([],{});a[Vs(f)]=x}return a}function bj(i,s,a){return a.some(f=>Gv(i,s,f)&&Vs(f)!==$n)}function wj(i,s,a){return a.some(f=>Gv(i,s,f))}function Gv(i,s,a){return(i.hasChildren()||s.length>0)&&a.pathMatch==="full"?!1:a.path===""}function Cj(i,s,a){return s.length===0&&!i.children[a]}var bE=class{};function Ej(i,s,a,f,x,n,R="emptyOnly"){return new wE(i,s,a,f,x,R,n).recognize()}var Mj=31,wE=class{constructor(s,a,f,x,n,R,$){this.injector=s,this.configLoader=a,this.rootComponentType=f,this.config=x,this.urlTree=n,this.paramsInheritanceStrategy=R,this.urlSerializer=$,this.applyRedirects=new vE(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(s){return new hn(4002,`'${s.segmentGroup}'`)}recognize(){let s=lR(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(s).pipe(jn(({children:a,rootSnapshot:f})=>{let x=new zo(f,a),n=new Bv("",x),R=OV(f,[],this.urlTree.queryParams,this.urlTree.fragment);return R.queryParams=this.urlTree.queryParams,n.url=this.urlSerializer.serialize(R),{state:n,tree:R}}))}match(s){let a=new yf([],Object.freeze({}),Object.freeze(Mt({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),$n,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,s,$n,a).pipe(jn(f=>({children:f,rootSnapshot:a})),hc(f=>{if(f instanceof Cg)return this.urlTree=f.urlTree,this.match(f.urlTree.root);throw f instanceof wg?this.noMatchError(f):f}))}processSegmentGroup(s,a,f,x,n){return f.segments.length===0&&f.hasChildren()?this.processChildren(s,a,f,n):this.processSegment(s,a,f,f.segments,x,!0,n).pipe(jn(R=>R instanceof zo?[R]:[]))}processChildren(s,a,f,x){let n=[];for(let R of Object.keys(f.children))R==="primary"?n.unshift(R):n.push(R);return ki(n).pipe(Ha(R=>{let $=f.children[R],G=jV(a,R);return this.processSegmentGroup(s,G,$,R,x)}),yb((R,$)=>(R.push(...$),R)),fc(null),_b(),or(R=>{if(R===null)return mf(f);let $=kR(R);return Sj($),vn($)}))}processSegment(s,a,f,x,n,R,$){return ki(a).pipe(Ha(G=>this.processSegmentAgainstRoute(G._injector??s,a,G,f,x,n,R,$).pipe(hc(se=>{if(se instanceof wg)return vn(null);throw se}))),ra(G=>!!G),hc(G=>{if(OR(G))return Cj(f,x,n)?vn(new bE):mf(f);throw G}))}processSegmentAgainstRoute(s,a,f,x,n,R,$,G){return Vs(f)!==R&&(R===$n||!Gv(x,n,f))?mf(x):f.redirectTo===void 0?this.matchSegmentAgainstRoute(s,x,f,n,R,G):this.allowRedirects&&$?this.expandSegmentAgainstRouteUsingRedirect(s,x,a,f,n,R,G):mf(x)}expandSegmentAgainstRouteUsingRedirect(s,a,f,x,n,R,$){let{matched:G,parameters:se,consumedSegments:Me,positionalParamSegments:ke,remainingSegments:tt}=FR(a,x,n);if(!G)return mf(a);typeof x.redirectTo=="string"&&x.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Mj&&(this.allowRedirects=!1));let Ye=new yf(n,se,Object.freeze(Mt({},this.urlTree.queryParams)),this.urlTree.fragment,cR(x),Vs(x),x.component??x._loadedComponent??null,x,uR(x)),wt=zv(Ye,$,this.paramsInheritanceStrategy);Ye.params=Object.freeze(wt.params),Ye.data=Object.freeze(wt.data);let mt=this.applyRedirects.applyRedirectCommands(Me,x.redirectTo,ke,Ye,s);return this.applyRedirects.lineralizeSegments(x,mt).pipe(or(Ht=>this.processSegment(s,f,a,Ht.concat(tt),R,!1,$)))}matchSegmentAgainstRoute(s,a,f,x,n,R){let $=_j(a,f,x,s,this.urlSerializer);return f.path==="**"&&(a.children={}),$.pipe(yo(G=>G.matched?(s=f._injector??s,this.getChildConfig(s,f,x).pipe(yo(({routes:se})=>{let Me=f._loadedInjector??s,{parameters:ke,consumedSegments:tt,remainingSegments:Ye}=G,wt=new yf(tt,ke,Object.freeze(Mt({},this.urlTree.queryParams)),this.urlTree.fragment,cR(f),Vs(f),f.component??f._loadedComponent??null,f,uR(f)),mt=zv(wt,R,this.paramsInheritanceStrategy);wt.params=Object.freeze(mt.params),wt.data=Object.freeze(mt.data);let{segmentGroup:Ht,slicedSegments:_n}=lR(a,tt,Ye,se);if(_n.length===0&&Ht.hasChildren())return this.processChildren(Me,se,Ht,wt).pipe(jn(Ln=>new zo(wt,Ln)));if(se.length===0&&_n.length===0)return vn(new zo(wt,[]));let Ut=Vs(f)===n;return this.processSegment(Me,se,Ht,_n,Ut?$n:n,!0,wt).pipe(jn(Ln=>new zo(wt,Ln instanceof zo?[Ln]:[])))}))):mf(a)))}getChildConfig(s,a,f){return a.children?vn({routes:a.children,injector:s}):a.loadChildren?a._loadedRoutes!==void 0?vn({routes:a._loadedRoutes,injector:a._loadedInjector}):fj(s,a,f,this.urlSerializer).pipe(or(x=>x?this.configLoader.loadChildren(s,a).pipe(yr(n=>{a._loadedRoutes=n.routes,a._loadedInjector=n.injector})):gj(a))):vn({routes:[],injector:s})}};function Sj(i){i.sort((s,a)=>s.value.outlet===$n?-1:a.value.outlet===$n?1:s.value.outlet.localeCompare(a.value.outlet))}function Tj(i){let s=i.value.routeConfig;return s&&s.path===""}function kR(i){let s=[],a=new Set;for(let f of i){if(!Tj(f)){s.push(f);continue}let x=s.find(n=>f.value.routeConfig===n.value.routeConfig);x!==void 0?(x.children.push(...f.children),a.add(x)):s.push(f)}for(let f of a){let x=kR(f.children);s.push(new zo(f.value,x))}return s.filter(f=>!a.has(f))}function cR(i){return i.data||{}}function uR(i){return i.resolve||{}}function Ij(i,s,a,f,x,n){return or(R=>Ej(i,s,a,f,R.extractedUrl,x,n).pipe(jn(({state:$,tree:G})=>ei(Mt({},R),{targetSnapshot:$,urlAfterRedirects:G}))))}function Dj(i,s){return or(a=>{let{targetSnapshot:f,guards:{canActivateChecks:x}}=a;if(!x.length)return vn(a);let n=new Set(x.map(G=>G.route)),R=new Set;for(let G of n)if(!R.has(G))for(let se of NR(G))R.add(se);let $=0;return ki(R).pipe(Ha(G=>n.has(G)?Aj(G,f,i,s):(G.data=zv(G,G.parent,i).resolve,vn(void 0))),yr(()=>$++),Ah(1),or(G=>$===R.size?vn(a):ko))})}function NR(i){let s=i.children.map(a=>NR(a)).flat();return[i,...s]}function Aj(i,s,a,f){let x=i.routeConfig,n=i._resolve;return x?.title!==void 0&&!DR(x)&&(n[Mg]=x.title),Pj(n,i,s,f).pipe(jn(R=>(i._resolvedData=R,i.data=zv(i,i.parent,a).resolve,null)))}function Pj(i,s,a,f){let x=QC(i);if(x.length===0)return vn({});let n={};return ki(x).pipe(or(R=>Rj(i[R],s,a,f).pipe(ra(),yr($=>{if($ instanceof bg)throw Vv(new bf,$);n[R]=$}))),Ah(1),gb(n),hc(R=>OR(R)?ko:Th(R)))}function Rj(i,s,a,f){let x=Tg(s)??f,n=Mf(i,x),R=n.resolve?n.resolve(s,a):rs(x,()=>n(s,a));return Lc(R)}function JC(i){return yo(s=>{let a=i(s);return a?ki(a).pipe(jn(()=>s)):vn(s)})}var zR=(()=>{class i{buildTitle(a){let f,x=a.root;for(;x!==void 0;)f=this.getResolvedTitleForRoute(x)??f,x=x.children.find(n=>n.outlet===$n);return f}getResolvedTitleForRoute(a){return a.data[Mg]}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:()=>Ct(Oj),providedIn:"root"})}}return i})(),Oj=(()=>{class i extends zR{constructor(a){super(),this.title=a}updateTitle(a){let f=this.buildTitle(a);f!==void 0&&this.title.setTitle(f)}static{this.\u0275fac=function(f){return new(f||i)(sn(xP))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Ag=new on("",{providedIn:"root",factory:()=>({})}),Lj=(()=>{class i{static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275cmp=Rn({type:i,selectors:[["ng-component"]],standalone:!0,features:[On],decls:1,vars:0,template:function(f,x){f&1&&qe(0,"router-outlet")},dependencies:[ME],encapsulation:2})}}return i})();function SE(i){let s=i.children&&i.children.map(SE),a=s?ei(Mt({},i),{children:s}):Mt({},i);return!a.component&&!a.loadComponent&&(s||a.loadChildren)&&a.outlet&&a.outlet!==$n&&(a.component=Lj),a}var Eg=new on(""),TE=(()=>{class i{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Ct(tv)}loadComponent(a){if(this.componentLoaders.get(a))return this.componentLoaders.get(a);if(a._loadedComponent)return vn(a._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(a);let f=Lc(a.loadComponent()).pipe(jn(BR),yr(n=>{this.onLoadEndListener&&this.onLoadEndListener(a),a._loadedComponent=n}),zu(()=>{this.componentLoaders.delete(a)})),x=new Sh(f,()=>new _r).pipe(Mh());return this.componentLoaders.set(a,x),x}loadChildren(a,f){if(this.childrenLoaders.get(f))return this.childrenLoaders.get(f);if(f._loadedRoutes)return vn({routes:f._loadedRoutes,injector:f._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(f);let n=Fj(f,this.compiler,a,this.onLoadEndListener).pipe(zu(()=>{this.childrenLoaders.delete(f)})),R=new Sh(n,()=>new _r).pipe(Mh());return this.childrenLoaders.set(f,R),R}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Fj(i,s,a,f){return Lc(i.loadChildren()).pipe(jn(BR),or(x=>x instanceof km||Array.isArray(x)?vn(x):ki(s.compileModuleAsync(x))),jn(x=>{f&&f(i);let n,R,$=!1;return Array.isArray(x)?(R=x,$=!0):(n=x.create(a).injector,R=n.get(Eg,[],{optional:!0,self:!0}).flat()),{routes:R.map(SE),injector:n}}))}function kj(i){return i&&typeof i=="object"&&"default"in i}function BR(i){return kj(i)?i.default:i}var IE=(()=>{class i{static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:()=>Ct(Nj),providedIn:"root"})}}return i})(),Nj=(()=>{class i{shouldProcessUrl(a){return!0}extract(a){return a}merge(a,f){return a}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),VR=new on(""),jR=new on("");function zj(i,s,a){let f=i.get(jR),x=i.get(zr);return i.get(Wi).runOutsideAngular(()=>{if(!x.startViewTransition||f.skipNextTransition)return f.skipNextTransition=!1,new Promise(se=>setTimeout(se));let n,R=new Promise(se=>{n=se}),$=x.startViewTransition(()=>(n(),Bj(i))),{onViewTransitionCreated:G}=f;return G&&rs(i,()=>G({transition:$,from:s,to:a})),R})}function Bj(i){return new Promise(s=>{uC({read:()=>setTimeout(s)},{injector:i})})}var Vj=new on(""),DE=(()=>{class i{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new _r,this.transitionAbortSubject=new _r,this.configLoader=Ct(TE),this.environmentInjector=Ct(to),this.urlSerializer=Ct(Sg),this.rootContexts=Ct(Ig),this.location=Ct(sf),this.inputBindingEnabled=Ct($v,{optional:!0})!==null,this.titleStrategy=Ct(zR),this.options=Ct(Ag,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Ct(IE),this.createViewTransition=Ct(VR,{optional:!0}),this.navigationErrorHandler=Ct(Vj,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>vn(void 0),this.rootComponentType=null;let a=x=>this.events.next(new aE(x)),f=x=>this.events.next(new lE(x));this.configLoader.onLoadEndListener=f,this.configLoader.onLoadStartListener=a}complete(){this.transitions?.complete()}handleNavigationRequest(a){let f=++this.navigationId;this.transitions?.next(ei(Mt(Mt({},this.transitions.value),a),{id:f}))}setupNavigations(a,f,x){return this.transitions=new Ir({id:0,currentUrlTree:f,currentRawUrl:f,extractedUrl:this.urlHandlingStrategy.extract(f),urlAfterRedirects:this.urlHandlingStrategy.extract(f),rawUrl:f,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:mg,restoredState:null,currentSnapshot:x.snapshot,targetSnapshot:null,currentRouterState:x,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(_o(n=>n.id!==0),jn(n=>ei(Mt({},n),{extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl)})),yo(n=>{let R=!1,$=!1;return vn(n).pipe(yo(G=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",Bo.SupersededByNewNavigation),ko;this.currentTransition=n,this.currentNavigation={id:G.id,initialUrl:G.rawUrl,extractedUrl:G.extractedUrl,targetBrowserUrl:typeof G.extras.browserUrl=="string"?this.urlSerializer.parse(G.extras.browserUrl):G.extras.browserUrl,trigger:G.source,extras:G.extras,previousNavigation:this.lastSuccessfulNavigation?ei(Mt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let se=!a.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Me=G.extras.onSameUrlNavigation??a.onSameUrlNavigation;if(!se&&Me!=="reload"){let ke="";return this.events.next(new Oc(G.id,this.urlSerializer.serialize(G.rawUrl),ke,Ov.IgnoredSameUrlNavigation)),G.resolve(!1),ko}if(this.urlHandlingStrategy.shouldProcessUrl(G.rawUrl))return vn(G).pipe(yo(ke=>{let tt=this.transitions?.getValue();return this.events.next(new wf(ke.id,this.urlSerializer.serialize(ke.extractedUrl),ke.source,ke.restoredState)),tt!==this.transitions?.getValue()?ko:Promise.resolve(ke)}),Ij(this.environmentInjector,this.configLoader,this.rootComponentType,a.config,this.urlSerializer,this.paramsInheritanceStrategy),yr(ke=>{n.targetSnapshot=ke.targetSnapshot,n.urlAfterRedirects=ke.urlAfterRedirects,this.currentNavigation=ei(Mt({},this.currentNavigation),{finalUrl:ke.urlAfterRedirects});let tt=new Lv(ke.id,this.urlSerializer.serialize(ke.extractedUrl),this.urlSerializer.serialize(ke.urlAfterRedirects),ke.targetSnapshot);this.events.next(tt)}));if(se&&this.urlHandlingStrategy.shouldProcessUrl(G.currentRawUrl)){let{id:ke,extractedUrl:tt,source:Ye,restoredState:wt,extras:mt}=G,Ht=new wf(ke,this.urlSerializer.serialize(tt),Ye,wt);this.events.next(Ht);let _n=TR(this.rootComponentType).snapshot;return this.currentTransition=n=ei(Mt({},G),{targetSnapshot:_n,urlAfterRedirects:tt,extras:ei(Mt({},mt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=tt,vn(n)}else{let ke="";return this.events.next(new Oc(G.id,this.urlSerializer.serialize(G.extractedUrl),ke,Ov.IgnoredByUrlHandlingStrategy)),G.resolve(!1),ko}}),yr(G=>{let se=new iE(G.id,this.urlSerializer.serialize(G.extractedUrl),this.urlSerializer.serialize(G.urlAfterRedirects),G.targetSnapshot);this.events.next(se)}),jn(G=>(this.currentTransition=n=ei(Mt({},G),{guards:ZV(G.targetSnapshot,G.currentSnapshot,this.rootContexts)}),n)),oj(this.environmentInjector,G=>this.events.next(G)),yr(G=>{if(n.guardsResult=G.guardsResult,G.guardsResult&&typeof G.guardsResult!="boolean")throw Vv(this.urlSerializer,G.guardsResult);let se=new rE(G.id,this.urlSerializer.serialize(G.extractedUrl),this.urlSerializer.serialize(G.urlAfterRedirects),G.targetSnapshot,!!G.guardsResult);this.events.next(se)}),_o(G=>G.guardsResult?!0:(this.cancelNavigationTransition(G,"",Bo.GuardRejected),!1)),JC(G=>{if(G.guards.canActivateChecks.length)return vn(G).pipe(yr(se=>{let Me=new oE(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(Me)}),yo(se=>{let Me=!1;return vn(se).pipe(Dj(this.paramsInheritanceStrategy,this.environmentInjector),yr({next:()=>Me=!0,complete:()=>{Me||this.cancelNavigationTransition(se,"",Bo.NoDataFromResolver)}}))}),yr(se=>{let Me=new sE(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(Me)}))}),JC(G=>{let se=Me=>{let ke=[];Me.routeConfig?.loadComponent&&!Me.routeConfig._loadedComponent&&ke.push(this.configLoader.loadComponent(Me.routeConfig).pipe(yr(tt=>{Me.component=tt}),jn(()=>{})));for(let tt of Me.children)ke.push(...se(tt));return ke};return Im(se(G.targetSnapshot.root)).pipe(fc(null),qa(1))}),JC(()=>this.afterPreactivation()),yo(()=>{let{currentSnapshot:G,targetSnapshot:se}=n,Me=this.createViewTransition?.(this.environmentInjector,G.root,se.root);return Me?ki(Me).pipe(jn(()=>n)):vn(n)}),jn(G=>{let se=$V(a.routeReuseStrategy,G.targetSnapshot,G.currentRouterState);return this.currentTransition=n=ei(Mt({},G),{targetRouterState:se}),this.currentNavigation.targetRouterState=se,n}),yr(()=>{this.events.next(new vg)}),WV(this.rootContexts,a.routeReuseStrategy,G=>this.events.next(G),this.inputBindingEnabled),qa(1),yr({next:G=>{R=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new _a(G.id,this.urlSerializer.serialize(G.extractedUrl),this.urlSerializer.serialize(G.urlAfterRedirects))),this.titleStrategy?.updateTitle(G.targetRouterState.snapshot),G.resolve(!0)},complete:()=>{R=!0}}),xb(this.transitionAbortSubject.pipe(yr(G=>{throw G}))),zu(()=>{!R&&!$&&this.cancelNavigationTransition(n,"",Bo.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation=null,this.currentTransition=null)}),hc(G=>{if($=!0,RR(G))this.events.next(new sl(n.id,this.urlSerializer.serialize(n.extractedUrl),G.message,G.cancellationCode)),qV(G)?this.events.next(new Cf(G.url,G.navigationBehaviorOptions)):n.resolve(!1);else{let se=new yg(n.id,this.urlSerializer.serialize(n.extractedUrl),G,n.targetSnapshot??void 0);try{let Me=rs(this.environmentInjector,()=>this.navigationErrorHandler?.(se));if(Me instanceof bg){let{message:ke,cancellationCode:tt}=Vv(this.urlSerializer,Me);this.events.next(new sl(n.id,this.urlSerializer.serialize(n.extractedUrl),ke,tt)),this.events.next(new Cf(Me.redirectTo,Me.navigationBehaviorOptions))}else{this.events.next(se);let ke=a.errorHandler(G);n.resolve(!!ke)}}catch(Me){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(Me)}}return ko}))}))}cancelNavigationTransition(a,f,x){let n=new sl(a.id,this.urlSerializer.serialize(a.extractedUrl),f,x);this.events.next(n),a.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let a=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),f=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return a.toString()!==f?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function jj(i){return i!==mg}var Uj=(()=>{class i{static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:()=>Ct($j),providedIn:"root"})}}return i})(),CE=class{shouldDetach(s){return!1}store(s,a){}shouldAttach(s){return!1}retrieve(s){return null}shouldReuseRoute(s,a){return s.routeConfig===a.routeConfig}},$j=(()=>{class i extends CE{static{this.\u0275fac=(()=>{let a;return function(x){return(a||(a=ha(i)))(x||i)}})()}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),UR=(()=>{class i{static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:()=>Ct(Gj),providedIn:"root"})}}return i})(),Gj=(()=>{class i extends UR{constructor(){super(...arguments),this.location=Ct(sf),this.urlSerializer=Ct(Sg),this.options=Ct(Ag,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Ct(IE),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new al,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=TR(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(a){return this.location.subscribe(f=>{f.type==="popstate"&&a(f.url,f.state)})}handleRouterEvent(a,f){if(a instanceof wf)this.stateMemento=this.createStateMemento();else if(a instanceof Oc)this.rawUrlTree=f.initialUrl;else if(a instanceof Lv){if(this.urlUpdateStrategy==="eager"&&!f.extras.skipLocationChange){let x=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl);this.setBrowserUrl(f.targetBrowserUrl??x,f)}}else a instanceof vg?(this.currentUrlTree=f.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl),this.routerState=f.targetRouterState,this.urlUpdateStrategy==="deferred"&&!f.extras.skipLocationChange&&this.setBrowserUrl(f.targetBrowserUrl??this.rawUrlTree,f)):a instanceof sl&&(a.code===Bo.GuardRejected||a.code===Bo.NoDataFromResolver)?this.restoreHistory(f):a instanceof yg?this.restoreHistory(f,!0):a instanceof _a&&(this.lastSuccessfulId=a.id,this.currentPageId=this.browserPageId)}setBrowserUrl(a,f){let x=a instanceof al?this.urlSerializer.serialize(a):a;if(this.location.isCurrentPathEqualTo(x)||f.extras.replaceUrl){let n=this.browserPageId,R=Mt(Mt({},f.extras.state),this.generateNgRouterState(f.id,n));this.location.replaceState(x,"",R)}else{let n=Mt(Mt({},f.extras.state),this.generateNgRouterState(f.id,this.browserPageId+1));this.location.go(x,"",n)}}restoreHistory(a,f=!1){if(this.canceledNavigationResolution==="computed"){let x=this.browserPageId,n=this.currentPageId-x;n!==0?this.location.historyGo(n):this.currentUrlTree===a.finalUrl&&n===0&&(this.resetState(a),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(f&&this.resetState(a),this.resetUrlToCurrentUrlTree())}resetState(a){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,a.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(a,f){return this.canceledNavigationResolution==="computed"?{navigationId:a,\u0275routerPageId:f}:{navigationId:a}}static{this.\u0275fac=(()=>{let a;return function(x){return(a||(a=ha(i)))(x||i)}})()}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),fg=function(i){return i[i.COMPLETE=0]="COMPLETE",i[i.FAILED=1]="FAILED",i[i.REDIRECTING=2]="REDIRECTING",i}(fg||{});function $R(i,s){i.events.pipe(_o(a=>a instanceof _a||a instanceof sl||a instanceof yg||a instanceof Oc),jn(a=>a instanceof _a||a instanceof Oc?fg.COMPLETE:(a instanceof sl?a.code===Bo.Redirect||a.code===Bo.SupersededByNewNavigation:!1)?fg.REDIRECTING:fg.FAILED),_o(a=>a!==fg.REDIRECTING),qa(1)).subscribe(()=>{s()})}function Hj(i){throw i}var qj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Wj={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},zi=(()=>{class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=Ct(Q0),this.stateManager=Ct(UR),this.options=Ct(Ag,{optional:!0})||{},this.pendingTasks=Ct(wc),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Ct(DE),this.urlSerializer=Ct(Sg),this.location=Ct(sf),this.urlHandlingStrategy=Ct(IE),this._events=new _r,this.errorHandler=this.options.errorHandler||Hj,this.navigated=!1,this.routeReuseStrategy=Ct(Uj),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Ct(Eg,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Ct($v,{optional:!0}),this.eventsSubscription=new ir,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:a=>{this.console.warn(a)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let a=this.navigationTransitions.events.subscribe(f=>{try{let x=this.navigationTransitions.currentTransition,n=this.navigationTransitions.currentNavigation;if(x!==null&&n!==null){if(this.stateManager.handleRouterEvent(f,n),f instanceof sl&&f.code!==Bo.Redirect&&f.code!==Bo.SupersededByNewNavigation)this.navigated=!0;else if(f instanceof _a)this.navigated=!0;else if(f instanceof Cf){let R=f.navigationBehaviorOptions,$=this.urlHandlingStrategy.merge(f.url,x.currentRawUrl),G=Mt({browserUrl:x.extras.browserUrl,info:x.extras.info,skipLocationChange:x.extras.skipLocationChange,replaceUrl:x.extras.replaceUrl||this.urlUpdateStrategy==="eager"||jj(x.source)},R);this.scheduleNavigation($,mg,null,G,{resolve:x.resolve,reject:x.reject,promise:x.promise})}}Xj(f)&&this._events.next(f)}catch(x){this.navigationTransitions.transitionAbortSubject.next(x)}});this.eventsSubscription.add(a)}resetRootComponentType(a){this.routerState.root.component=a,this.navigationTransitions.rootComponentType=a}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),mg,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((a,f)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(a,"popstate",f)},0)})}navigateToSyncWithBrowser(a,f,x){let n={replaceUrl:!0},R=x?.navigationId?x:null;if(x){let G=Mt({},x);delete G.navigationId,delete G.\u0275routerPageId,Object.keys(G).length!==0&&(n.state=G)}let $=this.parseUrl(a);this.scheduleNavigation($,f,R,n)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(a){this.config=a.map(SE),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(a,f={}){let{relativeTo:x,queryParams:n,fragment:R,queryParamsHandling:$,preserveFragment:G}=f,se=G?this.currentUrlTree.fragment:R,Me=null;switch($??this.options.defaultQueryParamsHandling){case"merge":Me=Mt(Mt({},this.currentUrlTree.queryParams),n);break;case"preserve":Me=this.currentUrlTree.queryParams;break;default:Me=n||null}Me!==null&&(Me=this.removeEmptyProps(Me));let ke;try{let tt=x?x.snapshot:this.routerState.snapshot.root;ke=CR(tt)}catch{(typeof a[0]!="string"||a[0][0]!=="/")&&(a=[]),ke=this.currentUrlTree.root}return ER(ke,a,Me,se??null)}navigateByUrl(a,f={skipLocationChange:!1}){let x=od(a)?a:this.parseUrl(a),n=this.urlHandlingStrategy.merge(x,this.rawUrlTree);return this.scheduleNavigation(n,mg,null,f)}navigate(a,f={skipLocationChange:!1}){return Zj(a),this.navigateByUrl(this.createUrlTree(a,f),f)}serializeUrl(a){return this.urlSerializer.serialize(a)}parseUrl(a){try{return this.urlSerializer.parse(a)}catch{return this.urlSerializer.parse("/")}}isActive(a,f){let x;if(f===!0?x=Mt({},qj):f===!1?x=Mt({},Wj):x=f,od(a))return iR(this.currentUrlTree,a,x);let n=this.parseUrl(a);return iR(this.currentUrlTree,n,x)}removeEmptyProps(a){return Object.entries(a).reduce((f,[x,n])=>(n!=null&&(f[x]=n),f),{})}scheduleNavigation(a,f,x,n,R){if(this.disposed)return Promise.resolve(!1);let $,G,se;R?($=R.resolve,G=R.reject,se=R.promise):se=new Promise((ke,tt)=>{$=ke,G=tt});let Me=this.pendingTasks.add();return $R(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Me))}),this.navigationTransitions.handleNavigationRequest({source:f,restoredState:x,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:a,extras:n,resolve:$,reject:G,promise:se,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),se.catch(ke=>Promise.reject(ke))}static{this.\u0275fac=function(f){return new(f||i)}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Zj(i){for(let s=0;s<i.length;s++)if(i[s]==null)throw new hn(4008,!1)}function Xj(i){return!(i instanceof vg)&&!(i instanceof Cf)}var Sf=(()=>{class i{constructor(a,f,x,n,R,$){this.router=a,this.route=f,this.tabIndexAttribute=x,this.renderer=n,this.el=R,this.locationStrategy=$,this.href=null,this.onChanges=new _r,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;let G=R.nativeElement.tagName?.toLowerCase();this.isAnchorElement=G==="a"||G==="area",this.isAnchorElement?this.subscription=a.events.subscribe(se=>{se instanceof _a&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(a){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",a)}ngOnChanges(a){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(a){a==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(od(a)?this.routerLinkInput=a:this.routerLinkInput=Array.isArray(a)?a:[a],this.setTabIndexIfNotOnNativeEl("0"))}onClick(a,f,x,n,R){let $=this.urlTree;if($===null||this.isAnchorElement&&(a!==0||f||x||n||R||typeof this.target=="string"&&this.target!="_self"))return!0;let G={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl($,G),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let a=this.urlTree;this.href=a!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(a)):null;let f=this.href===null?null:q2(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",f)}applyAttributeValue(a,f){let x=this.renderer,n=this.el.nativeElement;f!==null?x.setAttribute(n,a,f):x.removeAttribute(n,a)}get urlTree(){return this.routerLinkInput===null?null:od(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static{this.\u0275fac=function(f){return new(f||i)(St(zi),St(ya),Gw("tabindex"),St(pa),St(xo),St(il))}}static{this.\u0275dir=Ni({type:i,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(f,x){f&1&&Wn("click",function(R){return x.onClick(R.button,R.ctrlKey,R.shiftKey,R.altKey,R.metaKey)}),f&2&&Ju("target",x.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Ec],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Ec],replaceUrl:[2,"replaceUrl","replaceUrl",Ec],routerLink:"routerLink"},standalone:!0,features:[cC,da]})}}return i})();var Uv=class{};var Yj=(()=>{class i{constructor(a,f,x,n,R){this.router=a,this.injector=x,this.preloadingStrategy=n,this.loader=R}setUpPreloading(){this.subscription=this.router.events.pipe(_o(a=>a instanceof _a),Ha(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(a,f){let x=[];for(let n of f){n.providers&&!n._injector&&(n._injector=Y0(n.providers,a,`Route: ${n.path}`));let R=n._injector??a,$=n._loadedInjector??R;(n.loadChildren&&!n._loadedRoutes&&n.canLoad===void 0||n.loadComponent&&!n._loadedComponent)&&x.push(this.preloadConfig(R,n)),(n.children||n._loadedRoutes)&&x.push(this.processRoutes($,n.children??n._loadedRoutes))}return ki(x).pipe(Ih())}preloadConfig(a,f){return this.preloadingStrategy.preload(f,()=>{let x;f.loadChildren&&f.canLoad===void 0?x=this.loader.loadChildren(a,f):x=vn(null);let n=x.pipe(or(R=>R===null?vn(void 0):(f._loadedRoutes=R.routes,f._loadedInjector=R.injector,this.processRoutes(R.injector??a,R.routes))));if(f.loadComponent&&!f._loadedComponent){let R=this.loader.loadComponent(f);return ki([n,R]).pipe(Ih())}else return n})}static{this.\u0275fac=function(f){return new(f||i)(sn(zi),sn(tv),sn(to),sn(Uv),sn(TE))}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),GR=new on(""),Jj=(()=>{class i{constructor(a,f,x,n,R={}){this.urlSerializer=a,this.transitions=f,this.viewportScroller=x,this.zone=n,this.options=R,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},R.scrollPositionRestoration||="disabled",R.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(a=>{a instanceof wf?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=a.navigationTrigger,this.restoredId=a.restoredState?a.restoredState.navigationId:0):a instanceof _a?(this.lastId=a.id,this.scheduleScrollEvent(a,this.urlSerializer.parse(a.urlAfterRedirects).fragment)):a instanceof Oc&&a.code===Ov.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(a,this.urlSerializer.parse(a.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(a=>{a instanceof Fv&&(a.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(a.position):a.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(a.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(a,f){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Fv(a,this.lastSource==="popstate"?this.store[this.restoredId]:null,f))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(f){oA()}}static{this.\u0275prov=Jt({token:i,factory:i.\u0275fac})}}return i})();function HR(i,...s){return Vm([{provide:Eg,multi:!0,useValue:i},[],{provide:ya,useFactory:qR,deps:[zi]},{provide:Xm,multi:!0,useFactory:WR},s.map(a=>a.\u0275providers)])}function qR(i){return i.routerState.root}function Pg(i,s){return{\u0275kind:i,\u0275providers:s}}function WR(){let i=Ct(ts);return s=>{let a=i.get(Cc);if(s!==a.components[0])return;let f=i.get(zi),x=i.get(ZR);i.get(AE)===1&&f.initialNavigation(),i.get(XR,null,Jn.Optional)?.setUpPreloading(),i.get(GR,null,Jn.Optional)?.init(),f.resetRootComponentType(a.componentTypes[0]),x.closed||(x.next(),x.complete(),x.unsubscribe())}}var ZR=new on("",{factory:()=>new _r}),AE=new on("",{providedIn:"root",factory:()=>1});function Kj(){return Pg(2,[{provide:AE,useValue:0},{provide:ev,multi:!0,deps:[ts],useFactory:s=>{let a=s.get(YA,Promise.resolve());return()=>a.then(()=>new Promise(f=>{let x=s.get(zi),n=s.get(ZR);$R(x,()=>{f(!0)}),s.get(DE).afterPreactivation=()=>(f(!0),n.closed?vn(void 0):n),x.initialNavigation()}))}}])}function Qj(){return Pg(3,[{provide:ev,multi:!0,useFactory:()=>{let s=Ct(zi);return()=>{s.setUpLocationChangeListener()}}},{provide:AE,useValue:2}])}var XR=new on("");function e6(i){return Pg(0,[{provide:XR,useExisting:Yj},{provide:Uv,useExisting:i}])}function t6(){return Pg(8,[aR,{provide:$v,useExisting:aR}])}function n6(i){let s=[{provide:VR,useValue:zj},{provide:jR,useValue:Mt({skipNextTransition:!!i?.skipInitialTransition},i)}];return Pg(9,s)}var dR=new on("ROUTER_FORROOT_GUARD"),i6=[sf,{provide:Sg,useClass:bf},zi,Ig,{provide:ya,useFactory:qR,deps:[zi]},TE,[]],PE=(()=>{class i{constructor(a){}static forRoot(a,f){return{ngModule:i,providers:[i6,[],{provide:Eg,multi:!0,useValue:a},{provide:dR,useFactory:a6,deps:[[zi,new Iw,new FD]]},{provide:Ag,useValue:f||{}},f?.useHash?o6():s6(),r6(),f?.preloadingStrategy?e6(f.preloadingStrategy).\u0275providers:[],f?.initialNavigation?l6(f):[],f?.bindToComponentInputs?t6().\u0275providers:[],f?.enableViewTransitions?n6().\u0275providers:[],c6()]}}static forChild(a){return{ngModule:i,providers:[{provide:Eg,multi:!0,useValue:a}]}}static{this.\u0275fac=function(f){return new(f||i)(sn(dR,8))}}static{this.\u0275mod=is({type:i})}static{this.\u0275inj=ns({})}}return i})();function r6(){return{provide:GR,useFactory:()=>{let i=Ct(QA),s=Ct(Wi),a=Ct(Ag),f=Ct(DE),x=Ct(Sg);return a.scrollOffset&&i.setOffset(a.scrollOffset),new Jj(x,f,i,s,a)}}}function o6(){return{provide:il,useClass:KA}}function s6(){return{provide:il,useClass:xC}}function a6(i){return"guarded"}function l6(i){return[i.initialNavigation==="disabled"?Qj().\u0275providers:[],i.initialNavigation==="enabledBlocking"?Kj().\u0275providers:[]]}var hR=new on("");function c6(){return[{provide:hR,useFactory:WR},{provide:Xm,multi:!0,useExisting:hR}]}var Hv=class i{title="campusRide";static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Rn({type:i,selectors:[["app-root"]],standalone:!0,features:[On],decls:1,vars:0,template:function(a,f){a&1&&qe(0,"router-outlet")},dependencies:[Ji,ME,Bs]})};var cs=class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Rn({type:i,selectors:[["app-header"]],standalone:!0,features:[On],decls:25,vars:0,consts:[[1,"header"],[1,"header-left"],[1,"header-logo-container"],["routerLink","/home"],["src","assets/images/logo.webp","alt","CampusRide","width","80","height","90",1,"header-logo"],[1,"header-content"],[1,"header-item"],[1,"login-text2"],[1,"header-right"],["routerLink","/login",1,"login-text2"],["routerLink","/registro",1,"login-text"]],template:function(a,f){a&1&&(fe(0,"header",0)(1,"div",1)(2,"div",2)(3,"a",3),qe(4,"img",4),ue()(),fe(5,"nav",5)(6,"div",6)(7,"div",7),Pe(8,"Ayuda"),ue()(),fe(9,"div",6)(10,"div",7),Pe(11,"Contactanos"),ue()(),fe(12,"div",6)(13,"div",7),Pe(14,"Comunidad"),ue()(),fe(15,"div",6)(16,"div",7),Pe(17,"Quienes somos"),ue()()()(),fe(18,"div",8)(19,"div",6)(20,"a",9),Pe(21,"Iniciar sesi\xF3n"),ue()(),fe(22,"div",6)(23,"a",10),Pe(24,"Registrarse"),ue()()()())},dependencies:[Sf],styles:[".header-logo[_ngcontent-%COMP%]{width:75 px;height:75px;transition:all 2 s}.header[_ngcontent-%COMP%]{display:flex;width:100%;height:80px;padding-top:5 px;color:#7145d6;background-color:#cdbef1}.header-logo[_ngcontent-%COMP%]{cursor:pointer}.header-logo[_ngcontent-%COMP%]:hover, .header-item[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.header-right[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]{background:#7145d6;color:#fff;font-size:15px;font-weight:700;padding:5px 15px;border-radius:50px;cursor:pointer;transition:background-color .3s ease;text-decoration:none}.header-left[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]{background:#cdbef1;color:#fff;font-size:15px;font-weight:700;padding:5px 8px;border-radius:50px;cursor:pointer;transition:background-color .3s ease}.header-left[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]:hover{background:#7145d6}.header-right[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]:hover{background:#8550e1}"]})};var us=class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Rn({type:i,selectors:[["app-footer"]],standalone:!0,features:[On],decls:13,vars:0,consts:[[1,"w-100","d-flex","align-items-center","justify-content-center"],[1,"fs-5","px-3","pt-3"],["id","iconos"],["href","https://www.instagram.com/campusride__?igsh=YnUzNHZ6OWtqNWh5&utm_source=qr","target","_blank"],[1,"bi","bi-instagram"],["href","https://www.facebook.com/share/K59oGcWYNtk6UqET/?mibextid=LQQJ4d","target","_blank"],[1,"bi","bi-facebook"],["href","https://wa.link/y4fvsa","target","_blank"],[1,"bi","bi-whatsapp"]],template:function(a,f){a&1&&(fe(0,"footer",0)(1,"section")(2,"p",1),Pe(3,"Campus Ride UV \xA9 Todos Los Derechos Reservados 2024 "),qe(4,"br"),Pe(5," Tulu\xE1 - Valle del Cauca"),ue()(),fe(6,"div",2)(7,"a",3),qe(8,"i",4),ue(),fe(9,"a",5),qe(10,"i",6),ue(),fe(11,"a",7),qe(12,"i",8),ue()()())},styles:["footer[_ngcontent-%COMP%]{background:#fff;min-height:100px;padding:20px}footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#513494;text-align:center;margin-left:20px;margin-right:20px}#iconos[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:26px;color:#513494}#iconos[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:50px;margin-right:20px}footer[_ngcontent-%COMP%]{background:linear-gradient(#cdbef1 1%,#fff)}"]})};var br=class i{constructor(s){this.http=s}apiUrl="https://api-rest-vo9r.onrender.com/api";newUser(s){return this.http.post(`${this.apiUrl}/newUser`,s)}Allusuarios(){return this.http.get(`${this.apiUrl}/usuarios`)}login(s){return this.http.post(`${this.apiUrl}/login`,s)}addConductor(s){return this.http.post(`${this.apiUrl}/newConductor`,s)}addVehiculo(s){return this.http.post(`${this.apiUrl}/newVehiculo`,s)}recuperarContrasena(s){return this.http.post(`${this.apiUrl}/sendVerificationCode`,s)}verificarCodigo(s){return this.http.post(`${this.apiUrl}/verifyCode`,s)}establecerContrasena(s){return this.http.post(`${this.apiUrl}/newPassword`,s)}createHelpDeskRequest(s){return this.http.post(`${this.apiUrl}/helpDesk`,s)}getUserById(s){return this.http.get(`${this.apiUrl}/usuariosid/${s}`)}getConductorById(s){return this.http.get(`${this.apiUrl}/conductor/${s}`)}updateUser(s,a){return this.http.put(`${this.apiUrl}/updateUser/${s}`,a)}updateDriver(s,a){return this.http.put(`${this.apiUrl}/updateConductor/${s}`,a)}static \u0275fac=function(a){return new(a||i)(sn(Qm))};static \u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})};var YR="body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Montserrat,sans-serif}.login-container[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 60px);display:flex;justify-content:center;align-items:center;overflow:hidden}.image-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden}.background-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;z-index:-1}.login-box[_ngcontent-%COMP%]{border-width:2px;border-style:solid;border-color:#7145d6;background:#fff;box-shadow:2px 5px 10px #0000001a;border-radius:20px;padding:20px 40px;width:90%;max-width:400px;z-index:1}.login-header[_ngcontent-%COMP%]{color:#000;font-size:14px;font-weight:600;text-transform:uppercase;margin-bottom:10px;text-align:center}.login-subtitulo[_ngcontent-%COMP%]{color:#6c6c6c;font-size:11px;font-weight:500;margin-bottom:20px;text-align:center}.form-group[_ngcontent-%COMP%]{margin-bottom:15px;width:100%}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#6c6c6c;font-size:14px}input[type=text][_ngcontent-%COMP%], input[type=email][_ngcontent-%COMP%], input[type=password][_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:14px;font-family:Montserrat,sans-serif;font-weight:500;color:#6c6c6c}p[_ngcontent-%COMP%]{margin-top:10px;font-size:12px;text-align:center}a[_ngcontent-%COMP%]{color:#8450e1;text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.registrarte[_ngcontent-%COMP%]{text-align:center;margin-top:20px}.registrarte[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#8450e1;font-size:14px;font-weight:500}.password-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.password-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-right:40px}.password-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:absolute;right:10px;cursor:pointer;width:20px;height:20px}.toggle-password[_ngcontent-%COMP%]{position:relative;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;width:20px;height:20px}",qv=class i{constructor(s,a,f){this.fb=s;this.userService=a;this.router=f;this.ingresoUsuario=this.fb.group({correo:["",[Ot.required,Ot.email]],contrase\u00F1a:["",Ot.required]})}ingresoUsuario;isPasswordVisible=!1;ngOnInit(){}onSubmit(){this.ingresoUsuario.valid?(console.log("Formulario enviado:",this.ingresoUsuario.value),this.userService.login(this.ingresoUsuario.value).subscribe({next:s=>{if(console.log("Respuesta del servidor:",s),s&&s.id&&s.rol){switch(localStorage.setItem("userId",s.id),localStorage.setItem("userRole",s.rol),console.log("userId en localStorage:",localStorage.getItem("userId")),console.log("userRole en localStorage:",localStorage.getItem("userRole")),s.rol){case"admin":break;case"conductor":this.router.navigate(["/edit-driver"]);break;case"pasajero":this.router.navigate(["/edit-passenger"]);break;default:this.router.navigate(["/login"])}alert("Ingreso exitoso")}else console.error("Respuesta inv\xE1lida del servidor:",s),alert("Error al procesar la respuesta del servidor. Por favor, intenta nuevamente.")},error:s=>{console.error("Error al ingresar usuario:",s),alert("Usuario o contrase\xF1a incorrecto. Por favor, intenta nuevamente.")}})):(console.error("Formulario no v\xE1lido"),Object.keys(this.ingresoUsuario.controls).forEach(s=>{let a=this.ingresoUsuario.get(s)?.errors;a&&console.log(`Errores en control ${s}:`,a)}))}togglePasswordVisibility(){this.isPasswordVisible=!this.isPasswordVisible}static \u0275fac=function(a){return new(a||i)(St(bo),St(br),St(zi))};static \u0275cmp=Rn({type:i,selectors:[["app-login"]],standalone:!0,features:[On],decls:43,vars:3,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],["href",Ui`https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css`,"rel","stylesheet","integrity","sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl","crossorigin","anonymous"],["rel","stylesheet","href",Ui`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css`],[1,"login-container"],[1,"image-container"],["src","assets/images/fondologin.webp","alt","Fondo de login",1,"background-image"],[1,"login-box"],[1,"title"],[1,"login-header"],[1,"login-subtitulo"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","email"],["type","email","id","email","formControlName","correo","placeholder","Ingresa tu correo","required",""],["for","password"],[1,"password-container"],["id","password","formControlName","contrase\xF1a","placeholder","Ingresa tu contrase\xF1a","required","",3,"type"],["src","assets/images/ojo_cerrado.webp","alt","Mostrar/Ocultar Contrase\xF1a",1,"toggle-password",3,"click","src"],["routerLink","/password-recovery"],["type","submit",1,"bt"],[1,"registrarte"],["routerLink","/registro"]],template:function(a,f){a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3)(5,"link",4)(6,"link",5),fe(7,"title"),Pe(8,"Login - CampusRide"),ue()(),fe(9,"body"),qe(10,"app-header"),fe(11,"main",6)(12,"div",7),qe(13,"img",8),ue(),fe(14,"div",9)(15,"h1",10),Pe(16,"CAMPUSRIDE"),ue(),fe(17,"h2",11),Pe(18,"INICIAR SESI\xD3N"),ue(),fe(19,"p",12),Pe(20,"Ingrese sus credenciales para acceder a su cuenta"),ue(),fe(21,"form",13),Wn("ngSubmit",function(){return f.onSubmit()}),fe(22,"div",14)(23,"label",15),Pe(24,"Correo electr\xF3nico"),ue(),qe(25,"input",16),ue(),fe(26,"div",14)(27,"label",17),Pe(28,"Contrase\xF1a"),ue(),fe(29,"div",18),qe(30,"input",19),fe(31,"img",20),Wn("click",function(){return f.togglePasswordVisibility()}),ue()()(),fe(32,"p"),Pe(33,"\xBFOlvidaste tu contrase\xF1a? "),fe(34,"a",21),Pe(35,"Restablecer contrase\xF1a"),ue()(),fe(36,"div",14)(37,"button",22),Pe(38,"Iniciar sesi\xF3n"),ue()()(),fe(39,"div",23)(40,"a",24),Pe(41,"Registrarte"),ue()()()(),qe(42,"app-footer"),ue()()),a&2&&(Ft(21),qt("formGroup",f.ingresoUsuario),Ft(9),qt("type",f.isPasswordVisible?"text":"password"),Ft(),qt("src",f.isPasswordVisible?"assets/images/ojo_abierto.webp":"assets/images/ojo_cerrado.webp",Qa))},dependencies:[Ji,jr,vr,Br,Vr,so,ro,oo,Sf,cs,us],styles:[YR,YR]})};function u6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"El n\xFAmero de identificaci\xF3n es obligatorio."),ue()())}function d6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"El nombre es obligatorio."),ue()())}function h6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"El apellido es obligatorio."),ue()())}function f6(i,s){i&1&&(fe(0,"small",50),Pe(1,"El correo es obligatorio."),ue())}function p6(i,s){i&1&&(fe(0,"small",50),Pe(1,"El formato del correo no es v\xE1lido."),ue())}function m6(i,s){if(i&1&&(fe(0,"div"),yi(1,f6,2,0,"small",51)(2,p6,2,0,"small",51),ue()),i&2){let a,f,x=ss();Ft(),qt("ngIf",(a=x.agregarUsuario.get("correo"))==null||a.errors==null?null:a.errors.required),Ft(),qt("ngIf",(f=x.agregarUsuario.get("correo"))==null||f.errors==null?null:f.errors.email)}}function g6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"El n\xFAmero de tel\xE9fono es obligatorio."),ue()())}function _6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"La direcci\xF3n es obligatoria."),ue()())}function y6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"La fecha de nacimiento es obligatoria."),ue()())}function v6(i,s){i&1&&(fe(0,"small",50),Pe(1,"La contrase\xF1a es obligatoria."),ue())}function x6(i,s){i&1&&(fe(0,"small",50),Pe(1,"La contrase\xF1a debe tener al menos 6 caracteres."),ue())}function b6(i,s){if(i&1&&(fe(0,"div"),yi(1,v6,2,0,"small",51)(2,x6,2,0,"small",51),ue()),i&2){let a,f,x=ss();Ft(),qt("ngIf",(a=x.agregarUsuario.get("contrase\xF1a"))==null||a.errors==null?null:a.errors.required),Ft(),qt("ngIf",(f=x.agregarUsuario.get("contrase\xF1a"))==null||f.errors==null?null:f.errors.minlength)}}function w6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"Debes confirmar tu contrase\xF1a."),ue()())}function C6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"La fecha de vencimiento es obligatoria."),ue()())}function E6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"El n\xFAmero de la placa es obligatorio."),ue()())}function M6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"La marca del veh\xEDculo es obligatoria."),ue()())}function S6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"El modelo del veh\xEDculo es obligatorio."),ue()())}function T6(i,s){i&1&&(fe(0,"small",50),Pe(1,"El a\xF1o es obligatorio."),ue())}function I6(i,s){i&1&&(fe(0,"small",50),Pe(1,"El a\xF1o no puede ser anterior a 1900."),ue())}function D6(i,s){i&1&&(fe(0,"small",50),Pe(1,"El a\xF1o no puede ser mayor que el a\xF1o actual."),ue())}function A6(i,s){if(i&1&&(fe(0,"div"),yi(1,T6,2,0,"small",51)(2,I6,2,0,"small",51)(3,D6,2,0,"small",51),ue()),i&2){let a,f,x,n=ss(2);Ft(),qt("ngIf",(a=n.agregarUsuario.get("ano"))==null||a.errors==null?null:a.errors.required),Ft(),qt("ngIf",(f=n.agregarUsuario.get("ano"))==null||f.errors==null?null:f.errors.min),Ft(),qt("ngIf",(x=n.agregarUsuario.get("ano"))==null||x.errors==null?null:x.errors.max)}}function P6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"El color del veh\xEDculo es obligatorio."),ue()())}function R6(i,s){i&1&&(fe(0,"div")(1,"small",50),Pe(2,"La capacidad de pasajeros es obligatoria."),ue()())}function O6(i,s){if(i&1&&(fe(0,"div"),qe(1,"div",52),fe(2,"h1",8),Pe(3,"Licencia"),ue(),fe(4,"div",16)(5,"div",17)(6,"label",53),Pe(7,"N\xFAmero de licencia"),ue(),qe(8,"input",54),ue(),fe(9,"div",17)(10,"label",55),Pe(11,"Fecha de vencimiento"),ue(),qe(12,"input",56),yi(13,C6,3,0,"div",20),ue()(),qe(14,"div",52),fe(15,"h1",8),Pe(16,"Vehiculo"),ue(),fe(17,"div",16)(18,"div",17)(19,"label",57),Pe(20,"N\xFAmero Placa"),ue(),qe(21,"input",58),yi(22,E6,3,0,"div",20),ue(),fe(23,"div",17)(24,"label",59),Pe(25,"Marca"),ue(),qe(26,"input",60),yi(27,M6,3,0,"div",20),ue()(),fe(28,"div",16)(29,"div",17)(30,"label",61),Pe(31,"Modelo"),ue(),qe(32,"input",62),yi(33,S6,3,0,"div",20),ue(),fe(34,"div",17)(35,"label",63),Pe(36,"A\xF1o"),ue(),qe(37,"input",64),yi(38,A6,4,3,"div",20),ue()(),fe(39,"div",16)(40,"div",17)(41,"label",65),Pe(42,"Color"),ue(),qe(43,"input",66),yi(44,P6,3,0,"div",20),ue(),fe(45,"div",17)(46,"label",67),Pe(47,"Capacidad de Pasajeros"),ue(),qe(48,"input",68),yi(49,R6,3,0,"div",20),ue()(),qe(50,"div",52),fe(51,"h1",8),Pe(52,"Archivos"),ue(),fe(53,"div",16)(54,"div",17)(55,"label"),Pe(56,"Ingrese Foto de Perfil "),ue(),fe(57,"button",69),qe(58,"img",70),fe(59,"span"),Pe(60,"Subir"),ue(),qe(61,"input",71),ue(),fe(62,"label"),Pe(63,"Ingrese Foto de la Licencia por Lado y Lado"),ue(),fe(64,"button",69),qe(65,"img",72),fe(66,"span",73),Pe(67,"Subir PDF"),ue(),qe(68,"input",74),ue(),fe(69,"label"),Pe(70,"Ingrese Foto de la Tarjeta de Propiedad por Lado y Lado"),ue(),fe(71,"button",69),qe(72,"img",72),fe(73,"span",73),Pe(74,"Subir PDF"),ue(),qe(75,"input",74),ue(),fe(76,"label"),Pe(77,"Ingrese Foto de la C\xE9dula por Lado y Lado"),ue(),fe(78,"button",69),qe(79,"img",72),fe(80,"span",73),Pe(81,"Subir PDF"),ue(),qe(82,"input",74),ue()(),qe(83,"div",52),ue(),qe(84,"div",52),ue()),i&2){let a,f,x,n,R,$,G,se=ss();Ft(13),qt("ngIf",((a=se.agregarUsuario.get("fecha_vencimiento"))==null?null:a.invalid)&&(((a=se.agregarUsuario.get("fecha_vencimiento"))==null?null:a.touched)||((a=se.agregarUsuario.get("fecha_vencimiento"))==null?null:a.dirty))),Ft(9),qt("ngIf",((f=se.agregarUsuario.get("id_placa"))==null?null:f.invalid)&&(((f=se.agregarUsuario.get("id_placa"))==null?null:f.touched)||((f=se.agregarUsuario.get("id_placa"))==null?null:f.dirty))),Ft(5),qt("ngIf",((x=se.agregarUsuario.get("marca"))==null?null:x.invalid)&&(((x=se.agregarUsuario.get("marca"))==null?null:x.touched)||((x=se.agregarUsuario.get("marca"))==null?null:x.dirty))),Ft(6),qt("ngIf",((n=se.agregarUsuario.get("modelo"))==null?null:n.invalid)&&(((n=se.agregarUsuario.get("modelo"))==null?null:n.touched)||((n=se.agregarUsuario.get("modelo"))==null?null:n.dirty))),Ft(5),qt("ngIf",((R=se.agregarUsuario.get("ano"))==null?null:R.invalid)&&(((R=se.agregarUsuario.get("ano"))==null?null:R.touched)||((R=se.agregarUsuario.get("ano"))==null?null:R.dirty))),Ft(6),qt("ngIf",(($=se.agregarUsuario.get("color"))==null?null:$.invalid)&&((($=se.agregarUsuario.get("color"))==null?null:$.touched)||(($=se.agregarUsuario.get("color"))==null?null:$.dirty))),Ft(5),qt("ngIf",((G=se.agregarUsuario.get("capacidad_pasajeros"))==null?null:G.invalid)&&(((G=se.agregarUsuario.get("capacidad_pasajeros"))==null?null:G.touched)||((G=se.agregarUsuario.get("capacidad_pasajeros"))==null?null:G.dirty)))}}var JR='body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Montserrat,sans-serif}.registro-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;min-height:100vh;width:100%;justify-content:center;align-items:center;overflow-y:auto;background-color:#cdbef1}.registro-box[_ngcontent-%COMP%]{background:#fff;border-style:solid;border-color:#7145d6;box-shadow:2px 5px 10px #0000001a;border-radius:20px;padding:40px;width:80%;max-width:600px;z-index:1;display:flex;flex-direction:column;justify-content:center;margin-top:50px}.form-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:20px}.form-group[_ngcontent-%COMP%]{flex:1;margin-right:15px}.form-group[_ngcontent-%COMP%]:last-child{margin-right:0}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#6c6c6c;font-size:14px}input[type=text][_ngcontent-%COMP%], input[type=email][_ngcontent-%COMP%], input[type=tel][_ngcontent-%COMP%], input[type=password][_ngcontent-%COMP%], input[type=date][_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:14px;font-family:Montserrat,sans-serif;font-weight:500;color:#6c6c6c}p[_ngcontent-%COMP%]{margin-top:10px;font-size:12px;text-align:center}a[_ngcontent-%COMP%]{color:#8450e1;text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.registrarte[_ngcontent-%COMP%]{text-align:center;margin-top:20px}.registrarte[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#8450e1;font-size:14px;font-weight:500}.imagen-container[_ngcontent-%COMP%]{width:50%;height:100%;overflow:hidden;position:relative}.imagen-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:cover}.password-container[_ngcontent-%COMP%]{position:relative;width:100%}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;width:20px;height:20px}.radio-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.radio-input[_ngcontent-%COMP%]{--container_width: 165px;position:relative;display:flex;align-items:center;border-radius:10px;background-color:#fff;color:#000;width:var(--container_width);overflow:hidden;border:1px solid rgba(53,52,52,.226);margin-left:25px;top:-30px;left:320px}.radio-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%;padding:2px;cursor:pointer;display:flex;justify-content:center;align-items:center;z-index:1;font-weight:600;letter-spacing:-1px;font-size:15px;margin-left:-8px}.selection[_ngcontent-%COMP%]{display:none;position:absolute;height:100%;width:calc(var(--container_width) / 2);z-index:0;left:0;top:0;transition:.15s ease}.registarsebtn[_ngcontent-%COMP%]{background-color:#8550e1;width:100%;height:30px;border-radius:50px;cursor:pointer;color:#fff;font-size:16px;font-family:Montserrat,sans-serif;font-weight:500;word-wrap:break-word;border:none}.registarsebtn[_ngcontent-%COMP%]:hover{background-color:#7145d6}.radio-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:has(input:checked){color:#fff}.radio-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:has(input:checked) ~ .selection[_ngcontent-%COMP%]{background-color:#7145d6;display:inline-block}.radio-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:nth-child(1):has(input:checked) ~ .selection[_ngcontent-%COMP%]{transform:translate(calc(var(--container_width) * 0/2))}.radio-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:nth-child(2):has(input:checked) ~ .selection[_ngcontent-%COMP%]{transform:translate(calc(var(--container_width) * 1/2))}.divider[_ngcontent-%COMP%]{height:2px;background-color:#bebebe;margin:20px 0}.container-btn-file[_ngcontent-%COMP%]{display:flex;position:relative;width:100%;padding:10px;justify-content:center;align-items:center;background-color:#8550e1;color:#fff;border-style:none;border-radius:.5em;font-size:16px;overflow:hidden;z-index:1;box-shadow:4px 8px 10px -3px #0000005b;transition:all .25s}.container-btn-file[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;opacity:0;cursor:pointer}.container-btn-file[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{position:absolute;left:30px;top:50%;height:30px;transform:translateY(-50%)}.container-btn-file[_ngcontent-%COMP%]:before{content:"";position:absolute;height:100%;width:0;border-radius:.7em;background-color:#7145d6;z-index:-1;transition:all .35s}.container-btn-file[_ngcontent-%COMP%]:hover:before{width:100%}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:10px}.container-btn-file[_ngcontent-%COMP%]{margin-bottom:20px}.container[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{display:none}.tabs[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;gap:20px;border-bottom:2px solid #ddd;width:fit-content;padding-bottom:5px}.tabs[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{display:none}.tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#555;cursor:pointer;padding:2px;text-align:center;transition:color .3s ease}.tabs[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]:checked + .tab[_ngcontent-%COMP%]{color:#8550e1}.container[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{color:#185ee0}.container[_ngcontent-%COMP%]   input[id=radio-masculino][_ngcontent-%COMP%]:checked ~ .glider[_ngcontent-%COMP%]{transform:translate(0)}.container[_ngcontent-%COMP%]   input[id=radio-femenino][_ngcontent-%COMP%]:checked ~ .glider[_ngcontent-%COMP%]{transform:translate(100%)}@media (max-width: 700px){.tabs[_ngcontent-%COMP%]{transform:scale(.8)}}@media (max-width: 932px){.registro-container[_ngcontent-%COMP%], .form-row[_ngcontent-%COMP%]{flex-direction:column}.form-group[_ngcontent-%COMP%]{margin-bottom:2px}.container[_ngcontent-%COMP%]{margin-left:-47px}.radio-input[_ngcontent-%COMP%]{margin-left:0;top:0;left:0}}',Wv=class i{constructor(s,a,f){this.fb=s;this.userService=a;this.router=f;this.agregarUsuario=this.fb.group({id:["",Ot.required],genero:["",Ot.required],nombre:["",Ot.required],apellido:["",Ot.required],correo:["",[Ot.required,Ot.email]],telefono:["",Ot.required],direccion:["",Ot.required],fecha_nacimiento:["",Ot.required],contrase\u00F1a:["",[Ot.required,Ot.minLength(6)]],confirmarContrase\u00F1a:["",Ot.required]},{validator:this.passwordMatchValidator})}agregarUsuario;isPasswordVisible=!1;tipoUsuario="usuario";ngOnInit(){}onUserTypeChange(s){this.tipoUsuario=s,s==="conductor"?(this.agregarUsuario.addControl("numero_licencia",this.fb.control("",Ot.required)),this.agregarUsuario.addControl("fecha_vencimiento",this.fb.control("",Ot.required)),this.agregarUsuario.addControl("id_placa",this.fb.control("",Ot.required)),this.agregarUsuario.addControl("marca",this.fb.control("",Ot.required)),this.agregarUsuario.addControl("modelo",this.fb.control("",Ot.required)),this.agregarUsuario.addControl("ano",this.fb.control("",[Ot.required,Ot.minLength(4),Ot.maxLength(4)])),this.agregarUsuario.addControl("color",this.fb.control("",Ot.required)),this.agregarUsuario.addControl("capacidad_pasajeros",this.fb.control("",Ot.required))):(this.agregarUsuario.removeControl("numero_licencia"),this.agregarUsuario.removeControl("fecha_vencimiento"),this.agregarUsuario.removeControl("id_placa"),this.agregarUsuario.removeControl("marca"),this.agregarUsuario.removeControl("modelo"),this.agregarUsuario.removeControl("ano"),this.agregarUsuario.removeControl("color"),this.agregarUsuario.removeControl("capacidad_pasajeros"))}passwordMatchValidator(s){return s.get("contrase\xF1a")?.value===s.get("confirmarContrase\xF1a")?.value?null:{mismatch:!0}}onSubmit(){if(this.agregarUsuario.valid)if(console.log("Formulario v\xE1lido, enviando datos:",this.agregarUsuario.value),this.tipoUsuario==="conductor"){let{id:s,genero:a,nombre:f,apellido:x,correo:n,telefono:R,direccion:$,fecha_nacimiento:G,contrase\u00F1a:se,numero_licencia:Me,fecha_vencimiento:ke,id_placa:tt,marca:Ye,modelo:wt,ano:mt,color:Ht,capacidad_pasajeros:_n}=this.agregarUsuario.value;this.userService.newUser({id:s,genero:a,nombre:f,apellido:x,correo:n,telefono:R,direccion:$,fecha_nacimiento:G,contrase\u00F1a:se,rol:"conductor"}).subscribe(Ut=>{console.log("Usuario registrado:",Ut),localStorage.setItem("correo",this.agregarUsuario.value.correo);let Ln=s;this.userService.addConductor({id_conductor:Ln,numero_licencia:Me,fecha_vencimiento:ke}).subscribe(mi=>{console.log("Conductor registrado:",mi),this.userService.addVehiculo({id_placa:tt,id_conductor:Ln,marca:Ye,modelo:wt,ano:mt,color:Ht,capacidad_pasajeros:_n}).subscribe(Pt=>{console.log("Veh\xEDculo registrado:",Pt),alert("Registro de conductor y veh\xEDculo exitoso"),this.router.navigate(["/bike"]),setTimeout(()=>{this.router.navigate(["/auntentication-login"])},3e3)},Pt=>{console.error("Error al registrar veh\xEDculo:",Pt),alert("Error al registrar el veh\xEDculo. Por favor, intenta nuevamente.")})},mi=>{console.error("Error al registrar conductor:",mi),alert("Error al registrar el conductor. Por favor, intenta nuevamente.")})},Ut=>{console.error("Error al registrar usuario:",Ut),alert("Error al registrar el usuario. Por favor, intenta nuevamente.")})}else this.userService.newUser(this.agregarUsuario.value).subscribe(s=>{console.log("Usuario registrado:",s),localStorage.setItem("correo",this.agregarUsuario.value.correo),alert("Registro exitoso"),this.router.navigate(["/bike"]),setTimeout(()=>{this.router.navigate(["/auntentication-login"])},3e3)},s=>{console.error("Error al registrar usuario:",s),alert("Error al registrar el usuario. Por favor, intenta nuevamente.")});else console.error("Formulario no v\xE1lido"),Object.keys(this.agregarUsuario.controls).forEach(s=>{let a=this.agregarUsuario.get(s)?.errors;a&&console.log(`Control: ${s}`,a)})}togglePasswordVisibility(){this.isPasswordVisible=!this.isPasswordVisible}static \u0275fac=function(a){return new(a||i)(St(bo),St(br),St(zi))};static \u0275cmp=Rn({type:i,selectors:[["app-registro"]],standalone:!0,features:[On],decls:105,vars:17,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],["href",Ui`https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css`,"rel","stylesheet","integrity","sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl","crossorigin","anonymous"],["rel","stylesheet","href",Ui`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css`],[1,"registro-container"],[1,"registro-box"],[1,"title"],[1,"opcion-group"],[1,"tipo-label"],[1,"radio-input"],["type","radio","id","value-1","name","value-radio","value","usuario","checked","",3,"change"],["type","radio","id","value-2","name","value-radio","value","conductor",3,"change"],[1,"selection"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group"],["for","id"],["type","text","id","id","formControlName","id","placeholder","Ingresa tu n\xFAmero de identificaci\xF3n","required",""],[4,"ngIf"],["for","genero"],[1,"container"],[1,"tabs"],["type","radio","id","radio-masculino","name","genero","formControlName","genero","required","",3,"value"],["for","radio-masculino",1,"tab"],["type","radio","id","radio-femenino","name","genero","formControlName","genero","required","",3,"value"],["for","radio-femenino",1,"tab"],[1,"glider"],["for","nombre"],["type","text","id","nombre","formControlName","nombre","placeholder","Ingresa tu nombre","required",""],["for","apellido"],["type","text","id","apellido","formControlName","apellido","placeholder","Ingresa tu apellido","required",""],["for","correo"],["type","email","id","correo","formControlName","correo","placeholder","info@xyz.com","required",""],["for","telefono"],["type","tel","id","telefono","formControlName","telefono","placeholder","+57 315 564 7526","required",""],["for","direccion"],["type","text","id","direccion","formControlName","direccion","placeholder","Ingresa tu direcci\xF3n","required",""],["for","fecha_nacimiento"],["type","date","id","fecha_nacimiento","formControlName","fecha_nacimiento","required",""],["for","contrase\xF1a"],[1,"password-container"],["id","contrase\xF1a","formControlName","contrase\xF1a","placeholder","Ingresa tu contrase\xF1a","required","",3,"type"],["src","assets/images/ojo_cerrado.webp","alt","Mostrar/Ocultar Contrase\xF1a",1,"toggle-password",3,"click","src"],["for","confirmar-contrase\xF1a"],["id","confirmar-contrase\xF1a","formControlName","confirmarContrase\xF1a","placeholder","Confirma tu contrase\xF1a","required","",3,"type"],["type","submit",1,"registarsebtn"],["href","/login"],["src","assets/images/fondoRegistro.webp","alt","registro",1,"imagen-container"],[1,"error"],["class","error",4,"ngIf"],[1,"divider"],["for","numero_licencia"],["type","text","id","numero_licencia","formControlName","numero_licencia","placeholder","Ingresa tu n\xFAmero de licencia"],["for","fecha-vencimiento"],["type","date","id","fecha-vencimiento","formControlName","fecha_vencimiento","required",""],["for","id_placa"],["type","text","id","id_placa","formControlName","id_placa","placeholder","Ingresa el ID de la placa","required",""],["for","marca"],["type","text","id","marca","formControlName","marca","placeholder","Ingresa la marca del veh\xEDculo","required",""],["for","modelo"],["type","text","id","modelo","formControlName","modelo","placeholder","Ingresa el modelo del veh\xEDculo","required",""],["for","ano"],["type","text","id","ano","formControlName","ano","placeholder","Ingresa el a\xF1o","required","","minlength","4","maxlength","4"],["for","color"],["type","text","id","color","formControlName","color","placeholder","Ingresa el color del veh\xEDculo","required",""],["for","capacidad_pasajeros"],["type","text","id","capacidad_pasajeros","formControlName","capacidad_pasajeros","placeholder","Ingresa la capacidad de pasajeros","required",""],[1,"container-btn-file"],["src","assets/images/avatar.webp","alt","perfil Icon"],["name","text","type","file",1,"file"],["src","assets/images/documento.webp","alt","perfil Icon"],[2,"white-space","nowrap"],["name","text","type","file","accept",".pdf",1,"file"]],template:function(a,f){if(a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3)(5,"link",4)(6,"link",5),fe(7,"title"),Pe(8,"Registro - CampusRide"),ue()(),fe(9,"body"),qe(10,"app-header"),fe(11,"main",6)(12,"div",7)(13,"h1",8),Pe(14,"CAMPUSRIDE"),ue(),fe(15,"div",9)(16,"label",10),Pe(17,"Seleccione el tipo de usuario que deseas registrarte"),ue(),fe(18,"div",11)(19,"label")(20,"input",12),Wn("change",function(){return f.onUserTypeChange("usuario")}),ue(),fe(21,"span"),Pe(22,"Usuario"),ue()(),fe(23,"label")(24,"input",13),Wn("change",function(){return f.onUserTypeChange("conductor")}),ue(),fe(25,"span"),Pe(26,"Conductor"),ue()(),qe(27,"span",14),ue()(),fe(28,"form",15),Wn("ngSubmit",function(){return f.onSubmit()}),fe(29,"div",16)(30,"div",17)(31,"label",18),Pe(32,"N\xFAmero de Identificaci\xF3n"),ue(),qe(33,"input",19),yi(34,u6,3,0,"div",20),ue(),fe(35,"div",17)(36,"label",21),Pe(37,"Tipo de g\xE9nero"),ue(),fe(38,"div",22)(39,"div",23),qe(40,"input",24),fe(41,"label",25),Pe(42,"Masculino"),ue(),qe(43,"input",26),fe(44,"label",27),Pe(45,"Femenino"),ue(),qe(46,"span",28),ue()()()(),fe(47,"div",16)(48,"div",17)(49,"label",29),Pe(50,"Nombre"),ue(),qe(51,"input",30),yi(52,d6,3,0,"div",20),ue(),fe(53,"div",17)(54,"label",31),Pe(55,"Apellido"),ue(),qe(56,"input",32),yi(57,h6,3,0,"div",20),ue()(),fe(58,"div",16)(59,"div",17)(60,"label",33),Pe(61,"Correo electr\xF3nico"),ue(),qe(62,"input",34),yi(63,m6,3,2,"div",20),ue(),fe(64,"div",17)(65,"label",35),Pe(66,"N\xFAmero de tel\xE9fono"),ue(),qe(67,"input",36),yi(68,g6,3,0,"div",20),ue()(),fe(69,"div",16)(70,"div",17)(71,"label",37),Pe(72,"Direcci\xF3n"),ue(),qe(73,"input",38),yi(74,_6,3,0,"div",20),ue(),fe(75,"div",17)(76,"label",39),Pe(77,"Fecha de nacimiento"),ue(),qe(78,"input",40),yi(79,y6,3,0,"div",20),ue()(),fe(80,"div",16)(81,"div",17)(82,"label",41),Pe(83,"Contrase\xF1a"),ue(),fe(84,"div",42),qe(85,"input",43),fe(86,"img",44),Wn("click",function(){return f.togglePasswordVisibility()}),ue()(),yi(87,b6,3,2,"div",20),ue(),fe(88,"div",17)(89,"label",45),Pe(90,"Confirmar Contrase\xF1a"),ue(),fe(91,"div",42),qe(92,"input",46),fe(93,"img",44),Wn("click",function(){return f.togglePasswordVisibility()}),ue()(),yi(94,w6,3,0,"div",20),ue()(),yi(95,O6,85,7,"div",20),fe(96,"div",17)(97,"button",47),Pe(98,"Registrarse"),ue()(),fe(99,"p"),Pe(100,"\xBFYa tienes una cuenta? "),fe(101,"a",48),Pe(102,"Iniciar sesi\xF3n"),ue()()()(),qe(103,"img",49),ue(),qe(104,"app-footer"),ue()()),a&2){let x,n,R,$,G,se,Me,ke,tt;Ft(28),qt("formGroup",f.agregarUsuario),Ft(6),qt("ngIf",((x=f.agregarUsuario.get("id"))==null?null:x.invalid)&&(((x=f.agregarUsuario.get("id"))==null?null:x.touched)||((x=f.agregarUsuario.get("id"))==null?null:x.dirty))),Ft(6),qt("value","Masculino"),Ft(3),qt("value","Femenino"),Ft(9),qt("ngIf",((n=f.agregarUsuario.get("nombre"))==null?null:n.invalid)&&(((n=f.agregarUsuario.get("nombre"))==null?null:n.touched)||((n=f.agregarUsuario.get("nombre"))==null?null:n.dirty))),Ft(5),qt("ngIf",((R=f.agregarUsuario.get("apellido"))==null?null:R.invalid)&&(((R=f.agregarUsuario.get("apellido"))==null?null:R.touched)||((R=f.agregarUsuario.get("apellido"))==null?null:R.dirty))),Ft(6),qt("ngIf",(($=f.agregarUsuario.get("correo"))==null?null:$.invalid)&&((($=f.agregarUsuario.get("correo"))==null?null:$.touched)||(($=f.agregarUsuario.get("correo"))==null?null:$.dirty))),Ft(5),qt("ngIf",((G=f.agregarUsuario.get("telefono"))==null?null:G.invalid)&&(((G=f.agregarUsuario.get("telefono"))==null?null:G.touched)||((G=f.agregarUsuario.get("telefono"))==null?null:G.dirty))),Ft(6),qt("ngIf",((se=f.agregarUsuario.get("direccion"))==null?null:se.invalid)&&(((se=f.agregarUsuario.get("direccion"))==null?null:se.touched)||((se=f.agregarUsuario.get("direccion"))==null?null:se.dirty))),Ft(5),qt("ngIf",((Me=f.agregarUsuario.get("fechaNacimiento"))==null?null:Me.invalid)&&(((Me=f.agregarUsuario.get("fecha_nacimiento"))==null?null:Me.touched)||((Me=f.agregarUsuario.get("fecha_nacimiento"))==null?null:Me.dirty))),Ft(6),qt("type",f.isPasswordVisible?"text":"password"),Ft(),qt("src",f.isPasswordVisible?"assets/images/ojo_abierto.webp":"assets/images/ojo_cerrado.webp",Qa),Ft(),qt("ngIf",((ke=f.agregarUsuario.get("contrase\xF1a"))==null?null:ke.invalid)&&(((ke=f.agregarUsuario.get("contrase\xF1a"))==null?null:ke.touched)||((ke=f.agregarUsuario.get("contrase\xF1a"))==null?null:ke.dirty))),Ft(5),qt("type",f.isPasswordVisible?"text":"password"),Ft(),qt("src",f.isPasswordVisible?"assets/images/ojo_abierto.webp":"assets/images/ojo_cerrado.webp",Qa),Ft(),qt("ngIf",((tt=f.agregarUsuario.get("confirmarContrase\xF1a"))==null?null:tt.invalid)&&(((tt=f.agregarUsuario.get("confirmarContrase\xF1a"))==null?null:tt.touched)||((tt=f.agregarUsuario.get("confirmarContrase\xF1a"))==null?null:tt.dirty))),Ft(),qt("ngIf",f.tipoUsuario==="conductor")}},dependencies:[Ji,jr,vr,qC,Br,Vr,so,ug,nd,ro,oo,cs,Bs,Mc,us],styles:[JR,JR]})};var KR='-webkit-[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}body[_ngcontent-%COMP%]{background:#fff}.container[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:250px;height:150px;color:#000;font-family:droid-sans,sans-serif}.bike-body[_ngcontent-%COMP%]{width:250px;height:108px;position:relative;left:-20px;top:3px;z-index:1}.bike-body[_ngcontent-%COMP%]   .seat[_ngcontent-%COMP%]{width:30px;height:30px;background:radial-gradient(circle at right top,#f8503200,#f16f5c0050%,#f6290c0051%,#f22dbe0064%,#434b59 65% 71%,#434b59);background-position:center;background-repeat:no-repeat;transform:rotate(-40deg);position:absolute;top:64px;left:65px}.bike-body[_ngcontent-%COMP%]   .seat[_ngcontent-%COMP%]:before{content:"";display:block;width:9px;height:35px;position:relative;top:-2px;left:-4px;background:#434b59;border-radius:5px}.bike-body[_ngcontent-%COMP%]   .seat[_ngcontent-%COMP%]:after{content:"";display:block;width:35px;height:9px;position:relative;top:-10px;left:-4px;background:#434b59;border-radius:5px}.bike-body[_ngcontent-%COMP%]   .cover[_ngcontent-%COMP%]{width:75px;height:30px;background:#7145e6;position:absolute;top:55px;left:105px;border-top-color:transparent;border-left-color:transparent;border-radius:110px 20px 15px 5px/50px 20px 20px 5px;z-index:11;box-shadow:inset -5px -2px 0 2px #0003}.bike-body[_ngcontent-%COMP%]   .lamp[_ngcontent-%COMP%]{width:25px;height:25px;background:-webkit-gradient(linear,left top,right top,color-stop(65%,#434b59),color-stop(35%,#ffdd4d));background:linear-gradient(90deg,#434b59 65%,#ffdd4d 35%);border-radius:70px 60px 60px 50px/40px 60px 60px 15px;position:relative;top:60px;right:-185px}.bike-body[_ngcontent-%COMP%]   .motor[_ngcontent-%COMP%]{width:75px;height:45px;position:absolute;left:90px;top:90px}.part-1[_ngcontent-%COMP%]{width:35px;height:45px;display:inline-block}.part-1-top[_ngcontent-%COMP%]{width:40px;height:20px;background:linear-gradient(135deg,transparent 10px,#8450e1 0);border-radius:0 px 5px 5px;box-shadow:inset -25px -2px 0 1px #0003}.part-1-bottom[_ngcontent-%COMP%]{width:35px;height:17px;background:#829399;position:relative;top:5px;border-radius:5px}.part-1-bottom[_ngcontent-%COMP%]:after{content:"";display:block;width:17px;height:17px;border-radius:50%;background:#829399;border:3px solid #a2b1b7;position:relative;left:13px;top:-3px}.part-2[_ngcontent-%COMP%]{width:30px;height:45px;display:inline-block;animation:_ngcontent-%COMP%_shake .1s infinite}.part-2-base[_ngcontent-%COMP%]{width:25px;height:33px;background:#a4b4ba;margin:auto;position:relative;top:5px;left:5px;border-radius:15px}.line[_ngcontent-%COMP%]{position:relative;margin:auto auto 6px;width:105%;left:-2px;top:-2px;height:4px;background:#829399;border-radius:3px}.line[_ngcontent-%COMP%]:nth-child(1){height:6px;background:#434b59;top:0}.front[_ngcontent-%COMP%]{position:absolute;width:10px;height:100px;background:#aababf;transform:rotate(-30deg);right:53px;top:40px;border-radius:7px;z-index:10}.front[_ngcontent-%COMP%]:before{content:"";display:block;width:25px;height:6px;background:#434b59;border-radius:5px;transform:rotate(30deg);left:-18px;top:-7px;position:relative}.front[_ngcontent-%COMP%]:after{content:"";display:block;width:12px;height:12px;background:#434b59;position:absolute;border-radius:50%;top:-5px}.back[_ngcontent-%COMP%]{position:absolute;width:120px;box-sizing:content-box;border:10px solid #aababf;border-top-color:transparent;border-right-color:transparent;border-left-color:transparent;bottom:-40px;left:30px;z-index:10}.back[_ngcontent-%COMP%]:before{content:"";display:block;width:75px;height:13px;background:#aababf;position:absolute;top:2px;left:123px;transform-origin:0px;transform:rotate(-70deg);border-radius:0 0 10px}.back[_ngcontent-%COMP%]:after{content:"";display:block;width:80px;height:9px;background:transparent;position:absolute;border:10px solid #aababf;border-left-color:transparent;border-bottom-color:transparent;border-radius:0 10px 0 0;transform:skew(20deg);top:-18px;left:-50px}.tire[_ngcontent-%COMP%]{position:absolute;width:50px;height:50px;left:10px;border-radius:50%;background:#ccc;border:15px solid #fff;box-shadow:0 0 0 10px #454d5b;animation:_ngcontent-%COMP%_motion .8s linear infinite}@keyframes _ngcontent-%COMP%_motion{0%{transform:translateY(0)}50%{transform:translateY(3px)}to{transform:translateY(0)}}.tire[_ngcontent-%COMP%]:before{content:"";display:block;width:50px;height:50px;border:10px solid transparent;border-top-color:#8450e1;border-radius:50%;background:transparent;position:relative;top:-30px;left:-15px}.tire[_ngcontent-%COMP%]:after{content:"";display:block;width:50px;height:50px;border:4px solid transparent;border-top-color:#0003;border-radius:50%;background:transparent;position:relative;top:-80px;left:-15px;z-index:9}.tire2[_ngcontent-%COMP%]{position:absolute;width:50px;height:50px;right:5px;border-radius:50%;background:#ccc;border:15px solid #fff;box-shadow:0 0 0 10px #454d5b;animation:_ngcontent-%COMP%_motion .8s linear infinite}.tire2[_ngcontent-%COMP%]:before{content:"";display:block;width:50px;height:40px;border:10px solid transparent;border-top-color:#8450e1;border-radius:50%;background:transparent;position:relative;top:-30px;left:-20px;transform:rotate(-25deg)}.smoke[_ngcontent-%COMP%]{width:15px;height:15px;background:#000;border-radius:50%;position:absolute;top:120px;left:-50px;animation:_ngcontent-%COMP%_fly 1s infinite}.smoke[_ngcontent-%COMP%]:before{content:"";display:block;width:12px;height:12px;border-radius:50%;background:#000;position:relative;right:-12px;top:5px}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:rotate(0)}25%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}@keyframes _ngcontent-%COMP%_fly{0%,to{opacity:1}35%,to{opacity:0;top:100px;left:-70px}50%{transform:rotate(5deg)}}.progress-container[_ngcontent-%COMP%]{position:absolute;top:520px;left:50%;transform:translate(-50%)}.progress[_ngcontent-%COMP%]{background-color:#fff;width:275px;height:20px;border-radius:100px;overflow:hidden;backface-visibility:hidden;position:relative}.label-container[_ngcontent-%COMP%]{position:absolute;top:160px;left:-10px;width:100%;height:100%;display:flex;justify-content:center;align-items:center;font-size:1.5em;color:#454d5b;font-weight:700;animation:_ngcontent-%COMP%_bit .6s alternate infinite}.inner[_ngcontent-%COMP%]{background-image:linear-gradient(to left,#000,#1c1c1c,#383838,#555,#717171,#8d8d8d,#aaa,#c6c6c6,#e2e2e2,#fff);height:100%;transform-origin:left;animation:_ngcontent-%COMP%_progress 10s infinite}@keyframes _ngcontent-%COMP%_progress{0%{transform:scaleX(.1) translate(-10%)}to{transform:scaleX(.8) translate(150%)}}@keyframes _ngcontent-%COMP%_bit{0%{opacity:.3}to{opacity:1}}.lamp-post[_ngcontent-%COMP%]{position:absolute;top:-80px;left:250px;height:200px;animation:_ngcontent-%COMP%_moveLamp 1.4s linear infinite;z-index:2}@keyframes _ngcontent-%COMP%_moveLamp{0%{left:100%}to{left:-100px}}.road[_ngcontent-%COMP%]{width:100%;height:5px;background-color:#454d5b;position:relative;bottom:-60px;left:-60px;align-self:flex-end;border-radius:3px}.road[_ngcontent-%COMP%]:before{content:"";position:absolute;width:30px;height:100%;background-color:#454d5b;right:-50%;border-radius:3px;animation:_ngcontent-%COMP%_roadAnimation 1.4s linear infinite;border-left:10px solid white}.road[_ngcontent-%COMP%]:after{content:"";position:absolute;width:20px;height:100%;background-color:#454d5b;right:-65%;border-radius:3px;animation:_ngcontent-%COMP%_roadAnimation 1.4s linear infinite;border-left:4px solid white}@keyframes _ngcontent-%COMP%_roadAnimation{0%{transform:translate(0)}to{transform:translate(-350px)}}',Zv=class i{constructor(s){this.router=s}ngOnInit(){}static \u0275fac=function(a){return new(a||i)(St(zi))};static \u0275cmp=Rn({type:i,selectors:[["app-bike"]],standalone:!0,features:[On],decls:32,vars:0,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],[1,"container"],[1,"bike-body"],[1,"seat"],[1,"cover"],[1,"lamp"],[1,"motor"],[1,"part-1"],[1,"part-1-top"],[1,"part-1-bottom"],[1,"part-2"],[1,"part-2-base"],[1,"line"],[1,"front"],[1,"back"],[1,"tire"],[1,"tire2"],[1,"road"],[1,"smoke"],[1,"label-container"]],template:function(a,f){a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3),fe(5,"title"),Pe(6,"Bike - CampusRide"),ue()(),fe(7,"body")(8,"div",4)(9,"div",5),qe(10,"div",6)(11,"div",7)(12,"div",8),fe(13,"div",9)(14,"div",10),qe(15,"div",11)(16,"div",12),ue(),fe(17,"div",13)(18,"div",14),qe(19,"div",15)(20,"div",15)(21,"div",15)(22,"div",15),ue()()(),qe(23,"div",16)(24,"div",17),ue(),qe(25,"div",18)(26,"div",19)(27,"div",20)(28,"div",21),ue(),fe(29,"div",22)(30,"label"),Pe(31,"Cargando"),ue()()()())},dependencies:[Ji],styles:[KR,KR]})};function L6(i,s){i&1&&(fe(0,"h2",14),Pe(1,"RECUPERAR CONTRASE\xD1A"),ue())}function F6(i,s){i&1&&(fe(0,"p",15),Pe(1," Ingresa el correo electr\xF3nico asociado a tu cuenta y te enviaremos un c\xF3digo de verificaci\xF3n para restablecer tu contrase\xF1a. "),ue())}function k6(i,s){i&1&&(fe(0,"div")(1,"small",21),Pe(2,"Por favor, ingresa un correo v\xE1lido."),ue()())}function N6(i,s){if(i&1){let a=Wm();fe(0,"div")(1,"form",16),Wn("ngSubmit",function(){jm(a);let x=ss();return Um(x.onSubmit())}),fe(2,"div",17)(3,"label",18),Pe(4,"Correo electr\xF3nico"),ue(),qe(5,"input",19),yi(6,k6,3,0,"div",13),ue(),fe(7,"div",17)(8,"button",20),Pe(9,"Enviar c\xF3digo"),ue()()()()}if(i&2){let a,f=ss();Ft(),qt("formGroup",f.recovery),Ft(5),qt("ngIf",((a=f.recovery.get("correo"))==null?null:a.invalid)&&(((a=f.recovery.get("correo"))==null?null:a.touched)||f.recoverySubmitted))}}function z6(i,s){i&1&&(fe(0,"div")(1,"small",21),Pe(2,"Por favor, ingresa el c\xF3digo de verificaci\xF3n."),ue()())}function B6(i,s){if(i&1){let a=Wm();fe(0,"div")(1,"form",16),Wn("ngSubmit",function(){jm(a);let x=ss();return Um(x.onVerifyCode())}),fe(2,"div",17)(3,"p",15),Pe(4," Ingresa el c\xF3digo de verificaci\xF3n que te enviamos por correo electr\xF3nico. "),ue(),fe(5,"label",22),Pe(6,"C\xF3digo de verificaci\xF3n"),ue(),qe(7,"input",23),yi(8,z6,3,0,"div",13),ue(),fe(9,"div",17)(10,"button",20),Pe(11,"Verificar c\xF3digo"),ue()()()()}if(i&2){let a,f=ss();Ft(),qt("formGroup",f.verification),Ft(7),qt("ngIf",((a=f.verification.get("codigo_verificacion"))==null?null:a.invalid)&&f.verificationCodeSubmitted)}}var QR="body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Montserrat,sans-serif}.password-recovery-container[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 60px);display:flex;justify-content:center;align-items:center;overflow:hidden}.image-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden}.background-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;z-index:-1}.password-recovery-box[_ngcontent-%COMP%]{border-width:2px;border-style:solid;border-color:#7145d6;background:#fff;box-shadow:2px 5px 10px #0000001a;border-radius:20px;padding:20px 40px;width:90%;max-width:400px;z-index:1}.password-recovery-header[_ngcontent-%COMP%]{color:#000;font-size:14px;font-weight:600;text-transform:uppercase;margin-bottom:10px;text-align:center}.password-recovery-subtitulo[_ngcontent-%COMP%]{color:#6c6c6c;font-size:11px;font-weight:500;margin-bottom:20px}.password-recovery-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]{margin-bottom:15px;width:100%}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#6c6c6c;font-size:14px}input[type=email][_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:10px;font-family:Montserrat,sans-serif;font-weight:500;word-wrap:break-word}p[_ngcontent-%COMP%]{margin-top:10px;font-size:12px;text-align:left}input[type=text][_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:10px;font-family:Montserrat,sans-serif;font-weight:500;word-wrap:break-word}.error-message[_ngcontent-%COMP%]{color:red;font-size:10px;margin-top:5px}",Xv=class i{constructor(s,a,f){this.fb=s;this.userService=a;this.router=f;this.recovery=this.fb.group({correo:["",[Ot.required,Ot.email]]}),this.verification=this.fb.group({codigo_verificacion:["",Ot.required]})}recovery;showVerification=!1;verification;recoverySubmitted=!1;verificationCodeSubmitted=!1;ngOnInit(){}onSubmit(){if(this.recovery.valid)console.log(this.recovery.value),this.userService.recuperarContrasena(this.recovery.value).subscribe(s=>{console.log("Solicitud de recuperaci\xF3n de contrase\xF1a enviada:",s),alert("Se enviar\xE1 un c\xF3digo a tu correo para que restablezcas tu contrase\xF1a."),this.showVerification=!0},s=>{console.error("Error en la recuperaci\xF3n de contrase\xF1a:",s),alert("Hubo un error al procesar la solicitud. Intenta nuevamente.")});else{console.error("Formulario no v\xE1lido");let s=this.recovery.get("correo")?.errors;s&&console.log("Error en el campo correo:",s)}}onVerifyCode(){if(this.verificationCodeSubmitted=!0,this.verification.valid){let s={correo:this.recovery.get("correo")?.value,codigo_verificacion:this.verification.get("codigo_verificacion")?.value};this.userService.verificarCodigo(s).subscribe(a=>{if(a.success){console.log("C\xF3digo verificado correctamente:",a),alert("C\xF3digo de verificaci\xF3n correcto");let f=this.recovery.get("correo")?.value,x=this.verification.get("codigo_verificacion")?.value;this.router.navigate(["/new-password",f])}else console.error("C\xF3digo de verificaci\xF3n incorrecto"),alert("C\xF3digo de verificaci\xF3n incorrecto. Int\xE9ntalo de nuevo.")},a=>{console.error("Error al verificar el c\xF3digo:",a),alert("Error al verificar el c\xF3digo. Intenta nuevamente.")})}else console.error("Formulario de verificaci\xF3n no v\xE1lido"),alert("Por favor, ingresa el c\xF3digo de verificaci\xF3n.")}static \u0275fac=function(a){return new(a||i)(St(bo),St(br),St(zi))};static \u0275cmp=Rn({type:i,selectors:[["app-password-recovery"]],standalone:!0,features:[On],decls:22,vars:4,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],["href",Ui`https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css`,"rel","stylesheet","integrity","sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl","crossorigin","anonymous"],["rel","stylesheet","href",Ui`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css`],[1,"password-recovery-container"],[1,"image-container"],["src","assets/images/fondologin.png","alt","Fondo",1,"background-image"],[1,"password-recovery-box"],[1,"title"],["class","password-recovery-header",4,"ngIf"],["class","password-recovery-subtitulo",4,"ngIf"],[4,"ngIf"],[1,"password-recovery-header"],[1,"password-recovery-subtitulo"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","email"],["type","email","id","email","formControlName","correo","placeholder","Ingresa tu correo","required",""],["type","submit",1,"bt"],[1,"error-message"],["for","code"],["type","text","id","code","placeholder","Ingresa el c\xF3digo","formControlName","codigo_verificacion","required",""]],template:function(a,f){a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3)(5,"link",4)(6,"link",5),fe(7,"title"),Pe(8,"Password-recovery - CampusRide"),ue()(),fe(9,"body"),qe(10,"app-header"),fe(11,"main",6)(12,"div",7),qe(13,"img",8),ue(),fe(14,"div",9)(15,"h1",10),Pe(16,"CAMPUSRIDE"),ue(),yi(17,L6,2,0,"h2",11)(18,F6,2,0,"p",12)(19,N6,10,2,"div",13)(20,B6,12,2,"div",13),ue()(),qe(21,"app-footer"),ue()()),a&2&&(Ft(17),qt("ngIf",!f.showVerification),Ft(),qt("ngIf",!f.showVerification),Ft(),qt("ngIf",!f.showVerification),Ft(),qt("ngIf",f.showVerification))},dependencies:[cs,us,Ji,jr,vr,Br,Vr,so,ro,oo,Mv,Bs,Mc],styles:[QR,QR]})};function V6(i,s){i&1&&(fe(0,"small",24),Pe(1,"La contrase\xF1a es obligatoria."),ue())}function j6(i,s){i&1&&(fe(0,"small",24),Pe(1,"La contrase\xF1a debe tener al menos 6 caracteres."),ue())}function U6(i,s){if(i&1&&(fe(0,"div"),yi(1,V6,2,0,"small",23)(2,j6,2,0,"small",23),ue()),i&2){let a,f,x=ss();Ft(),qt("ngIf",(a=x.establecerPassword.get("nuevaContrasena"))==null||a.errors==null?null:a.errors.required),Ft(),qt("ngIf",(f=x.establecerPassword.get("nuevaContrasena"))==null||f.errors==null?null:f.errors.minlength)}}function $6(i,s){i&1&&(fe(0,"div")(1,"small",24),Pe(2,"Debes confirmar tu contrase\xF1a."),ue()())}var eO="body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Montserrat,sans-serif}.newpassword-container[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 60px);display:flex;justify-content:center;align-items:center;overflow:hidden}.image-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden}.background-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;z-index:-1}.newpassword-box[_ngcontent-%COMP%]{border-width:2px;border-style:solid;border-color:#7145d6;background:#fff;box-shadow:2px 5px 10px #0000001a;border-radius:20px;padding:20px 40px;width:90%;max-width:400px;z-index:1}.newpassword-header[_ngcontent-%COMP%]{color:#000;font-size:14px;font-weight:600;text-transform:uppercase;margin-bottom:10px;text-align:center}.newpassword-subtitulo[_ngcontent-%COMP%]{color:#6c6c6c;font-size:11px;font-weight:500;margin-bottom:20px}.newpassword-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]{margin-bottom:15px;width:100%}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#6c6c6c;font-size:14px}input[type=password][_ngcontent-%COMP%], input[type=text][_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:10px;font-family:Montserrat,sans-serif;font-weight:500;word-wrap:break-word}.password-container[_ngcontent-%COMP%]{position:relative;width:100%}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;width:20px;height:20px}p[_ngcontent-%COMP%]{margin-top:10px;font-size:12px;text-align:center}a[_ngcontent-%COMP%]{color:#8450e1;text-decoration:none}",Yv=class i{constructor(s,a,f,x){this.fb=s;this.userService=a;this.router=f;this.route=x;this.establecerPassword=this.fb.group({nuevaContrasena:["",[Ot.required,Ot.minLength(6)]],confirmarContrasena:["",[Ot.required,Ot.minLength(6)]]})}establecerPassword;isPasswordVisible=!1;isConfirmPasswordVisible=!1;correo="";ngOnInit(){this.correo=this.route.snapshot.paramMap.get("correo")||"",console.log("Correo recibido:",this.correo)}togglePasswordVisibility(){this.isPasswordVisible=!this.isPasswordVisible}toggleConfirmPasswordVisibility(){this.isConfirmPasswordVisible=!this.isConfirmPasswordVisible}onSubmit(){if(this.establecerPassword.valid){let{nuevaContrasena:s,confirmarContrasena:a}=this.establecerPassword.value;if(s===a){console.log("Contrase\xF1a establecida:",s),alert("La contrase\xF1a se ha establecido correctamente.");let f={correo:this.correo,contrase\u00F1a:s};this.userService.establecerContrasena(f).subscribe({next:x=>{console.log("Respuesta del servidor:",x),this.router.navigate(["/bike"])},error:x=>{console.error("Error al establecer la contrase\xF1a:",x),alert("Error al establecer la contrase\xF1a. Por favor, int\xE9ntalo de nuevo.")}})}else alert("Las contrase\xF1as no coinciden. Por favor, int\xE9ntalo de nuevo.")}else console.error("Formulario no v\xE1lido")}static \u0275fac=function(a){return new(a||i)(St(bo),St(br),St(zi),St(ya))};static \u0275cmp=Rn({type:i,selectors:[["app-newpassword"]],standalone:!0,features:[On],decls:40,vars:7,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],["href",Ui`https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css`,"rel","stylesheet","integrity","sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl","crossorigin","anonymous"],["rel","stylesheet","href",Ui`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css`],[1,"newpassword-container"],[1,"image-container"],["src","assets/images/fondologin.png","alt","Fondo de establecimiento de nueva contrase\xF1a",1,"background-image"],[1,"newpassword-box"],[1,"title"],[1,"newpassword-header"],[1,"newpassword-subtitulo"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","password"],[1,"password-container"],["id","password","formControlName","nuevaContrasena","placeholder","Ingresa tu nueva contrase\xF1a","required","",3,"type"],["src","assets/images/ojo_cerrado.png","alt","Mostrar/Ocultar Contrase\xF1a",1,"toggle-password",3,"click","src"],[4,"ngIf"],["for","confirmPassword"],["id","confirmPassword","formControlName","confirmarContrasena","placeholder","Confirma tu nueva contrase\xF1a","required","",3,"type"],["type","submit",1,"bt"],["class","error",4,"ngIf"],[1,"error"]],template:function(a,f){if(a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3),fe(5,"title"),Pe(6,"New-password - CampusRide"),ue(),qe(7,"link",4)(8,"link",5),ue(),fe(9,"body"),qe(10,"app-header"),fe(11,"main",6)(12,"div",7),qe(13,"img",8),ue(),fe(14,"div",9)(15,"h1",10),Pe(16,"CAMPUSRIDE"),ue(),fe(17,"h2",11),Pe(18,"ESTABLECER NUEVA CONTRASE\xD1A"),ue(),fe(19,"p",12),Pe(20,"Ingresa tu nueva contrase\xF1a para restablecer tu acceso a la cuenta."),ue(),fe(21,"form",13),Wn("ngSubmit",function(){return f.onSubmit()}),fe(22,"div",14)(23,"label",15),Pe(24,"Nueva Contrase\xF1a"),ue(),fe(25,"div",16),qe(26,"input",17),fe(27,"img",18),Wn("click",function(){return f.togglePasswordVisibility()}),ue()(),yi(28,U6,3,2,"div",19),ue(),fe(29,"div",14)(30,"label",20),Pe(31,"Confirmar Contrase\xF1a"),ue(),fe(32,"div",16),qe(33,"input",21),fe(34,"img",18),Wn("click",function(){return f.toggleConfirmPasswordVisibility()}),ue()(),yi(35,$6,3,0,"div",19),ue(),fe(36,"div",14)(37,"button",22),Pe(38,"Establecer Contrase\xF1a"),ue()()()()(),qe(39,"app-footer"),ue()()),a&2){let x,n;Ft(21),qt("formGroup",f.establecerPassword),Ft(5),qt("type",f.isPasswordVisible?"text":"password"),Ft(),qt("src",f.isPasswordVisible?"assets/images/ojo_abierto.png":"assets/images/ojo_cerrado.png",Qa),Ft(),qt("ngIf",((x=f.establecerPassword.get("nuevaContrasena"))==null?null:x.invalid)&&(((x=f.establecerPassword.get("nuevaContrasena"))==null?null:x.touched)||((x=f.establecerPassword.get("nuevaContrasena"))==null?null:x.dirty))),Ft(5),qt("type",f.isConfirmPasswordVisible?"text":"password"),Ft(),qt("src",f.isConfirmPasswordVisible?"assets/images/ojo_abierto.png":"assets/images/ojo_cerrado.png",Qa),Ft(),qt("ngIf",((n=f.establecerPassword.get("confirmarContrasena"))==null?null:n.invalid)&&(((n=f.establecerPassword.get("confirmarContrasena"))==null?null:n.touched)||((n=f.establecerPassword.get("confirmarContrasena"))==null?null:n.dirty)))}},dependencies:[cs,Ji,jr,vr,Br,Vr,so,ro,oo,Bs,Mc,us],styles:[eO,eO]})};var tO=".c-img[_ngcontent-%COMP%]{height:100%;object-fit:cover;filter:brightness(1)}.btn[_ngcontent-%COMP%]{margin-top:37.5%;border:none;color:#7145d6;background-color:#fff;font-weight:700;font-size:1rem;text-decoration:none}.btn[_ngcontent-%COMP%]:hover{background-color:#7145d6;color:#fff}",Tf=class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Rn({type:i,selectors:[["app-slider"]],standalone:!0,features:[On],decls:37,vars:0,consts:[["lang","en"],["charset","UTF-8"],["http-equiv","X-UA-Compatible","content","IE=edge"],["name","viewport","content","width=device-width, initial-scale=1.0"],["id","home-carousel","data-bs-ride","carousel",1,"carousel","slide"],[1,"carousel-indicators"],["type","button","data-bs-target","#home-carousel","data-bs-slide-to","0","aria-current","true","aria-label","Slide 1",1,"active"],["type","button","data-bs-target","#home-carousel","data-bs-slide-to","1","aria-label","Slide 2"],["type","button","data-bs-target","#home-carousel","data-bs-slide-to","2","aria-label","Slide 3"],[1,"carousel-inner"],[1,"carousel-item","active","c-item"],["src","assets/images/1.webp","alt","Slide 1",1,"d-block","w-100","c-img"],[1,"carousel-caption","top-0","mt-4"],["href","/login",1,"btn","btn-primary","px-4","py-2","fs-5"],[1,"carousel-item","c-item"],["src","assets/images/2.webp","alt","Slide 2",1,"d-block","w-100","c-img"],["src","assets/images/3.webp","alt","Slide 3",1,"d-block","w-100","c-img"],["type","button","data-bs-target","#home-carousel","data-bs-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],[1,"visually-hidden"],["type","button","data-bs-target","#home-carousel","data-bs-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"]],template:function(a,f){a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3),fe(5,"title"),Pe(6,"Slider - CampusRide"),ue()(),fe(7,"body")(8,"div",4)(9,"div",5),qe(10,"button",6)(11,"button",7)(12,"button",8),ue(),fe(13,"div",9)(14,"div",10),qe(15,"img",11),fe(16,"div",12)(17,"a",13),Pe(18,"\xA1Viajar Ahora!"),ue()()(),fe(19,"div",14),qe(20,"img",15),fe(21,"div",12)(22,"a",13),Pe(23,"\xA1Viajar Ahora!"),ue()()(),fe(24,"div",14),qe(25,"img",16),fe(26,"div",12)(27,"a",13),Pe(28,"\xA1Viajar Ahora!"),ue()()()(),fe(29,"button",17),qe(30,"span",18),fe(31,"span",19),Pe(32,"Anterior"),ue()(),fe(33,"button",20),qe(34,"span",21),fe(35,"span",19),Pe(36,"Siguiente"),ue()()()()())},styles:[tO,tO]})};var nO='.btn[_ngcontent-%COMP%]{background-color:#7145d6;color:#fff;border:none;border-radius:10px}.login-text[_ngcontent-%COMP%]:hover{background-color:#fff;color:#8550e1}.header-logo[_ngcontent-%COMP%]{width:75 px;height:75px;transition:all 2 s}.header[_ngcontent-%COMP%]{display:flex;width:100%;height:80px;padding-top:5 px;color:#fff;background-color:#8550e1}.header-logo[_ngcontent-%COMP%]{cursor:pointer}.header-logo[_ngcontent-%COMP%]:hover, .header-item[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.header-right[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]{background:#7145d6;color:#fff;font-size:15px;font-weight:700;padding:5px 15px;border-radius:50px;cursor:pointer;transition:background-color .3s ease;text-decoration:none}.header-left[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]{background:#8550e1;color:#fff;font-size:15px;font-weight:700;padding:5px 8px;border-radius:50px;cursor:pointer;transition:background-color .3s ease}.header-left[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]:hover{background-color:#7145d6}.about-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:3rem;color:#7145d6;text-align:center;margin-top:30%}.about-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;text-align:justify;margin-top:20px}.comunidad-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:3rem;color:#7145d6;text-align:center;margin-top:20%}.comunidad-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;text-align:justify;margin-top:20px}.rating[_ngcontent-%COMP%]{margin-right:40%}.rating[_ngcontent-%COMP%]:not(:checked) > input[_ngcontent-%COMP%]{position:absolute;appearance:none}.rating[_ngcontent-%COMP%]:not(:checked) > label[_ngcontent-%COMP%]{float:right;cursor:pointer;font-size:30px;color:#666}.rating[_ngcontent-%COMP%]:not(:checked) > label[_ngcontent-%COMP%]:before{content:"\\2605"}.rating[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:hover, .rating[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]:hover ~ label[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]:hover, .rating[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]:hover ~ label[_ngcontent-%COMP%], .rating[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]:hover ~ input[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{color:#e58e09}.rating[_ngcontent-%COMP%]:not(:checked) > label[_ngcontent-%COMP%]:hover, .rating[_ngcontent-%COMP%]:not(:checked) > label[_ngcontent-%COMP%]:hover ~ label[_ngcontent-%COMP%]{color:#ff9e0b}.rating[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{color:#ffa723}#bg-contactos[_ngcontent-%COMP%]{position:relative;top:-130px}#seccion-contacto[_ngcontent-%COMP%]{background-color:#8550e1;min-height:500px;position:relative}#contenedor-formulario[_ngcontent-%COMP%]{border:#7145d6;border-width:3px;border-style:solid;position:absolute;top:30%;left:50%;padding:20px;width:50%;transform:translate(-50%,-50%);background:#fff;border-radius:25px}#titulo-formulario[_ngcontent-%COMP%]{color:#3f3f3f}.btn[_ngcontent-%COMP%]:hover{background-color:#8550e1;color:#fff}footer[_ngcontent-%COMP%]{background:#8550e1;min-height:100px;padding:20px}footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;text-align:center;margin-left:20px;margin-right:20px}#iconos[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:26px;color:#fff}#iconos[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:50px;margin-right:20px}@media (max-width:1200px){#intro[_ngcontent-%COMP%], #equipo[_ngcontent-%COMP%]{width:90%!important;margin:auto}#local[_ngcontent-%COMP%]{flex-wrap:wrap;padding-top:30px}.wrapper-local[_ngcontent-%COMP%]{width:90%;margin:auto;padding-top:50px}}@media (max-width:768px){#intro[_ngcontent-%COMP%], #equipo[_ngcontent-%COMP%]{width:90%!important;margin:auto}#img-equipo[_ngcontent-%COMP%]{max-height:20rem!important;width:90%}.wrapper-local[_ngcontent-%COMP%]{width:90%;margin:auto;padding-top:50px}#local[_ngcontent-%COMP%]{flex-wrap:wrap}.mapa[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto}#bg-contactos[_ngcontent-%COMP%]{top:-120px}}@media (max-width: 576px){#servicios-fila-2[_ngcontent-%COMP%], #servicios-fila-1[_ngcontent-%COMP%]{width:100%!important}.icono-wrap[_ngcontent-%COMP%]{flex-wrap:wrap!important;justify-content:center!important;text-align:center}}',Jv=class i{constructor(s,a){this.apiService=s;this.formBuilder=a;this.helpForm=this.formBuilder.group({nombre:["",Ot.required],correo:["",[Ot.required,Ot.email]],telefono:[""],comentario:["",Ot.required]})}helpForm;onSubmit(){this.helpForm.valid?this.apiService.createHelpDeskRequest(this.helpForm.value).subscribe(s=>{alert("Su mensaje ha sido enviado correctamente."),this.helpForm.reset({nombre:"",correo:"",telefono:"",comentario:""})},s=>{alert("Hubo un error al enviar el mensaje. Int\xE9ntelo de nuevo.")}):alert("Por favor, complete los campos obligatorios.")}static \u0275fac=function(a){return new(a||i)(St(br),St(bo))};static \u0275cmp=Rn({type:i,selectors:[["app-home"]],standalone:!0,features:[On],decls:109,vars:2,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],["href",Ui`https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css`,"rel","stylesheet","integrity","sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH","crossorigin","anonymous"],["rel","stylesheet","href",Ui`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css`],[1,"header"],[1,"header-left"],[1,"header-logo-container"],["href","/home"],["src","assets/images/logohome.webp","alt","CampusRide","width","80","height","90",1,"header-logo"],[1,"header-content"],[1,"header-item"],[1,"login-text2"],[1,"header-right"],["routerLink","/login",1,"login-text"],["routerLink","/registro",1,"login-text"],["id","about",1,"about","section-padding"],[1,"container"],[1,"row"],[1,"col-lg-6","col-md-12","col-12"],[1,"about-img"],["alt","","src","assets/images/aboutus.webp",1,"img-fluid"],[1,"about-text"],["id","seccion-comunidad",1,"border-bottom","border-secondary","border-2"],[1,"col-lg-6","col-md-12"],[1,"comunidad-text"],[1,"rating"],["value","5","name","rate","id","star5","type","radio","checked",""],["title","text","for","star5"],["value","4","name","rate","id","star4","type","radio"],["title","text","for","star4"],["value","3","name","rate","id","star3","type","radio"],["title","text","for","star3"],["value","2","name","rate","id","star2","type","radio"],["title","text","for","star2"],["value","1","name","rate","id","star1","type","radio"],["title","text","for","star1"],["alt","","src","assets/images/comunidad.webp",1,"img-fluid"],["id","seccion-contacto",1,"border-bottom","border-secondary","border-2"],["id","bg-contactos"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 1440 320"],["fill","#8550e1","fill-opacity","1","d","M0,32L120,42.7C240,53,480,75,720,74.7C960,75,1200,53,1320,42.7L1440,32L1440,320L1320,320C1200,320,960,320,720,320C480,320,240,320,120,320L0,320Z"],["id","contenedor-formulario",1,"containercontacto",2,"max-width","500px"],["id","titulo-formulario",1,"text-center","mb-4"],[1,"fs-5"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["type","email","formControlName","correo","placeholder","Correo",1,"form-control"],["type","text","formControlName","nombre","placeholder","Nombre",1,"form-control"],["type","tel","formControlName","telefono","placeholder","Tel\xE9fono",1,"form-control"],["formControlName","comentario","placeholder","Dudas, reclamos o sugerencias","rows","4",1,"form-control"],["type","submit",1,"btn","w-100","fs-5",3,"disabled"],[1,"w-100","d-flex","align-items-center","justify-content-center"],[1,"fs-5","px-3","pt-3"],["id","iconos"],["href","https://www.instagram.com/campusride__?igsh=YnUzNHZ6OWtqNWh5&utm_source=qr","target","_blank"],[1,"bi","bi-instagram"],["href","https://www.facebook.com/share/K59oGcWYNtk6UqET/?mibextid=LQQJ4d","target","_blank"],[1,"bi","bi-facebook"],["href","https://wa.link/y4fvsa","target","_blank"],[1,"bi","bi-whatsapp"]],template:function(a,f){a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3)(5,"link",4)(6,"link",5),fe(7,"title"),Pe(8,"Home - CampusRide"),ue()(),fe(9,"body")(10,"div",6)(11,"div",7)(12,"div",8)(13,"a",9),qe(14,"img",10),ue()(),fe(15,"nav",11)(16,"div",12)(17,"div",13),Pe(18,"Ayuda"),ue()(),fe(19,"div",12)(20,"div",13),Pe(21,"Contactanos"),ue()(),fe(22,"div",12)(23,"div",13),Pe(24,"Comunidad"),ue()(),fe(25,"div",12)(26,"div",13),Pe(27,"Quienes somos"),ue()()()(),fe(28,"div",14)(29,"div",12)(30,"a",15),Pe(31,"Iniciar sesi\xF3n"),ue()(),fe(32,"div",12)(33,"a",16),Pe(34,"Registrarse"),ue()()()(),qe(35,"app-slider"),fe(36,"section",17)(37,"div",18)(38,"div",19)(39,"div",20)(40,"div",21),qe(41,"img",22),ue()(),fe(42,"div",20)(43,"div",23)(44,"h1"),Pe(45,"\xBFQui\xE9nes Somos?"),ue(),fe(46,"p"),Pe(47,"Nuestro software ofrece una soluci\xF3n integral de transporte a estudiantes universitarios que requieren una opci\xF3n de movilidad econ\xF3mica y eficaz. Empleamos un modelo arrendatario - arrendador por medio de motocicletas de terceros, siendo nosotros la conexi\xF3n entre estos mismos."),ue()()()()()(),fe(48,"section",24)(49,"div",18)(50,"div",19)(51,"div",25)(52,"div",26)(53,"h1"),Pe(54,"Comunidad"),ue(),fe(55,"p")(56,"strong"),Pe(57,"Carlos Camacho"),ue(),qe(58,"br"),Pe(59," El servicio ha sido excelente y muy economico, realmente lo recomiendo."),ue()(),fe(60,"div",27),qe(61,"input",28)(62,"label",29)(63,"input",30)(64,"label",31)(65,"input",32)(66,"label",33)(67,"input",34)(68,"label",35)(69,"input",36)(70,"label",37),ue()(),fe(71,"div",20)(72,"div",21),qe(73,"img",38),ue()()()()(),fe(74,"section",39)(75,"div",40),Xu(),fe(76,"svg",41),qe(77,"path",42),ue()(),Gm(),fe(78,"div",43)(79,"div",44)(80,"h2"),Pe(81,"Ayuda"),ue(),fe(82,"p",45),Pe(83,"D\xE9janos ayudarte con tus dudas, inquietudes o sugerencias."),ue()(),fe(84,"form",46),Wn("ngSubmit",function(){return f.onSubmit()}),fe(85,"div",47),qe(86,"input",48),ue(),fe(87,"div",47),qe(88,"input",49),ue(),fe(89,"div",47),qe(90,"input",50),ue(),fe(91,"div",47),qe(92,"textarea",51),ue(),fe(93,"div",47)(94,"button",52),Pe(95,"Enviar Mensaje"),ue()()()()(),fe(96,"footer",53)(97,"section")(98,"p",54),Pe(99,"Campus Ride UV \xA9 Todos Los Derechos Reservados 2024 "),qe(100,"br"),Pe(101," Tulu\xE1 - Valle del Cauca"),ue()(),fe(102,"div",55)(103,"a",56),qe(104,"i",57),ue(),fe(105,"a",58),qe(106,"i",59),ue(),fe(107,"a",60),qe(108,"i",61),ue()()()()()),a&2&&(Ft(84),qt("formGroup",f.helpForm),Ft(10),qt("disabled",f.helpForm.invalid))},dependencies:[Tf,Sf,Ji,jr,vr,Br,Vr,ro,oo],styles:[nO,nO]})};var Kv=class i{fullName="";static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Rn({type:i,selectors:[["app-header-driver"]],inputs:{fullName:"fullName"},standalone:!0,features:[On],decls:60,vars:1,consts:[[1,"header"],[1,"header-left"],[1,"header-logo-container"],["routerLink","/home"],["src","assets/images/logo.webp","alt","CampusRide","width","80","height","90",1,"header-logo"],[1,"header-content"],[1,"header-item"],[1,"login-text2"],[1,"material-icons"],[1,"header-right"],[1,"dropdown"],[1,"dropbtn"],["src","assets/images/avatar.webp","alt","avatar",1,"avatar"],[1,"dropdown-content"],["href","#"],[1,"separator"]],template:function(a,f){a&1&&(fe(0,"header",0)(1,"div",1)(2,"div",2)(3,"a",3),qe(4,"img",4),ue()(),fe(5,"nav",5)(6,"div",6)(7,"div",7)(8,"span",8),Pe(9,"map"),ue(),Pe(10,"Viajar"),ue()(),fe(11,"div",6)(12,"div",7)(13,"span",8),Pe(14,"local_offer"),ue(),Pe(15,"Codigos promocionales"),ue()(),fe(16,"div",6)(17,"div",7)(18,"span",8),Pe(19,"info"),ue(),Pe(20,"Informaci\xF3n"),ue()(),fe(21,"div",6)(22,"div",7)(23,"span",8),Pe(24,"help"),ue(),Pe(25,"Ayuda"),ue()()()(),fe(26,"div",9)(27,"div",10)(28,"button",11),qe(29,"img",12),fe(30,"span"),Pe(31),ue(),fe(32,"span",8),Pe(33,"expand_more"),ue()(),fe(34,"div",13)(35,"a",14)(36,"span",8),Pe(37,"manage_accounts"),ue(),Pe(38," Administrar perfil"),ue(),fe(39,"a",14)(40,"span",8),Pe(41,"two_wheeler"),ue(),Pe(42," Administrar vehiculo"),ue(),fe(43,"a",14)(44,"span",8),Pe(45,"history"),ue(),Pe(46," Registro de viajes"),ue(),fe(47,"a",14)(48,"span",8),Pe(49,"account_balance_wallet"),ue(),Pe(50," Wallet"),ue(),fe(51,"a",14)(52,"span",8),Pe(53,"settings"),ue(),Pe(54," Configuraci\xF3n"),ue(),qe(55,"div",15),fe(56,"a",14)(57,"span",8),Pe(58,"exit_to_app"),ue(),Pe(59," Cerrar sesi\xF3n"),ue()()()()()),a&2&&(Ft(31),el(f.fullName))},styles:[".header[_ngcontent-%COMP%]{display:flex;width:100%;height:80px;padding-top:5px;color:#7145d6;background-color:#cdbef1}.header-logo[_ngcontent-%COMP%]{width:75px;height:75px;transition:all 2s;cursor:pointer}.header-logo[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.header-left[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]{background:#cdbef1;color:#fff;font-size:15px;font-weight:700;padding:5px 8px;border-radius:50px;cursor:pointer;transition:background-color .3s ease}.header-left[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]:hover{background:#7145d6}.material-icons[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;margin-right:8px}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropbtn[_ngcontent-%COMP%]{background-color:#cdbef1;color:#fff;padding:10px 15px;font-size:16px;border:none;cursor:pointer;display:flex;align-items:center;gap:8px}.avatar-icon[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover}.username[_ngcontent-%COMP%]{font-weight:700}.dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;background-color:#fff;min-width:220px;box-shadow:0 8px 16px #0003;z-index:1;border-radius:4px;right:0}.dropdown[_ngcontent-%COMP%]:hover   .dropdown-content[_ngcontent-%COMP%]{display:block}.dropdown-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#333;padding:12px 16px;text-decoration:none;display:flex;align-items:center;gap:8px}.dropdown-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.separator[_ngcontent-%COMP%]{border-top:1px solid #e0e0e0;margin:5px 0}.dropdown-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{color:red}"]})};var iO=".perfil-usuario-footer[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{width:100%;max-width:600px;margin:0 auto;padding:20px}.perfil-usuario-footer[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1.2rem;gap:1rem;width:100%}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%], .seccion-perfil-usuario[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;flex-direction:column;align-items:center}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-header[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;background:linear-gradient(#B873FF,transparent);margin-bottom:1.25rem}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]{display:block;position:relative;width:90%;height:17rem;background-image:linear-gradient(45deg,#bc3cff,#317fff);border-radius:0 0 20px 20px}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;border:none;width:140px;height:50px;border-radius:3em;display:flex;align-items:center;gap:1px;background:#3165b4;cursor:pointer;transition:all .45s ease-in-out;color:#fff;padding:0}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:1rem;fill:#aaa;transition:all .8s ease}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]:hover{background:linear-gradient(0deg,#a47cf3,#683fea);box-shadow:inset 0 1px #fff6,inset 0 -4px #0003,0 0 0 4px #fff3,0 0 180px #7145d6;transform:translateY(-2px);color:#fff}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{fill:#fff;transform:scale(1.2)}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;font-size:medium}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-avatar[_ngcontent-%COMP%]{display:flex;width:180px;height:180px;align-items:center;justify-content:center;border:7px solid #FFFFFF;background-color:#dfe5f2;border-radius:50%;box-shadow:0 0 12px;position:absolute;bottom:-40px;left:calc(50% - 90px);z-index:1}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;position:relative;border-radius:50%}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-avatar[_ngcontent-%COMP%]   .boton-avatar[_ngcontent-%COMP%]{position:absolute;left:-2px;top:-2px;border:0;background-color:#fff;background-image:url(/assets/images/mas.webp);background-size:cover;background-position:center;box-shadow:0 0 12px #0003;width:32px;height:32px;border-radius:50%;cursor:pointer;transition:transform .3s}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-avatar[_ngcontent-%COMP%]   .boton-avatar[_ngcontent-%COMP%]:hover{transform:rotate(90deg)}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%]{width:70%;position:relative;max-width:750px}.perfil-usuario-bio[_ngcontent-%COMP%]{display:flex;justify-content:center}.perfil-usuario-bio[_ngcontent-%COMP%]   .texto-descripcion[_ngcontent-%COMP%]{width:300px;height:60px;border:2px solid #e3e3e3;border-radius:8px;padding:10px 15px;font-size:14px;color:#555;resize:none;transition:all .3s ease;background-color:#f8f9fa}.perfil-usuario-bio[_ngcontent-%COMP%]   .texto-descripcion[_ngcontent-%COMP%]:focus{border-color:#3165b4;outline:none;box-shadow:0 0 5px #3165b44d}.perfil-usuario-bio[_ngcontent-%COMP%]   .texto-descripcion[_ngcontent-%COMP%]::placeholder{color:#999}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%]   .titulo[_ngcontent-%COMP%]{display:block;width:100%;font-size:1.75em;margin-bottom:.5rem}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{color:#848484;font-size:.95em}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-footer[_ngcontent-%COMP%], .seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-bio[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding:1.5rem 2rem;box-shadow:0 0 12px #0003;background-color:#fff;border-radius:15px;width:100%}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-bio[_ngcontent-%COMP%]{margin-bottom:1.25rem;text-align:center}.seccion-perfil-usuario[_ngcontent-%COMP%]   .lista-datos[_ngcontent-%COMP%]{width:50%;list-style:none}.seccion-perfil-usuario[_ngcontent-%COMP%]   .lista-datos[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:5px 0}.seccion-perfil-usuario[_ngcontent-%COMP%]   .lista-datos[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > .icono[_ngcontent-%COMP%]{margin-right:1rem;font-size:1.2rem;vertical-align:middle}.seccion-perfil-usuario[_ngcontent-%COMP%]   .redes-sociales[_ngcontent-%COMP%]{position:absolute;right:calc(-50px - 1rem);top:0;display:flex;flex-direction:column}.perfil-usuario-footer[_ngcontent-%COMP%]   .formulario-perfil[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1.2rem;gap:1rem}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:140px;text-align:right;font-weight:500;color:#555}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;transition:border-color .3s ease}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 5px #4a90e233}.perfil-usuario-footer[_ngcontent-%COMP%]   .btn-guardar[_ngcontent-%COMP%]{display:block;width:200px;margin:2rem auto 0;padding:10px 20px;background-color:#7541d6;color:#fff;border:none;border-radius:5px;font-size:16px;font-weight:500;cursor:pointer;transition:all .3s ease}.perfil-usuario-footer[_ngcontent-%COMP%]   .btn-guardar[_ngcontent-%COMP%]:hover{background-color:#8450e1;transform:translateY(-2px);box-shadow:0 2px 5px #0003}@media (max-width: 768px){.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%;text-align:left;margin-bottom:.5rem}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}}@media (max-width: 750px){.seccion-perfil-usuario[_ngcontent-%COMP%]   .lista-datos[_ngcontent-%COMP%]{width:100%}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%], .seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%]{width:95%}h3[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.form-group[_ngcontent-%COMP%]   input[name=numero_licencia][_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   input[name=fecha_vencimiento][_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #c0d3f7;border-radius:4px;font-size:14px;color:#555;transition:all .3s ease}.form-group[_ngcontent-%COMP%]   input[name=numero_licencia][_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   input[name=fecha_vencimiento][_ngcontent-%COMP%]:focus{border-color:#2168e9;outline:none;box-shadow:0 0 5px #2168e933}.form-group[_ngcontent-%COMP%]   input[name=fecha_vencimiento][_ngcontent-%COMP%]{cursor:pointer}.form-row[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:15px}.form-group[_ngcontent-%COMP%]{flex:1}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#333}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px}h3[_ngcontent-%COMP%]{color:#333;text-align:center;margin:20px 0}}",Qv=class i{constructor(s,a,f){this.fb=s;this.apiService=a;this.router=f;this.driverForm=this.fb.group({nombre:["",Ot.required],apellido:["",Ot.required],genero:["",Ot.required],correo:["",[Ot.required,Ot.email]],telefono:["",[Ot.required,Ot.pattern(/^\+?[0-9]{10,15}$/)]],direccion:["",Ot.required],fechaNacimiento:["",Ot.required],contrase\u00F1a:["",[Ot.required,Ot.minLength(6)]],confirmarContrase\u00F1a:["",Ot.required],numeroLicencia:["",Ot.required],fechaVencimiento:["",Ot.required],idPlaca:["",Ot.required],marca:["",Ot.required],modelo:["",Ot.required],ano:["",[Ot.required,Ot.minLength(4),Ot.maxLength(4)]],color:["",Ot.required],capacidadPasajeros:["",Ot.required]},{validators:this.passwordMatchValidator})}driverForm;userId="";fullName="";ngOnInit(){let s=localStorage.getItem("userId");s?(this.userId=s,this.loadUserData()):this.router.navigate(["/login"])}loadUserData(){this.apiService.getConductorById(this.userId).subscribe({next:s=>{if(console.log("data:",s),s.success){let a=this.formatDate(s.data.fechaNacimiento),f=this.formatDate(s.data.fecha_vencimiento);this.fullName=`${s.data.nombre} ${s.data.apellido}`,this.driverForm.patchValue({nombre:s.data.nombre,apellido:s.data.apellido,genero:s.data.genero,correo:s.data.correo,telefono:s.data.telefono,direccion:s.data.direccion,fechaNacimiento:a,contrase\u00F1a:s.data.contrase\u00F1a,confirmarContrase\u00F1a:s.data.contrase\u00F1a,numeroLicencia:s.data.numero_licencia,fechaVencimiento:f,idPlaca:s.data.vehiculo.id_placa,marca:s.data.vehiculo.marca,modelo:s.data.vehiculo.modelo,ano:s.data.vehiculo.ano,color:s.data.vehiculo.color,capacidadPasajeros:s.data.vehiculo.capacidad_pasajeros})}else alert("No se pudo cargar la informaci\xF3n del usuario.")},error:s=>{console.error("Error al cargar los datos del usuario",s),alert("Error al cargar los datos del usuario.")}})}formatDate(s){if(!s)return"";let a=new Date(s);if(isNaN(a.getTime()))return console.error("Fecha inv\xE1lida:",s),"";let f=a.getFullYear(),x=(a.getMonth()+1).toString().padStart(2,"0"),n=a.getDate().toString().padStart(2,"0");return`${f}-${x}-${n}`}passwordMatchValidator(s){let a=s.get("contrase\xF1a")?.value,f=s.get("confirmarContrase\xF1a")?.value;return a===f?null:{mismatch:!0}}onSubmit(){if(this.driverForm.invalid){alert("Por favor, complete todos los campos obligatorios correctamente.");return}let s=this.driverForm.value,a={nombre:s.nombre,apellido:s.apellido,genero:s.genero,correo:s.correo,telefono:s.telefono,direccion:s.direccion,fechaNacimiento:s.fechaNacimiento,contrase\u00F1a:s.contrase\u00F1a,numeroLicencia:s.numeroLicencia,fechaVencimiento:s.fechaVencimiento,idPlaca:s.idPlaca,marca:s.marca,modelo:s.modelo,ano:s.ano,color:s.color,capacidadPasajeros:s.capacidadPasajeros};this.apiService.updateDriver(this.userId,a).subscribe({next:f=>{alert("Usuario actualizado correctamente."),this.router.navigate(["/edit-driver"])},error:f=>{console.error("Error al actualizar el usuario:",f),alert("Error al actualizar el usuario. Intente nuevamente.")}})}static \u0275fac=function(a){return new(a||i)(St(bo),St(br),St(zi))};static \u0275cmp=Rn({type:i,selectors:[["app-edit-driver"]],standalone:!0,features:[On],decls:112,vars:3,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],["href",Ui`https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css`,"rel","stylesheet","integrity","sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl","crossorigin","anonymous"],["rel","stylesheet","href",Ui`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css`],[3,"fullName"],[1,"seccion-perfil-usuario"],[1,"perfil-usuario-header"],[1,"perfil-usuario-portada"],[1,"perfil-usuario-avatar"],["src","assets/images/avatargrande.webp","alt","avatargrande.webp","width","100","height","160"],["type","button",1,"boton-avatar"],[1,"far","fa-image"],["type","button",1,"boton-portada"],[1,"perfil-usuario-body"],[1,"perfil-usuario-bio","text-center"],[1,"titulo"],[1,"form-group"],["placeholder","Escribe una breve descripci\xF3n sobre ti...","maxlength","100","rows","3","name","descripcion","id","descripcion",1,"texto-descripcion"],[1,"perfil-usuario-footer"],[3,"ngSubmit","formGroup"],["for","nombre"],["type","text","id","nombre","formControlName","nombre","required",""],["for","apellido"],["type","text","id","apellido","formControlName","apellido","required",""],["for","genero"],["id","genero","formControlName","genero"],["value","Masculino"],["value","Femenino"],["for","correo"],["type","email","id","correo","formControlName","correo","required",""],["for","telefono"],["type","tel","id","telefono","formControlName","telefono"],["for","direccion"],["type","text","id","direccion","formControlName","direccion"],["for","fechaNacimiento"],["type","date","id","fechaNacimiento","formControlName","fechaNacimiento"],["for","contrase\xF1a"],["type","password","id","contrase\xF1a","formControlName","contrase\xF1a","required",""],["for","confirmar_contrase\xF1a"],["type","password","id","confirmar_contrase\xF1a","formControlName","confirmarContrase\xF1a","required",""],[2,"text-align","center","width","100%"],["for","numeroLicencia"],["type","text","id","numeroLicencia","formControlName","numeroLicencia","required",""],["for","fecha_vencimiento"],["type","date","id","fecha_vencimiento","formControlName","fechaVencimiento","required",""],[1,"form-row"],["for","id_placa"],["type","text","id","id_placa","formControlName","idPlaca","required",""],["for","marca"],["type","text","id","marca","formControlName","marca","required",""],["for","modelo"],["type","text","id","modelo","formControlName","modelo","required",""],["for","ano"],["type","text","id","ano","formControlName","ano","required","","minlength","4","maxlength","4"],["for","color"],["type","text","id","color","formControlName","color","required",""],["for","capacidad_pasajeros"],["type","text","id","capacidad_pasajeros","formControlName","capacidadPasajeros","required",""],["type","submit",1,"btn-guardar"]],template:function(a,f){a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3)(5,"link",4)(6,"link",5),fe(7,"title"),Pe(8,"Edit - CampusRide"),ue()(),fe(9,"body"),qe(10,"app-header-driver",6),fe(11,"section",7)(12,"div",8)(13,"div",9)(14,"div",10),qe(15,"img",11),fe(16,"button",12),qe(17,"i",13),ue()(),fe(18,"button",14),qe(19,"i",13),Pe(20," Cambiar fondo "),ue()()(),fe(21,"div",15)(22,"div",16)(23,"h3",17),Pe(24),ue(),fe(25,"div",18),qe(26,"textarea",19),ue()()(),fe(27,"div",20)(28,"form",21),Wn("ngSubmit",function(){return f.onSubmit()}),fe(29,"div",18)(30,"label",22),Pe(31,"Nombre"),ue(),qe(32,"input",23),ue(),fe(33,"div",18)(34,"label",24),Pe(35,"Apellido"),ue(),qe(36,"input",25),ue(),fe(37,"div",18)(38,"label",26),Pe(39,"G\xE9nero"),ue(),fe(40,"select",27)(41,"option",28),Pe(42,"Masculino"),ue(),fe(43,"option",29),Pe(44,"Femenino"),ue()()(),fe(45,"div",18)(46,"label",30),Pe(47,"Correo Electr\xF3nico"),ue(),qe(48,"input",31),ue(),fe(49,"div",18)(50,"label",32),Pe(51,"Tel\xE9fono"),ue(),qe(52,"input",33),ue(),fe(53,"div",18)(54,"label",34),Pe(55,"Direcci\xF3n"),ue(),qe(56,"input",35),ue(),fe(57,"div",18)(58,"label",36),Pe(59,"Fecha de nacimiento"),ue(),qe(60,"input",37),ue(),fe(61,"div",18)(62,"label",38),Pe(63,"Contrase\xF1a"),ue(),qe(64,"input",39),ue(),fe(65,"div",18)(66,"label",40),Pe(67,"Confirmar Contrase\xF1a"),ue(),qe(68,"input",41),ue(),fe(69,"div",42)(70,"h3"),Pe(71,"Licencia"),ue()(),fe(72,"div",18)(73,"label",43),Pe(74,"N\xFAmero de Licencia"),ue(),qe(75,"input",44),ue(),fe(76,"div",18)(77,"label",45),Pe(78,"Fecha de Vencimiento"),ue(),qe(79,"input",46),ue(),fe(80,"div",42)(81,"h3"),Pe(82,"Veh\xEDculo"),ue()(),fe(83,"div",47)(84,"div",18)(85,"label",48),Pe(86,"N\xFAmero Placa"),ue(),qe(87,"input",49),ue(),fe(88,"div",18)(89,"label",50),Pe(90,"Marca"),ue(),qe(91,"input",51),ue()(),fe(92,"div",47)(93,"div",18)(94,"label",52),Pe(95,"Modelo"),ue(),qe(96,"input",53),ue(),fe(97,"div",18)(98,"label",54),Pe(99,"A\xF1o"),ue(),qe(100,"input",55),ue()(),fe(101,"div",47)(102,"div",18)(103,"label",56),Pe(104,"Color"),ue(),qe(105,"input",57),ue(),fe(106,"div",18)(107,"label",58),Pe(108,"Capacidad de Pasajeros"),ue(),qe(109,"input",59),ue()(),fe(110,"button",60),Pe(111,"Guardar Cambios"),ue()()()()()()),a&2&&(Ft(10),qt("fullName",f.fullName),Ft(14),el(f.fullName),Ft(4),qt("formGroup",f.driverForm))},dependencies:[Kv,Ji,jr,Cv,Ev,vr,pf,Br,Vr,so,ug,nd,ro,oo],styles:[iO,iO,`.mensaje[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {
      color: inherit;
      margin-right: .5rem;
      display: inline-block;
    }

    .mensaje[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover {
      color: #309B76;
      transform: scale(1.4);
    }`]})};var If=class i{fullName="";static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Rn({type:i,selectors:[["app-header-passenger"]],inputs:{fullName:"fullName"},standalone:!0,features:[On],decls:56,vars:1,consts:[[1,"header"],[1,"header-left"],[1,"header-logo-container"],["routerLink","/home"],["src","assets/images/logo.webp","alt","CampusRide","width","80","height","90",1,"header-logo"],[1,"header-content"],[1,"header-item"],[1,"login-text2"],[1,"material-icons"],[1,"header-right"],[1,"dropdown"],[1,"dropbtn"],["src","assets/images/avatar.webp","alt","Avatar",1,"avatar-icon"],[1,"dropdown-content"],["href","#"],[1,"separator"]],template:function(a,f){a&1&&(fe(0,"header",0)(1,"div",1)(2,"div",2)(3,"a",3),qe(4,"img",4),ue()(),fe(5,"nav",5)(6,"div",6)(7,"div",7)(8,"span",8),Pe(9,"map"),ue(),Pe(10,"Viajar"),ue()(),fe(11,"div",6)(12,"div",7)(13,"span",8),Pe(14,"local_offer"),ue(),Pe(15,"Codigos promocionales"),ue()(),fe(16,"div",6)(17,"div",7)(18,"span",8),Pe(19,"info"),ue(),Pe(20,"Informaci\xF3n"),ue()(),fe(21,"div",6)(22,"div",7)(23,"span",8),Pe(24,"help"),ue(),Pe(25,"Ayuda"),ue()()()(),fe(26,"div",9)(27,"div",10)(28,"button",11),qe(29,"img",12),fe(30,"span"),Pe(31),ue(),fe(32,"span",8),Pe(33,"expand_more"),ue()(),fe(34,"div",13)(35,"a",14)(36,"span",8),Pe(37,"manage_accounts"),ue(),Pe(38," Administrar perfil"),ue(),fe(39,"a",14)(40,"span",8),Pe(41,"history"),ue(),Pe(42," Registro de viajes"),ue(),fe(43,"a",14)(44,"span",8),Pe(45,"account_balance_wallet"),ue(),Pe(46," Wallet"),ue(),fe(47,"a",14)(48,"span",8),Pe(49,"settings"),ue(),Pe(50," Configuraci\xF3n"),ue(),qe(51,"div",15),fe(52,"a",14)(53,"span",8),Pe(54,"exit_to_app"),ue(),Pe(55," Cerrar sesi\xF3n"),ue()()()()()),a&2&&(Ft(31),el(f.fullName))},styles:[".header[_ngcontent-%COMP%]{display:flex;width:100%;height:80px;padding-top:5px;color:#7145d6;background-color:#cdbef1}.header-logo[_ngcontent-%COMP%]{width:75px;height:75px;transition:all 2s;cursor:pointer}.header-logo[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.header-left[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]{background:#cdbef1;color:#fff;font-size:15px;font-weight:700;padding:5px 8px;border-radius:50px;cursor:pointer;transition:background-color .3s ease}.header-left[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]   .login-text2[_ngcontent-%COMP%]:hover{background:#7145d6}.material-icons[_ngcontent-%COMP%]{font-size:20px;vertical-align:middle;margin-right:8px}.dropdown[_ngcontent-%COMP%]{position:relative;display:inline-block}.dropbtn[_ngcontent-%COMP%]{background-color:#cdbef1;color:#fff;padding:10px 15px;font-size:16px;border:none;cursor:pointer;display:flex;align-items:center;gap:8px}.avatar-icon[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover}.dropdown-content[_ngcontent-%COMP%]{display:none;position:absolute;background-color:#fff;min-width:220px;box-shadow:0 8px 16px #0003;z-index:1;border-radius:4px;right:0}.dropdown[_ngcontent-%COMP%]:hover   .dropdown-content[_ngcontent-%COMP%]{display:block}.dropdown-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#333;padding:12px 16px;text-decoration:none;display:flex;align-items:center;gap:8px}.dropdown-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.separator[_ngcontent-%COMP%]{border-top:1px solid #e0e0e0;margin:5px 0}.dropdown-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:last-child{color:red}"]})};var rO=".perfil-usuario-footer[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{width:100%;max-width:600px;margin:0 auto;padding:20px}.perfil-usuario-footer[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1.2rem;gap:1rem;width:100%}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px}@media (max-width: 768px){.perfil-usuario-footer[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{width:95%;padding:10px}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%;text-align:left;margin-bottom:.5rem}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%], .seccion-perfil-usuario[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;flex-direction:column;align-items:center}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-header[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;background:linear-gradient(#B873FF,transparent);margin-bottom:1.25rem}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]{display:block;position:relative;width:90%;height:17rem;background-image:linear-gradient(45deg,#bc3cff,#317fff);border-radius:0 0 20px 20px}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;border:none;width:140px;height:50px;border-radius:3em;display:flex;align-items:center;gap:1px;background:#3165b4;cursor:pointer;transition:all .45s ease-in-out;color:#fff;padding:0}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:1rem;fill:#aaa;transition:all .8s ease}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]:hover{background:linear-gradient(0deg,#a47cf3,#683fea);box-shadow:inset 0 1px #fff6,inset 0 -4px #0003,0 0 0 4px #fff3,0 0 180px #7145d6;transform:translateY(-2px);color:#fff}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]{fill:#fff;transform:scale(1.2)}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%]   .boton-portada[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;font-size:medium}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-avatar[_ngcontent-%COMP%]{display:flex;width:180px;height:180px;align-items:center;justify-content:center;border:7px solid #FFFFFF;background-color:#dfe5f2;border-radius:50%;box-shadow:0 0 12px;position:absolute;bottom:-40px;left:calc(50% - 90px);z-index:1}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;position:relative;border-radius:50%}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-avatar[_ngcontent-%COMP%]   .boton-avatar[_ngcontent-%COMP%]{position:absolute;left:-2px;top:-2px;border:0;background-color:#fff;background-image:url(/assets/images/mas.webp);background-size:cover;background-position:center;box-shadow:0 0 12px #0003;width:32px;height:32px;border-radius:50%;cursor:pointer;transition:transform .3s}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-avatar[_ngcontent-%COMP%]   .boton-avatar[_ngcontent-%COMP%]:hover{transform:rotate(90deg)}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%]{width:70%;position:relative;max-width:750px}.perfil-usuario-bio[_ngcontent-%COMP%]{display:flex;justify-content:center}.perfil-usuario-bio[_ngcontent-%COMP%]   .texto-descripcion[_ngcontent-%COMP%]{width:300px;height:60px;border:2px solid #e3e3e3;border-radius:8px;padding:10px 15px;font-size:14px;color:#555;resize:none;transition:all .3s ease;background-color:#f8f9fa}.perfil-usuario-bio[_ngcontent-%COMP%]   .texto-descripcion[_ngcontent-%COMP%]:focus{border-color:#3165b4;outline:none;box-shadow:0 0 5px #3165b44d}.perfil-usuario-bio[_ngcontent-%COMP%]   .texto-descripcion[_ngcontent-%COMP%]::placeholder{color:#999}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%]   .titulo[_ngcontent-%COMP%]{display:block;width:100%;font-size:1.75em;margin-bottom:.5rem}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{color:#848484;font-size:.95em}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-footer[_ngcontent-%COMP%], .seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-bio[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding:1.5rem 2rem;box-shadow:0 0 12px #0003;background-color:#fff;border-radius:15px;width:100%}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-bio[_ngcontent-%COMP%]{margin-bottom:1.25rem;text-align:center}.seccion-perfil-usuario[_ngcontent-%COMP%]   .lista-datos[_ngcontent-%COMP%]{width:50%;list-style:none}.seccion-perfil-usuario[_ngcontent-%COMP%]   .lista-datos[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:5px 0}.seccion-perfil-usuario[_ngcontent-%COMP%]   .lista-datos[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] > .icono[_ngcontent-%COMP%]{margin-right:1rem;font-size:1.2rem;vertical-align:middle}.seccion-perfil-usuario[_ngcontent-%COMP%]   .redes-sociales[_ngcontent-%COMP%]{position:absolute;right:calc(-50px - 1rem);top:0;display:flex;flex-direction:column}.perfil-usuario-footer[_ngcontent-%COMP%]   .formulario-perfil[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1.2rem;gap:1rem}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:140px;text-align:right;font-weight:500;color:#555}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;transition:border-color .3s ease}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 5px #4a90e233}.perfil-usuario-footer[_ngcontent-%COMP%]   .btn-guardar[_ngcontent-%COMP%]{display:block;width:200px;margin:2rem auto 0;padding:10px 20px;background-color:#7541d6;color:#fff;border:none;border-radius:5px;font-size:16px;font-weight:500;cursor:pointer;transition:all .3s ease}.perfil-usuario-footer[_ngcontent-%COMP%]   .btn-guardar[_ngcontent-%COMP%]:hover{background-color:#8450e1;transform:translateY(-2px);box-shadow:0 2px 5px #0003}@media (max-width: 768px){.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%;text-align:left;margin-bottom:.5rem}.perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .perfil-usuario-footer[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%}}@media (max-width: 750px){.seccion-perfil-usuario[_ngcontent-%COMP%]   .lista-datos[_ngcontent-%COMP%]{width:100%}.seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-portada[_ngcontent-%COMP%], .seccion-perfil-usuario[_ngcontent-%COMP%]   .perfil-usuario-body[_ngcontent-%COMP%]{width:95%}}",ex=class i{constructor(s,a,f){this.fb=s;this.apiService=a;this.router=f;this.passengerForm=this.fb.group({nombre:["",Ot.required],apellido:["",Ot.required],genero:["",Ot.required],correo:["",[Ot.required,Ot.email]],telefono:["",[Ot.required,Ot.pattern(/^\+?[0-9]{10,15}$/)]],direccion:["",Ot.required],fechaNacimiento:["",Ot.required],contrase\u00F1a:["",[Ot.required,Ot.minLength(6)]],confirmarContrase\u00F1a:["",Ot.required]},{validators:this.passwordMatchValidator})}passengerForm;userId="";fullName="";ngOnInit(){let s=localStorage.getItem("userId");s?(this.userId=s,this.loadUserData()):this.router.navigate(["/login"])}loadUserData(){this.apiService.getUserById(this.userId).subscribe({next:s=>{if(s.success){let a=this.formatDate(s.data.usuario.fechaNacimiento);this.fullName=`${s.data.usuario.nombre} ${s.data.usuario.apellido}`,this.passengerForm.patchValue({nombre:s.data.usuario.nombre,apellido:s.data.usuario.apellido,genero:s.data.usuario.genero,correo:s.data.usuario.correo,telefono:s.data.usuario.telefono,direccion:s.data.usuario.direccion,fechaNacimiento:a,contrase\u00F1a:s.data.usuario.contrase\u00F1a,confirmarContrase\u00F1a:s.data.usuario.contrase\u00F1a})}else alert("No se pudo cargar la informaci\xF3n del usuario.")},error:s=>{console.error("Error al cargar los datos del usuario",s),alert("Error al cargar los datos del usuario.")}})}formatDate(s){let a=new Date(s),f=a.getFullYear(),x=(a.getMonth()+1).toString().padStart(2,"0"),n=a.getDate().toString().padStart(2,"0");return`${f}-${x}-${n}`}passwordMatchValidator(s){let a=s.get("contrase\xF1a")?.value,f=s.get("confirmarContrase\xF1a")?.value;return a===f?null:{mismatch:!0}}onSubmit(){if(this.passengerForm.invalid){alert("Por favor, complete todos los campos obligatorios correctamente.");return}let s=this.passengerForm.value,a={nombre:s.nombre,apellido:s.apellido,genero:s.genero,correo:s.correo,telefono:s.telefono,direccion:s.direccion,fechaNacimiento:s.fechaNacimiento,contrase\u00F1a:s.contrase\u00F1a};this.apiService.updateDriver(this.userId,a).subscribe({next:f=>{alert("Usuario actualizado correctamente.")},error:f=>{console.error("Error al actualizar el usuario:",f),alert("Error al actualizar el usuario. Intente nuevamente.")}})}static \u0275fac=function(a){return new(a||i)(St(bo),St(br),St(zi))};static \u0275cmp=Rn({type:i,selectors:[["app-edit-passenger"]],standalone:!0,features:[On],decls:71,vars:3,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],["href",Ui`https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css`,"rel","stylesheet","integrity","sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl","crossorigin","anonymous"],["rel","stylesheet","href",Ui`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css`],[3,"fullName"],[1,"seccion-perfil-usuario"],[1,"perfil-usuario-header"],[1,"perfil-usuario-portada"],[1,"perfil-usuario-avatar"],["src","assets/images/avatargrande.webp","alt","avatargrande.webp","width","100","height","160"],["type","button",1,"boton-avatar"],[1,"far","fa-image"],["type","button",1,"boton-portada"],[1,"perfil-usuario-body"],[1,"perfil-usuario-bio","text-center"],[1,"titulo"],[1,"form-group"],["placeholder","Escribe una breve descripci\xF3n sobre ti...","maxlength","100","rows","3","name","descripcion","id","descripcion",1,"texto-descripcion"],[1,"perfil-usuario-footer"],[3,"ngSubmit","formGroup"],["for","nombre"],["type","text","id","nombre","formControlName","nombre","required",""],["for","apellido"],["type","text","id","apellido","formControlName","apellido","required",""],["for","genero"],["id","genero","formControlName","genero"],["value","Masculino"],["value","Femenino"],["for","correo"],["type","email","id","correo","formControlName","correo","required",""],["for","telefono"],["type","tel","id","telefono","formControlName","telefono"],["for","direccion"],["type","text","id","direccion","formControlName","direccion"],["for","fechaNacimiento"],["type","date","id","fechaNacimiento","formControlName","fechaNacimiento"],["for","contrase\xF1a"],["type","password","id","contrase\xF1a","formControlName","contrase\xF1a","required",""],["for","confirmar_contrase\xF1a"],["type","password","id","confirmar_contrase\xF1a","formControlName","confirmarContrase\xF1a","required",""],["type","submit",1,"btn-guardar"]],template:function(a,f){a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3)(5,"link",4)(6,"link",5),fe(7,"title"),Pe(8,"Edit - CampusRide"),ue()(),fe(9,"body"),qe(10,"app-header-passenger",6),fe(11,"section",7)(12,"div",8)(13,"div",9)(14,"div",10),qe(15,"img",11),fe(16,"button",12),qe(17,"i",13),ue()(),fe(18,"button",14),qe(19,"i",13),Pe(20," Cambiar fondo "),ue()()(),fe(21,"div",15)(22,"div",16)(23,"h3",17),Pe(24),ue(),fe(25,"div",18),qe(26,"textarea",19),ue()()(),fe(27,"div",20)(28,"form",21),Wn("ngSubmit",function(){return f.onSubmit()}),fe(29,"div",18)(30,"label",22),Pe(31,"Nombre"),ue(),qe(32,"input",23),ue(),fe(33,"div",18)(34,"label",24),Pe(35,"Apellido"),ue(),qe(36,"input",25),ue(),fe(37,"div",18)(38,"label",26),Pe(39,"G\xE9nero"),ue(),fe(40,"select",27)(41,"option",28),Pe(42,"Masculino"),ue(),fe(43,"option",29),Pe(44,"Femenino"),ue()()(),fe(45,"div",18)(46,"label",30),Pe(47,"Correo Electr\xF3nico"),ue(),qe(48,"input",31),ue(),fe(49,"div",18)(50,"label",32),Pe(51,"Tel\xE9fono"),ue(),qe(52,"input",33),ue(),fe(53,"div",18)(54,"label",34),Pe(55,"Direcci\xF3n"),ue(),qe(56,"input",35),ue(),fe(57,"div",18)(58,"label",36),Pe(59,"Fecha de nacimiento"),ue(),qe(60,"input",37),ue(),fe(61,"div",18)(62,"label",38),Pe(63,"Contrase\xF1a"),ue(),qe(64,"input",39),ue(),fe(65,"div",18)(66,"label",40),Pe(67,"Confirmar Contrase\xF1a"),ue(),qe(68,"input",41),ue(),fe(69,"button",42),Pe(70,"Guardar Cambios"),ue()()()()()()),a&2&&(Ft(10),qt("fullName",f.fullName),Ft(14),el(f.fullName),Ft(4),qt("formGroup",f.passengerForm))},dependencies:[If,Ji,jr,Cv,Ev,vr,pf,Br,Vr,so,ro,oo],styles:[rO,rO,`.mensaje[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {
      color: inherit;
      margin-right: .5rem;
      display: inline-block;
    }

    .mensaje[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover {
      color: #309B76;
      transform: scale(1.4);
    }`]})};var oO="body[_ngcontent-%COMP%], html[_ngcontent-%COMP%]{margin:0;padding:0;font-family:Montserrat,sans-serif}.main-container[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 60px);display:flex;justify-content:center;align-items:center;overflow:hidden}.image-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden}.background-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;z-index:-1}.otp-Form[_ngcontent-%COMP%]{padding:20px 40px;width:100%;max-width:400px;z-index:1;height:350px;background-color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;position:relative;box-shadow:0 0 20px #00000015;border-radius:15px}.verificacion[_ngcontent-%COMP%]{font-size:1.1em;color:#0f0f0f;font-weight:700}.otpSubheading[_ngcontent-%COMP%]{font-size:.7em;color:#000;line-height:17px;text-align:center}.inputContainer[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;gap:10px;align-items:center;justify-content:center}.otp-input[_ngcontent-%COMP%]{background-color:#e4e4e4;width:40px;height:40px;text-align:center;border:none;border-radius:7px;caret-color:#7f81ff;color:#2c2c2c;outline:none;font-weight:600;margin-bottom:10px}.otp-input[_ngcontent-%COMP%]:focus, .otp-input[_ngcontent-%COMP%]:valid{background-color:#7f81ff33;transition-duration:.3s}.verifyButton[_ngcontent-%COMP%]{width:100%;height:30px;border:none;background-color:#8550e1;color:#fff;font-weight:600;cursor:pointer;border-radius:10px;transition-duration:.2s}.verifyButton[_ngcontent-%COMP%]:hover{background-color:#7145d6;transition-duration:.2s}.exitBtn[_ngcontent-%COMP%]{position:absolute;top:5px;right:5px;box-shadow:0 0 20px #0000002c;background-color:#fff;border-radius:50%;width:25px;height:25px;border:none;color:#000;font-size:1.1em;cursor:pointer}.resendNote[_ngcontent-%COMP%]{font-size:.7em;color:#000;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px}.resendBtn[_ngcontent-%COMP%]{background-color:transparent;border:none;color:#8550e1;cursor:pointer;font-size:1.1em;font-weight:700}@media (max-width: 768px){.otp-Form[_ngcontent-%COMP%]{max-width:80%;padding:15px}.otp-input[_ngcontent-%COMP%]{width:45px;height:45px;font-size:1.2rem}.verifyButton[_ngcontent-%COMP%]{font-size:.9rem}}@media (max-width: 480px){.otp-Form[_ngcontent-%COMP%]{padding:10px}.otp-input[_ngcontent-%COMP%]{width:40px;height:40px;font-size:1rem}.verificacion[_ngcontent-%COMP%]{font-size:1.2rem}.otpSubheading[_ngcontent-%COMP%]{font-size:.9rem}}",tx=class i{constructor(s,a){this.apiService=s;this.router=a;let f=localStorage.getItem("correo");f&&(this.correo=f,console.log("Correo guardado:",this.correo))}otp=["","","",""];correo="";onSubmit(){let s=this.otp.join("");if(s.length!==4){alert("Por favor, complete el c\xF3digo de verificaci\xF3n.");return}this.apiService.verificarCodigo({correo:this.correo,codigo_verificacion:s}).subscribe(a=>{a.success?(alert("C\xF3digo verificado exitosamente."),this.router.navigate(["/login"])):alert("C\xF3digo incorrecto. Int\xE9ntalo nuevamente.")},a=>{console.error("Error al verificar el c\xF3digo:",a),alert("Hubo un problema al verificar el c\xF3digo. Int\xE9ntalo m\xE1s tarde.")})}resendCode(){this.apiService.newUser({correo:this.correo}).subscribe(s=>{alert("Nuevo c\xF3digo enviado a tu correo.")},s=>{console.error("Error al reenviar el c\xF3digo:",s),alert("No se pudo reenviar el c\xF3digo. Int\xE9ntalo m\xE1s tarde.")})}exit(){this.router.navigate(["/login"])}static \u0275fac=function(a){return new(a||i)(St(br),St(zi))};static \u0275cmp=Rn({type:i,selectors:[["app-auntentucation-login"]],standalone:!0,features:[On],decls:33,vars:4,consts:[["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],["href",Ui`https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css`,"rel","stylesheet","integrity","sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl","crossorigin","anonymous"],["rel","stylesheet","href",Ui`https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css`],[1,"main-container"],[1,"image-container"],["src","assets/images/fondologin.png","alt","Fondo de login",1,"background-image"],[1,"otp-Form",3,"ngSubmit"],[1,"verificacion"],[1,"otpSubheading"],[1,"inputContainer"],["required","","maxlength","1","type","text","name","otp1",1,"otp-input",3,"ngModelChange","ngModel"],["required","","maxlength","1","type","text","name","otp2",1,"otp-input",3,"ngModelChange","ngModel"],["required","","maxlength","1","type","text","name","otp3",1,"otp-input",3,"ngModelChange","ngModel"],["required","","maxlength","1","type","text","name","otp4",1,"otp-input",3,"ngModelChange","ngModel"],["type","submit",1,"verifyButton"],["type","button",1,"exitBtn",3,"click"],[1,"resendNote"],["type","button",1,"resendBtn",3,"click"]],template:function(a,f){a&1&&(fe(0,"html",0)(1,"head"),qe(2,"meta",1)(3,"meta",2)(4,"meta",3)(5,"link",4)(6,"link",5),fe(7,"title"),Pe(8,"Autenticaci\xF3n - CampusRide"),ue()(),fe(9,"body"),qe(10,"app-header"),fe(11,"main",6)(12,"div",7),qe(13,"img",8),ue(),fe(14,"form",9),Wn("ngSubmit",function(){return f.onSubmit()}),fe(15,"span",10),Pe(16,"Autenticaci\xF3n de Dos Pasos"),ue(),fe(17,"p",11),Pe(18,"Ingresa el c\xF3digo que enviamos a tu correo"),ue(),fe(19,"div",12)(20,"input",13),nf("ngModelChange",function(n){return Zm(f.otp[0],n)||(f.otp[0]=n),n}),ue(),fe(21,"input",14),nf("ngModelChange",function(n){return Zm(f.otp[1],n)||(f.otp[1]=n),n}),ue(),fe(22,"input",15),nf("ngModelChange",function(n){return Zm(f.otp[2],n)||(f.otp[2]=n),n}),ue(),fe(23,"input",16),nf("ngModelChange",function(n){return Zm(f.otp[3],n)||(f.otp[3]=n),n}),ue()(),fe(24,"button",17),Pe(25,"Verificar"),ue(),fe(26,"button",18),Wn("click",function(){return f.exit()}),Pe(27,"\xD7"),ue(),fe(28,"p",19),Pe(29,"\xBFNo recibiste ning\xFAn c\xF3digo? "),fe(30,"button",20),Wn("click",function(){return f.resendCode()}),Pe(31,"Reenviar c\xF3digo"),ue()()()(),qe(32,"app-footer"),ue()()),a&2&&(Ft(20),tf("ngModel",f.otp[0]),Ft(),tf("ngModel",f.otp[1]),Ft(),tf("ngModel",f.otp[2]),Ft(),tf("ngModel",f.otp[3]))},dependencies:[cs,us,Ji,jr,vr,Br,Vr,so,nd,Mv,HC,GC],styles:[oO,oO]})};var nx=class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Rn({type:i,selectors:[["app-loading"]],standalone:!0,features:[On],decls:11,vars:0,consts:[[1,"loading-map","d-flex","justify-content-center","align-items-center","min-vh-100"],[1,"content-container"],[1,"typing-indicator"],[1,"typing-circle"],[1,"typing-shadow"],[1,"geolocalizando-label"]],template:function(a,f){a&1&&(fe(0,"div",0)(1,"div",1)(2,"div",2),qe(3,"div",3)(4,"div",3)(5,"div",3)(6,"div",4)(7,"div",4)(8,"div",4),ue(),fe(9,"label",5),Pe(10,"Geolocalizando..."),ue()()())},styles:[".loading-map[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#f0f0f0}.content-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.typing-indicator[_ngcontent-%COMP%]{width:120px;height:60px;position:relative;z-index:4}.typing-circle[_ngcontent-%COMP%]{width:16px;height:16px;position:absolute;border-radius:50%;background-color:#8550e1;left:15%;transform-origin:50%;animation:_ngcontent-%COMP%_typing-circle7124 .5s alternate infinite ease}@keyframes _ngcontent-%COMP%_typing-circle7124{0%{top:30px;height:10px;border-radius:50px 50px 25px 25px;transform:scaleX(1.7)}40%{height:16px;border-radius:50%;transform:scaleX(1)}to{top:0%}}.typing-circle[_ngcontent-%COMP%]:nth-child(2){left:45%;animation-delay:.2s}.typing-circle[_ngcontent-%COMP%]:nth-child(3){left:auto;right:15%;animation-delay:.3s}.typing-shadow[_ngcontent-%COMP%]{width:10px;height:8px;border-radius:50%;background-color:#0003;position:absolute;top:45px;transform-origin:50%;z-index:3;left:15%;filter:blur(1px);animation:_ngcontent-%COMP%_typing-shadow046 .5s alternate infinite ease}@keyframes _ngcontent-%COMP%_typing-shadow046{0%{transform:scaleX(1.5)}40%{transform:scaleX(1);opacity:.7}to{transform:scaleX(.2);opacity:.4}}.typing-shadow[_ngcontent-%COMP%]:nth-child(4){left:45%;animation-delay:.2s}.typing-shadow[_ngcontent-%COMP%]:nth-child(5){left:auto;right:15%;animation-delay:.3s}.geolocalizando-label[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin-top:20px;color:#333;text-align:center}"]})};var Df=nI(LE());var sd=class i{map;get isMapReady(){return!!this.map}setMap(s){this.map=s}flyto(s){if(!this.isMapReady)throw new Error("Map is not ready");this.map?.flyTo({center:s,zoom:14})}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})};var aO={production:!0,apiUrl:"http://localhost:8080",apiKey:"pk.eyJ1IjoiamVzc3ZpbGxhMTk3NSIsImEiOiJjbTN6N29kZG8xOWh1Mmtwc21kOXY3NHlmIn0.HzSxs5C37iEUIU2pDlJyuQ"};var Rg=class i extends Qm{baseUrl="https://api.mapbox.com/geocoding/v5/mapbox.places";constructor(s){super(s)}get(s,a){return s=this.baseUrl+s,super.get(s,{params:Mt({country:"co",language:"es",access_token:aO.apiKey},a.params)})}static \u0275fac=function(a){return new(a||i)(sn(ed))};static \u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})};var js=class i{constructor(s){this.placesApi=s;this.getUserLocation()}userlocation;isLoadingPlaces=!1;places=[];get isUserLocationReady(){return!!this.userlocation}getUserLocation(){return vh(this,null,function*(){return new Promise((s,a)=>{navigator.geolocation.getCurrentPosition(({coords:f})=>{this.userlocation=[f.longitude,f.latitude],s(this.userlocation)},f=>{console.error(f),alert("No se puedo obtener geolocalizaci\xF3n"),a(f)})})})}getPlacesQuery(s=""){this.isLoadingPlaces=!0,this.placesApi.get(`/${s}.json`,{params:{proximity:this.userlocation.join(",")}}).subscribe(a=>{console.log(a.features),this.isLoadingPlaces=!1,this.places=a.features})}static \u0275fac=function(a){return new(a||i)(sn(Rg))};static \u0275prov=Jt({token:i,factory:i.\u0275fac,providedIn:"root"})};var H6=["mapDiv"],lO="body[_ngcontent-%COMP%]{margin:0;height:100vh;display:flex;justify-content:flex-end;align-items:center;background-color:#fff}.map-container[_ngcontent-%COMP%]{width:600px;height:500px;background-color:#fff;box-shadow:0 4px 8px #0000001a;border-radius:8px;margin-right:100px}",rx=class i{constructor(s,a){this.placesService=s;this.mapService=a}mapDivElement;ngAfterViewInit(){let s=new Df.Map({container:this.mapDivElement.nativeElement,style:"mapbox://styles/mapbox/streets-v12",center:this.placesService.userlocation,zoom:12}),a=new Df.Popup().setHTML(`

        <h8 style="font-weight: bold; text-align: left;">Ubicaci\xF3n Cercana   </h8>
    `);new Df.Marker({color:"red"}).setLngLat(this.placesService.userlocation||[-76.1986,4.08472]).setPopup(a).addTo(s),this.mapService.setMap(s)}static \u0275fac=function(a){return new(a||i)(St(js),St(sd))};static \u0275cmp=Rn({type:i,selectors:[["app-map-view"]],viewQuery:function(a,f){if(a&1&&kA(H6,5),a&2){let x;dC(x=hC())&&(f.mapDivElement=x.first)}},standalone:!0,features:[On],decls:11,vars:0,consts:[["mapDiv",""],["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],[1,"map-container"]],template:function(a,f){a&1&&(fe(0,"html",1)(1,"head"),qe(2,"meta",2)(3,"meta",3)(4,"meta",4),fe(5,"title"),Pe(6,"Map - CampusRide"),ue()(),qe(7,"app-header-passenger"),fe(8,"body"),qe(9,"div",5,0),ue()())},dependencies:[If],styles:[lO,lO]})};var ox=class i{constructor(s,a){this.placesService=s;this.mapService=a}goToMyLocation(){console.log("Go to my location"),this.placesService.getUserLocation().then(s=>{this.mapService.flyto(s)}).catch(s=>{console.error(s)})}static \u0275fac=function(a){return new(a||i)(St(js),St(sd))};static \u0275cmp=Rn({type:i,selectors:[["app-btn-my-location"]],standalone:!0,features:[On],decls:4,vars:0,consts:[[1,"button",3,"click"],["viewBox","0 0 512 512","height","1em","xmlns","http://www.w3.org/2000/svg",1,"svgIcon"],["d","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm50.7-186.9L162.4 380.6c-19.4 7.5-38.5-11.6-31-31l55.5-144.3c3.3-8.5 9.9-15.1 18.4-18.4l144.3-55.5c19.4-7.5 38.5 11.6 31 31L325.1 306.7c-3.2 8.5-9.9 15.1-18.4 18.4zM288 256a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"]],template:function(a,f){a&1&&(fe(0,"button",0),Wn("click",function(){return f.goToMyLocation()}),Xu(),fe(1,"svg",1),qe(2,"path",2),ue(),Pe(3," Mi ubicacion "),ue())},styles:[".button[_ngcontent-%COMP%]{width:110px;height:30px;display:flex;align-items:center;justify-content:flex-start;gap:8px;background-color:#a585dd;border-radius:20px;color:#131313;font-weight:500;font-size:12px;border:none;position:absolute;cursor:pointer;transition-duration:.2s;box-shadow:5px 5px 10px #0000001e;padding-left:6px;transition-duration:.5s;bottom:420px;right:110px}.svgIcon[_ngcontent-%COMP%]{height:16px;transition-duration:1.5s}.bell[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#131313}.button[_ngcontent-%COMP%]:hover{background-color:#7145d6;transition-duration:.5s}.button[_ngcontent-%COMP%]:active{transform:scale(.97);transition-duration:.2s}.button[_ngcontent-%COMP%]:hover   .svgIcon[_ngcontent-%COMP%]{transform:rotate(250deg);transition-duration:1.5s}"]})};var sx=class i{constructor(){}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=Rn({type:i,selectors:[["app-search-results"]],standalone:!0,features:[On],decls:10,vars:0,consts:[[1,"alet","alet-primary","mt-2","text-center"],[1,"spinner-border","spinner-border-sm"],[1,"list-group","mt-2"],[1,"list-group-item","list-group-item-action","pointer"],[1,"btn","btn-outline-primary","btn-sm"]],template:function(a,f){a&1&&(fe(0,"div",0),qe(1,"span",1),ue(),fe(2,"ul",2)(3,"li",3)(4,"h6"),Pe(5,"Lugar"),ue(),fe(6,"p"),Pe(7,"Descripci\xF3n"),ue(),fe(8,"button",4),Pe(9,"Direcciones"),ue()()())},styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}p[_ngcontent-%COMP%]{font-size:12px}.list-group-item[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-bottom:1px solid #f0f0f0;border-radius:0;font-size:14px;color:#333;transition:.3s;width:220px}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:0;font-size:14px;color:#310eca;transition:.3s;position:relative;width:100%}"]})};var ax=class i{constructor(s){this.placesService=s}debounceTimer;onQueryChange(s=""){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.placesService.getPlacesQuery(s)},1e3)}static \u0275fac=function(a){return new(a||i)(St(js))};static \u0275cmp=Rn({type:i,selectors:[["app-search-bar"]],standalone:!0,features:[On],decls:13,vars:0,consts:[["txtQuery",""],[1,"form"],["for","search"],["required","","autocomplete","off","placeholder","Buscar Lugar","id","search","type","text",3,"keyup"],[1,"icon"],["stroke-width","2","stroke","currentColor","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"swap-on"],["d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","stroke-linejoin","round","stroke-linecap","round"],["stroke-width","2","stroke","currentColor","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"swap-off"],["d","M10 19l-7-7m0 0l7-7m-7 7h18","stroke-linejoin","round","stroke-linecap","round"],["type","reset",1,"close-btn"],["viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg",1,"h-5","w-5"],["clip-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","fill-rule","evenodd"]],template:function(a,f){if(a&1){let x=Wm();fe(0,"form",1)(1,"label",2)(2,"input",3,0),Wn("keyup",function(){jm(x);let R=K0(3);return Um(f.onQueryChange(R.value))}),ue(),fe(4,"div",4),Xu(),fe(5,"svg",5),qe(6,"path",6),ue(),fe(7,"svg",7),qe(8,"path",8),ue()(),Gm(),fe(9,"button",9),Xu(),fe(10,"svg",10),qe(11,"path",11),ue()()(),Gm(),qe(12,"app-search-results"),ue()}},dependencies:[sx],styles:[".form[_ngcontent-%COMP%]{--input-bg: #FFf;--padding: 1.5em;--rotate: 80deg;--gap: 2em;--icon-change-color: #15A986;--height: 40px;width:220px;padding-inline-end:1em;background:var(--input-bg);position:absolute;border-radius:4px;left:670px;bottom:280px}.form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;height:var(--height)}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-inline-start:calc(var(--padding) + var(--gap));outline:none;background:none;border:0}.form[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#111;transition:.3s cubic-bezier(.4,0,.2,1);position:absolute;height:15px}.icon[_ngcontent-%COMP%]{position:absolute;left:var(--padding);transition:.3s cubic-bezier(.4,0,.2,1);display:flex;justify-content:center;align-items:center}.swap-off[_ngcontent-%COMP%]{transform:rotate(-80deg);opacity:0;visibility:hidden}.close-btn[_ngcontent-%COMP%]{background:none;border:none;right:calc(var(--padding) - var(--gap));box-sizing:border-box;display:flex;align-items:center;justify-content:center;color:#111;padding:.1em;width:20px;height:20px;border-radius:50%;transition:.3s;opacity:0;transform:scale(0);visibility:hidden}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus ~ .icon[_ngcontent-%COMP%]{transform:rotate(var(--rotate)) scale(1.3)}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus ~ .icon[_ngcontent-%COMP%]   .swap-off[_ngcontent-%COMP%]{opacity:1;transform:rotate(-80deg);visibility:visible;color:var(--icon-change-color)}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus ~ .icon[_ngcontent-%COMP%]   .swap-on[_ngcontent-%COMP%]{opacity:0;visibility:visible}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:valid ~ .icon[_ngcontent-%COMP%]{transform:scale(1.3) rotate(var(--rotate))}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:valid ~ .icon[_ngcontent-%COMP%]   .swap-off[_ngcontent-%COMP%]{opacity:1;visibility:visible;color:var(--icon-change-color)}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:valid ~ .icon[_ngcontent-%COMP%]   .swap-on[_ngcontent-%COMP%]{opacity:0;visibility:visible}.form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:valid ~ .close-btn[_ngcontent-%COMP%]{opacity:1;visibility:visible;transform:scale(1);transition:0s}"]})};function q6(i,s){i&1&&qe(0,"app-loading")}function W6(i,s){i&1&&qe(0,"app-map-view")(1,"app-btn-my-location")(2,"app-search-bar")}var lx=class i{constructor(s){this.placeService=s}ngOnInit(){}get isUserLocationReady(){return this.placeService.isUserLocationReady}static \u0275fac=function(a){return new(a||i)(St(js))};static \u0275cmp=Rn({type:i,selectors:[["app-map-screen"]],standalone:!0,features:[On],decls:11,vars:2,consts:[["mapReady",""],["lang","es"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["http-equiv","X-UA-Compatible","content","IE=edge"],[4,"ngIf","ngIfElse"]],template:function(a,f){if(a&1&&(fe(0,"html",1)(1,"head"),qe(2,"meta",2)(3,"meta",3)(4,"meta",4),fe(5,"title"),Pe(6,"Map - CampusRide"),ue()(),fe(7,"body"),yi(8,q6,1,0,"app-loading",5)(9,W6,3,0,"ng-template",null,0,BA),ue()()),a&2){let x=K0(10);Ft(8),qt("ngIf",!f.isUserLocationReady)("ngIfElse",x)}},dependencies:[nx,rx,Bs,Mc,ox,ax]})};var FE=[{path:"",pathMatch:"full",redirectTo:"home"},{path:"login",component:qv},{path:"registro",component:Wv},{path:"bike",component:Zv},{path:"password-recovery",component:Xv},{path:"new-password/:correo",component:Yv},{path:"home",component:Jv},{path:"slider",component:Tf},{path:"edit-driver",component:Qv},{path:"edit-passenger",component:ex},{path:"auntentication-login",component:tx},{path:"map",component:lx},{path:"**",redirectTo:"home"}],cO=class i{static \u0275fac=function(a){return new(a||i)};static \u0275mod=is({type:i});static \u0275inj=ns({imports:[PE.forRoot(FE,{useHash:!0}),PE]})};var uO={production:!0,apiKey:"pk.eyJ1IjoiamVzc3ZpbGxhMTk3NSIsImEiOiJjbTN6N29kZG8xOWh1Mmtwc21kOXY3NHlmIn0.HzSxs5C37iEUIU2pDlJyuQ"};var dO=nI(LE());dO.default.accessToken="pk.eyJ1IjoiamVzc3ZpbGxhMTk3NSIsImEiOiJjbTN6N29kZG8xOWh1Mmtwc21kOXY3NHlmIn0.HzSxs5C37iEUIU2pDlJyuQ";vP(Hv,{providers:[HR(FE),uP(),Pw(Ji)]}).catch(i=>console.error(i));uO.production&&void 0;if(!navigator.geolocation)throw alert("Geolocation is not supported by your browser"),new Error("Geolocation is not supported by your browser");
